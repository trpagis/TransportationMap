// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
/*
 jQuery Knob*/
require({cache:{"widgets/Visibility/js/VisibilityControl":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/event dojo/Deferred dojo/_base/lang dojo/_base/array dojo/on dojo/number dojo/string dojo/dom-style dojo/mouse dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!../templates/VisibilityControl.html jimu/dijit/Message esri/dijit/util/busyIndicator esri/graphic esri/layers/GraphicsLayer esri/tasks/FeatureSet esri/graphicsUtils esri/symbols/SimpleMarkerSymbol esri/renderers/SimpleRenderer esri/Color esri/dijit/analysis/CreateViewshed esri/layers/FeatureLayer esri/geometry/Polygon esri/geometry/geometryEngine ./geometryUtils jimu/dijit/CoordinateControl ./util jimu/utils dojo/keys dijit/focus ./portal-publish dojo/dom-class dojo/dom-construct esri/renderers/UniqueValueRenderer jimu/LayerStructure ../js/symbologySettings esri/tasks/GeometryService dijit/form/NumberTextBox jimu/dijit/CheckBox ./jquery.knob.min".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I,K,Q,N,T,W,X,ea,fa,J,V,aa,Z,L){return H([d,h,p],{templateString:q,baseClass:"jimu-widget-visibility-control",FOV:180,LA:180,map:null,_currentOpenPanel:"mainPage",portalPublishObj:null,_renderer:null,Azimuth1:null,Azimuth2:null,graphics:null,_layerList:null,fillStyles:null,lineStyles:null,constructor:function(O){H.safeMixin(this,O);this.nls=O.nls},postCreate:function(){this.openAtStartAysn=!0;this.fillStyles={esriSFSBackwardDiagonal:"backwarddiagonal",
esriSFSCross:"cross",esriSFSDiagonalCross:"diagonalcross",esriSFSForwardDiagonal:"forwarddiagonal",esriSFSHorizontal:"horizontal",esriSFSNull:"none",esriSFSSolid:"solid",esriSFSVertical:"vertical"};this.lineStyles={esriSLSDash:"dash",esriSLSDashDot:"dashdot",esriSLSDashDotDot:"longdashdotdot",esriSLSDot:"dot",esriSLSLongDash:"longdash",esriSLSLongDashDot:"longdashdot",esriSLSNull:"none",esriSLSShortDash:"shortdash",esriSLSShortDashDot:"shortdashdot",esriSLSShortDashDotDot:"shortdashdotdot",esriSLSShortDot:"shortdot",
esriSLSSolid:"solid"};var O=[],D;l.forEach("meters kilometers miles feet yards nauticalMiles".split(" "),m.hitch(this,function(R){D={value:R,label:window.jimuNls.units[R]};O.push(D)}));this.observerHeightDD.addOption(O);this.utils=new N({appConfig:this.appConfig,nls:this.nls});this.distanceUnitDD.addOption(m.clone(O));this.config.hasOwnProperty("observeHeight")&&this.observerHeight.setValue(this.config.observeHeight);this.config.hasOwnProperty("minimumObservableDistanceValue")&&this.minObsRange.setValue(this.config.minimumObservableDistanceValue);
this.config.hasOwnProperty("maximumObservableDistanceValue")&&this.maxObsRange.setValue(this.config.maximumObservableDistanceValue);this.observerHeightDD.set("value",this.config.defaultObserverHeightUnit);this.distanceUnitDD.set("value",this.config.defaultObservableDistanceUnit);this.angleUnits.setValue(this.config.defaultAngleUnits);if(this.portalUrl){this._initGL();this._createSettings();this._layerList=this._getAllMapLayers();this._ptSym=new F(this.pointSymbol);var P=new y(this._ptSym);this._observerLocation=
new x({id:"observerLocation"});this._observerLocation.spatialReference=this.map.spatialReference;this._observerLocation.setRenderer(P);this.map.addLayer(this._observerLocation);this.distanceUnit=this.distanceUnitDD.get("value");this.observerHeightUnit=this.observerHeightDD.get("value");this.inputControl=new Q({parentWidget:this.parentWidget,label:this.nls.observerLocation,input:!0,showCopyButton:!1,showFormatButton:!0,showDrawPoint:!0,drawButtonLabel:this.nls.addPointToolTip,graphicsLayer:this._observerLocation});
this.inputControl.placeAt(this.observerCoordsContainer);this.inputControl.startup();this._syncEvents();this.minObsRange.invalidMessage=this.nls.invalidMessage;this.minObsRange.rangeMessage=this.nls.minimumRangeMessage;this.maxObsRange.invalidMessage=this.nls.invalidMessage;this.maxObsRange.rangeMessage=this.nls.maximumRangeMessage;this.observerHeight.invalidMessage=this.nls.invalidMessage;this.observerHeight.rangeMessage=this.nls.observerRangeMessage}else this._showPortalURLError(this.nls.portalURLError);
this.resetInputColor();setTimeout(m.hitch(this,function(){this._suppoprtAccessibility()}),100)},startup:function(){this.busyIndicator=v.create({target:this.domNode.parentNode.parentNode.parentNode,backgroundOpacity:0});this.FOVInput.id="fovinput"+this.parentWidget.id;var O=m.hitch(this,function(D,P,R){this.LA=this.angleUnits.checked?D/17.777777777778:D;this.FOV=Math.round(P);this.tooltip.innerHTML=this.angleUnits.checked?$("#"+this.FOVInput.id).val()+" "+this.nls.milsLabel:R+" "+this.nls.degreesLabel});
$("#"+this.FOVInput.id).knob({min:0,max:360,cursor:360,width:160,height:160,draw:function(){O(this.v,this.o.cursor,this.cv);window.isRTL&&this.i.css({"margin-right":"-"+(3*this.w/4+2>>0)+"px","margin-left":"auto"})}})},destroy:function(){this.map.removeLayer(this._observerLocation);this.map.removeLayer(this.graphicsLayer)},_showPortalURLError:function(O){f.set(this.controls,"display","none");f.set(this.buttonContainer,"display","none");this.errorText.innerHTML=O;f.set(this.errorText,"display","")},
_initGL:function(){this.graphicsLayer=new x;this.graphicsLayer.name="Viewshed Layer";this.map.addLayer(this.graphicsLayer)},_syncEvents:function(){this.own(b(this.btnCreate,"click",m.hitch(this,this.createButtonWasClicked)),b(this.btnCreate,"keydown",m.hitch(this,function(O){O.keyCode!==W.ENTER&&O.keyCode!==W.SPACE||this.createButtonWasClicked()})),b(this.btnClear,"click",m.hitch(this,function(){fa.add(this.saveToLayerIcon,"esriCTHidden");this.onClearBtnClicked();this._suppoprtAccessibility()})),
b(this.btnClear,"keydown",m.hitch(this,function(O){if(O.keyCode===W.ENTER||O.keyCode===W.SPACE)fa.add(this.saveToLayerIcon,"esriCTHidden"),this.onClearBtnClicked(),this._suppoprtAccessibility()})),b(this.minObsRange,"change",m.hitch(this,this.minObsRangeKeyWasPressed)),b(this.FOVInput,"mousemove",m.hitch(this,this.mouseMoveOverFOVInput)),b(this.FOVInput,e.leave,m.hitch(this,this.mouseMoveOutFOVInput)),b(this.FOVGroup,e.leave,m.hitch(this,function(){this.tooltip.hidden=!0})),b(this.FOVGroup,e.enter,
m.hitch(this,this.mouseMoveOverFOVGroup)),b(this.FOVInput,e.enter,m.hitch(this,function(){this.tooltip.hidden=!0})),b(this.FOVInput,"keypress",m.hitch(this,function(O){isNaN(O.key)&&13!==O.charCode&&n.stop(O)})),this.angleUnits.on("change",m.hitch(this,this.angleUnitsDidChange)),this.observerHeightDD.on("change",m.hitch(this,this.distanceUnitDDDidChange)),this.distanceUnitDD.on("change",m.hitch(this,this.distanceUnitDDDidChange)),b(this.inputControl.dt,"DrawComplete",m.hitch(this,function(){this.feedbackDidComplete();
X.focus(this.inputControl.coordtext)})),b(this.inputControl,"get-coordinate-complete",m.hitch(this,this.feedbackDidComplete)),b(this.saveToLayerIcon,"click",m.hitch(this,function(){fa.contains(this.saveToLayerIcon,"esriCTHidden")||this._showPanel("publishPage")})),b(this.saveToLayerIcon,"keydown",m.hitch(this,function(O){if(O.keyCode===W.ENTER||O.keyCode===W.SPACE)fa.contains(this.saveToLayerIcon,"esriCTHidden")||this._showPanel("publishPage")})),b(this.settingsIcon,"click",m.hitch(this,function(){fa.contains(this.settingsIcon,
"esriCTHidden")||this._showPanel("settingsPage")})),b(this.settingsIcon,"keydown",m.hitch(this,function(O){if(O.keyCode===W.ENTER||O.keyCode===W.SPACE)fa.contains(this.settingsIcon,"esriCTHidden")||this._showPanel("settingsPage")})),b(this.settingsPanelBackButton,"click",m.hitch(this,function(){fa.contains(this.settingsPanelBackButton,"esriCTHidden")||(this._SettingsInstance.onSettingsChanged(),this._showPanel("mainPage"))})),b(this.settingsPanelBackButton,"keydown",m.hitch(this,function(O){O.keyCode!==
W.ENTER&&O.keyCode!==W.SPACE||fa.contains(this.settingsPanelBackButton,"esriCTHidden")||(this._SettingsInstance.onSettingsChanged(),this._showPanel("mainPage"))})))},minObsRangeKeyWasPressed:function(){this.minObsRange.isValid()&&(this.maxObsRange.constraints.min=Number(this.minObsRange.value)+.001,this.maxObsRange.set("value",Number(this.minObsRange.value)+1))},mouseMoveOverFOVGroup:function(){!1===this.FOVInput.disabled&&(this.mouseMoveOverFOVInput(),this.tooltip.hidden=!1)},mouseMoveOverFOVInput:function(){var O=
this.tooltip;!1===this.FOVInput.disabled&&$(document).ready(function(){$(document).mousemove(function(D){f.set(O,{left:D.pageX+10+"px",top:D.pageY+10+"px"})})})},mouseMoveOutFOVInput:function(){this.tooltip.hidden=!1;this.FOVInput.blur()},angleUnitsDidChange:function(){this.angleUnits.checked?($("#"+this.FOVInput.id).trigger("configure",{max:6400,units:"mils",milsValue:6400}),$("#"+this.FOVInput.id).val(6400).trigger("change")):($("#"+this.FOVInput.id).trigger("configure",{max:360,units:"degrees",
milsValue:6400}),$("#"+this.FOVInput.id).val(360).trigger("change"));this.resetInputColor()},distanceUnitDDDidChange:function(){var O="",D={};this.distanceUnit=this.distanceUnitDD.get("value");this.observerHeightUnit=this.observerHeightDD.get("value");if(this.distanceUnit){switch(this.distanceUnit){case "miles":D.max=31;break;case "nauticalMiles":D.max=26.9383;break;case "kilometers":D.max=50;break;case "yards":D.max=54680;break;case "feet":D.max=164041;break;case "meters":D.max=5E4}O=c.substitute(this.nls.maximumRangeMessage,
{units:window.jimuNls.units[this.distanceUnit],limit:a.format(D.max,{places:2,locale:k.locale})});D.min=Number(this.minObsRange.value)+.001;this.maxObsRange.set("constraints",D);this.maxObsRange.set("rangeMessage",O)}},feedbackDidComplete:function(){this.inputControl.deactivateDrawTool();this.map.enableMapNavigation();this.enableFOVDial()},enableFOVDial:function(){this.FOVInput.disabled&&(this.FOVInput.disabled=!1,$("#"+this.FOVInput.id).trigger("configure",{fgColor:"#00ff66",bgColor:"#f37371",inputColor:"#ccc"}));
this.resetInputColor()},_createWedgesUsingBuffers:function(O,D,P,R){D=B.getGeometries(D);R=I.geodesicBuffer(D,[R],"meters",!0);0<P?(P=I.geodesicBuffer(D,[P],"meters",!0),R=I.difference(R[0],P[0])):R=R[0];O.resolve([R,R])},_createWedgesUsingAngles:function(O,D,P,R,ca,ha){D=D.geometry;var oa=[];var ma=[];this.Azimuth1=P>R?P-360:P;ha=K.getPointsForArc(P,R,D,ha);ma.push([D.x,D.y]);l.forEach(ha,function(da){ma.push([da.x,da.y])});ma.push([D.x,D.y]);if(0<ca){var U=K.getDestinationPoint(D,P,ca);P=K.getPointsForArc(P,
R,D,ca);oa.push([U.x,U.y]);l.forEach(ha,function(da){oa.push([da.x,da.y])});P.reverse();l.forEach(P,function(da){oa.push([da.x,da.y])});oa.push([U.x,U.y])}else oa=ma;P=new G(oa);P.setSpatialReference(D.spatialReference);R=new G(ma);R.setSpatialReference(D.spatialReference);O.resolve([P,R])},_createWedges:function(O,D,P){var R=new r;this.Azimuth1=parseInt(this.LA-this.FOV/2,10);0>this.Azimuth1&&(this.Azimuth1+=360);this.Azimuth2=parseInt(this.LA+this.FOV/2,10);360<this.Azimuth2&&(this.Azimuth2-=360);
360===this.FOV?(this.Azimuth1=0,this.Azimuth2=360,this._createWedgesUsingBuffers(R,O,D,P)):this._createWedgesUsingAngles(R,O[0],this.Azimuth1,this.Azimuth2,D,P);return R.promise},_getFeatureCollectionLayer:function(O){l.forEach(O,m.hitch(this,function(D,P){D.attributes={};D.attributes.ObjectID=P}));return new z({featureSet:{features:O,geometryType:"esriGeometryPoint"},layerDefinition:{name:"InputLayer",geometryType:"esriGeometryPoint",objectIdField:"ObjectID",fields:[{name:"ObjectID",alias:"ObjectID",
type:"esriFieldTypeOID"}]}})},_initAnalysisProcess:function(O){this._createWedges(O.InputObserver.features,O.MinimumRadius,O.MaximumRadius).then(m.hitch(this,function(D){var P=[];if(D&&2===D.length){var R=this.appConfig.geometryService;var ca=new L(R);R=K.getProjectedGeometry(D[0],this.map.spatialReference,ca).then(m.hitch(this,function(ha){this._wedgeGeometry=ha}));P.push(R);D=K.getProjectedGeometry(D[1],this.map.spatialReference,ca).then(m.hitch(this,function(ha){this._fullWedgeGeometry=ha}));P.push(D);
g(P).then(m.hitch(this,function(){this._createViewShed(O)}))}}))},_createViewShed:function(O){O={portalUrl:this.portalUrl,inputLayer:this._getFeatureCollectionLayer(O.InputObserver.features),maxDistanceUnits:"Meters",maximumDistance:O.MaximumRadius,observerHeightUnits:"Meters",observerHeight:O.ObserverHeight,showSelectAnalysisLayer:!1,targetHeightUnits:"Meters",map:this.map,showChooseExtent:!1,returnFeatureCollection:!0};O=new A(O);O.startup();O.on("job-result",m.hitch(this,this._onViewShedCreated));
O.on("job-status",m.hitch(this,function(D){"esriJobFailed"===D.jobStatus&&this._showJobError(D)}));O.on("job-fail",m.hitch(this,this._showJobError));O._form.validate()?(this.busyIndicator.show(),O._handleSaveBtnClick()):new u({message:this.nls.validationError})},_showJobError:function(O){new u({message:O.message});this.busyIndicator.hide()},_onViewShedCreated:function(O){var D=[];l.forEach(O.value.featureSet.features,m.hitch(this,function(P){P=new G(P.geometry);P.setSpatialReference(this.map.spatialReference);
(P=I.difference(this._wedgeGeometry,P))&&(P=I.difference(this._wedgeGeometry,P));P=new t(P);P.setAttributes({type:1});D.push(P)}));this._showGraphicsOnMap(D)},_drawWedge:function(O,D){for(var P=new r,R=0,ca=O.length;R<ca;R++){var ha=O[R];ha&&ha.geometry&&(D?ha.setAttributes({type:2}):ha.setAttributes({type:3}),this.graphicsLayer.add(ha))}P.resolve("success");return P.promise},_drawViewshed:function(O){var D=new r;this.graphics=[];var P=new t(this._wedgeGeometry);P.setAttributes({type:0,regionType:"nonVisible"});
for(var R=0,ca=O.length;R<ca;R++){var ha=O[R];if(ha&&ha.geometry){var oa=ha.geometry;ha.setAttributes({type:1,regionType:"visible"});var ma=ha;this.graphicsLayer.add(ha)}}oa&&(this.graphics.push(ma),O=I.difference(this._wedgeGeometry,oa),P=new t(O),P.setAttributes({type:0,regionType:"nonVisible"}));this.graphics.push(P);this.graphicsLayer.add(P);D.resolve("success");return D.promise},_showGraphicsOnMap:function(O){this._drawWedge([new t(this._fullWedgeGeometry)],!0);this._drawWedge([new t(this._wedgeGeometry)],
!1);this._drawViewshed(O).then(m.hitch(this,function(){this.map.setExtent(B.graphicsExtent(this.graphicsLayer.graphics),!0);fa.remove(this.saveToLayerIcon,"esriCTHidden");this.busyIndicator.hide();this._createPortalPublishUI();this._suppoprtAccessibility()}))},createButtonWasClicked:function(){if(this.inputControl.getMapCoordinateDD()&&this.minObsRange.isValid()&&this.maxObsRange.isValid()&&this.observerHeight.isValid()&&0!==parseInt(this.FOVInput.value,10)&&!isNaN(parseInt(this.FOVInput.value,10))){var O=
new t(this.inputControl.getMapCoordinateDD()),D=new C;D.features=[O];O={InputObserver:D,MinimumRadius:this.utils.convertToMeters(this.minObsRange.value,this.distanceUnit),MaximumRadius:this.utils.convertToMeters(this.maxObsRange.value,this.distanceUnit),ObserverHeight:this.utils.convertToMeters(this.observerHeight.value,this.observerHeightUnit)};this._initAnalysisProcess(O)}else new u({message:this.nls.validationError})},onClearBtnClicked:function(){this.angleUnits&&(this.angleUnits.setValue(this.config.defaultAngleUnits),
this.observerHeightDD.set("value",this.config.defaultObserverHeightUnit),this.distanceUnitDD.set("value",this.config.defaultObservableDistanceUnit),this.config.hasOwnProperty("observeHeight")&&this.observerHeight.setValue(this.config.observeHeight),this.config.hasOwnProperty("minimumObservableDistanceValue")&&this.minObsRange.setValue(this.config.minimumObservableDistanceValue),this.config.hasOwnProperty("maximumObservableDistanceValue")&&setTimeout(m.hitch(this,function(){this.maxObsRange.setValue(this.config.maximumObservableDistanceValue)}),
100),this.minObsRangeKeyWasPressed(),this.graphicsLayer.clear(),this.inputControl.clear(),this.FOVInput.disabled=!0,this.angleUnitsDidChange(),$("#"+this.FOVInput.id).trigger("configure",{fgColor:"#ccc",bgColor:"#ccc",inputColor:"#ccc"}),this.tooltip.hidden=!0,this.resetInputColor())},resetInputColor:function(){setTimeout(m.hitch(this,function(){f.set(this.FOVInput,"color","gray")}),100)},_suppoprtAccessibility:function(){"mainPage"===this._currentOpenPanel&&(T.initFirstFocusNode(this.parentWidget.domNode,
this.settingsIcon),T.isAutoFocusFirstNodeWidget(this)&&X.focus(this.settingsIcon),T.initLastFocusNode(this.parentWidget.domNode,this.btnClear));"publishPage"===this._currentOpenPanel&&this.portalPublishObj._setFirstLastFocusNodes();"settingsPage"===this._currentOpenPanel&&(T.initFirstFocusNode(this.parentWidget.domNode,this.settingsPanelBackButton),this._SettingsInstance._setLastFocusNode())},_createPortalPublishUI:function(){this.portalPublishObj=new ea({config:this.config,appConfig:this.appConfig,
graphicsLayer:this.graphicsLayer,graphics:this.graphics,_renderer:this._renderer,map:this.map,nls:this.nls,parentNode:this.parentWidget.domNode,observerHeight:this.observerHeight.value,minObsRange:this.minObsRange.value,maxObsRange:this.maxObsRange.value,distanceUnitDD:this.distanceUnitDD.getOptions(this.distanceUnitDD.value).label,observerHeightDD:this.observerHeightDD.getOptions(this.observerHeightDD.value).label,angleUnits:this.nls.degreesLabel,centerPoint:this.inputControl.coordtext.value,fovStartAngle:this.Azimuth1,
fovEndAngle:this.Azimuth2,_layerList:this._layerList});J.empty(this.portalPublishContainer);this.portalPublishObj.placeAt(this.portalPublishContainer);this.portalPublishObj.startup();this.own(b(this.portalPublishObj,"displayMainPageOnBack",m.hitch(this,function(){this._showPanel("mainPage")})));this._showPanel("publishPage")},_showPanel:function(O){if(this._currentOpenPanel){var D=this._getNodeByName(this._currentOpenPanel);fa.add(D,"esriCTHidden")}D=this._getNodeByName(O);fa.remove(D,"esriCTHidden");
this._lastOpenPanel=this._currentOpenPanel;this._currentOpenPanel=O;this._suppoprtAccessibility()},_getNodeByName:function(O){switch(O){case "mainPage":var D=this.visibiltyWidget;break;case "publishPage":D=this.portalPublishContainer;break;case "settingsPage":D=this.settingsContainer}return D},_createRendererForPublishLayer:function(O){var D=new w(O.visibleSectionFillColor.color),P=255*(1-O.visibleSectionFillColor.transparency),R=new w(O.visibleSectionOutlineColor.color),ca=255*(1-O.visibleSectionOutlineColor.transparency),
ha=new w(O.nonVisibleSectionFillColor.color),oa=255*(1-O.nonVisibleSectionFillColor.transparency),ma=new w(O.nonVisibleSectionOutlineColor.color);this._renderer=new V({type:"uniqueValue",field1:"RegionType",uniqueValueInfos:[{value:1,symbol:{color:[D.r,D.g,D.b,P],outline:{color:[R.r,R.g,R.b,ca],width:.75,type:"esriSLS",style:O.visibleSectionOutlineColor.type},type:"esriSFS",style:O.visibleSectionFillColor.type}},{value:0,symbol:{color:[ha.r,ha.g,ha.b,oa],outline:{color:[ma.r,ma.g,ma.b,255*(1-O.nonVisibleSectionOutlineColor.transparency)],
width:1,type:"esriSLS",style:O.nonVisibleSectionOutlineColor.type},type:"esriSFS",style:O.nonVisibleSectionFillColor.type}}]});this._renderer.removeValue("others")},_createRendererForGraphicsLayer:function(O){var D=new w(O.visibleSectionFillColor.color),P=255*(1-O.visibleSectionFillColor.transparency),R=new w(O.visibleSectionOutlineColor.color),ca=255*(1-O.visibleSectionOutlineColor.transparency),ha=new w(O.nonVisibleSectionFillColor.color),oa=255*(1-O.nonVisibleSectionFillColor.transparency),ma=
new w(O.nonVisibleSectionOutlineColor.color);O=new V({type:"uniqueValue",field1:"type",uniqueValueInfos:[{value:1,symbol:{color:[D.r,D.g,D.b,P],outline:{color:[R.r,R.g,R.b,ca],width:.75,type:"esriSLS",style:O.visibleSectionOutlineColor.type},type:"esriSFS",style:O.visibleSectionFillColor.type}},{value:0,symbol:{color:[ha.r,ha.g,ha.b,oa],outline:{color:[ma.r,ma.g,ma.b,255*(1-O.nonVisibleSectionOutlineColor.transparency)],width:1,type:"esriSLS",style:O.nonVisibleSectionOutlineColor.type},type:"esriSFS",
style:O.nonVisibleSectionFillColor.type}},{value:2,symbol:{color:[0,0,0,0],outline:{color:[0,0,0,1],width:1,type:"esriSLS",style:"esriSLSDash"},type:"esriSFS",style:"esriSFSSolid"}},{value:3,symbol:{color:[0,0,0,0],outline:{color:[255,0,0,1],width:1,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]});O.removeValue("others");this.graphicsLayer.setRenderer(O);this.graphicsLayer.refresh()},_getAllMapLayers:function(){var O=[];aa.getInstance().traversal(function(D){"undefined"!==
typeof D._layerInfo.layerObject.type&&-1===D._layerInfo.layerObject.type.indexOf("tile")&&"esriGeometryPolygon"===D._layerInfo.layerObject.geometryType&&O.push(D._layerInfo.layerObject)});return O},_createSettings:function(){this._SettingsInstance=new Z({nls:this.nls,config:this.config,appConfig:this.appConfig,refDomNode:this.parentWidget.domNode},J.create("div",{},this.symbologySettingsNode));this.own(this._SettingsInstance.on("settingsChanged",m.hitch(this,function(O){this._createRendererForPublishLayer(O);
this._createRendererForGraphicsLayer(O)})));this._SettingsInstance.startup()}})})},"esri/dijit/util/busyIndicator":function(){define("dijit/registry dojo/_base/lang dojo/_base/window dojo/dom dojo/dom-construct dojox/widget/Standby require".split(" "),function(H,k,n,r,m,l,b){var a={_defaultStandbyParams:{image:b.toUrl("../images/loading-throb.gif"),color:"#fff",opacity:.75,duration:200},create:function(c){if(c=this._normalizeParams(c))return c=new l(a._toStandbyParams(c)),m.place(c.domNode,n.doc.body),
a._createHandle(c)},_normalizeParams:function(c){if(c){if(c.target)return c;if("string"===typeof c){var f=H.byId(c);c=f?f.domNode:r.byId(c)}else c=c.domNode?c.domNode:r.byId(c);if(c)return{target:c}}},_toStandbyParams:function(c){c.imageUrl&&(c.image=c.imageUrl);c.backgroundColor&&(c.color=c.backgroundColor);c.backgroundOpacity&&(c.opacity=c.backgroundOpacity);c.fadeDuration&&(c.duration=c.fadeDuration);return k.mixin({},a._defaultStandbyParams,c)},_createHandle:function(c){return{show:function(){c&&
c.show()},hide:function(){c&&c.hide()},destroy:function(){c&&(c.destroy(),c=null)}}}};return a})},"dojox/widget/Standby":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/window dojo/_base/window dojo/_base/fx dojo/fx dijit/_Widget dijit/_TemplatedMixin dijit/registry".split(" "),function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u){H.experimental("dojox.widget.Standby");
return k("dojox.widget.Standby",[p,q],{image:require.toUrl("dojox/widget/Standby/images/loading.gif").toString(),imageText:"Please Wait...",text:"Please wait...",centerIndicator:"image",target:"",color:"#C0C0C0",duration:500,zIndex:"auto",opacity:.75,templateString:'\x3cdiv\x3e\x3cdiv style\x3d"display: none; opacity: 0; z-index: 9999; position: absolute; cursor:wait;" dojoAttachPoint\x3d"_underlayNode"\x3e\x3c/div\x3e\x3cimg src\x3d"${image}" style\x3d"opacity: 0; display: none; z-index: -10000; position: absolute; top: 0px; left: 0px; cursor:wait;" dojoAttachPoint\x3d"_imageNode"\x3e\x3cdiv style\x3d"opacity: 0; display: none; z-index: -10000; position: absolute; top: 0px;" dojoAttachPoint\x3d"_textNode"\x3e\x3c/div\x3e\x3c/div\x3e',
_underlayNode:null,_imageNode:null,_textNode:null,_centerNode:null,_displayed:!1,_resizeCheck:null,_started:!1,_parent:null,startup:function(v){if(!this._started){if("string"===typeof this.target){var t=u.byId(this.target);this.target=t?t.domNode:l.byId(this.target)}this.text&&(this._textNode.innerHTML=this.text);"image"===this.centerIndicator?(this._centerNode=this._imageNode,b.set(this._imageNode,"src",this.image),b.set(this._imageNode,"alt",this.imageText)):this._centerNode=this._textNode;f.set(this._underlayNode,
{display:"none",backgroundColor:this.color});f.set(this._centerNode,"display","none");this.connect(this._underlayNode,"onclick","_ignore");this.domNode.parentNode&&this.domNode.parentNode!=g.body()&&g.body().appendChild(this.domNode);7==m("ie")&&(this._ieFixNode=a.create("div"),f.set(this._ieFixNode,{opacity:"0",zIndex:"-1000",position:"absolute",top:"-1000px"}),g.body().appendChild(this._ieFixNode));this.inherited(arguments)}},show:function(){this._displayed||(this._anim&&(this._anim.stop(),delete this._anim),
this._displayed=!0,this._size(),this._disableOverflow(),this._fadeIn())},hide:function(){if(this._displayed)try{this._anim&&(this._anim.stop(),delete this._anim),this._size()}catch(v){console.error(v)}finally{this._fadeOut(),this._displayed=!1,null!==this._resizeCheck&&(clearInterval(this._resizeCheck),this._resizeCheck=null)}},isVisible:function(){return this._displayed},onShow:function(){},onHide:function(){},uninitialize:function(){this._displayed=!1;this._resizeCheck&&clearInterval(this._resizeCheck);
f.set(this._centerNode,"display","none");f.set(this._underlayNode,"display","none");7==m("ie")&&this._ieFixNode&&(g.body().removeChild(this._ieFixNode),delete this._ieFixNode);this._anim&&(this._anim.stop(),delete this._anim);this._centerNode=this._textNode=this._imageNode=this.target=null;this.inherited(arguments)},_size:function(){if(this._displayed){var v=b.get(g.body(),"dir");v&&(v=v.toLowerCase());var t=this._scrollerWidths(),x=this.target,C=f.get(this._centerNode,"display");f.set(this._centerNode,
"display","block");var B=c.position(x,!0);if(x===g.body()||x===g.doc)B=e.getBox(),B.x=B.l,B.y=B.t;var F=c.getMarginBox(this._centerNode);f.set(this._centerNode,"display",C);if(this._ieFixNode){var y=-this._ieFixNode.offsetTop/1E3;B.x=Math.floor((B.x+.9)/y);B.y=Math.floor((B.y+.9)/y);B.w=Math.floor((B.w+.9)/y);B.h=Math.floor((B.h+.9)/y)}var w=f.get(x,"zIndex"),A=C=w;if("auto"===this.zIndex)if("auto"!=w)C=parseInt(C,10),A=parseInt(A,10);else{var z=x;if(z&&z!==g.body()&&z!==g.doc)for(z=x.parentNode,
y=-1E5;z&&z!==g.body();)(w=f.get(z,"zIndex"))&&"auto"!==w&&(w=parseInt(w,10),y<w&&(y=w,C=w+1,A=w+1)),z=z.parentNode}else C=parseInt(this.zIndex,10),A=parseInt(this.zIndex,10);f.set(this._centerNode,"zIndex",A);f.set(this._underlayNode,"zIndex",C);if((C=x.parentNode)&&C!==g.body()&&x!==g.body()&&x!==g.doc){z=B.h;A=B.w;x=c.position(C,!0);this._ieFixNode&&(y=-this._ieFixNode.offsetTop/1E3,x.x=Math.floor((x.x+.9)/y),x.y=Math.floor((x.y+.9)/y),x.w=Math.floor((x.w+.9)/y),x.h=Math.floor((x.h+.9)/y));x.w-=
C.scrollHeight>C.clientHeight&&0<C.clientHeight?t.v:0;x.h-=C.scrollWidth>C.clientWidth&&0<C.clientWidth?t.h:0;"rtl"===v&&(m("opera")?(B.x+=C.scrollHeight>C.clientHeight&&0<C.clientHeight?t.v:0,x.x+=C.scrollHeight>C.clientHeight&&0<C.clientHeight?t.v:0):m("ie")?x.x+=C.scrollHeight>C.clientHeight&&0<C.clientHeight?t.v:0:m("webkit"));x.w<B.w&&(B.w-=x.w);x.h<B.h&&(B.h-=x.h);var G=x.y,I=x.y+x.h,K=B.y,Q=B.y+z;v=x.x;y=x.x+x.w;w=B.x;var N=B.x+A;if(Q>G&&K<G)B.y=x.y,z-=G-K,B.h=z<x.h?z:B.h-2*(C.scrollWidth>
C.clientWidth&&0<C.clientWidth?t.h:0);else if(K<I&&Q>I)B.h=I-K;else if(Q<=G||K>=I)B.h=0;if(N>v&&w<v)B.x=x.x,A-=v-w,B.w=A<x.w?A:B.w-2*(C.scrollHeight>C.clientHeight&&0<C.clientHeight?t.w:0);else if(w<y&&N>y)B.w=y-w;else if(N<=v||w>=y)B.w=0}0<B.h&&0<B.w?(f.set(this._underlayNode,{display:"block",width:B.w+"px",height:B.h+"px",top:B.y+"px",left:B.x+"px"}),t=["borderRadius","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"],this._cloneStyles(t),m("ie")||(t=
"MozBorderRadius MozBorderRadiusTopleft MozBorderRadiusTopright MozBorderRadiusBottomleft MozBorderRadiusBottomright WebkitBorderRadius WebkitBorderTopLeftRadius WebkitBorderTopRightRadius WebkitBorderBottomLeftRadius WebkitBorderBottomRightRadius".split(" "),this._cloneStyles(t,this)),t=B.h/2-F.h/2,C=B.w/2-F.w/2,B.h>=F.h&&B.w>=F.w?f.set(this._centerNode,{top:t+B.y+"px",left:C+B.x+"px",display:"block"}):f.set(this._centerNode,"display","none")):(f.set(this._underlayNode,"display","none"),f.set(this._centerNode,
"display","none"));if(null===this._resizeCheck){var T=this;this._resizeCheck=setInterval(function(){T._size()},100)}}},_cloneStyles:function(v){n.forEach(v,function(t){f.set(this._underlayNode,t,f.get(this.target,t))},this)},_fadeIn:function(){var v=this,t=d.animateProperty({duration:v.duration,node:v._underlayNode,properties:{opacity:{start:0,end:v.opacity}}}),x=d.animateProperty({duration:v.duration,node:v._centerNode,properties:{opacity:{start:0,end:1}},onEnd:function(){v.onShow();delete v._anim}});
this._anim=h.combine([t,x]);this._anim.play()},_fadeOut:function(){var v=this,t=d.animateProperty({duration:v.duration,node:v._underlayNode,properties:{opacity:{start:v.opacity,end:0}},onEnd:function(){f.set(this.node,{display:"none",zIndex:"-1000"})}}),x=d.animateProperty({duration:v.duration,node:v._centerNode,properties:{opacity:{start:1,end:0}},onEnd:function(){f.set(this.node,{display:"none",zIndex:"-1000"});v.onHide();v._enableOverflow();delete v._anim}});this._anim=h.combine([t,x]);this._anim.play()},
_ignore:function(v){v&&r.stop(v)},_scrollerWidths:function(){var v=a.create("div");f.set(v,{position:"absolute",opacity:0,overflow:"hidden",width:"50px",height:"50px",zIndex:"-100",top:"-200px",padding:"0px",margin:"0px"});var t=a.create("div");f.set(t,{width:"200px",height:"10px"});v.appendChild(t);g.body().appendChild(v);t=c.getContentBox(v);f.set(v,"overflow","scroll");var x=c.getContentBox(v);g.body().removeChild(v);return{v:t.w-x.w,h:t.h-x.h}},_setTextAttr:function(v){this.text=this._textNode.innerHTML=
v},_setColorAttr:function(v){f.set(this._underlayNode,"backgroundColor",v);this.color=v},_setImageTextAttr:function(v){b.set(this._imageNode,"alt",v);this.imageText=v},_setImageAttr:function(v){b.set(this._imageNode,"src",v);this.image=v},_setCenterIndicatorAttr:function(v){this.centerIndicator=v;"image"===v?(this._centerNode=this._imageNode,f.set(this._textNode,"display","none")):(this._centerNode=this._textNode,f.set(this._imageNode,"display","none"))},_setTargetAttr:function(v){if("string"===typeof v){var t=
u.byId(v);this._set("target",t?t.domNode:l.byId(v))}else this._set("target",v)},_disableOverflow:function(){if(this.target===g.body()||this.target===g.doc){this._overflowDisabled=!0;var v=g.body();this._oldOverflow=v.style&&v.style.overflow?f.get(v,"overflow"):"";if(m("ie")&&!m("quirks")){if(v.parentNode&&v.parentNode.style&&v.parentNode.style.overflow)this._oldBodyParentOverflow=v.parentNode.style.overflow;else try{this._oldBodyParentOverflow=f.get(v.parentNode,"overflow")}catch(t){this._oldBodyParentOverflow=
"scroll"}f.set(v.parentNode,"overflow","hidden")}f.set(v,"overflow","hidden")}},_enableOverflow:function(){if(this._overflowDisabled){delete this._overflowDisabled;var v=g.body();m("ie")&&!m("quirks")&&(v.parentNode.style.overflow=this._oldBodyParentOverflow,delete this._oldBodyParentOverflow);f.set(v,"overflow",this._oldOverflow);if(m("webkit")){var t=a.create("div",{style:{height:"2px"}});v.appendChild(t);setTimeout(function(){v.removeChild(t)},0)}delete this._oldOverflow}}})})},"esri/dijit/analysis/CreateViewshed":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/json dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/number dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/TextBox dijit/form/NumberSpinner dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/form/FilteringSelect dijit/Dialog ../../kernel ../../lang ./AnalysisBase ./_AnalysisOptions ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ../../toolbars/draw ../PopupTemplate ../../layers/FeatureLayer ../../graphic ./utils ./AnalysisRegistry ./CreditEstimator ../../symbols/PictureMarkerSymbol dijit/form/HorizontalSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dojo/i18n!../../nls/jsapi dojo/text!./templates/CreateViewshed.html".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I,K,Q,N,T,W,X,ea,fa,J,V,aa,Z,L,O,D,P,R,ca,ha,oa,ma,U){H=k([u,v,t,x,C,ea,X],{declaredClass:"esri.dijit.analysis.CreateViewshed",templateString:U,widgetsInTemplate:!0,inputLayer:null,maximumDistance:15,maxDistanceUnits:"Kilometers",targetHeight:0,targetHeightUnits:"Meters",observerHeight:1.75,observerHeightUnits:"Meters",outputLayerName:null,i18n:null,map:null,toolName:"CreateViewshed",helpFileName:"CreateViewshed",resultParameter:"viewshedLayer",
constructor:function(da,na){na=da.distanceDefaultUnits||"Miles";this._pbConnects=[];da.containerNode&&(this.container=da.containerNode);this.maxDistanceUnits=da.maxDistanceUnits?da.maxDistanceUnits:na;this.maximumDistance=W.isDefined(da.maximumDistance)?da.maximumDistance:"Miles"===na?9:15;this.observerHeightUnits=da.observerHeightUnits?da.observerHeightUnits:"Miles"===na?"Feet":"Meters";this.observerHeight=W.isDefined(da.observerHeight)?da.observerHeight:"Miles"===na?6:1.75;this.targetHeightUnits=
da.targetHeightUnits?da.targetHeightUnits:"Miles"===na?"Feet":"Meters"},destroy:function(){this.inherited(arguments);r.forEach(this._pbConnects,m.disconnect);delete this._pbConnects},postMixInProperties:function(){this.inherited(arguments);n.mixin(this.i18n,ma.findHotSpotsTool);n.mixin(this.i18n,ma.createViewshedTool);this.set("drawPointLayerName",this.i18n.pointlayerName)},postCreate:function(){this.inherited(arguments);p.add(this._form.domNode,"esriSimpleForm");this._outputLayerInput.set("validator",
n.hitch(this,this.validateServiceName));this.showCredits=!1;this._buildUI()},startup:function(){},_handleModeCrumbClick:function(da){da.preventDefault();this._onClose(!0)},_onClose:function(da){da&&this._pointfeatureLayer&&(this.map.removeLayer(this._pointfeatureLayer),r.forEach(this.inputLayers,function(na,ia){na===this._pointfeatureLayer&&(this._analysisSelect.removeOption({value:ia+1,label:this._pointfeatureLayer.name}),this.inputLayers.splice(ia,1))},this));this._handleInputDrawPointChange(!1);
this.emit("close",{save:!da})},clear:function(){this._pointfeatureLayer&&(this.map.removeLayer(this._pointfeatureLayer),r.forEach(this.inputLayers,function(da,na){da===this._pointfeatureLayer&&(this._analysisSelect.removeOption({value:na+1,label:this._pointfeatureLayer.name}),this.inputLayers.splice(na,1))},this));this._handleInputDrawPointChange(!1)},_handleShowCreditsClick:function(da){da.preventDefault();da={};var na=this.get("observerHeight"),ia=this.get("targetHeight"),pa=this.get("maximumDistance");
this._form.validate()&&(da.inputLayer=b.toJson(this.constructAnalysisInputLyrObj(this.get("inputLayer"))),0<=pa&&(da.maximumDistance=pa,da.maxDistanceUnits=this.get("maxDistanceUnits")),0<=na&&(da.observerHeight=na,da.observerHeightUnits=this.get("observerHeightUnits")),0<=ia&&(da.targetHeight=ia,da.targetHeightUnits=this.get("targetHeightUnits")),this.returnFeatureCollection||(da.OutputName=b.toJson({serviceProperties:{name:this.get("outputLayerName")}})),this.returnFeatureCollection||(da.OutputName=
b.toJson({serviceProperties:{name:this.get("outputLayerName")}})),this.showChooseExtent&&this._useExtentCheck.get("checked")&&(da.context=b.toJson({extent:this.map.extent._normalize(!0)})),this.getCreditsEstimate(this.toolName,da).then(n.hitch(this,function(E){this._usageForm.set("content",E);this._usageDialog.show()})))},_handleSaveBtnClick:function(da){if(this._form.validate()){this._saveBtn.set("disabled",!0);da={};var na={};var ia=this.get("observerHeight");var pa=this.get("targetHeight"),E=this.get("maximumDistance");
da.inputLayer=b.toJson(this.constructAnalysisInputLyrObj(this.get("inputLayer")));0<=E&&(da.maximumDistance=E,da.maxDistanceUnits=this.get("maxDistanceUnits"));0<=ia&&(da.observerHeight=ia,da.observerHeightUnits=this.get("observerHeightUnits"));0<=pa&&(da.targetHeight=pa,da.targetHeightUnits=this.get("targetHeightUnits"));this.returnFeatureCollection||(da.OutputName=b.toJson({serviceProperties:{name:this.get("outputLayerName")}}));this.showChooseExtent&&!this.get("disableExtent")&&this._useExtentCheck.get("checked")&&
(da.context=b.toJson({extent:this.map.extent._normalize(!0)}));this.returnFeatureCollection&&(ia={outSR:this.map.spatialReference},this.showChooseExtent&&this._useExtentCheck.get("checked")&&(ia.extent=this.map.extent._normalize(!0)),da.context=b.toJson(ia));da.returnFeatureCollection=this.returnFeatureCollection;na.jobParams=da;na.itemParams={description:this.i18n.itemDescription,tags:f.substitute(this.i18n.itemTags,{layername:this.inputLayer.name,fieldname:da.field?da.field:""}),snippet:this.i18n.itemSnippet};
this.showSelectFolder&&(na.itemParams.folder=this.get("folderId"));this.execute(na)}},_save:function(){},_buildUI:function(){this._loadConnections();this.signInPromise.then(n.hitch(this,O.initHelpLinks,this.domNode,this.showHelp,{analysisGpServer:this.analysisGpServer}));var da=!0;this.get("showSelectAnalysisLayer")&&(this.inputLayers&&this.inputLayer&&!O.isLayerInLayers(this.inputLayer,this.inputLayers)&&(this.inputLayers.push(this.inputLayer),-1!==this.inputLayer.name.indexOf("Drawn Input Points")&&
(this.map.addLayer(this.inputLayer),this._pointfeatureLayer=this.inputLayer)),this.get("inputLayer")||!this.get("inputLayers")||this.rerun||this.set("inputLayer",this.inputLayers[0]),O.populateAnalysisLayers(this,"inputLayer","inputLayers",{posIncrement:1}));this.outputLayerName&&(this._outputLayerInput.set("value",this.outputLayerName),da=!1);O.addReadyToUseLayerOption(this,[this._analysisSelect]);this._updateAnalysisLayerUI(da);e.set(this._chooseFolderRow,"display",!0===this.showSelectFolder?"block":
"none");this.showSelectFolder&&this.getFolderStore().then(n.hitch(this,function(na){this.folderStore=na;O.setupFoldersUI({folderStore:this.folderStore,folderId:this.folderId,folderName:this.folderName,folderSelect:this._webMapFolderSelect,username:this.portalUser?this.portalUser.username:""})}));e.set(this._chooseExtentDiv,"display",!0===this.showChooseExtent?"inline-block":"none");e.set(this._showCreditsLink,"display",!0===this.showCredits?"block":"none");this._distanceUnitsSelect.addOption([{value:"Miles",
label:this.i18n.miles},{value:"Yards",label:this.i18n.yards},{value:"Feet",label:this.i18n.feet},{type:"separator"},{value:"Kilometers",label:this.i18n.kilometers},{value:"Meters",label:this.i18n.meters}]);this.maxDistanceUnits&&(this._distanceUnitsSelect.set("value",this.maxDistanceUnits),this._handleMaxDstUnitsChange(this.maxDistanceUnits));this.maximumDistance&&this._maximumDistanceInput.set("value",this.maximumDistance);this._obsrUnitsSelect.addOption([{value:"Miles",label:this.i18n.miles},{value:"Yards",
label:this.i18n.yards},{value:"Feet",label:this.i18n.feet},{type:"separator"},{value:"Kilometers",label:this.i18n.kilometers},{value:"Meters",label:this.i18n.meters}]);this.observerHeightUnits&&this._obsrUnitsSelect.set("value",this.observerHeightUnits);this.observerHeight&&this._obsrHeightInput.set("value",this.observerHeight);this._targetUnitsSelect.addOption([{value:"Miles",label:this.i18n.miles},{value:"Yards",label:this.i18n.yards},{value:"Feet",label:this.i18n.feet},{type:"separator"},{value:"Kilometers",
label:this.i18n.kilometers},{value:"Meters",label:this.i18n.meters}]);this.targetHeightUnits&&this._targetUnitsSelect.set("value",this.targetHeightUnits);this.targetHeight&&this._targetHgtInput.set("value",this.targetHeight)},_loadConnections:function(){this.on("start",n.hitch(this,"_onClose",!1));this._connect(this._closeBtn,"onclick",n.hitch(this,"_onClose",!0))},validateServiceName:function(da){return O.validateServiceName(da,{textInput:this._outputLayerInput,isItem:!this.returnFeatureCollection})},
_handleInputDrawPointChange:function(da){da?(this.emit("drawtool-activate",{}),this._pointfeatureLayer||this._createPointFeatColl(),this._pointtoolbar.activate(V.POINT)):this._pointtoolbar.deactivate()},_createPointFeatColl:function(){var da=O.createPointFeatureCollection(this.drawPointLayerName);this._pointfeatureLayer=new Z(da,{id:this.drawPointLayerName});this.map.addLayer(this._pointfeatureLayer);m.connect(this._pointfeatureLayer,"onClick",n.hitch(this,function(na){this.map.infoWindow.setFeatures([na.graphic])}))},
_addPointFeatures:function(da){var na=[],ia={};da=new L(da);ia.description="blayer desc";ia.title="blayer";da.setAttributes(ia);na.push(da);this._pointfeatureLayer.applyEdits(na,null,null);if(0===this.inputLayers.length||this.inputLayers[this.inputLayers.length-1]!==this._pointfeatureLayer)this.inputLayers.push(this._pointfeatureLayer),na=this.inputLayers.length-1,ia=this._analysisSelect.getOptions(),this._analysisSelect.removeOption(ia),ia=r.map(ia,function(pa){pa.selected=!1;return pa}),this._analysisSelect.addOption({value:na+
1,label:this._pointfeatureLayer.name,selected:!0}),this._analysisSelect.addOption(ia),this._handleAnalysisLayerChange(na+1)},_handleMaxDstChange:function(){this._maximumDistanceInput.validate()},_handleMaxDstUnitsChange:function(da){var na="",ia={min:0};"Miles"===da?(ia.max=31,na=f.substitute(this.i18n.maxDistanceValidMsg,{units:da,limit:31})):"Kilometers"===da?(ia.max=50,na=f.substitute(this.i18n.maxDistanceValidMsg,{units:da,limit:50})):"Yards"===da?(ia.max=54680,na=f.substitute(this.i18n.maxDistanceValidMsg,
{units:da,limit:54680})):"Feet"===da?(ia.max=164041,na=f.substitute(this.i18n.maxDistanceValidMsg,{units:da,limit:164041})):"Meters"===da&&(ia.max=5E4,na=f.substitute(this.i18n.maxDistanceValidMsg,{units:da,limit:5E4}));this._maximumDistanceInput.set("constraints",ia);this._maximumDistanceInput.set("rangeMessage",na)},_handleAnalysisLayerChange:function(da){"browse"===da||"browselayers"===da?(this._createBrowseItems({browseValue:da,disabledSubResources:[this.inputLayer]},{tags:["point"],geometryTypes:[D.GeometryTypes.Point,
D.GeometryTypes.MultiPoint]},this._analysisSelect),this._analysisPointDrawBtn.reset()):(this.inputLayer=this.inputLayers[da-1],this._updateAnalysisLayerUI(!0))},_handleBrowseItemsSelect:function(da,na){da&&da.selection&&O.addAnalysisReadyLayer({item:da.selection,layers:this.inputLayers,layersSelect:this._analysisSelect,posIncrement:1,browseDialog:da.dialog||this._browsedlg,widget:this},na).always(n.hitch(this,this._updateAnalysisLayerUI,!0))},_updateAnalysisLayerUI:function(da){this.inputLayer&&(g.set(this._interpolateToolDescription,
"innerHTML",f.substitute(this.i18n.toolDefine,{layername:this.inputLayer.name})),da&&(this.outputLayerName=f.substitute(this.i18n.outputLayerName,{layername:this.inputLayer.name})),this._outputLayerInput.set("value",this.outputLayerName),this._pointfeatureLayer&&this._pointfeatureLayer.name!==this.inputLayer.name&&this._analysisPointDrawBtn.reset())},_setAnalysisGpServerAttr:function(da){da&&(this.analysisGpServer=da,this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName))},_setInputLayersAttr:function(da){this.inputLayers=
da||[]},_setInputLayerAttr:function(da){this.inputLayer=da},_getInputLayerAttr:function(){return this.inputLayer},_getOutputLayerNameAttr:function(){this._outputLayerInput&&(this.outputLayerName=this._outputLayerInput.get("value"));return this.outputLayerName},_setOutputLayerNameAttr:function(da){this.outputLayerName=da},_setMapAttr:function(da){this.map=da;this._pointtoolbar=new V(this.map);m.connect(this._pointtoolbar,"onDrawEnd",n.hitch(this,this._addPointFeatures))},_getMapAttr:function(){return this.map},
_setDisableRunAnalysisAttr:function(da){this._saveBtn.set("disabled",da)},_setDisableExtentAttr:function(da){this._useExtentCheck.set("checked",!da);this._useExtentCheck.set("disabled",da)},_getDisableExtentAttr:function(){this._useExtentCheck.get("disabled")},_setMaxDistanceUnitsAttr:function(da){this.maxDistanceUnits=da},_getMaxDistanceUnitsAttr:function(){this._distanceUnitsSelect&&this._distanceUnitsSelect.get("value")&&(this.maxDistanceUnits=this._distanceUnitsSelect.get("value"));return this.maxDistanceUnits},
_setMaximumDistanceAttr:function(da){this.maximumDistance=da},_getMaximumDistanceAttr:function(){return this._maximumDistanceInput.get("value")},_setObserverHeightUnitsAttr:function(da){this.observerHeightUnits=da},_getObserverHeightUnitsAttr:function(){this._obsrUnitsSelect&&this._obsrUnitsSelect.get("value")&&(this.observerHeightUnits=this._obsrUnitsSelect.get("value"));return this.observerHeightUnits},_setObserverHeightAttr:function(da){this.observerHeight=da},_getObserverHeightAttr:function(){return this._obsrHeightInput.get("value")},
_setTargetHeightUnitsAttr:function(da){this.targetHeightUnits=da},_getTargetHeightUnitsAttr:function(){this._targetUnitsSelect&&this._targetUnitsSelect.get("value")&&(this.targetHeightUnits=this._targetUnitsSelect.get("value"));return this.targetHeightUnits},_setTargetHeightAttr:function(da){this.targetHeight=da},_getTargetHeightAttr:function(){return this._targetHgtInput.get("value")},_setDrawPointLayerNameAttr:function(da){this.drawPointLayerName=da},_getDrawPointLayerNameAttr:function(){return this._pointfeatureLayer.name},
_getDrawLayerAttr:function(){var da=[];this._featureLayer&&da.push(this._featureLayer);this._pointfeatureLayer&&da.push(this._pointfeatureLayer);return da},_connect:function(da,na,ia){this._pbConnects.push(m.connect(da,na,ia))}});a("extend-esri")&&n.setObject("dijit.analysis.CreateViewshed",H,T);return H})},"esri/dijit/analysis/AnalysisBase":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has dojo/json dojo/Deferred dojo/promise/all dojo/when dojo/data/ItemFileWriteStore dojo/string dojo/Evented dojo/_base/kernel dojo/Stateful ../../kernel ../../lang ../../request ../../tasks/Geoprocessor dojo/i18n!../../nls/jsapi ./utils ./storageUtils ./ItemTypes ../../IdentityManager".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F){k=k([p,d],{declaredClass:"esri.dijit.analysis.AnalysisBase",isOutputLayerItemUpdated:!1,analysisGpServer:null,toolName:null,portalUrl:null,jobParams:null,itemParams:null,gp:null,resultParameter:null,signInPromise:null,getResultLyrInfos:!1,checkCreditLimits:!1,useGPCreditTask:!0,_isGPCreditSync:!0,_jobInfo:null,_popupInfo:null,_toolServiceUrl:null,_counter:null,_analysisType:"feature",doRefreshItem:!0,doSaveJobInfo:!1,doSaveInStorage:!1,_doDeleteViewResult:!1,
outputName:"OutputName",_freeGPTools:["CreateWatersheds","CreateViewshed","TraceDownstream"],constructor:function(y){this.isOutputLayerItemUpdated=!1;this._rids=[];this._counter=0;this._popupInfo=[];y.analysisGpServer?this._signIn(y.analysisGpServer):y.portalUrl&&(this.portalUrl=y.portalUrl,this._signIn(y.portalUrl,!0));this.i18n={};n.mixin(this.i18n,x.common);n.mixin(this.i18n,x.analysisTools);n.mixin(this.i18n,x.analysisMsgCodes);n.mixin(this.i18n,x.analysisSettings);this.signInPromise.then(n.hitch(this,
this._initErrorHelpMap))},execute:function(y){var w;this.jobParams=y.jobParams;this.jobParams.actualOutputName=this.outputName;var A=this.jobParams[this.outputName];this._analysisType=y.analysisType||"feature";this._updateContext();var z=m.fromJson(this.jobParams.context);A&&(w=m.fromJson(A));!A||w&&!w.serviceProperties?(this.itemParams=null,this.jobParams.resultName=this.get("resultName")):this.showGeoAnalyticsParams&&A&&z&&z.dataStore&&-1===["BDS","GDB"].indexOf(z.dataStore)?(this.jobParams._gaxOutName=
w.serviceProperties.name.replace(/[\s]|\-|\./g,"_"),this.jobParams[this.outputName]=null,this.jobParams.outputType=F.BDFSTEMPLATE,this.itemParams=null):(this.showGeoAnalyticsParams&&"CopyToDataStore"===this.toolName&&z&&z.dataStore&&-1!==["BDS","GDB"].indexOf(z.dataStore)&&(delete z.dataStore,this.jobParams.context=m.toJson(z)),this.itemParams=y.itemParams);u.isDefined(y.isSpatioTemporalDataStore)&&(this._isSpatioTemporalDataStore=C.settingsVM&&C.settingsVM.datastore&&"CopyToDataStore"!==this.toolName?
"BDS"===C.settingsVM.datastore:y.isSpatioTemporalDataStore);this.signInPromise.then(n.hitch(this,this._checkUser))},_updateContext:function(){var y;this.rerun&&this.context&&this._useExtentCheck&&!this._useExtentCheck.get("checked")&&(this.context.extent=null);this.context&&((y=m.fromJson(this.jobParams.context))||(y={}),this.context.outSR&&!y.outSR&&(y.outSR=this.context.outSR),this.context.processSR&&!y.processSR&&(y.processSR=this.context.processSR),this.context.extent&&!y.extent&&(y.extent=this.context.extent),
this.showGeoAnalyticsParams&&this.context.dataStore&&!y.dataStore&&(y.dataStore=this.context.dataStore),"raster"===this.analysisMode&&(this.context.cellSize&&!y.cellSize&&(y.cellSize=this.context.cellSize),!this.context.mask||y.mask||this.isDLTool&&!this.isDetectObjectTool||(y.mask=this.context.mask),!this.context.snapRaster||y.snapRaster||this.isDetectObjectTool||(y.snapRaster=this.context.snapRaster),this.isDLTool||this.isOutputFeatureTool||this.isProximityTool||!this.context.resamplingMethod||
y.resamplingMethod||(y.resamplingMethod=this.context.resamplingMethod)),this.isDLTool&&(this.context.processorType&&!y.processorType&&(y.processorType=this.context.processorType),"feature"===this._analysisType&&this.context.cellSize&&!y.cellSize&&(y.cellSize=this.context.cellSize)),this.isPPFTool&&(this.context.parallelProcessingFactor&&!y.parallelProcessingFactor&&(y.parallelProcessingFactor=this.context.parallelProcessingFactor),this.context.recycleProcessingWorkers&&!y.recycleProcessingWorkers&&
(y.recycleProcessingWorkers=this.context.recycleProcessingWorkers),this.context.retryOnFailures&&!y.retryOnFailures&&(y.retryOnFailures=this.context.retryOnFailures)),this.jobParams.context=m.toJson(y))},_checkUser:function(){var y;if(y=q.id.findCredential(this.portalUrl).userId)y=this.portalUrl+"/sharing/rest/community/users/"+y,v({url:y,content:{f:"json"}}).then(n.hitch(this,this._handleUserProfileResponse),n.hitch(this,function(w){this.emit("job-fail",{message:w.message+(w.details?w.details.toString():
""),jobParams:this.jobParams})}))},getUserProfile:function(){var y=new a;this.userProfile?y.resolve(this.userProfile):this.signInPromise.then(n.hitch(this,function(w){if(w=w.userId)w=this.portalUrl+"/sharing/rest/community/users/"+w,v({url:w,content:{f:"json"}}).then(n.hitch(this,function(A){this.userProfile=A;y.resolve(A)}),n.hitch(this,function(A){y.reject(A)}))}));return y.promise},_handleUserProfileResponse:function(y){var w=this.jobParams.outputType&&this.jobParams.outputType===F.FLAYERVIEW;
if(u.isDefined(y)&&u.isDefined(y.orgId))if(-1===r.indexOf(["account_admin","account_publisher","org_admin","org_publisher"],y.role))this.emit("job-fail",{message:this.i18n.pubRoleMsg,messageCode:"AB_0001",jobParams:this.jobParams});else if(u.isDefined(y.availableCredits)&&this.get("checkCreditLimits")&&!w&&!this._byPassCreditCheck(this.toolName)){var A,z={},G=this.toolName,I=new a;var K=this._cleanUpJobParamsForSubmit();for(A in K)K.hasOwnProperty(A)&&("object"===typeof K[A]?z[A]=m.toJson(K[A]):-1!==
r.indexOf(["measurementtype"],A.toLowerCase())&&"StraightLine"!==K[A]?(w=m.fromJson(K[A]),z[A]=w?w.name.replace(/[\s~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/g,""):"DrivingTime"):z[A]=K[A]);this.isRaster&&(G=this.rasterGPToolName,z.functionArguments&&(z.functionArguments=m.fromJson(z.functionArguments)),z.context&&(z.context=m.fromJson(z.context)));u.isDefined(this.itemParams)&&!this.isRaster?I=this._checkServiceName(y.orgId,!0):I.resolve(!0);I.then(n.hitch(this,function(Q){Q&&(this.isRaster&&u.isDefined(this.estimatedCost)?
y.availableCredits>this.estimatedCost?this._runJob():this.emit("job-fail",{message:this.i18n.insufficientCreditsMsg,messageCode:"AB_0001",jobParams:this.jobParams}):this.getCreditsEstimate(G,z,this.isRaster).always(n.hitch(this,function(N){var T=N&&u.isDefined(N.cost)?N.cost:N.maximumCost;u.isDefined(T)&&y.availableCredits>T?this._runJob():N&&(N.messageCode||N.message)&&0!==N.status?(T=u.isDefined(this.i18n[N.messageCode])?this.i18n[N.messageCode]:N.message,T=u.isDefined(N.params)?g.substitute(T,
N.params):T,this.emit("job-fail",{message:T,messageCode:"AB_0001",jobParams:this.jobParams})):this.isRaster&&u.isDefined(T)&&y.availableCredits<T?this.emit("job-fail",{message:this.i18n.insufficientCreditsMsg,messageCode:"AB_0001",jobParams:this.jobParams}):this._runJob()})))}))}else u.isDefined(this.itemParams)?this._checkServiceName(y.orgId):(this.emit("start",this.jobParams),this._submitGpJob());else this.emit("job-fail",{message:this.i18n.orgUsrMsg,jobParams:this.jobParams})},_runJob:function(){u.isDefined(this.itemParams)?
("raster"===this._analysisType?this._createImageService():this._createService(),this.emit("start",this.jobParams)):(this.emit("start",this.jobParams),this._submitGpJob())},_checkServiceName:function(y,w){var A=new a;q.id.findCredential(this.portalUrl);y=this.portalUrl+"/sharing/rest/portals/"+y+"/isServiceNameAvailable";var z=m.fromJson(this.jobParams[this.outputName]);u.isDefined(z.serviceProperties)&&u.isDefined(z.serviceProperties.name)&&(z.serviceProperties.name=z.serviceProperties.name.replace(/[\s]|\-|\./g,
"_"),this.jobParams[this.outputName]=m.toJson(z));v({url:y,content:{name:z.serviceProperties.name,type:"raster"===this._analysisType?"Image Service":"Feature Service",f:"json"}}).then(n.hitch(this,function(G){G.available?(w||("raster"===this._analysisType?this._createImageService():this._createService(),this.emit("start",this.jobParams)),A.resolve(!0)):(this.emit("job-fail",{message:this.i18n.servNameExists,type:"warning",messageCode:"AB_0002",jobParams:this.jobParams}),A.resolve(!1))}),n.hitch(this,
function(G){this.emit("job-fail",{message:G.message+(G.details?G.details.toString():""),jobParams:this.jobParams});A.resolve(!1)}));return A},_checkServiceNameOnly:function(y,w){var A=new a;q.id.findCredential(this.portalUrl);v({url:this.portalUrl+"/sharing/rest/portals/"+y+"/isServiceNameAvailable",content:{name:w,type:"Image Service",f:"json"}}).then(n.hitch(this,function(z){z.available?A.resolve(!0):(this.emit("job-fail",{message:this.i18n.servNameExists,type:"warning",messageCode:"AB_0002",jobParams:this.jobParams}),
A.resolve(!1))}),n.hitch(this,function(z){this.emit("job-fail",{message:z.message+(z.details?z.details.toString():""),jobParams:this.jobParams});A.resolve(!1)}));return A},_createService:function(){var y=this._submitGpJob;var w=q.id.findCredential(this.portalUrl).userId;var A=m.fromJson(this.jobParams[this.outputName]);if(w){var z=this.itemParams.folder;w=this.portalUrl+"/sharing/rest/content/users/"+w+(z&&"/"!==z?"/"+z:"")+"/createService";A={createParameters:m.toJson({currentVersion:10.2,serviceDescription:"",
hasVersionedData:!1,supportsDisconnectedEditing:!1,hasStaticData:!0,maxRecordCount:2E3,supportedQueryFormats:"JSON",capabilities:"Query",description:"",copyrightText:"",allowGeometryUpdates:!1,syncEnabled:!1,editorTrackingInfo:{enableEditorTracking:!1,enableOwnershipAccessControl:!1,allowOthersToUpdate:!0,allowOthersToDelete:!0},xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"},tables:[],name:A.serviceProperties.name}),outputType:"featureService",
f:"json"};this._isSpatioTemporalDataStore&&(z=m.fromJson(A.createParameters),z.options={dataSourceType:"spatiotemporal"},A.createParameters=m.toJson(z));this.jobParams.outputType&&this.jobParams.outputType===F.FLAYERVIEW&&(z=m.fromJson(A.createParameters),n.mixin(A,this._getViewCreateParams()),A.createParameters=m.toJson(z),y=this._addViewDefinition);v({url:w,content:A},{usePost:!0}).then(n.hitch(this,y),n.hitch(this,this._handleCreateServiceError))}},_createImageService:function(){var y=q.id.findCredential(this.portalUrl).userId;
var w=m.fromJson(this.jobParams[this.outputName]);if(y){var A=this.itemParams.folder;y=this.portalUrl+"/sharing/rest/content/users/"+y+(A&&"/"!==A?"/"+A:"")+"/createService";w={createParameters:m.toJson({name:w.serviceProperties.name,description:"",capabilities:w.serviceProperties.capabilities||"Image",properties:{isCached:!0,path:"@",description:"",copyright:""}}),outputType:"imageService",f:"json"};v({url:y,content:w},{usePost:!0}).then(n.hitch(this,this._submitGpJob),n.hitch(this,this._handleCreateServiceError))}},
_handleCreateServiceError:function(y){this.emit("job-fail",{message:y.message+(y.details?y.details.toString():""),jobParams:this.jobParams})},_getViewCreateParams:function(){return{isView:!0}},_addViewDefinition:function(y){var w;if(this.itemParams){this.currentGpItemId=y.itemId;var A=m.fromJson(this.jobParams[this.outputName]);A.serviceProperties&&(A.serviceProperties.serviceUrl=y.serviceurl);A.itemProperties={itemId:y.itemId};this.itemParams.folder&&(A.itemProperties.folderId=this.itemParams.folder);
this.jobParams[this.outputName]=m.toJson(A)}this.getViewParams({jobParams:this.jobParams,resultService:{url:y.serviceurl,itemId:y.itemId}}).then(n.hitch(this,function(z){w=z;var G={jobId:"ViewJob_"+(new Date).getTime(),jobStatus:"esriJobSubmitted",jobParams:this.jobParams};this._addToDefinition(y.serviceurl,w).then(n.hitch(this,function(I){var K={value:{}};this._doDeleteViewResult||(this._jobInfo.jobStatus="esriJobSucceeded",setTimeout(n.hitch(this,function(){this.itemParams.properties={jobUrl:I.serviceurl+
"/jobs/"+this._jobInfo.jobId,jobType:"GPServer",jobId:this._jobInfo.jobId,jobStatus:"completed"};this._readItem()}),300),this.doSaveJobInfo&&this.saveJobInfo(this._jobInfo),K.outputLayerName=m.fromJson(this.jobParams[this.outputName]).serviceProperties.name,K.value.itemId=this.currentGpItemId,K.analysisInfo={toolName:this.toolName,secondaryOutputs:this.secondaryOutputs,jobParams:this.jobParams},this.emit("job-result",K))}),n.hitch(this,this._gpJobFailed));this.emit("job-submit",this.jobParams);setTimeout(n.hitch(this,
function(){this._jobInfo=G;this._jobInfo.jobStatus="esriJobExecuting";this._readItem();this.emit("job-status",this._jobInfo)},0))}),n.hitch(this,this._gpJobFailed))},_addToDefinition:function(y,w){y=y.replace("/rest/services","/rest/admin/services")+"/addToDefinition";var A=q.id.findCredential(this.portalUrl);w={f:"json",addToDefinition:m.toJson(w),token:A.token};return v({url:y,content:w},{usePost:!0})},_getAdminLayerInfo:function(y){y=y.replace("/rest/services","/rest/admin/services");var w={f:"json",
token:q.id.findCredential(this.portalUrl).token};return v({url:y,content:w})},_getSelf:function(y){return v({url:y+"/sharing/rest/portals/self",content:{culture:h.locale,f:"json"},callbackParamName:"callback",timeout:0},{})},_submitGpJob:function(y){var w=m.fromJson(this.jobParams.context);this._doCancelCleanup=!1;if(this.itemParams){this.currentGpItemId=y.itemId;var A=m.fromJson(this.jobParams[this.outputName]);A.serviceProperties&&(A.serviceProperties.serviceUrl=y.serviceurl);A.itemProperties={itemId:y.itemId};
this.itemParams.folder&&(A.itemProperties.folderId=this.itemParams.folder);this.jobParams[this.outputName]=m.toJson(A)}if(this.analysisGpServer){this._toolServiceUrl&&this.gp||this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName);this.gp.setUpdateDelay(3E3);if(this.showGeoAnalyticsParams&&this.jobParams._gaxOutName&&w.dataStore&&-1===["BDS","GDB"].indexOf(w.dataStore)){var z=this.jobParams[this.outputName]=this.jobParams._gaxOutName;delete this.jobParams._gaxOutName}this.itemParams||
delete this.jobParams.resultName;this.gp.submitJob(this._cleanUpJobParamsForSubmit(),n.hitch(this,this._gpJobComplete),n.hitch(this,this._gpJobStatus),n.hitch(this,this._gpJobFailed));this.itemParams||(this.jobParams.resultName=this.get("resultName"));z&&(this.jobParams[this.outputName]=null);this.emit("job-submit",this.jobParams)}else this._getSelf(this.portalUrl).then(n.hitch(this,function(G){this.analysisGpServer=G.helperServices.analysis&&G.helperServices.analysis.url?G.helperServices.analysis.url:
null;this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName);this.gp.setUpdateDelay(3E3);this.itemParams||delete this.jobParams.resultName;this.gp.submitJob(this.jobParams,n.hitch(this,this._gpJobComplete),n.hitch(this,this._gpJobStatus),n.hitch(this,this._gpJobFailed));this.itemParams||(this.jobParams.resultName=this.get("resultName"));this.emit("job-submit",this.jobParams)}))},_cleanUpJobParamsForSubmit:function(){var y=n.mixin({},this.jobParams),w=["actualOutputName","aLayer","attributeExprObj",
"data","resultName"].concat(this.removeJobParamKeys||[]),A;for(A in y)y.hasOwnProperty(A)&&-1!==w.indexOf(A)&&delete y[A];return y},_updateItem:function(y){var w;if(w=q.id.findCredential(this.portalUrl).userId){var A=this.itemParams.folder;w=this.portalUrl+"/sharing/rest/content/users/"+w+(A&&"/"!==A?"/"+A:"")+"/items/"+this.currentGpItemId+"/update";if(y)var z=y.item.properties;u.isDefined(z)||(z={});u.isDefined(z.jobUrl)||(z.jobUrl=this._toolServiceUrl+"/jobs/"+this._jobInfo.jobId,z.jobType="GPServer",
z.jobId=this._jobInfo.jobId,z.jobStatus="processing",this.itemParams.properties=z);z=n.mixin({f:"json"},this.itemParams);y&&z.folder===y.item.folder&&delete z.folder;y&&y.item&&z.tags===y.item.tags.toString()&&delete z.tags;y&&y.item&&z.snippet===y.item.snippet&&delete z.snippet;y&&y.item&&z.description===y.item.description&&delete z.description;z.properties&&(z.properties=m.toJson(z.properties));z.text&&(z.text=m.toJson(z.text));y=v({url:w,content:z},{usePost:!0});y.then(n.hitch(this,this._handleItemUpdate),
n.hitch(this,this._handleUpdateItemError));return y}},_handleItemUpdate:function(y){this.isOutputLayerItemUpdated=!0},_handleItemDataUpdate:function(y){},_handleUpdateItemError:function(y){this.isOutputLayerItemUpdated=!0;this.emit("job-fail",{message:y.message+(y.details?y.details.toString():""),jobParams:this.jobParams})},_handleErrorResponse:function(y){this.emit("job-fail",y)},_refreshItem:function(){var y;if(y=q.id.findCredential(this.portalUrl).userId){var w=this.itemParams.folder;y=this.portalUrl+
"/sharing/rest/content/users/"+y+(w&&"/"!==w?"/"+w:"")+"/items/"+this.currentGpItemId+"/refresh";y=v({url:y,content:{f:"json"}},{usePost:!0})}else y=new a,y.resolve();return y.promise},_handleItemRefresh:function(y){},_readItem:function(){var y;if(y=q.id.findCredential(this.portalUrl).userId){var w=this.itemParams.folder;y=this.portalUrl+"/sharing/rest/content/users/"+y+(w&&"/"!==w?"/"+w:"")+"/items/"+this.currentGpItemId;y=v({url:y,content:{f:"json"}});return y.then(n.hitch(this,this._updateItem))}},
getItemInfo:function(y){if(q.id.findCredential(this.portalUrl).userId)return y=this.portalUrl+"/sharing/rest/content/items/"+y,v({url:y,content:{f:"json"}})},_gpJobStatus:function(y){y.jobParams=this.jobParams;y.resultParameter=this.resultParameter;y.returnProcessInfo=this.jobParams.returnProcessInfo;y.getResultLyrInfos=this.getResultLyrInfos;y.currentGpItemId=this.currentGpItemId;y.itemParams=this.itemParams;"esriJobFailed"===y.jobStatus||"esriJobSucceeded"===y.jobStatus||"esriJobTimedOut"===y.jobStatus?
(y.messages&&(y.message=this._buildErrorMsg(y)),this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=null,this._gpJobComplete(y)),"esriJobFailed"!==y.jobStatus&&"esriJobTimedOut"!==y.jobStatus||this._deleteItem(!1)):-1===["esriJobCancelling","esriJobCancelled"].indexOf(y.jobStatus)||this._doCancelCleanup||(this._handleOnCancel(y),this._doCancelCleanup=!0);this.doSaveJobInfo&&this.saveJobInfo(y);this.emit("job-status",y);this._jobInfo=y;this.itemParams&&!this.isOutputLayerItemUpdated&&
this._readItem()},_updateRefreshItem:function(y){var w=[],A=y[0];w.push(this._readItem(this.doRefreshItem));c(w).then(n.hitch(this,function(z){A.outputLayerName=m.fromJson(this.jobParams[this.outputName]).serviceProperties.name;A.value.itemId=this.currentGpItemId;A.analysisInfo={toolName:this.toolName,secondaryOutputs:this.secondaryOutputs,jobParams:this.jobParams};this.doRefreshItem?this._refreshItem().always(n.hitch(this,function(){this.emit("job-result",A)})):this.emit("job-result",A)}),n.hitch(this,
this._handleDeleteItemError))},_gpJobComplete:function(y){var w;"esriJobSucceeded"===y.jobStatus&&(y.jobParams=this.jobParams,this.emit("job-success",y),c(this._getGpResultData(y)).then(n.hitch(this,function(A){A=r.filter(A,function(z){var G=!0;u.isDefined(z.value.empty)?G=z.value.empty:u.isDefined(z.value.url)||u.isDefined(z.value.itemId)?G=!1:u.isDefined(z.value.featureSet)?G=!1:this.jobParams.outputType===F.BDFSTEMPLATE&&(G=!1);if(!G)return z},this);0===A.length?(this.currentGpItemId&&this._deleteItem(!1),
this.showGeoAnalyticsParams&&y.messages&&(y.message=this._buildErrorMsg(y)),this.emit("job-fail",{message:this.showGeoAnalyticsParams?y.message:this.i18n.emptyResultInfoMsg,type:"warning",jobParams:this.jobParams})):(u.isDefined(this.itemParams)&&this.itemParams.properties&&this.itemParams.properties.jobStatus&&"processing"===this.itemParams.properties.jobStatus&&(this.itemParams.properties.jobStatus="completed"),r.forEach(A,function(z){if(z.value.featureSet&&!z.value.url)z.value.featureSet.spatialReference=
z.value.layerDefinition.spatialReference;else if(z.value.url&&-1!==z.value.url.indexOf("/FeatureServer/")&&z.value.layerInfo&&z.value.layerInfo.popupInfo){var G=z.value.url.match(/[0-9]+$/g)[0];this._popupInfo[G]=z.value.layerInfo.popupInfo}},this),w=A[0],w.results=A,this.jobParams.returnProcessInfo?this.gp.getResultData(y.jobId,"processInfo").then(n.hitch(this,function(z){var G=[];r.forEach(z.value,function(I){G.push(m.fromJson(I))},this);this.currentGpItemId?(this.itemParams.description=C.buildReport(G),
this._updateRefreshItem(A)):(w.analysisReport=C.buildReport(G),w.outputLayerName=this.jobParams.resultName,this.emit("job-result",w))})):this.currentGpItemId?this._updateRefreshItem(A):(w.outputLayerName=this.jobParams.resultName,this.emit("job-result",w)))})))},_gpJobFailed:function(y){var w=n.clone(y);w.jobParams=this.jobParams;this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=null);y.messages&&(y.message=this._buildErrorMsg(y));this.emit("job-fail",w)},_getGpResultData:function(y){var w=
[],A=[];"string"===typeof this.resultParameter?A.push(this.resultParameter):this.resultParameter instanceof Array&&(A=this.resultParameter,this.secondaryOutputs&&this.secondaryOutputNames&&(A=r.filter(A,function(z){z=this.secondaryOutputs.indexOf(z);return-1===z?!0:y.jobParams.hasOwnProperty(this.secondaryOutputNames[z])},this)));r.forEach(A,function(z,G){w.push(this.gp.getResultData(y.jobId,z))},this);return w},_handleOnCancel:function(y){this.itemParams?this._deleteItem(!0,y):this.emit("job-cancel",
y)},cancel:function(y){this.jobParams.outputType&&this.jobParams.outputType===F.FLAYERVIEW?(this._doDeleteViewResult=!0,this._deleteItem(!0)):this.gp.cancelJob(y.jobId).then(n.hitch(this,function(w){"esriJobCancelled"===w.jobStatus&&this._handleOnCancel(w)}),function(w){})},checkJobStatus:function(y){this.signInPromise.then(n.hitch(this,function(){this.gp.setUpdateDelay(3E3);this._checkTimer=setInterval(n.hitch(this,this._checkStatus,y,n.hitch(this,this._gpJobStatus),n.hitch(this,this._gpJobFailed)),
3E3)}))},_checkStatus:function(y,w,A){this.gp.checkJobStatus(y,w,A)},_deleteItem:function(y,w){var A;if((A=q.id.findCredential(this.portalUrl).userId)&&this.itemParams){var z=u.isDefined(this.itemParams.folder)?this.itemParams.folder:"";A=this.portalUrl+"/sharing/rest/content/users/"+A+(z&&"/"!==z?"/"+z:"")+"/items/"+this.currentGpItemId+"/delete";v({url:A,content:{f:"json"}},{usePost:!0}).then(n.hitch(this,this._handleItemDelete,y,w),n.hitch(this,this._handleDeleteItemError))}},_handleItemDelete:function(y,
w,A){y&&this.emit("job-cancel",w)},_handleDeleteItemError:function(y){this.emit("job-fail",{message:y.message+(y.details?y.details.toString():""),jobParams:this.jobParams})},_initFolderStore:function(y,w){this._fportal=this.portalSelf?new y.Portal({url:this.portalUrl,self:this.portalSelf}):new y.Portal(this.portalUrl);this._fportal.signIn().then(n.hitch(this,function(A){this.portalUser=A;this.portalUser.getFolders().then(n.hitch(this,function(z){z=C.createFolderStore(z,this.portalUser.username);w.resolve(z)}))}))},
getFolderStore:function(){var y=new a,w,A,z,G;this.folderStore?y.resolve(this.folderStore):this.signInPromise.then(n.hitch(this,function(I){w=["../../arcgis/Portal"];A=this._counter++;z=this;this._rids&&this._rids.push(A);H(w,function(K){G=z._rids?r.indexOf(z._rids,A):-1;-1!==G&&(z._rids.splice(G,1),z._initFolderStore(K,y))})}));return y},_checkToolUrl:function(){var y=new a;this.analysisGpServer?(this._toolServiceUrl&&this.gp||this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName),y.resolve({success:!0})):
this._getSelf(this.portalUrl).then(n.hitch(this,function(w){(this.analysisGpServer=w.helperServices.analysis&&w.helperServices.analysis.url?w.helperServices.analysis.url:null)&&this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName);y.resolve({success:!0})}));return y},getCreditsEstimate:function(y,w,A){this.start=window.performance.now();var z,G,I,K,Q,N={};var T=new a;this._checkToolUrl().then(n.hitch(this,function(W){this._toolServiceUrl?K=this._toolServiceUrl:(I=this.portalUrl&&-1!==
this.portalUrl.indexOf("dev")?"dev":this.portalUrl&&-1!==this.portalUrl.indexOf("qa")?"qa":"",K="http://analysis"+I+".arcgis.com/arcgis/rest/services/tasks/GPServer/"+this.toolName);this.useGPCreditTask?(Q=this.portalSelf||this._portal,A?(z=Q&&Q.helperServices&&Q.helperServices.rasterAnalytics.url?Q.helperServices.rasterAnalytics.url+"/EstimateRasterAnalysisCost":K.replace("/tasks/GPServer/"+y,"/RasterAnalysisTools/GPServer/EstimateRasterAnalysisCost"),N.name=y,N.parameters=w,W=w.context,W.cellSize=
this.context.cellSize,!W.extent&&this.context.extent&&(W.extent=this.context.extent),W={jobParams:{inputAnalysisTask:m.toJson(N),context:m.toJson(W)},resultParameter:"outCost",def:T,isGPCreditSync:!1}):(z=Q&&Q.helperServices&&Q.helperServices.creditEstimation&&Q.helperServices.creditEstimation.url?Q.helperServices.creditEstimation.url+"/EstimateCredits":K.replace("/tasks/GPServer/"+y,"/Estimate/GPServer/EstimateCredits"),W={jobParams:{taskName:y,taskParameters:m.toJson(w)},resultParameter:"creditEstimate",
def:T,isGPCreditSync:this._isGPCreditSync}),this._getGPCreditEstimate(z,W)):(z=K.replace("/"+y,"/exts/Estimate/"+y),G=n.mixin({f:"json"},w),v({url:z,content:G},{usePost:!0}).then(n.hitch(this,function(X){this.end=window.performance.now();console.log("Analysis Credit Estimator SOE Sync Time : "+(this.end-this.start)+" milliseconds");T.resolve(X)}),function(X){T.resolve(X)}))}));return T.promise},_getGPCreditEstimate:function(y,w){this.creditGP=new t(y);this.creditGP.setUpdateDelay(1E3);w.isGPCreditSync?
this.creditGP.execute(w.jobParams,n.hitch(this,this._getGPCreditResult,w.def,w.resultParameter,w.isGPCreditSync),n.hitch(this,this._creditGPJobFailed,w.def,w.isGPCreditSync)):this.creditGP.submitJob(w.jobParams,n.hitch(this,this._getGPCreditResult,w.def,w.resultParameter,w.isGPCreditSync),n.hitch(this,this._creditGPJobFailed,w.def,w.isGPCreditSync),n.hitch(this,this._creditGPJobFailed,w.def,w.isGPCreditSync))},_getGPCreditResult:function(y,w,A,z){A?(this.end=window.performance.now(),console.log("Analysis Credit Estimator GP Sync Time : "+
(this.end-this.start)+" milliseconds"),y.resolve(z[0].value)):this.creditGP.getResultData(z.jobId,w).then(n.hitch(this,function(G,I){I&&I.value&&0<=I.value.credits&&(I.value.cost=I.value.credits);this.end=window.performance.now();console.log("Analysis Credit Estimator GP Async Time : "+(this.end-this.start)+" milliseconds");G.resolve(I.value)},y),n.hitch(this,function(G,I){G.resolve(I)},y))},_creditGPJobFailed:function(y,w,A){w?!A.code||400!==A.code&&-1===A.code.indexOf("IdentityManagerBase.")?0===
A.status&&A.message&&(A.messages=[A.message],y.resolve(this._buildErrorMsg(A))):(A.messages=A.details,y.resolve(A)):"esriJobFailed"!==A.jobStatus&&"esriJobCancelled"!==A.jobStatus||y.resolve(this._buildErrorMsg(A))},_signIn:function(y,w){var A,z;this.signInPromise=new a;if(w){w=["../../arcgis/Portal"];var G=this._counter++;var I=this;this._rids&&this._rids.push(G);H(w,n.hitch(this,function(K){A=I._rids?r.indexOf(I._rids,G):-1;-1!==A&&(I._rids.splice(A,1),this._portal=this.portalSelf?new K.Portal({url:y,
self:this.portalSelf}):new K.Portal(y),this._portal.signIn().then(n.hitch(this,function(Q){this.portalUser=Q;this._portal.helperServices&&this._portal.helperServices.analysis&&this._portal.helperServices.analysis.url?(this.analysisGpServer=this._portal.helperServices.analysis.url,this.showGeoAnalyticsParams&&this._portal.helperServices.geoanalytics&&(this.analysisGpServer=this._portal.helperServices.geoanalytics.url),v({url:this.analysisGpServer,content:{f:"json"},callbackParamName:"callback"}).then(n.hitch(this,
function(N){z=q.id.findCredential(this.analysisGpServer);this.signInPromise.resolve(z)}),n.hitch(this,function(N){this.signInPromise.reject(N)}))):this.signInPromise.resolve(Q)}),n.hitch(this,this._handleSignInError)))}))}else v({url:y,content:{f:"json"},callbackParamName:"callback"}).then(n.hitch(this,function(K){K=q.id.findCredential(y);if(u.isDefined(K)){var Q=q.id.findServerInfo(this._toolServiceUrl);u.isDefined(Q)&&u.isDefined(Q.owningSystemUrl)&&(this.portalUrl=Q.owningSystemUrl);this.signInPromise.resolve(K)}else q.id.getCredential(y).then(n.hitch(this,
function(N){N=q.id.findCredential(y);Q=q.id.findServerInfo(this._toolServiceUrl);u.isDefined(Q)&&u.isDefined(Q.owningSystemUrl)&&(this.portalUrl=Q.owningSystemUrl);this.signInPromise.resolve(N)}),n.hitch(this,this._handleSignInError))}),n.hitch(this,this._handleSignInError));return this.signInPromise},_handleSignInError:function(y){this.emit("job-fail",{message:this.i18n.analysisSignInErrorMsg,messageCode:"AB_0003"});this.signInPromise.reject(y)},_buildErrorMsg:function(y){var w="",A=[],z,G;this.errorHelpMap||
this._initErrorHelpMap();A=r.filter(y.messages,function(I){if(("esriJobMessageTypeError"===I.type||"esriJobMessageTypeWarning"===I.type)&&-1!==I.description.indexOf("messageCode"))return I.description},this);0<A.length&&r.forEach(A,function(I){try{z=m.fromJson(I.description)}catch(K){z=I.description}G="";"esriJobMessageTypeWarning"===I.type&&(y.type="warning");z.messageCode?(G=u.isDefined(this.i18n[z.messageCode])?this.i18n[z.messageCode]:z.message,G=u.isDefined(z.params)?g.substitute(G,z.params):
G,w+=G+"\x26nbsp;",(I=this._addLearnMoreErrorLink(z.messageCode))&&(w+=I)):z.error&&z.error.messageCode?(G=u.isDefined(this.i18n[z.error.messageCode])?this.i18n[z.error.messageCode]:z.error.message,G=u.isDefined(z.error.params)?g.substitute(G,z.error.params):G,w+=G+"\x26nbsp;",(I=this._addLearnMoreErrorLink(z.error.messageCode))&&(w+=I)):w+=z+"\x26nbsp;"},this);return w},_toolServiceUrlSetter:function(y){this._toolServiceUrl=y;this.gp=new t(y)},_setToolServiceUrlAttr:function(y){this._toolServiceUrl=
y;this.gp=new t(y)},checkCreditLimitsAttr:function(y){this.checkCreditLimits=y},saveJobInfo:function(y){if(this.doSaveJobInfo&&this.currentGpItemId&&-1!==r.indexOf(["esriJobSucceeded"],y.jobStatus)){n.mixin(y.jobParams,{extentCheck:this._useExtentCheck&&this._useExtentCheck.get("checked")});r.forEach(y.messages,function(z){z.description=C.safetagsReplace(z.description)},this);y={toolName:this.toolName,jobParams:y.jobParams,timestamp:Date.now(),portalUrl:this.portalUrl,jobInfo:{jobId:y.jobId,jobStatus:y.jobStatus,
messages:y.messages,analysisServer:"bigdata"===this.analysisMode?"geoanalytics":"default"===this.analysisMode?"standard":this.analysisMode}};"CopyToDataStore"===this.toolName&&(y.jobParams.isSpatioTemporalDataStore=this._isSpatioTemporalDataStore);"bigdata"===this.analysisMode&&y.jobParams.timeStepReference&&(y.jobParams.timeReferenceType=this.get("timeReferenceType"));"bigdata"===this.analysisMode&&y.jobParams.timeBoundaryReference&&(y.jobParams.timeBoundaryReferenceType=this.get("timeBoundaryReferenceType"));
for(A in y.jobParams)if(y.jobParams.hasOwnProperty(A)&&u.isDefined(y.jobParams[A])){if("object"===typeof y.jobParams[A]&&y.jobParams[A].serviceToken||"string"===typeof y.jobParams[A]&&-1!==y.jobParams[A].indexOf("serviceToken")){var w="string"===typeof y.jobParams[A]?m.fromJson(y.jobParams[A]):y.jobParams[A];w&&w.serviceToken&&(delete w.serviceToken,y.jobParams[A]="string"===typeof y.jobParams[A]?m.toJson(w):w)}if("object"===typeof y.jobParams[A]&&!n.isArray(y.jobParams[A])&&y.jobParams[A].filter||
"string"===typeof y.jobParams[A]&&-1!==y.jobParams[A].search(/[<>]/g))"object"===typeof y.jobParams[A]&&y.jobParams[A].filter&&!n.isArray(y.jobParams[A])?y.jobParams[A].filter=C.safetagsReplace(y.jobParams[A].filter):"string"===typeof y.jobParams[A]&&-1!==y.jobParams[A].search(/[<>]/g)&&(y.jobParams[A]=C.safetagsReplace(y.jobParams[A]))}var A=q.id.findCredential(this.portalUrl);this.currentGpItemId&&(A={id:this.currentGpItemId,folderId:this.itemParams.folder,owner:A.userId},B.addToItemResource(A,
y));this.doSaveInStorage&&B.addToStorage(y)}},_initErrorHelpMap:function(){if(this.isSingleTenant){var y=H.toUrl("./help/errorhelpmap_enterprise.json");v({url:y}).then(n.hitch(this,function(w){this.errorHelpMap=w.map}))}},_addLearnMoreErrorLink:function(y){if(this.isSingleTenant){var w=this.portalSelf&&this.portalSelf.helpMap&&this.portalSelf.helpMap.m;y=w&&w[this.errorHelpMap[y]];w=this&&this.portalSelf?this.portalSelf.helpBase:null;var A=this.analysisGpServer&&-1!==this.analysisGpServer.indexOf("dev")?
"dev":this.analysisGpServer&&-1!==this.analysisGpServer.indexOf("qa")?"uat":"";if(u.isDefined(y)){var z="http://doc"+A+".arcgis.com/en/arcgis-online/analyze/"+y;this.isSingleTenant&&w?z=w+y:this.isSingleTenant&&!w&&(z="http://server"+A+".arcgis.com/en/portal/latest/use/"+y)}z&&(z="\x3cbr/\x3e\x3cbr/\x3e\x3cdiv class\x3d'esriHelpPopup'\x3e\x3ca class\x3d'action zoomTo' href\x3d'"+z+"' target\x3d'_help'\x3e"+this.i18n.learnMore+"\x3c/a\x3e\x3c/div\x3e\x3cbr/\x3e\x3cbr/\x3e");return z}},getLearnMoreLink:function(y){return y?
this._addLearnMoreErrorLink(y):""},_byPassCreditCheck:function(y){return-1!==this._freeGPTools.indexOf(y)}});l("extend-esri")&&n.setObject("dijit.analysis.AnalysisBase",k,q);return k})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F){H=H(g,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(y){this._jobUpdateHandler=k.hitch(this,this._jobUpdateHandler);this._getJobStatus=k.hitch(this,this._getJobStatus);this._getResultDataHandler=
k.hitch(this,this._getResultDataHandler);this._getResultImageHandler=k.hitch(this,this._getResultImageHandler);this._executeHandler=k.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(y){this.updateDelay=y},setProcessSpatialReference:function(y){this.processSpatialReference=y},setOutputSpatialReference:function(y){this._setOutSR(y)},setOutSpatialReference:function(y){this._setOutSR(y)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(y){this.outSpatialReference=this.outputSpatialReference=y},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(y,w,A){for(var z in y){var G=y[z];k.isArray(G)?y[z]=m.toJson(n.map(G,function(I){return this._gpEncode({item:I},!0).item},this)):G instanceof Date&&(y[z]=G.getTime())}return this._encode(y,w,A)},_decode:function(y){var w=y.dataType,
A=new x(y);if(-1!==n.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],w))return A;if("GPLinearUnit"===w)A.value=new q(A.value);else if("GPFeatureRecordSetLayer"===w||"GPRecordSet"===w)A.value=new d(A.value);else if("GPDataFile"===w)A.value=new u(A.value);else if("GPDate"===w)y=A.value,k.isString(y)?A.value=new t({date:y}):A.value=new Date(y);else if("GPRasterData"===w||"GPRasterDataLayer"===w)y=y.value.mapImage,A.value=y?new F(y):new v(A.value);else if(-1!==w.indexOf("GPMultiValue:")){var z=w.split(":")[1];
y=A.value;A.value=n.map(y,function(G){return this._decode({paramName:"_name",dataType:z,value:G}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+A.dataType),A=null;return A},submitJob:function(y,w,A,z,G){var I=this._getOutSR(),K=G.assembly;y=this._gpEncode(k.mixin({},this._url.query,{f:"json","env:outSR":I?I.wkid||m.toJson(I.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||m.toJson(this.processSpatialReference.toJson()):
null},y),null,K&&K[0]);var Q=this._jobUpdateHandler,N=this._errorHandler;return c({url:this._url.path+"/submitJob",content:y,callbackParamName:"callback",load:function(T,W){Q(T,W,!1,w,A,G.dfd)},error:function(T){N(T,z,G.dfd)}})},_jobUpdateHandler:function(y,w,A,z,G,I){var K=y.jobId;w=new h(y);this._successHandler([w],"onStatusUpdate",G,A&&I);if(!A)switch(clearTimeout(this._updateTimers[K]),this._updateTimers[K]=null,I&&I.progress(w),y.jobStatus){case h.STATUS_SUBMITTED:case h.STATUS_EXECUTING:case h.STATUS_WAITING:case h.STATUS_NEW:var Q=
this._getJobStatus;this._updateTimers[K]=setTimeout(function(){Q(K,A,z,G,I)},this.updateDelay);break;default:this._successHandler([w],"onJobComplete",z,I)}},_getJobStatus:function(y,w,A,z,G){var I=this._jobUpdateHandler;c({url:this._url.path+"/jobs/"+y,content:k.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(K,Q){I(K,Q,w,A,z,G)},error:this._errorHandler})},_getResultDataHandler:function(y,w,A,z,G){try{var I=this._decode(y);this._successHandler([I],"onGetResultDataComplete",
A,G)}catch(K){this._errorHandler(K,z,G)}},getResultData:function(y,w,A,z){var G=this._getResultDataHandler,I=this._errorHandler,K=new r(f._dfdCanceller);K._pendingDfd=c({url:this._url.path+"/jobs/"+y+"/results/"+w,content:k.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(Q,N){G(Q,N,A,z,K)},error:function(Q){I(Q,z,K)}});return K},checkJobStatus:function(y,w,A){var z=this._jobUpdateHandler,G=this._errorHandler,I=new r(f._dfdCanceller);I._pendingDfd=
c({url:this._url.path+"/jobs/"+y,content:k.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(K,Q){z(K,Q,!0,null,w,I)},error:function(K){G(K,A,I)}});return I},cancelJob:function(y,w,A){var z=this._errorHandler,G=new r(f._dfdCanceller);G._pendingDfd=c({url:this._url.path+"/jobs/"+y+"/cancel",content:k.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:k.hitch(this,function(I,K){this._successHandler([I],"onJobCancel",w,G)}),error:function(I){z(I,A,G)}});
return G},execute:function(y,w,A,z){var G=this._getOutSR(),I=z.assembly;y=this._gpEncode(k.mixin({},this._url.query,{f:"json","env:outSR":G?G.wkid||m.toJson(G.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||m.toJson(this.processSpatialReference.toJson()):null},y),null,I&&I[0]);var K=this._executeHandler,Q=this._errorHandler;return c({url:this._url.path+"/execute",content:y,callbackParamName:"callback",load:function(N,T){K(N,T,w,A,z.dfd)},error:function(N){Q(N,
A,z.dfd)}})},_executeHandler:function(y,w,A,z,G){try{var I=y.results,K,Q=y.messages;var N=0;for(K=I.length;N<K;N++)I[N]=this._decode(I[N]);N=0;for(K=Q.length;N<K;N++)Q[N]=new p(Q[N]);this._successHandler([I,Q],"onExecuteComplete",A,G)}catch(T){this._errorHandler(T,z,G)}},_getResultImageHandler:function(y,w,A,z,G){try{var I=this._decode(y);this._successHandler([I],"onGetResultImageComplete",A,G)}catch(K){this._errorHandler(K,z,G)}},getResultImage:function(y,w,A,z,G){var I=this._getResultImageHandler,
K=this._errorHandler;A=this._gpEncode(k.mixin({},this._url.query,{f:"json"},A.toJson()));var Q=new r(f._dfdCanceller);Q._pendingDfd=c({url:this._url.path+"/jobs/"+y+"/results/"+w,content:A,callbackParamName:"callback",load:function(N,T){I(N,T,z,G,Q)},error:function(N){K(N,G,Q)}});return Q},cancelJobStatusUpdates:function(y){clearTimeout(this._updateTimers[y]);this._updateTimers[y]=null},getResultImageLayer:function(y,w,A,z){if(null==w){var G=this._url.path.indexOf("/GPServer/");y=this._url.path.substring(0,
G)+"/MapServer/jobs/"+y}else y=this._url.path+"/jobs/"+y+"/results/"+w;this._url.query&&(y+="?"+b.objectToQuery(this._url.query));w=null==w?new B(y,{imageParameters:A}):new C(y,{imageParameters:A},!0);this.onGetResultImageLayerComplete(w);z&&z(w);return w},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});e._createWrappers(H);
l("extend-esri")&&k.setObject("tasks.Geoprocessor",H,a);return H})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(H,k,n,r,m){H=H(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(l){this.messages=[];k.mixin(this,l);l=this.messages;var b,a=l.length;for(b=0;b<a;b++)l[b]=new m(l[b])},jobId:"",jobStatus:""});k.mixin(H,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});n("extend-esri")&&k.setObject("tasks.JobInfo",H,r);return H})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,k,n,r){H=H(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(m){k.mixin(this,
m)}});k.mixin(H,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});n("extend-esri")&&k.setObject("tasks.GPMessage",H,r);return H})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(H,k,n,r){H=H(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(m){m&&k.mixin(this,m)},distance:0,units:null,toJson:function(){var m={};this.distance&&(m.distance=this.distance);this.units&&(m.units=this.units);return m}});n("extend-esri")&&k.setObject("tasks.LinearUnit",H,r);return H})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,k,n,r){H=H(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(m){m&&k.mixin(this,m)},url:null,itemID:null,toJson:function(){var m={};this.url&&(m.url=this.url);this.itemID&&(m.itemID=this.itemID);return m}});n("extend-esri")&&k.setObject("tasks.DataFile",H,r);return H})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,k,n,r){H=H(null,{declaredClass:"esri.tasks.RasterData",constructor:function(m){m&&k.mixin(this,m)},url:null,format:null,itemID:null,toJson:function(){var m=
{};this.url&&(m.url=this.url);this.format&&(m.format=this.format);this.itemID&&(m.itemID=this.itemID);return m}});n("extend-esri")&&k.setObject("tasks.RasterData",H,r);return H})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(H,k,n,r,m){H=H(null,{declaredClass:"esri.tasks.Date",constructor:function(l){l&&(l.format&&(this.format=l.format),this.date=n.parse(l.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:n.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});r("extend-esri")&&k.setObject("tasks.Date",H,m);return H})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,k,n,r){H=H(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(m){k.mixin(this,m)}});n("extend-esri")&&k.setObject("tasks.ParameterValue",H,r);return H})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(H,k,n,r,m,l,b){H=H(b,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(a,c){c&&c.imageParameters&&c.imageParameters.extent&&(this.initialExtent=this.fullExtent=c.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=k.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(a,c,f,e){var g=a.spatialReference.wkid;e(this._url.path+"?"+m.objectToQuery(k.mixin(this._params,{f:"image",bbox:n.toJson(a.toJson()),bboxSR:g,imageSR:g,size:c+","+f})))}});r("extend-esri")&&k.setObject("tasks._GPResultImageLayer",H,l);return H})},"esri/dijit/analysis/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/fx dojo/_base/json dojo/_base/kernel dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/date/locale dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/promise/all dojo/fx/easing dojo/number dojo/_base/window dojo/when dojo/dom dojo/on dojo/data/ItemFileWriteStore dojo/topic dojo/store/Memory dojox/mvc/equals dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../units ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor ../../dijit/SingleFilter ./FeatureRecordSetLayer ./PluginLayers ./PCSList ./ItemTypes ../../layers/ArcGISImageServiceLayer ../../layers/RasterXLayer ../../layers/RasterFunction ./AnalysisRegistry ../RasterFunctionEditor/utils".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I,K,Q,N,T,W,X,ea,fa,J,V,aa,Z,L,O,D,P,R,ca,ha,oa,ma,U,da,na,ia,pa){H={};k.mixin(H,{_helpDialog:null,systemRFTGroupName:"Raster Function Templates",i18n:null,UNITSMAP:{Feet:"esriFeet",Yards:"esriYards",Miles:"esriMiles",Meters:"esriMeters",Kilometers:"esriKilometers",NauticalMiles:"esriNauticalMiles"},initHelpLinks:function(E,M,ba){if(E){var Y=T.byNode(E),ka=Y?Y.get("helpFileName"):ba&&ba.helpFileName?ba.helpFileName:null,S=Y?Y.get("isSingleTenant"):
ba&&ba.isSingleTenant?ba.isSingleTenant:!1,ja=ia.Modes.standard,la=Y&&Y.portalSelf?Y.portalSelf.helpBase:ba&&ba.helpBase?ba.helpBase:null,qa=Y&&Y.portalSelf;this._helpDialog||(this._helpDialog=new aa({isPortal:S,portalSelf:qa}));Y&&(Y.showGeoAnalyticsParams||Y.showBigData)||ba&&ba.analysisMode&&ba.analysisMode===ia.Modes.Bigdata?(ka+="_bd",ja=ia.Modes.Bigdata):ba&&ba.analysisMode&&"raster"===ba.analysisMode&&(ka+="_ra",ja=ia.Modes.Raster);q("[esriHelpTopic]",E).forEach(function(ta,Ba,wa){ta&&(v.set(ta,
"display",fa.isDefined(M)&&!0!==M?"none":""),fa.isDefined(ta._helpClickHandler)&&(ta._helpClickHandler.remove(),ta._helpClickHandler=null),ta._helpClickHandler=G(ta,"click",k.hitch(this,function(ua){m.stop(ua);ba&&ba.showHelpFromUrl&&ba.helpUrl?this._helpDialog.show(ua,{showHelpFromUrl:ba.showHelpFromUrl,helpUrl:ba.helpUrl}):this._helpDialog.show(ua,{helpId:c.get(ta,"esriHelpTopic"),helpFileName:ka,analysisGpServer:ba&&ba.analysisGpServer?ba.analysisGpServer:null,helpParentNode:E,isPortal:S,analysisMode:ja,
helpBase:la,portalSelf:Y&&Y.portalSelf})})))},this)}},constructAnalysisFeatColl:function(E){var M={},ba;M.featureCollection=E.layerDefinition;for(ba in M.featureCollection)M.featureCollection.hasOwnProperty(ba)&&"objectIdField"===ba&&(M.featureCollection.objectIdFieldName=k.clone(M.featureCollection.objectIdField),delete M.featureCollection.objectIdField);M.featureCollection.features=E.featureSet.features;return M},constructAnalysisInputLyrObj:function(E,M,ba){if(E instanceof U||"Image Service"===
E.type||"esri.layers.RasterXLayer"===E.declaredClass)return pa.getRasterJsonFromLayer(E);var Y={},ka="";fa.isDefined(ba)||(ba=!0);if(E.getMap)var S=E.getMap();else E._map&&(S=E._map);if(E.url&&!E._collection)Y={url:E.url},this.isHostedService(E.url),E.getDefinitionExpression&&E.getDefinitionExpression()?Y.filter=E.getDefinitionExpression():fa.isDefined(E.definitionExpression)&&""!==E.definitionExpression&&(Y.filter=E.definitionExpression),E.useMapTime&&E.timeInfo&&S&&S.timeExtent&&ba&&(S.timeExtent.startTime?
(ka+=S.timeExtent.startTime.getTime(),S.timeExtent.endTime&&(ka+=","+S.timeExtent.endTime.getTime())):S.timeExtent.endTime&&(ka+=S.timeExtent.endTime.getTime()),ka&&(Y.time=ka)),E.credential&&(Y.serviceToken=E.credential.token),-1!==Y.url.indexOf("?")&&(ba=Y.url.substring(Y.url.indexOf("?")+1,Y.url.length),ba=g.queryToObject(ba),k.mixin(Y,ba),Y.url=Y.url.substring(0,Y.url.indexOf("?")));else if(!E.url||E._collection)try{Y=E.toJson()}catch(ja){E._json=h.parse(E._json),Y=E.toJson()}Y.name=E.name;M&&
(Y=new ca(Y));return Y},formatDate:function(E){return u.format(E,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+u.format(E,{selector:"time",timePattern:"HH:mm:ss"})},isHostedService:function(E){if(!E)return!1;var M=-1!==E.indexOf(".arcgis.com/");E=-1!==E.indexOf("/services")||-1!==E.indexOf("//tiles")||-1!==E.indexOf("//features");return M&&E},isPortalHostedService:function(E){return E?-1!==E.toLowerCase().indexOf("/hosted/"):!1},isTimeEnabled:function(E){var M=10.2<=E.version&&E._useStandardizedQueries;
return E.useMapTime&&E.timeInfo&&(M||10.2<=E.version)||fa.isDefined(E.time)},isTimeInstantLayer:function(E){return fa.isDefined(E.timeInfo)&&fa.isDefined(E.timeInfo.startTimeField)&&!fa.isDefined(E.timeInfo.endTimeField)||fa.isDefined(E.time)&&fa.isDefined(E.time.timeType)&&"instant"===E.time.timeType},buildReport:function(E,M){var ba="";M||(M={},k.mixin(M,d.analysisMsgCodes));n.forEach(E,function(Y,ka){if("string"===typeof Y.message){var S=fa.isDefined(M[Y.messageCode])?M[Y.messageCode]:Y.message;
ba+=Y.style.substring(0,Y.style.indexOf("\x3c/"))+(this._isEmptyObject(Y.params)?S:p.substitute(S,Y.params))+Y.style.substring(Y.style.indexOf("\x3c/"))}else if(k.isArray(Y.message)){var ja=[];var la=k.clone(Y.style);n.forEach(Y.message,function(qa,ta){la=la.replace(/<\//,"${"+ta+"}");S=fa.isDefined(M[Y.messageCode+"_"+ta])?M[Y.messageCode+"_"+ta]:qa;S=this._isEmptyObject(Y.params)?S:p.substitute(S,Y.params);"string"===typeof S&&(S=this.safetagsReplace(S));ja.push(S+"\x3c/")},this);la=p.substitute(la,
ja);ba+=la}},this);return ba},getLayerFeatureCount:function(E,M){var ba=new Z,Y=new C;M||(M={});ba.geometry=M.geometry;ba.geometryType=M.geometryType||"esriGeometryEnvelope";E.url||ba.geometry?(E.url&&(ba.where=M.where||"1\x3d1",E.getDefinitionExpression&&E.getDefinitionExpression()&&!M.where?ba.where=E.getDefinitionExpression():fa.isDefined(E.definitionExpression)&&""!==E.definitionExpression&&!M.where&&(ba.where=E.definitionExpression)),Y=E.queryCount(ba)):Y.resolve(E.graphics.length);return Y.promise},
createPolygonFeatureCollection:function(E){var M={layerDefinition:null,featureSet:{features:[],geometryType:ia.GeometryTypes.Polygon}};M.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:ia.GeometryTypes.Polygon,minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",
name:E,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",
type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return M},createPointFeatureCollection:function(E){var M={layerDefinition:null,featureSet:{features:[],geometryType:ia.GeometryTypes.Point}};
M.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:E,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:ia.GeometryTypes.Point,fields:[{alias:"OBJECTID",
name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return M},createFolderStore:function(E,M){var ba=new I({data:{identifier:"id",label:"name",items:[]}});ba.newItem({name:M,id:""});
n.forEach(E,function(Y){ba.newItem({name:Y.title,id:Y.id})});return ba},setupFoldersUI:function(E){E.folderSelect.set("store",E.folderStore);E.folderSelect.set("required",!0);E.folderSelect.set("searchAttr","name");fa.isDefined(E.folderId)?E.folderStore.get(E.folderId).then(k.hitch(this,function(M){fa.isDefined(M)?E.folderSelect.set("item",M):E.folderStore.get("").then(function(ba){E.folderSelect.set("item",ba)},this)})):E.folderName?E.folderStore.fetch({query:{name:E.folderName},onComplete:k.hitch(this,
function(M){fa.isDefined(M)&&0<M.length?E.folderSelect.set("item",M[0]):E.folderStore.get("").then(function(ba){E.folderSelect.set("item",ba)},this)})}):E.username?E.folderSelect.set("displayedValue",E.username):E.folderStore.get("").then(function(M){E.folderSelect.set("item",M)},this)},_isEmptyObject:function(E){for(var M in E)if(E.hasOwnProperty(M))return!1;return!0},validateServiceName:function(E,M){var ba=/(:|&|<|>|%|#|\?|\\|"|\/|\+|=|\*|@|'|;|\||,)/g.test(E),Y=!0,ka=!0;if(fa.isDefined(M)&&M.textInput)var S=
M.textInput;fa.isDefined(M)&&fa.isDefined(M.isItem)&&(ka=M.isItem);this.initI18n();if(0===E.length||0===p.trim(E).length){var ja=this.i18n.requiredValue;Y=!1}else if(ba)ja=this.i18n.invalidServiceName,Y=!1;else if(ka&&98<E.length)ja=this.i18n.invalidServiceNameLength,Y=!1;else if(ka&&170<encodeURIComponent(E).length){for(E+="";170<encodeURIComponent(E).length;)E=E.substring(0,E.length-1);ja=p.substitute(this.i18n.suggestedServiceNameLength,{count:E.length});Y=!1}S&&!Y&&S.set("invalidMessage",ja);
return Y},getStepNumber:function(E){q(".esriAnalysisNumberLabel",E).forEach(function(M,ba){ba=this._getNumberLabel(ba);c.set(M,"innerHTML",ba)},this)},_getNumberLabel:function(E){var M="";this.initI18n();switch(E){case 0:M=this.i18n.oneLabel;break;case 1:M=this.i18n.twoLabel;break;case 2:M=this.i18n.threeLabel;break;case 3:M=this.i18n.fourLabel;break;case 4:M=this.i18n.fiveLabel;break;case 5:M=this.i18n.sixLabel;break;case 6:M=this.i18n.sevenLabel;break;case 7:M=this.i18n.eightLabel;break;case 8:M=
this.i18n.nineLabel;break;case 9:M=this.i18n.tenLabel;break;case 10:M=this.i18n.elevenLabel;break;case 11:M=this.i18n.twelveLabel;break;case 12:M=this.i18n.thirteenLabel}return M},populateAnalysisLayers:function(E,M,ba,Y){if(E){var ka=[],S=E.get(M);M=Y&&Y.layerSelect?Y.layerSelect:E._analysisSelect;E.rerun&&!S&&(Y||(Y={}),Y.chooseBlank=!0);E._titleRow&&v.set(E._titleRow,"display","none");E._analysisLabelRow&&v.set(E._analysisLabelRow,"display","table-row");E._selectAnalysisRow&&(v.set(E._selectAnalysisRow,
"display","table-row"),v.set(E._analysisSelect.domNode.parentNode,"padding-bottom","1em"));E.domNode&&this.getStepNumber(E.domNode);fa.isDefined(Y)&&Y.chooseLabel&&ka.push({value:-1,label:this.i18n.chooseLabel});fa.isDefined(Y)&&Y.chooseBlank&&ka.push({value:"  ",label:""});fa.isDefined(Y)&&fa.isDefined(Y.posIncrement)||(fa.isDefined(Y)||(Y={}),Y.posIncrement=0);E.get(ba)||E.set(ba,[]);n.forEach(E.get(ba),function(ja,la){la+=Y.posIncrement;la={value:fa.isDefined(Y)&&Y.chooseLabel?""+la+1:""+la,label:ja.name};
S&&(ja.name===S.name||ja.url&&S.url&&ja.url===S.url)&&(la.selected=!0);ka.push(la)},this);M.addOption(ka);M.set("required",!0);Y.chooseBlank&&"  "===M.get("value")&&setTimeout(k.hitch(this,this._validateSelectUI,M),100)}},isValidAnalysisLayer:function(E){var M="",ba=!0;var Y={isValid:ba,validationMessage:M};var ka,S,ja=0,la=0,qa=0,ta,Ba,wa,ua=!0;if(!fa.isDefined(E)||!fa.isDefined(E.toolName))return Y;this.initI18n();Y=E.toolName;var ra=E.layers;var sa=E.analysisLayer;var va=Y.charAt(0).toLowerCase()+
Y.substring(1);var za=this.i18n;E=E.showReadyToUseLayers||!1;n.forEach(ra,function(Aa){ua=!1;if(Aa instanceof U||"esri.layers.RasterXLayer"===Aa.declaredClass)ta=!0;ta&&1<Aa.bandCount&&(Ba=!0);ta&&1===Aa.bandCount&&(wa=!0);Aa.geometryType===ia.GeometryTypes.Point&&(Ea=!0,ja++);if(Aa.geometryType===ia.GeometryTypes.Point||Aa.geometryType===ia.GeometryTypes.MultiPoint)ka=!0;Aa.geometryType===ia.GeometryTypes.Line&&(S=!0,qa++);Aa.geometryType===ia.GeometryTypes.Polygon&&(Oa=!0,la++)},this);if(-1!==n.indexOf(["CreateDriveTimeAreas",
"PlanRoutes","ConnectOriginsToDestinations"],Y)&&(!Ea||sa&&sa.geometryType!==ia.GeometryTypes.Point))M=p.substitute(this.i18n.selectPointLayer,{toolName:za[va]}),ba=!1;else if("AggregatePoints"!==Y&&"InterpolatePoints"!==Y||(!sa||sa.geometryType===ia.GeometryTypes.Point||sa.geometryType===ia.GeometryTypes.MultiPoint)&&ka)if("CalculateDensity"===Y&&(!ka&&!S||sa&&sa.geometryType!==ia.GeometryTypes.Point&&sa.geometryType!==ia.GeometryTypes.MultiPoint&&sa.geometryType!==ia.GeometryTypes.Line))M=p.substitute(this.i18n.areaFeatureInvalidMsg,
{toolName:za[va]}),ba=!1;else if("FindHotSpots"!==Y&&"FindOutliers"!==Y||E||!(!ka&&!Oa||sa&&sa.geometryType!==ia.GeometryTypes.Point&&sa.geometryType!==ia.GeometryTypes.MultiPoint&&sa.geometryType!==ia.GeometryTypes.Polygon))if("OverlayLayers"!==Y&&"AggregatePoints"!==Y&&"SummarizeWithin"!==Y&&"SummarizeNearby"!==Y&&"FindNearest"!==Y&&"MergeLayers"!==Y||E||0!==ra.length&&(1!==ra.length||ra[0]!==sa&&fa.isDefined(sa)))if("ConnectOriginsToDestinations"===Y&&!E&&(ua||2>ja))M=p.substitute(this.i18n.odPointMsg,
{toolName:za[va]}),ba=!1;else if(this.isFindCentroids(Y)&&this.isPointLayer(sa))M=p.substitute(this.i18n.selectNoPointLayer,{toolName:za[va]}),ba=!1;else if("AggregatePoints"===Y&&!E&&1<ra.length){var Oa=n.some(ra,function(Aa){return Aa.geometryType===ia.GeometryTypes.Polygon});Oa||(M=p.substitute(this.i18n.aggregatePolyMsg,{toolName:za[va]}),ba=!1)}else if("MergeLayers"===Y&&!E&&1<ra.length)1<ja||1<qa||1<la||(M=this.i18n.mergeValidationMsg,ba=!1);else if("SummarizeWithin"!==Y&&"DissolveBoundaries"!==
Y||(!sa||sa.geometryType===ia.GeometryTypes.Polygon)&&Oa||E)if("ExtractData"===Y)(ba=n.some(ra,function(Aa){return-1!==Aa.capabilities.indexOf("Extract")}))||(M=p.substitute(this.i18n.extractValidationMsg));else if(("ConnectOriginsToDestinations"===Y||Y===ia.Tools.ChooseBestFacilities)&&1<ra.length){var Ea=n.some(ra,function(Aa){var Wa=fa.isDefined(sa)&&sa.id===Aa.id;return Aa.geometryType===ia.GeometryTypes.Point&&!Wa});Ea||(M=p.substitute(Y===ia.Tools.ChooseBestFacilities?this.i18n.selectPointLayer:
this.i18n.odPointMsg,{toolName:za[va]}),ba=!1)}else"CalculateSlope"===Y||"DeriveAspect"===Y||"RemapValues"===Y?ta?wa||(ba=!1,M=p.substitute(this.i18n.noSingleBandISMsg,{toolName:za[va]})):(ba=!1,M=p.substitute(this.i18n.noImageServiceMsg,{toolName:za[va]})):"ExtractRaster"===Y?ta||(ba=!1,M=p.substitute(this.i18n.noImageServiceMsg,{toolName:za[va]})):"MonitorVegetation"===Y&&(ta?Ba||(ba=!1,M=p.substitute(this.i18n.noMultiBandISMsg,{toolName:za[va]})):(ba=!1,M=p.substitute(this.i18n.noImageServiceMsg,
{toolName:za[va]})));else M=p.substitute(this.i18n.selectPolyLayer,{toolName:za[va]}),ba=!1;else M=p.substitute(this.i18n.overlayValidationMsg,{toolName:za[va]}),ba=!1;else M=p.substitute(this.i18n.hotspotsLineFeatureMsg,{toolName:za[va]}),ba=!1;else M=p.substitute(this.i18n.selectPointLayer,{toolName:za[va]}),ba=!1;return Y={isValid:ba,validationMessage:M}},isFindCentroids:function(E){return E===ia.Tools.FindCentroids},isPointLayer:function(E){return E&&E.geometryType===ia.GeometryTypes.Point},initI18n:function(){this.i18n||
(this.i18n={},k.mixin(this.i18n,d.common),k.mixin(this.i18n,d.analysisTools),k.mixin(this.i18n,d.analysisMsgCodes),k.mixin(this.i18n,d.browseLayersDlg),k.mixin(this.i18n,d.driveTimes),k.mixin(this.i18n,d.calculateFields))},addBrowseAnalysisDialog:function(E){if(E&&E.widget){this.i18n||this.initI18n();var M="esri/dijit/analysis/PluginAnalysisLayers",ba=function(ra){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(ra.thumbnailUrl||this._portal.staticImagesUrl+
"/desktopapp.png")+"'\x3e"},Y=function(ra){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(ra.title||ra.name||"\x3cNo Title\x3e")+"'\x3e"+(ra.title.replace(/_/g," ")||ra.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},ka=function(ra){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+ra.iconUrl+"'/\x3e"},S=function(ra){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+
ra.iconUrl+"'/\x3e"},ja=w.doc.createDocumentFragment();ja=x.create("div",{style:"width:100%;height:100%;"},ja);var la=x.create("div",{style:"width:100%;height:10%;","class":""}),qa=x.create("div",{style:"width:100%"},ja),ta=this._isCustomAnalysisQuery(E.widget);1===E.browseType?(M="esri/dijit/analysis/PluginLayers",M={portalUrl:E.widget.get("portalUrl"),message:"",plugin:M,sortDescending:!0,sort:"title",self:E.widget.get("portalSelf"),itemsPerPage:100,demandList:!0,extent:E.widget.get("map").extent,
useExtent:!1,fetchTimeout:600,galleryTemplate:"\x3cdiv class\x3d'listServiceTitle'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%'\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cdiv  style\x3d\"position:absolute;left:80px; top:10px; width:1px; height:1px; background: transparent;\"\x3e\x3c/div\x3e\x3cdiv style\x3d'overflow:hidden;'\x3e\x3ca style\x3d\"height:16px;\"\x3e${item.title}\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%' class\x3d'bottomRowTable'\x3e\x3ctd width\x3d'20'\x3e  \x3cspan class\x3d'esriAlignLeading'\x3e${item:_formatThumbnail}\x3c/span\x3e\x3c/td\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cspan class\x3d'esriAlignLeading' style\x3d'color:#656565;'\x3e${item.owner}\x3c/span\x3e\x3c/td\x3e\x3ctd style\x3d'padding-right:5px;padding-left:3px;'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e",
showInfoPanel:!0,isAutoClose:!1,checkIsButtonEnabled:!0,formatThumbnail:S,formatInfoPanelImage:ka,"class":"esriAnalysisLayersItems"}):M={portalUrl:E.widget.get("portalUrl"),message:"",plugin:M,sortDescending:!0,sort:"title",self:E.widget.get("portalSelf"),pagingLinks:1,rowsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",extent:E.widget.get("map").extent,useExtent:!ta,fetchTimeout:600,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatItemTitle:Y,showInfoPanel:!1,showTooltip:!0,formatThumbnail:ba,style:"width:48em;height:100%;clear:both;"};Y=x.toDom('\x3cdiv class\x3d"esriBrowseOptions"\x3e');x.place(Y,la);ba=x.create("div",{"class":"esriBrowseOption"},Y);if(!E.browseType||1!==E.browseType){Y=x.create("div",{"class":"esriBrowseOption"},Y);var Ba=new X({name:"addlayer",id:E.widget.id+(E.browseType?E.browseType:"")+"_addlayercheck","class":"",value:!1,checked:!1},x.create("input",{},Y));x.create("label",{"for":E.widget.id+
"_addlayercheck","class":"esriBrowseOption_label",innerHTML:this.i18n.addLayer},Y)}Y=!0;E.browseType&&1===E.browseType?Y=!1:ta&&(Y=!1);Y=new X({name:"extentcheck",id:E.widget.id+(E.browseType?E.browseType:"")+"_addextentcheck","class":"",value:Y,checked:Y},x.create("input",{},ba));x.create("label",{"for":E.widget.id+(E.browseType?E.browseType:"")+"_addextentcheck","class":"esriBrowseOption_label",innerHTML:this.i18n.withinMapArea},ba);M.messageRight=la;var wa=new L(M,qa);Y.on("change",k.hitch(this,
function(ra){wa.set("useExtent",ra)}));var ua=new W({title:1===E.browseType?this.i18n.browseLayers:ta?this.i18n.browseAnalysisLayers:this.i18n.browseAnalysisTitle,content:ja,browseItems:wa,addlayerCheckBox:Ba,style:E.browseType&&1===E.browseType?"":"padding:.75em 0;background-color: #fff;width:50em;"});E.widget.own(ua.on("hide",k.hitch(ua,function(ra){ua.browseItems.reset()})));return ua}},addAnalysisReadyLayer:function(E,M){function ba(wa){var ua;if("Feature Service"===S.type){var ra=new O(S.url,
{outFields:["*"]});k.mixin(S,ra)}"Image Service"===S.type&&(ra=-1<wa.capabilities.indexOf("TilesOnly")?new da(S.url,{outFields:["*"]}):new U(S.url,{outFields:["*"]}),k.mixin(S,ra));k.mixin(S,wa);S.id=S.title+"_"+wa.id;S.title=E.item.selectedLayer?S.title+"-"+wa.name:S.title.replace(/_/g," ");S.name=S.title;S.version=S.currentVersion;if(la&&E.widget.showBrowseLayers){var sa=(ua=E.layersSelect.get("store"))&&ua.data;ua=2;ua=sa.splice(sa.length-ua,ua);var va={id:sa.length,label:S.title,name:S.title,
url:S.url};sa.push(va);sa=sa.concat(ua);ua=new Q({data:sa,idProperty:"id"});E.layersSelect.set("store",ua);E.layersSelect.set("value",va.name)}else{sa=E.layersSelect.getOptions();if(E.widget.useArcGISComponents&&(E.widget.showBrowseLayers||E.widget.showReadyToUseLayers))ua=2;else if(E.widget.showBrowseLayers&&E.widget.showReadyToUseLayers)ua=3;else if(E.widget.showBrowseLayers||E.widget.showReadyToUseLayers)ua=2;ua=sa.splice(sa.length-ua,ua);E.layersSelect.removeOption(ua);sa=E.layers.length;E.posIncrement&&
(sa+=E.posIncrement);sa=""+sa;ua.unshift({value:sa,label:S.title,selected:!0});E.layersSelect.addOption(ua);E.layersSelect.set("value",sa)}ra&&(S.lyr=ra,ra.name=S.name);S.linfo=wa;E.layers.push(S);if(E.browseDialog.addlayerCheckBox&&E.browseDialog.addlayerCheckBox.get("checked")||ja||M)this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=E.widget.map.on("layer-add",k.hitch(this,function(za){this._addLayerHandle.remove();E.widget.emit("add-ready-to-use-layer",{layer:za.layer,layerInfo:wa,
item:S})})),E.widget.map.addLayer(ra);E.browseDialog.browseItems&&E.browseDialog.browseItems.clear()}if(fa.isDefined(E)&&fa.isDefined(E.item)&&fa.isDefined(E.layersSelect)&&fa.isDefined(E.layers)&&fa.isDefined(E.browseDialog)){E.browseDialog.hide&&E.browseDialog.hide();var Y,ka;(Y=!E.item.selectedLayer&&E.item.url?E.item.type===ma.IS?E.item.url:E.item.url+"/0":E.item.selectedLayer.url)&&-1!==window.location.protocol.indexOf("https:")&&(Y=Y.replace("http:","https:"));var S={url:Y,itemId:E.item.id,
title:E.item.title,type:E.item.type,analysisReady:!0};Y=n.some(E.layers,function(wa,ua){var ra=wa.analysisReady&&S.analysisReady&&wa.itemId===S.itemId;E.item.selectedLayer&&E.item.selectedLayer.url&&(ra=wa.itemId&&S.itemId?wa.itemId===S.itemId&&wa.url===S.url:wa.url===S.url);ra&&(ka=ua);return ra});var ja;E.browseDialog.browseItems&&q(".js-add-layer-checkbox",E.browseDialog.browseItems.infoPanel).forEach(function(wa){ja=wa.checked});var la=-1!==E.layersSelect.baseClass.indexOf("dijitComboBox");var qa=
new C;var ta="sync";if(Y){E.posIncrement&&(ka+=E.posIncrement);if(E.browseDialog.addlayerCheckBox&&E.browseDialog.addlayerCheckBox.get("checked")||ja||M){E.posIncrement||(E.posIncrement=0);var Ba=E.layers[ka-E.posIncrement];E.widget.map.getLayer(Ba.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=E.widget.map.on("layer-add",k.hitch(this,function(wa){this._addLayerHandle.remove();E.widget.emit("add-ready-to-use-layer",{layer:wa.layer,layerInfo:Ba.linfo,item:Ba})})),
E.widget.map.addLayer(Ba.lyr))}la?E.layersSelect.set("value",E.layers[ka-1].name):E.layersSelect.set("value",""+ka);E.browseDialog.browseItems&&E.browseDialog.browseItems.clear();qa.resolve()}else E.item.selectedLayer?(S.url=E.item.selectedLayer.url,qa.then(k.hitch(this,ba)),setTimeout(function(){qa.resolve(E.item.selectedLayer)},500)):(ta=E.item.itemDataUrl?V({url:E.item.itemDataUrl,content:{f:"json"}}):"sync",A(ta,k.hitch(this,function(wa){wa&&wa.layers&&wa.layers[0].id&&(S.url=S.url.substring(0,
S.url.lastIndexOf("/0"))+"/"+wa.layers[0].id);V({url:S.url,content:{f:"json"}}).then(k.hitch(this,function(ua){ba(ua);qa.resolve()}))})));return qa.promise}},addReadyToUseLayerOption:function(E,M){E&&(E.showReadyToUseLayers||E.showBrowseLayers)&&(M||(M=[]),E.signInPromise||(E.signInPromise=new C,setTimeout(k.hitch(this,function(){E.signInPromise.resolve()}),100)),E.i18n||(this.initI18n(),E.i18n=this.i18n),E.signInPromise.then(k.hitch(this,function(){n.forEach(M,function(ba){var Y=ba.select||ba;if(-1!==
Y.baseClass.indexOf("dijitComboBox")&&E.showBrowseLayers){if(ba=Y.get("store"))ba.put({id:"separator",name:"separator",label:"\x3chr\x3e"}),ba.put({id:"browselayers",name:"browselayers",label:E.i18n.browseLayers})}else{var ka=Y.getOptions();n.some(ka,function(S){return"separator"===S.type},this)||!E.showReadyToUseLayers&&!E.showBrowseLayers||Y.addOption({type:"separator",value:""});this.addBrowseOptionForTool({select:Y,disableLAAL:ba.disableLAAL},E)}},this);E.showReadyToUseLayers&&!fa.isDefined(E._browsedlg)&&
(E._browsedlg=this.addBrowseAnalysisDialog({widget:E}),E.own(E._browsedlg.browseItems.on("select-change",k.hitch(E,E._handleBrowseItemsSelect)),E._browsedlg.on("hide",k.hitch(E,function(){n.forEach(M,function(ba){"browse"===ba.get("value")&&ba.reset()});E.layersSelect&&E.layersSelect.reset()}))));E.showBrowseLayers&&!fa.isDefined(E._browseLyrsdlg)&&(E._browseLyrsdlg=this.addBrowseAnalysisDialog({widget:E,browseType:1}),E.own(E._browseLyrsdlg.on("browseitems-close",k.hitch(this,function(ba){"add-layer"===
ba.action&&(E._browseLyrsdlg.browseItems.plugIn._grid&&(ba.selection.selectedLayer=E._browseLyrsdlg.browseItems.plugIn._selectedLayer,E._handleBrowseItemsSelect({dialog:E._browseLyrsdlg,selection:ba.selection})),E._browseLyrsdlg.browseItems.closeInfoPanel())})),E._browseLyrsdlg.on("hide",k.hitch(E,function(){n.forEach(M,function(ba){"browselayers"===ba.get("value")&&ba.reset()})}))))})))},addBrowseOptionForTool:function(E,M){var ba=E.select,Y=E.disableLAAL||!1,ka=ba.getOptions();E=[];var S=!1;if(!n.some(ka,
function(ja){return"browselayers"===ja.value||"browse"===ja.value},this)){if(0<ka.length&&"separator"!==ka[ka.length-1].type||0===ka.length)E.push({type:"separator"}),S=!0;M.useArcGISComponents&&(M.showBrowseLayers||M.showReadyToUseLayers)?E.push({value:"browselayers",label:M.i18n.browseAnalysisLayers}):(!Y&&M.showReadyToUseLayers&&(Y=M.i18n.browseAnalysisTitle,this._isCustomAnalysisQuery(M)&&(Y=M.i18n.browseAnalysisLayers),E.push({value:"browse",label:Y})),M.showBrowseLayers&&E.push({value:"browselayers",
label:M.i18n.browseLayers}));(!0===S&&1<E.length||!1===S&&0<E.length)&&ba.addOption(E)}},_isCustomAnalysisQuery:function(E){var M='title:"Living Atlas Analysis Layers" AND owner:esri',ba=!1;E&&E.isSingleTenant&&(M='title:"Living Atlas Analysis Layers" AND owner:esri_livingatlas');E.portalSelf&&E.portalSelf.analysisLayersGroupQuery&&E.portalSelf.analysisLayersGroupQuery!==M?ba=!0:E._portal&&E._portal.analysisLayersGroupQuery&&E._portal.analysisLayersGroupQuery!==M&&(ba=!0);return ba},getMaxInputByMode:function(E){if(E&&
E.units&&E.type&&E.limits&&E.travelMode){var M,ba=E.limits.maximumBreakDistanceValue,Y=E.limits.maximumBreakDistanceValueUnits,ka=E.limits.maximumBreakTimeValue,S=E.limits.maximumBreakTimeValueUnits,ja=this.isWalkingTravelMode(E.travelMode.travelMode);ja&&(ba=E.limits.maximumBreakWalkingDistanceValue,Y=E.limits.maximumBreakWalkingDistanceValueUnits,ka=E.limits.maximumBreakWalkingTimeValue,S=E.limits.maximumBreakWalkingTimeValueUnits);"reachableStreets"===E.alternateLimits&&(S=this.generateLimitsForReachableStreets({limits:E.limits,
isWalking:ja}),ba=S.driveDistanceLimit,Y=S.driveDistanceUnit,ka=S.driveTimeLimit,S=S.driveTimeUnit);"unreachableAreas"===E.alternateLimits&&(S=this.generateLimitsForUnreachableAreas({limits:E.limits,isWalking:ja}),ba=S.driveDistanceLimit,Y=S.driveDistanceUnit,ka=S.driveTimeLimit,S=S.driveTimeUnit);ka*=this.perMinute(S);ba*=this.perMile(Y);"StraightLine"===E.type?"Miles"===E.units?M=1E3:"Yards"===E.units?M=176E4:"Kilometers"===E.units?M=y.format(1609.344,{places:2}):"Meters"===E.units?M=y.format(1609344,
{places:2}):"Feet"===E.units&&(M=528E4):this.isDistanceMode(E.travelMode)?"Miles"===E.units?M=ba:"Yards"===E.units?M=1760*ba:"Kilometers"===E.units?M=y.format(1.609344*ba,{places:2}):"Meters"===E.units?M=y.format(1609.344*ba,{places:2}):"Feet"===E.units&&(M=5280*ba):this.isTimeMode(E.travelMode)&&("Minutes"===E.units?M=ka:"Seconds"===E.units?M=60*ka:"Hours"===E.units&&(M=ka/60));return"string"===typeof M?y.parse(M):parseFloat(M)}},isWalkingTravelMode:function(E){if(E&&E.restrictionAttributeNames)return E.restrictionAttributeNames.some(function(M){return"walking"===
M.toLowerCase()})},isDistanceMode:function(E){return"Distance"===E.units},isTimeMode:function(E){return"Time"===E.units},generateLimitsForUnreachableAreas:function(E){var M={driveDistanceLimit:null,driveDistanceUnit:null,driveTimeLimit:null,driveTimeUnit:null};E.isWalking?(M.driveDistanceLimit=E.limits.maximumBreakWalkingDistanceValueDetailedPolygons,M.driveDistanceUnit=E.limits.maximumBreakWalkingDistanceValueUnitsDetailedPolygons,M.driveTimeLimit=E.limits.maximumBreakWalkingTimeValueDetailedPolygons,
M.driveTimeUnit=E.limits.maximumBreakWalkingTimeValueUnitsDetailedPolygons):(M.driveDistanceLimit=E.limits.maximumBreakDistanceValueDetailedPolygons,M.driveDistanceUnit=E.limits.maximumBreakDistanceValueUnitsDetailedPolygons,M.driveTimeLimit=E.limits.maximumBreakTimeValueDetailedPolygons,M.driveTimeUnit=E.limits.maximumBreakTimeValueUnitsDetailedPolygons);return M},generateLimitsForReachableStreets:function(E){var M={driveDistanceLimit:null,driveDistanceUnit:null,driveTimeLimit:null,driveTimeUnit:null};
E.isWalking?(M.driveDistanceLimit=E.limits.maximumBreakWalkingDistanceValueServiceAreaLines,M.driveDistanceUnit=E.limits.maximumBreakWalkingDistanceValueUnitsServiceAreaLines,M.driveTimeLimit=E.limits.maximumBreakWalkingTimeValueServiceAreaLines,M.driveTimeUnit=E.limits.maximumBreakWalkingTimeValueUnitsServiceAreaLines):(M.driveDistanceLimit=E.limits.maximumBreakDistanceValueServiceAreaLines,M.driveDistanceUnit=E.limits.maximumBreakDistanceValueUnitsServiceAreaLines,M.driveTimeLimit=E.limits.maximumBreakTimeValueServiceAreaLines,
M.driveTimeUnit=E.limits.maximumBreakTimeValueUnitsServiceAreaLines);return M},updateModeConstraints:function(E){if(E&&E.validateWidget&&E.units&&E.type&&E.travelMode){var M=E.validateWidget.get("constraints");M.max=this.getMaxInputByMode(E);E.validateWidget.set(M)}},getTravelModes:function(E){var M=new C,ba,Y,ka,S;fa.isDefined(this.travelModes)&&0<this.travelModes.length?M.resolve(this.travelModes):E&&E.widget?E.widget.signInPromise.then(k.hitch(this,function(ja){(S=E.widget.get("helperServices"))&&
S.routingUtilities?(ka=S.routingUtilities.url,ba="sync"):ba=E.widget._getSelf(E.widget.portalUrl);A(ba,k.hitch(this,function(la){la&&la.helperServices&&la.helperServices.routingUtilities&&(ka=la.helperServices.routingUtilities.url);fa.isDefined(ka)?(Y=new P(ka+"/GetTravelModes"),Y.execute({}).then(k.hitch(this,function(qa){this.travelModes=n.map(qa[0].value&&qa[0].value.features,function(ta){return b.fromJson(ta.attributes.TravelMode)});qa[1]&&qa[1].paramName&&"defaultTravelMode"===qa[1].paramName&&
(this.defaultTravelModeId=qa[1].value);M.resolve(this.travelModes)}),k.hitch(this,function(qa){M.reject(qa)}))):M.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),function(la){M.reject(la)})})):M.reject(Error("Missing parameter: params.widget required parameter"));return M.promise},populateTravelModes:function(E){if(E&&E.selectWidget&&E.widget){var M=[],ba=E.allowmode||"all",Y=!1;this.initI18n();E.addStraightLine&&M.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+
this.i18n.straightLineDistance+"\x3c/div\x3e",selected:E.value&&"StraightLine"===E.value});this.getTravelModes({widget:E.widget}).then(k.hitch(this,function(ka){var S=fa.isDefined(E.enableTravelModes)&&!E.enableTravelModes;n.forEach(ka,function(ja,la){la=this.createOptionForTravelMode(ja,{name:ja.name,disabled:S,separator:E.separator});this.isTravelModeAllowed(ba,la.units)&&("all"!==ba&&(la.value=la.value.replace(la.units,"")),E.value&&E.value.id===ja.id?N(E.value,ja)&&(la.selected=!la.disabled,Y=
!0):!E.value&&E.selectDefaultMode&&this.defaultTravelModeId&&this.defaultTravelModeId===ja.id&&(la.selected=!0),M.push(la))},this);!Y&&this.isRequiredToAddTravelMode(E)&&this.isTravelModeAllowed(ba,this.getTravelModeUnits(E.value))&&M.push(this.getOptionForCustomTravelMode(E,S));E.selectWidget.removeOption();E.selectWidget.addOption(M);E.widget.emit("travelmodes-added",{travelOptions:M})}),k.hitch(this,function(ka){M&&0<M.length&&(E.selectWidget.removeOption(),E.selectWidget.addOption(M),E.widget.emit("travelmodes-added",
{travelOptions:M}))}))}},getTravelModeLabel:function(E,M){M=M?M:E.name;return'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+this.getTravelModei18nKey(E.type)+this.getTravelModeUnits(E)+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;" title\x3d"'+E.description+'"\x3e'+M+"\x3c/div\x3e"},getTravelModeUnits:function(E){var M=E.units||name.split(/\s/)[1];return M=E.impedanceAttributeName===E.timeAttributeName?"Time":E.impedanceAttributeName===E.distanceAttributeName?
"Distance":"Other"},getTravelModeValue:function(E,M){return E.replace(/\s/g,M||"")},getTravelModei18nKey:function(E){return"AUTOMOBILE"===E?"Driving":"TRUCK"===E?"Trucking":"WALK"===E?"Walking":"Other"},isTravelModeAllowed:function(E,M){return"all"===E||E.toLowerCase()===M.toLowerCase()},isRequiredToAddTravelMode:function(E){return E.widget.rerun&&"StraightLine"!==E.value},isTrafficBasedTravelMode:function(E){var M=this.getTravelModei18nKey(E.type).toLowerCase();return"time"===this.getTravelModeUnits(E).toLowerCase()&&
("driving"===M||"trucking"===M)},getOptionForCustomTravelMode:function(E,M){E=this.createOptionForTravelMode(E.value,{name:"\x26lt"+E.value.name+"\x26gt",disabled:M,separator:E.separator});E.selected=!0;return E},createOptionForTravelMode:function(E,M){return{label:this.getTravelModeLabel(E,M.name),value:this.getTravelModeValue(M.name,M.separator),travelMode:E,disabled:M.disabled,modei18nKey:this.getTravelModei18nKey(E.type).toLowerCase(),units:this.getTravelModeUnits(E)}},updateDisplay:function(E,
M,ba){(new q.NodeList(E)).style("display",M?ba?ba:"block":"none")},isGreaterThanZero:function(){return 0<this.get("value")},getExprFunctions:function(){this.i18n||this.initI18n();this.exprFunctions||(this.exprFunctions=[{type:"NumType",label:p.substitute(this.i18n.asMetersFunc,{functionName:"as_meters(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_meters()"},{type:"NumType",label:p.substitute(this.i18n.asKilometersFunc,{functionName:"as_kilometers(\x3ci\x3enumber\x3c/i\x3e)",
num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_kilometers()"},{type:"NumType",label:p.substitute(this.i18n.asFeetFunc,{functionName:"as_feet(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_feet()"},{type:"NumType",label:p.substitute(this.i18n.asYardsFunc,{functionName:"as_yards(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_yards()"},{type:"NumType",label:p.substitute(this.i18n.asMilesFunc,{functionName:"as_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),
name:"as_miles()"},{type:"NumType",label:p.substitute(this.i18n.asNuaticalMilesFunc,{functionName:"as_nautical_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_nautical_miles()"},{type:"NumType",label:p.substitute(this.i18n.absFunc,{functionName:"abs(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"abs()"},{type:"NumType",label:p.substitute(this.i18n.logFunc,{functionName:"log(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"log()"},
{type:"NumType",label:p.substitute(this.i18n.sinFunc,{functionName:"sin(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sin()"},{type:"NumType",label:p.substitute(this.i18n.cosFunc,{functionName:"cos(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"cos()"},{type:"NumType",label:p.substitute(this.i18n.tanFunc,{functionName:"tan(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"tan()"},{type:"NumType",label:p.substitute(this.i18n.squareRootFunc,
{functionName:"sqrt(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sqrt()"},{type:"NumType",label:p.substitute(this.i18n.minFunc,{functionName:"min(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"min()"},{type:"NumType",label:p.substitute(this.i18n.maxFunc,{functionName:"max(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"max()"},{type:"NumType",label:p.substitute(this.i18n.constrainFunc,{functionName:"constrain(\x3ci\x3enumber\x3c/i\x3e, \x3ci\x3elow\x3c/i\x3e, \x3ci\x3ehigh\x3c/i\x3e",
num:"\x3ci\x3enumber\x3c/i\x3e",low:"\x3ci\x3elow\x3c/i\x3e",high:"\x3ci\x3ehigh\x3c/i\x3e"}),name:"constrain(,,)"},{type:"NumType",label:p.substitute(this.i18n.iffFunc,{functionName:"iif(\x3ci\x3econdition\x3c/i\x3e,\x3ci\x3evalue if TRUE\x3c/i\x3e,\x3ci\x3evalue if FALSE\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"iif(,,)"},{type:"NumType",label:p.substitute(this.i18n.whenFunc,{functionName:"when(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"when(,)"},{type:"NumType",
label:p.substitute(this.i18n.decodeFunc,{functionName:"decode(\x3ci\x3eexpression\x3c/i\x3e, \x3ci\x3ecase1,return1,..caseN,returnN\x3c/i\x3e, \x3ci\x3edefault\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"decode(,,,)"}]);return this.exprFunctions},addAttributeOptions:function(E){this.initI18n();fa.isDefined(E.allowSelectLabel)||(E.allowSelectLabel=!0);var M=[],ba=fa.isDefined(E.emptyValue)?E.emptyValue:"";if(E.allowNumericType||void 0===E.allowNumericType)M=[ia.FieldTypes.Short,ia.FieldTypes.Integer,
ia.FieldTypes.Float,ia.FieldTypes.Double];var Y=E.layer;var ka=E.selectWidget;var S=Y?Y.fields:[];ka.removeOption(ka.getOptions());E.allowSelectLabel&&ka.addOption({value:ba,label:this.i18n.attribute});E.allowStringType&&M.push(ia.FieldTypes.String);E.allowDateType&&M.push(ia.FieldTypes.Date);var ja=[];n.forEach(S,function(la){-1!==n.indexOf(M,la.type)&&la.name!==Y.objectIdField&&ja.push({value:la.name,label:fa.isDefined(la.alias)&&""!==la.alias?la.alias:la.name,type:la.type===ia.FieldTypes.String?
ia.PseudoFieldTypes.String:la.type===ia.FieldTypes.Date?ia.PseudoFieldTypes.Date:ia.PseudoFieldTypes.Number})},this);if(0===ja.length)return!1;ka.addOption(ja);fa.isDefined(E.priorityChange)?ka.set("value",ba,E.priorityChange):ka.set("value",ba);ka.set("disabled",!Y||0===Y.fields.length);return!0},addStatisticsOptions:function(E){this.initI18n();var M=E.selectWidget,ba=[{value:"SUM",label:this.i18n.sum},{value:"MIN",label:this.i18n.minimum},{value:"MAX",label:this.i18n.maximum},{value:"MEAN",label:E.showGeoAnalyticsParams?
this.i18n.mean:this.i18n.average},{value:"STDDEV",label:this.i18n.standardDev}],Y=[{value:"MIN",label:this.i18n.minimum},{value:"MAX",label:this.i18n.maximum}],ka=[{value:"First",label:this.i18n.first},{value:"Last",label:this.i18n.last}],S=fa.isDefined(E.emptyValue)?E.emptyValue:"";M.removeOption(M.getOptions());M.addOption([{value:S,label:this.i18n.statistic}]);E.showGeoAnalyticsParams&&(M.addOption({value:"COUNT",label:this.i18n.count}),ba.push({value:"VARIANCE",label:this.i18n.variance}),ba.splice(4,
0,{value:"RANGE",label:this.i18n.range}));E.showFirstLastStats&&M.addOption(ka);E.type&&"number"!==E.type?E.type&&"string"===E.type?(M.addOption({value:"ANY",label:this.i18n.any}),E.selectWidget.optionsType="string"):E.type&&"date"===E.type&&(M.addOption(Y),E.selectWidget.optionsType="date"):(M.addOption(ba),E.selectWidget.optionsType="number");M.set("value",S)},addFillOptions:function(E){var M=E.selectWidget,ba=[{value:"ZEROES",label:this.i18n.zeroes},{value:"SPATIAL_NEIGHBORS",label:this.i18n.spatialneighbhors},
{value:"SPACE_TIME_NEIGHBORS",label:this.i18n.spacetimeneighbors},{value:"TEMPORAL_TREND",label:this.i18n.temporaltrend}];M.removeOption(M.getOptions());M.addOption([{value:"0",label:this.i18n.fill}]);E.type&&"number"!==E.type||M.addOption(ba)},perMeter:function(E){var M=1;switch(E){case J.MILLIMETERS:M=1E3;break;case J.CENTIMETERS:M=100;break;case J.DECIMETERS:M=10;break;case J.METERS:M=1;break;case J.KILOMETERS:M=.001;break;case J.INCHES:M=39.370079;break;case J.FEET:M=3.2808399;break;case J.YARDS:M=
1.0936133;break;case J.MILES:M=6.2137119E-4;break;case J.NAUTICAL_MILES:M=5.399568E-4;break;case J.ACRES:M=2.4710538E-4;break;case J.ARES:M=.01;break;case J.HECTARES:M=1E-4;break;case J.SQUARE_INCHES:M=1550.0031;break;case J.SQUARE_FEET:M=10.7639104;break;case J.SQUARE_YARDS:M=1.19599005;break;case J.SQUARE_MILES:M=3.86102159E-7;break;case J.SQUARE_NAUTICAL_MILES:M=2.9155335E-7;break;case J.SQUARE_MILLIMETERS:M=1E6;break;case J.SQUARE_CENTIMETERS:M=1E4;break;case J.SQUARE_DECIMETERS:M=100;break;case J.SQUARE_METERS:M=
1;break;case J.SQUARE_KILOMETERS:M=1E-6}return M},perMile:function(E){var M=1;switch(E){case "Feet":M=1.89394E-4;break;case "Yards":M=5.68182E-4;break;case "Meters":M=6.21371E-4;break;case "Kilometers":M=.621371}return M},perMinute:function(E){var M=1;switch(E){case "Seconds":M=.0166667;break;case "Hours":M=60}return M},getType:function(E){var M=null;switch(E){case J.ACRES:M=2;break;case J.ARES:M=2;break;case J.CENTIMETERS:M=1;break;case J.DECIMETERS:M=1;break;case J.FEET:M=1;break;case J.HECTARES:M=
2;break;case J.INCHES:M=1;break;case J.KILOMETERS:M=1;break;case J.METERS:M=1;break;case J.MILES:M=1;break;case J.MILLIMETERS:M=1;break;case J.NAUTICAL_MILES:M=1;break;case J.SQUARE_CENTIMETERS:M=2;break;case J.SQUARE_DECIMETERS:M=2;break;case J.SQUARE_FEET:M=2;break;case J.SQUARE_INCHES:M=2;break;case J.SQUARE_KILOMETERS:M=2;break;case J.SQUARE_METERS:M=2;break;case J.SQUARE_MILES:M=2;break;case J.SQUARE_MILLIMETERS:M=2;break;case J.SQUARE_NAUTICAL_MILES:M=2;break;case J.SQUARE_YARDS:M=2;break;case J.YARDS:M=
1;break;default:M=0}return M},unitConversion:function(E,M,ba){var Y=!0;fa.isDefined(E)||(this.emitError("The 'From' Value must be a valid numeric value: "+E),Y=!1);fa.isDefined(M)||(this.emitError("The 'From' Units must be defined: "+M),Y=!1);fa.isDefined(ba)||(this.emitError("The 'To' Units must be defined: "+ba),Y=!1);E instanceof Array&&(this.emitError("Only single 'From' Value supported: "+E),Y=!1);M instanceof Array&&(this.emitError("Only single 'From' Units supported: "+M),Y=!1);ba instanceof
Array&&(this.emitError("Only single 'To' Units supported: "+ba),Y=!1);var ka=this.getType(M),S=this.getType(ba);0===ka&&(this.emitError("Unsupported 'From' Units: "+M),Y=!1);0===S&&(this.emitError("Unsupported 'To' Units: "+ba),Y=!1);ka!==S&&(this.emitError("Incompatible 'From' and 'To' Units: "+M+" and "+ba),Y=!1);return Y?M===ba?+E:+E/this.perMeter(M)*this.perMeter(ba):Number.NaN},emitError:function(E){console.log("error",Error(E))},isEmpty:function(E){for(var M in E)if(E.hasOwnProperty(M))return!1;
return h.stringify(E)===h.stringify({})},getRoutingUtilities:function(E){var M=new C,ba={},Y,ka,S,ja;E||M.reject(Error("Missing parameter: widget required parameter"));-1!==n.indexOf(["CreateDriveTimeAreas","EnrichLayer","SummarizeNearby"],E.toolName)?k.mixin(ba,{toolName:"GenerateServiceAreas",serviceName:"asyncServiceArea"}):E.toolName===ia.Tools.ChooseBestFacilities?k.mixin(ba,{toolName:"SolveLocationAllocation",serviceName:"asyncLocationAllocation"}):"PlanRoutes"===E.toolName?k.mixin(ba,{toolName:"SolveVehicleRoutingProblem",
serviceName:"asyncVRP"}):"FindNearest"===E.toolName?k.mixin(ba,{toolName:"FindClosestFacilities",serviceName:"asyncClosestFacility"}):"ConnectOriginsToDestinations"===E.toolName&&k.mixin(ba,{toolName:"FindRoutes",serviceName:"asyncRoute"});this.routingUtilities||(this.routingUtilities={});this.routingUtilities&&this.routingUtilities[E.toolName]?M.resolve(this.routingUtilities[E.toolName]):E.signInPromise.then(k.hitch(this,function(la){(ja=E.get("helperServices"))&&ja.routingUtilities?(S=ja.routingUtilities.url,
Y="sync"):Y=E._getSelf(E.portalUrl);A(Y,k.hitch(this,function(qa){qa&&qa.helperServices&&qa.helperServices.routingUtilities&&(S=qa.helperServices.routingUtilities.url);fa.isDefined(S)||M.reject(Error("Missing Routing Utility Service to get Network Analysis Service Limits."));ka=new P(S+"/GetToolInfo");ka.execute(ba).then(k.hitch(this,function(ta){ta&&0<ta.length&&ta[0].value?(this.routingUtilities[E.toolName]=ta[0].value,M.resolve(ta[0].value)):M.reject("Routing Utility Service 'GetToolInfo' job did not return service limits.")}),
function(ta){M.reject(ta)})}))}),function(la){M.reject(la)});return M.promise},getNetworkAnalysisLimits:function(E){var M=new C;E||M.reject(Error("Missing parameter: widget required parameter"));this.getRoutingUtilities(E).then(k.hitch(this,function(ba){ba.serviceLimits?M.resolve(ba.serviceLimits):M.reject()}),function(ba){M.reject(ba)});return M.promise},isEsriWorldGeocoder:function(E){var M=this.isAgoWorldGeocodeServer(E);E=this.isAgoWorldGeocodeServerProxy(E);return M||E},isAgoWorldGeocodeServer:function(E){return E&&
!!E.match(/(arcgis.com\/arcgis\/rest\/services\/world\/geocodeserver).*/ig)},isCustomGeoEnrichmentServer:function(E,M){var ba=(E||"").toLowerCase();E=-1<ba.indexOf("/geoenrichmentserver")&&-1<ba.indexOf("/servers/")&&-1<ba.indexOf("/rest/services/");M=!M&&ba.indexOf("utility")&&-1<ba.indexOf(".arcgis.com");return E&&M},isAgoWorldGeocodeServerProxy:function(E){return E&&!!E.match(/(\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/ig)},isWorldGeoLocator:function(E){return E&&!!E.match(/(\/rest\/services\/world\/geocodeserver).*/ig)},
showMessages:function(E,M,ba){c.set(M,"innerHTML",E);l.fadeIn({node:ba,easing:F.quadIn,onEnd:k.hitch(this,function(){v.set(ba,{display:""})})}).play()},hideMessages:function(E){l.fadeOut({node:E,easing:F.quadOut,onEnd:function(){v.set(E,{display:"none"})}}).play()},getHelpUrl:function(E){if(E.topic&&E.widget){var M;E.widget.portalSelf&&E.widget.portalSelf.helpBase?M=E.widget.portalSelf.helpBase+"index.html#":!E.widget.isSingleTenant||E.widget.portalSelf&&E.widget.portalSelf.helpBase||(M="http://server.arcgis.com/en/portal/latest/use/");
"BufferExpression"===E.topic&&(M+="Use_expressions_with_GeoAnalytics_Tools/019300000183000000/");return M}},isPCS:function(E){return!!E&&!!oa&&-1!==n.indexOf(oa,E)},isPCSByLayerType:function(E){var M=!!E&&!!E.fullExtent&&this.isPCS(E.fullExtent.spatialReference.wkid);!M&&E.extent&&(M=!!E&&!!E.extent&&this.isPCS(E.extent.spatialReference.wkid));!M&&E.spatialReference&&(M=!!E&&!!E.spatialReference&&this.isPCS(E.spatialReference.wkid));return M},checkPCSforAnalysis:function(E){var M=E.widget&&E.widget.toolName,
ba=!!E.widget&&!!E.widget.context&&!!E.widget.context.processSR&&this.isPCS(E.widget.context.processSR.wkid),Y=!0,ka=E.jobParams||E.widget.jobParams,S=!!E.widget&&!!E.widget.context&&!!E.widget.context.processSR&&!!E.widget.context.processSR.wkid;if(!M||!ka||!E.widget.showGeoAnalyticsParams)return!1;var ja="\x3ca  href\x3d'#' id\x3d'"+E.widget.id+"_warn_settings_link'\x3e"+E.widget.i18n.analysisSettings+"\x3c/a\x3e\x3cdiv class\x3d'esriAnalysisSettingsIcon'\x3e\x3c/div\x3e";var la=p.substitute(E.widget.i18n.PCSReqMsg,
{defaultSpatialRef:E.widget.i18n.worldCylindrical,settingsIcon:ja});"FindHotSpots"!==M&&"FindPointClusters"!==M||ba?"CalculateDensity"!==M&&"FindPointClusters"!==M&&"GeographicallyWeightedRegression"!==M||ba?"AggregatePoints"!==M||-1===n.indexOf(["HEXAGON","SQUARE"],ka.binType)||ba?"SummarizeWithin"===M&&ka.summaryPolygons&&!ba?Y=this.isPCSByLayerType(E.widget.sumWithinLayer):"SummarizeWithin"!==M||-1===n.indexOf(["HEXAGON","SQUARE"],ka.binType)||ba?"JoinFeatures"===M&&ka.spatialNearDistance&&"Near"===
ka.spatialRelationship&&!ba?(Y=this.isPCSByLayerType(E.widget.targetLayer))||(la=p.substitute(E.widget.i18n.JFPCSReqMsg,{settingsIcon:ja})):"BuildMultiVariableGrid"!==M||ba?"CalculateMotionStatistics"===M&&"Planar"===ka.distanceMethod&&(1<ka.motionStatistics.split(",").length||1===ka.motionStatistics.split(",").length&&-1===ka.motionStatistics.indexOf("Duration"))&&!ba?(Y=this.isPCSByLayerType(E.widget.inputLayer))||(la=p.substitute(E.widget.i18n.CMSPCSReqMsg,{settingsIcon:ja})):"TraceProximityEvents"!==
M||"Planar"!==ka.distanceMethod||ba||(Y=this.isPCSByLayerType(E.widget.inputLayer))||(la=p.substitute(E.widget.i18n.TPEPCSReqMsg,{settingsIcon:ja})):Y=n.every(E.inputLayers,function(qa){return this.isPCSByLayerType(qa)},this):Y=this.isPCSByLayerType(E.widget.summaryLayer):Y=this.isPCSByLayerType(E.widget.pointLayer):(Y=this.isPCSByLayerType(E.widget.inputLayer),"GeographicallyWeightedRegression"!==M||Y||(la=p.substitute(E.widget.i18n.GWRPCSReqMsg,{settingsIcon:ja}))):(Y=this.isPCSByLayerType(E.widget.analysisLayer),
"FindPointClusters"!==M||Y||(la=p.substitute(E.widget.i18n.FPCSReqMsg,{settingsIcon:ja})));Y||E.hasPCSWarnShown||(E.widget.set("disableRunAnalysis",Y),this.settingsVM&&this.settingsDlg&&E.widget._bodyNode&&E.widget._errorMessagePane&&(this.showMessages(la,E.widget._bodyNode,E.widget._errorMessagePane),z.byId(E.widget.id+"_warn_settings_link")&&G(z.byId(E.widget.id+"_warn_settings_link"),"click",k.hitch(E.widget,E.widget.showSettingsDlg))));!Y&&E.hasPCSWarnShown&&S&&(Y=!0);return Y},tryParseJSON:function(E){try{var M=
h.parse(E);if(M&&"object"===typeof M&&null!==M)return M}catch(ba){}return!1},decodeTag:function(E){return{"\x26lt;":"\x3c","\x26gt;":"\x3e"}[E]||E},stringDecode:function(E){return E.replace(/(&lt;|&gt;)/g,this.decodeTag)},jobParamsToWidgetProps:function(E){if(E&&E.jobParams){var M=E.jobParams,ba=new C,Y=[],ka=[],S;for(S in M){var ja;M.hasOwnProperty(S)&&("string"===typeof M[S]&&-1!==M[S].search(/(&lt;|&gt;)/g)&&(M[S]=this.stringDecode(M[S])),ja="string"===typeof M[S]?this.tryParseJSON(M[S]):M[S])&&
(-1!==S.toLowerCase().indexOf("layer")&&"object"===typeof ja?ka.push({key:S,obj:ja}):ja&&(ja.Raster||ja.url)&&ka.push({key:S,obj:ja}),M[S]=ja)}for(S=0;S<ka.length;S++){ja=ka[S].obj;var la=ka[S].key;"object"===typeof ja&&ja.length?(M[la]=[],n.forEach(ja,function(qa,ta){this._getFlayers(qa,la,M,Y,!0,ta)},this)):"object"===typeof ja&&ja.Raster?(ja.url=ja.Raster.url,this._getFlayers(ja,la,M,Y,!0,"Raster")):this._getFlayers(ja,la,M,Y)}B(Y).then(k.hitch(this,function(){ba.resolve(E)}),k.hitch(this,function(){ba.resolve(E)}));
return ba.promise}},_getLayerType:function(E){return E?-1!==E.indexOf("BigDataCatalogServer")?ma.BIGDATA:-1!==E.indexOf("ImageServer")?ma.IS:ma.FS:null},_getFlayers:function(E,M,ba,Y,ka,S){if(E.url){var ja=V({url:E.url,content:{f:"json"}});var la=new C;Y.push(la);ja.then(k.hitch(this,function(qa,ta,Ba,wa,ua){var ra=this._getLayerType(qa.url);if(ra===ma.FS){var sa=new O(qa.url,{mode:O.MODE_ONDEMAND,outFields:["*"],resourceInfo:ua});qa.filter&&sa.setDefinitionExpression(qa.filter);sa.filter=qa.filter}else ra===
ma.BIGDATA?(sa=ua,k.mixin(sa,qa)):ra===ma.IS&&(ua=qa.Raster||qa,sa=new U(ua.url),ua.renderingRule&&sa.setRenderingRule(new na(ua.renderingRule)),ua.name&&(sa.name=ua.name),qa.Raster&&qa.Raster.url===qa.url&&delete qa.url);qa.name&&(sa.name=qa.name);ka?ba[ta][wa]=sa:ka&&ra===ma.IS?k.mixin(ba[ta][wa],sa):ba[ta]=sa;Ba.resolve()},E,M,la,S),k.hitch(this,function(qa,ta,Ba,wa,ua){qa={name:qa.name,empty:!0};ka?ba[ta][wa]=qa:ba[ta]=qa;Ba.resolve()},E,M,la,S))}else Y=new O(E,{outFields:["*"]}),E.name&&(Y.name=
E.name),ka?ba[M][S]=Y:ba[M]=Y},isLayerInLayers:function(E,M){return n.some(M,function(ba){return this.isSameLayer(E,ba)},this)},addBlankOption:function(E,M){M&&M.length?M.push({value:"  ",label:""}):E.addOption({value:"  ",label:""});setTimeout(k.hitch(this,this._validateSelectUI,E),100)},_validateSelectUI:function(E){E._hasBeenBlurred=!0;E.set("focused",!0);E.validate();E.set("focused",!1);E._hasBeenBlurred=!1;setTimeout(k.hitch(this,function(){E.reset()}),1E3)},updateExpressions:function(E){E&&
E.selectedInputLayers&&E.inputLayers&&E.data&&E.expressions&&(n.forEach(E.selectedInputLayers,function(M,ba){n.forEach(E.inputLayers,function(Y,ka){Y&&M&&(!M.url&&!Y.url&&M.name===Y.name||M.url&&Y.url&&M.url===Y.url)&&(M._oldIndex=ba,M._newIndex=ka)})}),n.forEach(E.data,function(M,ba){0<ba&&M&&(ba=E.expressions[ba-1],fa.isDefined(M.layer)&&(M.layer=ba&&ba.layer),fa.isDefined(M.selectingLayer)&&(M.selectingLayer=ba&&ba.selectingLayer))}),n.forEach(E.data,function(M){var ba=!1,Y=!1;n.forEach(E.selectedInputLayers,
function(ka){fa.isDefined(M.layer)&&M.layer===ka._oldIndex&&!ba&&(M.layer=ka._newIndex,ba=!0);fa.isDefined(M.selectingLayer)&&M.selectingLayer===ka._oldIndex&&!Y&&(M.selectingLayer=ka._newIndex,Y=!0)},this)},this))},isBigDataTypeTobeAdded:function(E){return-1==n.indexOf(E,'type:"Big Data File Share"')?!0:!1},removeDuplicates:function(E,M){for(var ba=[],Y={},ka=0;ka<E.length;ka++)Y[E[ka]]?Y[E[ka]]+=1:(ba.push(E[ka]),Y[E[ka]]=1);return M?Y:ba},isPoint:function(E){return E&&E.geometryType===ia.GeometryTypes.Point},
isLine:function(E){return E&&E.geometryType===ia.GeometryTypes.Line},isPolygon:function(E){return E&&E.geometryType===ia.GeometryTypes.Polygon},isSameLayer:function(E,M){return E&&M&&(E.name&&M.name&&E.name===M.name||E.url&&M.url&&E.url===M.url)},getTimeType:function(E){return E?fa.isDefined(E.timeInfo)&&fa.isDefined(E.timeInfo.startTimeField)&&!fa.isDefined(E.timeInfo.endTimeField)?ia.TimeTypes.Instant:fa.isDefined(E.timeInfo)&&fa.isDefined(E.timeInfo.startTimeField)&&fa.isDefined(E.timeInfo.endTimeField)?
ia.TimeTypes.Interval:fa.isDefined(E.time)&&fa.isDefined(E.time.timeType)?E.time.timeType:!1:!1},fetchGroupForRFT:function(E){var M=new C,ba=a.locale,Y=ba?ba.substring(0,2):"en";ba=this.systemRFTGroupName+" owner: ("+("en"===Y?["esri_en"]:["esri_en","esri_"+Y]).join(" OR ")+")";E.queryGroups({q:ba},!0).then(function(ka){0<ka.total&&ka.results?(ka=ka.results,ka=this.findRFTLocaleGroup(ka,Y)||this.findRFTLocaleGroup(ka,"en"),M.resolve(ka)):M.resolve(null)}.bind(this));return M},findRFTLocaleGroup:function(E,
M){var ba;E.some(function(Y){var ka=Y.owner;if(ka&&ka.substring(ka.length-2)===M)return ba=Y,!0});return ba},updateOptions:function(E,M){if(E){for(;0<E.getOptions().length;)E.removeOption(E.getOptions());E._setDisplay("");M&&0<M.length&&E.addOption(M)}},addOptionsFromLayers:function(E){E.select&&E.layers&&(E.customOptions=E.customOptions||[],E.forbiddenLayers=E.forbiddenLayers||[],E.layers.forEach(function(M,ba){this.isLayerInLayers(M,E.forbiddenLayers)||E.customOptions.push({value:ba.toString(),
label:M.name,selected:E.selectedOption&&this.isSameLayer(E.selectedOption,M)})},this),this.updateOptions(E.select,E.customOptions),this.addBrowseOptionForTool({select:E.select,disableLAAL:!0},E.widget))},replaceTag:function(E){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;"}[E]||E},safetagsReplace:function(E){return E.replace(/[<>]/g,this.replaceTag)}});f("extend-esri")&&k.setObject("dijit.analysis.utils",H,ea);return H})},"dojo/fx/easing":function(){define(["../_base/lang"],function(H){var k=
{linear:function(n){return n},quadIn:function(n){return Math.pow(n,2)},quadOut:function(n){return n*(n-2)*-1},quadInOut:function(n){n*=2;return 1>n?Math.pow(n,2)/2:-1*(--n*(n-2)-1)/2},cubicIn:function(n){return Math.pow(n,3)},cubicOut:function(n){return Math.pow(n-1,3)+1},cubicInOut:function(n){n*=2;return 1>n?Math.pow(n,3)/2:(Math.pow(n-2,3)+2)/2},quartIn:function(n){return Math.pow(n,4)},quartOut:function(n){return-1*(Math.pow(n-1,4)-1)},quartInOut:function(n){n*=2;return 1>n?Math.pow(n,4)/2:-.5*
(Math.pow(n-2,4)-2)},quintIn:function(n){return Math.pow(n,5)},quintOut:function(n){return Math.pow(n-1,5)+1},quintInOut:function(n){n*=2;return 1>n?Math.pow(n,5)/2:(Math.pow(n-2,5)+2)/2},sineIn:function(n){return-1*Math.cos(Math.PI/2*n)+1},sineOut:function(n){return Math.sin(Math.PI/2*n)},sineInOut:function(n){return-1*(Math.cos(Math.PI*n)-1)/2},expoIn:function(n){return 0==n?0:Math.pow(2,10*(n-1))},expoOut:function(n){return 1==n?1:-1*Math.pow(2,-10*n)+1},expoInOut:function(n){if(0==n)return 0;
if(1==n)return 1;n*=2;if(1>n)return Math.pow(2,10*(n-1))/2;--n;return(-1*Math.pow(2,-10*n)+2)/2},circIn:function(n){return-1*(Math.sqrt(1-Math.pow(n,2))-1)},circOut:function(n){return Math.sqrt(1-Math.pow(n-1,2))},circInOut:function(n){n*=2;return 1>n?-.5*(Math.sqrt(1-Math.pow(n,2))-1):.5*(Math.sqrt(1-Math.pow(n-2,2))+1)},backIn:function(n){return Math.pow(n,2)*(2.70158*n-1.70158)},backOut:function(n){--n;return Math.pow(n,2)*(2.70158*n+1.70158)+1},backInOut:function(n){n*=2;if(1>n)return Math.pow(n,
2)*(3.5949095*n-2.5949095)/2;n-=2;return(Math.pow(n,2)*(3.5949095*n+2.5949095)+2)/2},elasticIn:function(n){if(0==n||1==n)return n;--n;return-1*Math.pow(2,10*n)*Math.sin(2*(n-.075)*Math.PI/.3)},elasticOut:function(n){return 0==n||1==n?n:Math.pow(2,-10*n)*Math.sin(2*(n-.075)*Math.PI/.3)+1},elasticInOut:function(n){if(0==n)return 0;n*=2;if(2==n)return 1;var r=.3*1.5,m=r/4;if(1>n)return--n,-.5*Math.pow(2,10*n)*Math.sin(2*(n-m)*Math.PI/r);--n;return.5*Math.pow(2,-10*n)*Math.sin(2*(n-m)*Math.PI/r)+1},bounceIn:function(n){return 1-
k.bounceOut(1-n)},bounceOut:function(n){return n<1/2.75?7.5625*Math.pow(n,2):n<2/2.75?7.5625*Math.pow(n-1.5/2.75,2)+.75:n<2.5/2.75?7.5625*Math.pow(n-2.25/2.75,2)+.9375:7.5625*Math.pow(n-2.625/2.75,2)+.984375},bounceInOut:function(n){return.5>n?k.bounceIn(2*n)/2:k.bounceOut(2*n-1)/2+.5}};H.setObject("dojo.fx.easing",k);return k})},"dojox/mvc/equals":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/Stateful","./StatefulArray"],function(H,k,n,r){var m=function(l,b,a){a=a||m;var c=[a.getType(l),
a.getType(b)];return c[0]!=c[1]?!1:a["equals"+c[0].replace(/^[a-z]/,function(f){return f.toUpperCase()})](l,b)};return k.setObject("dojox.mvc.equals",k.mixin(m,{getType:function(l){return k.isArray(l)?"array":k.isFunction((l||{}).getTime)?"date":null!=l&&("[object Object]"=={}.toString.call(l)||k.isFunction((l||{}).set)&&k.isFunction((l||{}).watch))?"object":"value"},equalsArray:function(l,b){for(var a=0,c=Math.max(l.length,b.length);a<c;a++)if(!m(l[a],b[a]))return!1;return!0},equalsDate:function(l,
b){return l.getTime()==b.getTime()},equalsObject:function(l,b){var a=k.mixin({},l,b),c;for(c in a)if(!(c in n.prototype||"_watchCallbacks"==c||m(l[c],b[c])))return!1;return!0},equalsValue:function(l,b){return l===b}}))})},"dojox/mvc/StatefulArray":function(){define(["dojo/_base/lang","dojo/Stateful"],function(H,k){function n(m){m._watchElementCallbacks&&m._watchElementCallbacks(void 0,[],[]);return m}var r=function(m){m=H._toArray(m||[]);m.constructor=r;return H.mixin(m,{pop:function(){return this.splice(this.get("length")-
1,1)[0]},push:function(){this.splice.apply(this,[this.get("length"),0].concat(H._toArray(arguments)));return this.get("length")},reverse:function(){return n([].reverse.apply(this,H._toArray(arguments)))},shift:function(){return this.splice(0,1)[0]},sort:function(){return n([].sort.apply(this,H._toArray(arguments)))},splice:function(l,b){var a=this.get("length");l+=0>l?a:0;var c=Math.min(l,a),f=this.slice(l,l+b),e=H._toArray(arguments).slice(2);[].splice.apply(this,[l,b].concat(Array(e.length)));for(var g=
0;g<e.length;g++)this[c+g]=e[g];this._watchElementCallbacks&&this._watchElementCallbacks(l,f,e);this._watchCallbacks&&this._watchCallbacks("length",a,a-f.length+e.length);return f},unshift:function(){this.splice.apply(this,[0,0].concat(H._toArray(arguments)));return this.get("length")},concat:function(l){return new r([].concat.apply(this,arguments))},join:function(l){for(var b=[],a=this.get("length"),c=0;c<a;c++)b.push(this.get(c));return b.join(l)},slice:function(l,b){var a=this.get("length");b=
(void 0===b?a:b)+(0>b?a:0);var c=[];for(l=l+(0>l?a:0)||0;l<Math.min(b,this.get("length"));l++)c.push(this.get(l));return new r(c)},watchElements:function(l){var b=this._watchElementCallbacks,a=this;b||(b=this._watchElementCallbacks=function(f,e,g){for(var d=[].concat(b.list),h=0;h<d.length;h++)d[h].call(a,f,e,g)},b.list=[]);b.list.push(l);var c={};c.unwatch=c.remove=function(){for(var f=b.list,e=0;e<f.length;e++)if(f[e]==l){f.splice(e,1);break}};return c}},k.prototype,{set:function(l,b){if("length"==
l)l=this.get("length"),l<b?this.splice.apply(this,[l,0].concat(Array(b-l))):b<l&&this.splice.apply(this,[b,l-b]);else{var a=this.length;k.prototype.set.call(this,l,b);a!=this.length&&k.prototype.set.call(this,"length",this.length)}return this},isInstanceOf:function(l){return k.prototype.isInstanceOf.apply(this,arguments)||l==r}})};r._meta={bases:[k]};return H.setObject("dojox.mvc.StatefulArray",r)})},"esri/dijit/analysis/HelpWindow":function(){define("require dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/_base/kernel dojo/aspect dojo/has dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/dom-style dojo/query dojo/window dojo/dom-geometry dijit/_Widget dijit/TooltipDialog dijit/popup ../../kernel ../../lang ../../urlUtils ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w){n=n([u],{declaredClass:"esri.dijit.analysis.HelpWindow",i18n:null,onlineHelpMap:null,showLearnMore:!1,"class":"esriAnalyisHelpWindow",constructor:function(A){this.isPortal=A&&A.isPortal},postMixInProperties:function(){this.inherited(arguments);this.i18n={};r.mixin(this.i18n,w.common);r.mixin(this.i18n,w.analysisHelp)},postCreate:function(){this.inherited(arguments);var A=["ar","he"],z;this.onlineHelpMap={};for(z=0;z<A.length;z+=1){var G=
A[z];b.locale&&-1!==b.locale.indexOf(G)&&(-1!==b.locale.indexOf("-")?-1!==b.locale.indexOf(G+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0)}A=H.toUrl(this.isPortal?"./help/helpmap_enterprise.json":"./help/helpmap.json");F({url:A}).then(r.hitch(this,function(I){this.onlineHelpMap=I.map}));this._initSelfHelpMap()},_getAbsoluteUrl:function(A){var z=B.getProtocolForWebResource();if(/^https?:/i.test(A))return A;if(/^\/\//i.test(A))return z+A;if(/^\//i.test(A))return z+"//"+window.location.host+
A},_computeSize:function(A){var z={w:400,h:200};c("esri-mobile")?z={w:"50%",h:"90%"}:-1!==A.indexOf("Category")?(z.w=400,z.h=320):-1!==A.indexOf("Tool")?(z.w=400,z.h=320):-1!==A.indexOf("toolDescription")&&(z.w=400,z.h=520);return z},_initSelfHelpMap:function(){this.isPortal&&this.portalSelf&&this.portalSelf.helpMap&&(this.selfHelpMap=this.portalSelf.helpMap.m)},_setHelpTopicAttr:function(A){this.tooltipHelpDlg&&(t.close(this.tooltipHelpDlg),this.tooltipHelpDlg.destroy(),this.tooltipHelpDlg=null);
var z="";this.showLearnMore=!1;var G=this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("dev")?"dev":this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("qa")?"uat":"";z=this.isPortal?"-PortalOnly":"-OnlineOnly";var I=r.clone(b.locale);var K="es-es es-mx fr-fr fr-ch it-ch it-it de-de de-ch".split(" ");"nb"===I?I="no":-1!==k.indexOf(K,I)&&(I=I.split("-")[0]);var Q="ar bg bs ca cs da de es el et fi fr he hr hu id it ja ko lt lv ru nl no pl pt-br pt-pt ro sl sk sv sr th tr uk vi zh-cn zh-hk zh-tw".split(" ");
var N="ar de es fr it ja ko ru pl pt-br zh-cn".split(" ");if("SHOWHELPURL"===A)K=this.helpIdUrl,this.showLearnMore=!1;else{K=H.toUrl("esri/dijit/analysis/help/"+this.helpFileName+".html");var T=this.helpFileName;if(C.isDefined(this.onlineHelpMap[T])&&C.isDefined(this.onlineHelpMap[T][A])){this.showLearnMore=!0;var W="https://doc"+G+".arcgis.com/en/arcgis-online/analyze/"+this.onlineHelpMap[T][A];this.isPortal&&this.helpBase&&this.selfHelpMap&&(W=this.helpBase+this.selfHelpMap[this.onlineHelpMap[T][A]])}-1!==
k.indexOf(Q,I)&&(-1!==I.indexOf("-")&&(I=I.split("-"),I=I[0]+"-"+I[1].toUpperCase()),K=H.toUrl("esri/dijit/analysis/help/"+I+"/"+this.helpFileName+".html"));-1!==k.indexOf(N,I)&&this.showLearnMore&&(W="https://doc"+G+".arcgis.com/"+I+"/arcgis-online/analyze/"+this.onlineHelpMap[T][A],this.isPortal&&this.helpBase&&this.selfHelpMap?W=this.helpBase+this.selfHelpMap[this.onlineHelpMap[T][A]]:this.isPortal&&!this.helpBase&&(W="https://server"+G+".arcgis.com/"+I+"/portal/latest/use/"+this.onlineHelpMap[T][A]))}this._size=
G=this._computeSize(A);this.tooltipHelpDlg=new v({preload:!0,content:"\x3cdiv class\x3d'' style\x3d'position:relative'\x3cdiv class\x3d'sizer content'\x3e\x3cdiv class\x3d'contentPane'\x3e\x3cdiv class\x3d'esriFloatTrailing' style\x3d'padding:0;'\x3e\x3ca href\x3d'#' class\x3d'esriAnalysisCloseIcon' title\x3d'"+this.i18n.close+"'\x3e\x3c/a\x3e\x3c/div\x3e\x3ciframe frameborder\x3d'0'  id\x3d'"+A+"' src\x3d'"+K+"#"+A+z+"' width\x3d'"+G.w+"' height\x3d'"+G.h+"' marginheight\x3d'0' marginwidth\x3d'0'\x3e\x3c/iframe\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'actionsPane'\x3e\x3cdiv class\x3d'actionList"+
(this.showLearnMore?"'\x3e":" hidden'\x3e")+"\x3ca class\x3d'action zoomTo' href\x3d'"+(this.showLearnMore?W:"#")+"' target\x3d'_help'\x3e"+this.i18n.learnMore+"\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e","class":"esriHelpPopup esriHelpPopupWrapper esriAnalyisHelpWindow"});this.tooltipHelpDlg.startup()},show:function(A,z){this.helpFileName=z.helpFileName;this._analysisGpServer=z.analysisGpServer;this.isPortal=z.isPortal;this.helpBase=z.helpBase;z.portalSelf&&(this.portalSelf=
z.portalSelf);this.selfHelpMap||this._initSelfHelpMap();z.analysisMode&&(this.analysisMode=z.analysisMode);z.showHelpFromUrl&&z.helpUrl&&(this.showHelpFromUrl=z.showHelpFromUrl,this.helpIdUrl=z.helpUrl,z.helpId="SHOWHELPURL");this.set("helpTopic",z.helpId);var G=a.after(t,"open",r.hitch(this,function(){h(".esriAnalysisCloseIcon",this.tooltipHelpDlg.domNode).on("click",r.hitch(this,this.close));G.remove()})),I=A.pageX,K=p.getBox(),Q;var N=!1;if(z.helpParentNode)var T=z.helpParentNode;T&&(Q=q.position(T));
Q&&K.w-A.pageX<Q.w?(N=!0,I=Q.x-this._size.w-10,this._isRightToLeft&&(I-=10)):this._isRightToLeft&&I-40<this._size.w&&(I=Q.w+this._size.w+80);t.open({popup:this.tooltipHelpDlg,x:!0===this._isRightToLeft||N?I-40:I+40,y:A.screenY-A.pageY+10,onCancel:r.hitch(this,function(){this.close()}),onExecute:function(){this.close()}});this.tooltipHelpDlg.domNode.parentNode&&d.set(this.tooltipHelpDlg.domNode.parentNode,"overflowY","hidden")},close:function(A,z){t.close(this.tooltipHelpDlg)}});c("extend-esri")&&
r.setObject("dijit.analysis.HelpWindow",n,x);return n})},"esri/dijit/BrowseItems":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/event dojo/dom-class dojo/dom-style dojo/dom-attr dojo/string dojo/on dojo/aspect dojo/has dojo/dom dojo/dom-construct dojo/mouse dojo/topic dojo/query dojo/parser dijit/registry dijit/TooltipDialog dijit/popup dojo/promise/all dojo/Deferred dgrid/Grid dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/OnDemandGrid dgrid/Selection dgrid/selector dgrid/Keyboard dgrid/util/mouse dgrid/util/touch put-selector/put dojo/store/Observable dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../arcgis/Portal ../Evented ../PluginTarget dojo/i18n!../nls/jsapi ./_AppTemplateFiltersMixin ./_RefreshMixin ../kernel ../lang ../config ../geometry/webMercatorUtils ../tasks/GeometryService ../SpatialReference dojo/NodeList-dom".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I,K,Q,N,T,W,X,ea,fa,J,V,aa,Z,L,O,D,P,R,ca,ha,oa){var ma=H(null,{idProperty:"id",constructor:function(U){H.safeMixin(this,U)},get:function(U,da){return J.PortalUtil.request(this.portalUrl+"content/items/"+U,da).then(function(na){return new J.PortalItem(k.mixin(na,{portal:this.portal}))})},getIdentity:function(U){return U[this.idProperty]},query:function(U,da){U=k.isObject(U)?U:{q:U};var na=null;if(da){U=k.mixin(U,{num:da.count,start:(da.start||
0)+1});if(da.sort&&da.sort.length){var ia=da.sort[0];U=k.mixin(U,{sortField:encodeURIComponent("created"===ia.attribute?"uploaded":ia.attribute),sortOrder:ia.descending?"desc":"asc"})}da.useExtent&&da.extent&&(U.bbox=da.extent);da.queryType&&"group"===da.queryType&&(na="group")}da="group"===na?this.portal.queryGroups(U,!0).then(function(pa){pa.results.total=pa.total;return pa.results}):this.portal.queryItems(U,!0).then(function(pa){pa.results.total=pa.total;return pa.results});return J.PortalResult(da)}});
r=H([X,ea,fa,aa],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"top-bar"\x3e\x3cdiv  class\x3d"esriFloatLeading instructions"\x3e\x3cspan class\x3d"messageLeft hide" data-dojo-attach-point\x3d"messageNodeLeft"\x3e\x3c/span\x3e\x3cspan class\x3d"messageRight hide" data-dojo-attach-point\x3d"messageNodeRight"\x3e\x3c/span\x3e\x3ca tabIndex\x3d"-1" data-dojo-attach-point\x3d"helpLink" class\x3d"esriHelpIcon hide" title\x3d"${i18n.browseItems.learnMoreConfigurableApps}" href\x3d"#" target\x3d"_blank"\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"${id}_search"class\x3d"searchBar esriFloatTrailing"\x3e\x3cinput tabIndex\x3d"1" placeholder\x3d"${i18n.browseItems.searchTitle}" class\x3d"esriSearchBox dijitTextBox" type\x3d"search"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"gallery"\x3e\x3cdiv class\x3d"gallery-left  quiet-scroll"\x3e\x3cul class\x3d"filters"\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d"templates gallery-right"\x3e\x3cp id\x3d"${id}_filterTitle" class\x3d"filter-title hide" data-dojo-attach-point\x3d"filterDescription"\x3e\x3c/p\x3e\x3cdiv id\x3d"${id}_grid"class\x3d"dgrid-autoheight quiet-scroll"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv  class\x3d"loaderWrap" data-dojo-attach-point\x3d"loaderWrap"\x3e\x3c/div\x3e\x3cdiv  class\x3d"js-info-panel templateInfoPanel" data-dojo-attach-point\x3d"infoPanel"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
galleryTemplate:"\x3cdiv style\x3d'opacity:1;' class\x3d'grid-item gallery-view'\x3e${item:_formatThumbnail}${item:_formatItemTitle}\x3cp class\x3d\"template-overlay\" style\x3d\"display:none;\"\x3e${i18n.browseItems.selectDetails}\x3c/p\x3e\x3c/div\x3e",infoPanelTemplate:'\x3cdiv\x3e\x3cdiv class\x3d"template-info-showing"\x3e\x3cdiv class\x3d"thumbnail"\x3e\x3cimg src\x3d"${item:_formatInfoPanelImage}"\x3e\x3c/div\x3e\x3ch4\x3e${item.title}\x3c/h4\x3e\x3cdiv class\x3d"template-info"\x3e\x3cp class\x3d"quiet-scroll"\x3e${item.snippet}\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-actions"\x3e\x3cbutton class\x3d"btn blue btn-main" id\x3d"on-next"\x3e${i18n.browseItems.configure}\x3c/button\x3e\x3cbutton class\x3d"btn btn-cancel" id\x3d"close-panel"\x3e${i18n.common.close}\x3c/button\x3e\x3c/div\x3e\x3cdiv\x3e',
_popupTemplate:'\x3cdiv class\x3d"esriBrowsePopup quiet-scroll"\x3e\x3cp\x3e{summary}\x3c/p\x3e\x3c/div\x3e',showInfoPanel:!0,isAutoClose:!0,showTooltip:!1,filterWithinGroup:!0,checkIsButtonEnabled:!1,baseClass:"esriBrowseItemsCtr",i18n:Z,postMixInProperties:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.self?(this._portal=new J.Portal({url:this.portalUrl,self:this.self}),this._init(),this._portal.on("load",k.hitch(this,function(){this.emit("portal-load",
{portal:this._portal});this._fetchData()}))):(this._portal=new J.Portal(this.portalUrl),this._portal.signIn().then(k.hitch(this,function(){this.emit("portal-load",{portal:this._portal});this._init();this._fetchData()})))},_init:function(){this._canSearchPublic=this.self?this.self.canSearchPublic:this._portal.canSearchPublic;this.query=k.mixin(this.query||{},{get:function(U){return this[U]&&this[U].length?"("+this[U].join(" OR ")+") ":""},toString:function(){return{q:this.get("groups")+this.get("tags")+
this.get("persistentTypekeywords")+this.get("typekeywords")+this.get("types")+this.get("owners")+this.get("orgids")+this.get("custom")+(this.query||"")+(this.search||"")+' -type:"Attachment" -tags:"mature support"'}}});this.self?this.self.canSearchPublic=!0:this._portal.canSearchPublic=!0;this.galleryTemplate=this.plugIn&&this.plugIn.galleryTemplate||this.galleryTemplate;this.infoPanelTemplate=this.plugIn&&this.plugIn.infoPanelTemplate||this.infoPanelTemplate;if(this.helpLinkUrl=this.plugIn&&this.plugIn.helpLinkUrl||
"")a.set(this.helpLink,"href",this.helpLinkUrl),l.remove(this.helpLink,"hide");u(".templates",this.domNode).addClass("fade");u(".dgrid-footer",this.domNode).addClass("hide");b.set(this.infoPanel,"display","none")},destroy:function(){this.inherited(arguments);this._grid&&this._grid.destroy();this._img_connect&&(this._img_connect.remove(),this._img_connect_error.remove());this._queryTimer&&clearTimeout(this._queryTimer);this._grid=this._portal=null},closeInfoPanel:function(){d.byId("close-panel").click()},
_setItemQueryAttr:function(U){this.itemQuery=U},_setPluginAttr:function(U){this.addPlugin(U)},_setMessageAttr:function(U){this.set("messageRight",U)},_setMessageRightAttr:function(U){"string"===typeof U?a.set(this.messageNodeRight,"innerHTML",U):U instanceof HTMLElement&&h.place(U,this.messageNodeRight);l.remove(this.messageNodeRight,"hide")},_setMessageLeftAttr:function(U){"string"===typeof U?a.set(this.messageNodeLeft,"innerHTML",U):U instanceof HTMLElement&&h.place(U,this.messageNodeLeft);l.remove(this.messageNodeLeft,
"hide")},_setDisabledAttr:function(U){var da=t.findWidgets(this.domNode).concat(t.findWidgets(this._content));n.forEach(da,function(na){na.set("disabled",U)});l[U?"add":"remove"](this._interval.domNode,"dijitTextBoxDisabled")},_setSortAttr:function(U){this.sortAttribute=U},_setSortDescendingAttr:function(U){this.sortDescending=U},_getSelectionAttr:function(){var U=this._grid.selection,da;for(da in U)if(U.hasOwnProperty(da))break;return da&&this._grid.row(da).data},_setGalleryTemplateAttr:function(U){P.isDefined(U)&&
(this.galleryTemplate=U)},_setFormatThumbnailAttr:function(U){P.isDefined(U)&&"function"===typeof U&&(this._formatThumbnail=U)},_setFormatItemTitleAttr:function(U){P.isDefined(U)&&"function"===typeof U&&(this._formatItemTitle=U)},_setRowsPerPageAttr:function(U){this._set("rowsPerPage",U)},_setPagingLinksAttr:function(U){this._set("pagingLinks",U)},_getQueryAttr:function(){return this.query},_setQueryAttr:function(U){this._set("query",U);this._grid&&this._grid.set("query",U.toString())},_setExtentAttr:function(U){U&&
this._set("extent",this._extentToString(U))},_setUseExtentAttr:function(U){this._set("useExtent",U)},_setQueryTypeAttr:function(U){this._set("queryType",U)},_setFetchTimeoutAttr:function(U){this._set("fetchTimeout",U)},_setShowInfoPanelAttr:function(U){this._set("showInfoPanel",U)},_setSelectionModeAttr:function(U){-1===n.indexOf(["extended","toggle","multiple","single","none"],U)&&(console.log("Incorrect Value provided for selectionMode. It is one of the following: extended, toggle, multiple, single, none"),
U="single");this._set("selectionMode",U)},_setDemandListAttr:function(U){this._set("demandList",U)},_validate:function(){return!!this.get("selection")},reset:function(){u(".esriSearchBox",d.byId(this.id+"_search")).forEach(function(pa){a.set(pa,"value","")});this.query.search="";if(this.plugIn.filters){var U=[],da=[],na=[],ia=[];u("li.active",this.domNode).forEach(function(pa){l.remove(pa,"active");var E=this.plugIn.filters[pa.childNodes[0].id];pa=n.map(E.tags,function(Y){return'tags:"'+Y+'"'},this);
var M=n.map(E.owners,function(Y){return'owner:"'+Y+'"'},this),ba=n.map(E.orgids,function(Y){return'orgid:"'+Y+'"'},this);E=n.map(E.typekeywords,function(Y){return'typekeywords:"'+Y+'"'},this);U.push(pa);na.push(M);ia.push(ba);da.push(E)},this);this.query.tags=n.filter(this.query.tags,function(pa){return-1!==n.indexOf(U,pa)});this.query.owners=n.filter(this.query.owners,function(pa){return-1!==n.indexOf(na,pa)});this.query.orgids=n.filter(this.query.orgids,function(pa){return-1!==n.indexOf(ia,pa)});
this.query.typekeywords=n.filter(this.query.typekeywords,function(pa){return-1!==n.indexOf(da,pa)});d.byId("all").click()}},_showPopup:function(U){if(!this._isInsideTooltipDialog){this._closePopup();var da=this._grid.row(U);U=u("img",da.element)[0];if(da={summary:da.data.snippet},da.summary)this._tooltip=new x({content:k.replace(this._popupTemplate,da),onMouseEnter:k.hitch(this,function(){this._isInsideTooltipDialog=!0}),onMouseLeave:k.hitch(this,function(){this._isInsideTooltipDialog=!1;this._closePopup()})}),
C.open({className:"esriBrowsePopupCtr",popup:this._tooltip,around:U,orient:["after-centered","before-centered"]}),this._onCloseConnect=u(".dijitDialogCloseIcon",this._tooltip.domNode).on("click",k.hitch(this,function(na){na.preventDefault();this._closePopup()}))}},_closePopup:function(){this._tooltip&&(this._onCloseConnect&&this._onCloseConnect.remove(),C.close(this._tooltip),this._tooltip.destroyRecursive(),this._tooltip=this._onCloseConnect=void 0)},_clearQueryTimeout:function(){clearTimeout(this._queryTimer);
this._queryTimer=null},_clearClosePanelTimeout:function(){clearTimeout(this._panelClosing);this._panelClosing=null;n.forEach(this._panelClickHandles,"item.remove();");h.empty(this.infoPanel)},_createGrid:function(){var U=H([y,w,G,O,A]),da=new W(new ma({portal:this._portal})),na=this.query,ia=k.hitch(this,function(M){M.snippet=M.snippet||"";var ba=T("div");M=c.substitute(this.galleryTemplate,{item:M,i18n:this.i18n},null,this);h.place(M,ba);return ba}),pa={};this.get("demandList")&&(U=H([y,z,G,O,A]));
this.get("useExtent")&&(pa.extent=this.get("extent"),pa.useExtent=this.get("useExtent"));this.get("queryType")&&(pa.queryType=this.get("queryType"));var E={store:da,query:na.toString(),selectionMode:this.selectionMode||"single",pagingLinks:this.get("pagingLinks")||2,rowsPerPage:this.plugIn&&this.plugIn.rowsPerPage||this.get("itemsPerPage")||6,loadingMessage:"Loading items...",showLoadingMessage:!1,renderRow:ia,noDataMessage:this.i18n.gallery.noItemsToDisplay,deselectOnRefresh:!("multiple"===this.selectionMode||
"extended"===this.selectionMode||"toggle"===this.selectionMode),sort:[{attribute:this.sortAttribute||"title",descending:this.sortDescending||!1}],queryOptions:pa};this.get("demandList")&&(E={store:da,query:na.toString(),minRowsPerPage:this.plugIn&&this.plugIn.rowsPerPage||this.get("itemsPerPage")||50,selectionMode:this.selectionMode||"single",loadingMessage:"Loading items...",showLoadingMessage:!1,renderRow:ia,pagingMethod:"throttleDelayed",noDataMessage:this.i18n.gallery.noItemsToDisplay,deselectOnRefresh:!("multiple"===
this.selectionMode||"extended"===this.selectionMode||"toggle"===this.selectionMode),sort:[{attribute:this.sortAttribute||"title",descending:this.sortDescending||!1}],queryOptions:pa});this._grid=new U(E,this.id+"_grid");this._grid.startup();this.own(f(this.domNode,"click",k.hitch(this,function(M){d.byId("close-panel")&&this.isAutoClose&&d.byId("close-panel").click()})),this._grid.on(Q.enterRow,k.hitch(this,function(M){!1===l.contains(this.domNode,"showing")&&this.showInfoPanel&&this._showOverlay(!0,
M);this.showTooltip&&!this.showInfoPanel&&this._showPopup(M)})),this._grid.on(Q.leaveRow,k.hitch(this,function(M){this._showOverlay(!1,M);this.showTooltip&&!this.showInfoPanel&&this._closePopup(M)})),this._grid.on(".dgrid-row:click",k.hitch(this,function(M){this.emit("grid-row-click",M);if(!1===l.contains(this.domNode,"showing")&&this.showInfoPanel){M.preventDefault();m.stop(M);this._clearClosePanelTimeout();var ba=this.get("selection");this._showOverlay(!1,M);this.showInfoPanel&&this.infoPanelTemplate?
(b.set(this.infoPanel,"display","block"),h.place(c.substitute(this.infoPanelTemplate,{item:ba,i18n:this.i18n},function(Y){return P.isDefined(Y)?Y:""},this),this.infoPanel)):b.set(this.infoPanel,"display","none");this.emit("show-info-panel");l.add(this.domNode,"showing");this._panelClickHandles=[u(".template-info-showing .thumbnail img",this.domNode).on("error",k.hitch(this,function(Y){a.set(Y.target,"src",ba.thumbnailUrl)})),u(".panel-actions .btn").on("click",k.hitch(this,function(Y){Y.preventDefault();
m.stop(Y);this.checkIsButtonEnabled&&l.contains(Y.target,"disabled")||("close-panel"===Y.target.id?(l.remove(this.domNode,"showing"),b.set(this.infoPanel,"display","none"),this._panelClosing=setTimeout(k.hitch(this,function(){n.forEach(void 0,"item.remove();");h.empty(this.infoPanel)},250))):(q.publish("/esri/browseitems/close",Y.target.id,this.get("selection")),Y={selection:this.get("selection"),action:Y.target.id},this.emit("browseitems-close",Y)))})),u(".js-info-panel",this.domNode).on("click",
k.hitch(this,function(Y){this.isAutoClose&&(Y.preventDefault(),m.stop(Y))})),f(u(".dgrid-footer,.dgrid-header",this._grid.domNode),p.leave,k.hitch(this,function(Y){this.showTooltip&&!this.showInfoPanel&&this._closePopup()}))]}})),this._grid.on("dgrid-refresh-complete",k.hitch(this,function(M){u(".templates",this.domNode).removeClass("fade");u(".loaderWrap",this.domNode).addClass("hide");u(".dgrid-footer",this.domNode)[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide");this.showTooltip&&
!this.showInfoPanel&&this._closePopup()})),this._grid.on("refresh",k.hitch(this,function(){this.showTooltip&&!this.showInfoPanel&&this._closePopup();this._img_connect&&(this._img_connect.remove(),this._img_connect_error.remove(),this._img_connect_error=this._img_connect=null);this._img_connect=u(".grid-item-thumb",this._grid.domNode).on("load",k.hitch(this,function(M){(M=this._grid.row(M))&&M.element&&u(".grid-item",M.element).addClass("fadeIn").style("opacity","1")}));this._img_connect_error=u(".grid-item-thumb",
this._grid.domNode).on("error",k.hitch(this,function(M){a.set(M.target,"src",this._portal.staticImagesUrl+"/desktopapp.png")}))})),f(d.byId(this.id+"_search"),"keyup",k.hitch(this,function(M){M.preventDefault();this._clearQueryTimeout();this._queryTimer=setTimeout(k.hitch(this,function(){this.query.search=a.get(M.target,"value");this._fetchItems(this.query).then(k.hitch(this,function(){this._clearQueryTimeout()}))}),this.searchKeypressDelay||450)})),f(d.byId(this.id+"_search"),"search",k.hitch(this,
function(M){this._queryTimer||(M.preventDefault(),this.query.search=a.get(M.target,"value"),this._fetchItems(this.query))})),this.watch("extent",k.hitch(this,function(M,ba,Y){this._grid.queryOptions.extent=this.get("extent");this._grid.queryOptions.useExtent=this.get("useExtent");this._grid.query.bbox=this._grid.queryOptions.useExtent?this._grid.queryOptions.extent:"";this._grid.refresh()})),this.watch("useExtent",k.hitch(this,function(M,ba,Y){this._grid.queryOptions.extent=this.get("extent");this._grid.queryOptions.useExtent=
Y;this._grid.query.bbox=this._grid.queryOptions.useExtent?this._grid.queryOptions.extent:"";this._grid.refresh()})));this.showInfoPanel||("single"===this._grid.selectionMode?this.own(this._grid.on("dgrid-select,dgrid-deselect",k.hitch(this,function(M){M={selection:this.get("selection")};this.emit("select-change",M)}))):-1!==n.indexOf(["toggle","multiple","extended"],this._grid.selectionMode)&&this.own(this._grid.on("dgrid-select,dgrid-deselect",k.hitch(this,function(M){M=M.grid.selection;var ba,Y=
[];for(ba in M)M[ba]&&Y.push(this._grid.row(ba).data);this.emit("select-change",{selection:Y})}))));this.emit("grid-ready",{grid:this._grid,ready:!0})},_createFilters:function(){if(this.plugIn&&this.plugIn.filters){var U=this.plugIn.filters,da=this.plugIn.filterStrings,na,ia=u(".filters",this.domNode)[0];for(na in U)h.create("li",{"class":"all"===na?"active":"",innerHTML:"\x3ca id\x3d'"+na+"'  href\x3d'#'\x3e"+da[na].title+"\x3c/a\x3e"},ia);this.own(f(ia,"li a:click",k.hitch(this,function(pa){pa.preventDefault();
var E=pa.target;u(".active",ia).removeClass("active");l.add(E.parentNode,"active");u(".templates",this.domNode).addClass("fade");setTimeout(k.hitch(this,function(){l["all"===E.id?"add":"remove"](this.filterDescription,"hide");a.set(this.filterDescription,"innerHTML",da[E.id].description||"")}),225);pa=k.mixin({},U[E.id]||{});this.query.tags=n.map(pa.tags||[],function(M){return'tags:"'+M+'"'});this.query.owners=n.map(pa.owners,function(M){return'owner:"'+M+'"'});this.query.orgids=n.map(pa.orgids,function(M){return'orgid:"'+
M+'"'});this.query.typekeywords=[].concat(n.map(pa.typekeywords||[],function(M){return'typekeywords:"'+M+'"'}));this.filterWithinGroup||(this.query.groups=n.map(pa.groups,function(M){return'group:"'+M+'"'}));this._fetchItems(this.query)})));l.add(this.domNode,"filters");l.remove(this.domNode,"nofilters")}else l.add(this.domNode,"nofilters"+(this.plugIn&&this.plugIn.extraClasses?" "+this.plugIn.extraClasses.join(" "):"")),l.remove(this.domNode,"filters")},_showOverlay:function(U,da){(da=this._grid.row(da))&&
u(".template-overlay",da.element).style("display",U?"":"none")},_fetchData:function(){this._user=this._portal.getPortalUser();return this.plugIn&&this.plugIn.fetchData?this.plugIn.fetchData():this._fetchItems(this.itemQuery)},_fetchItems:function(U,da){var na={sort:[{attribute:this.sortAttribute||"title",descending:this.sortDescending||!1}]},ia=new F;this.get("useExtent")&&(na.extent=this.get("extent"),na.useExtent=this.get("useExtent"));this.get("queryType")&&(na.queryType=this.get("queryType"));
u(".templates",this.domNode).addClass("fade");u(".dgrid-footer",this.domNode).addClass("hide");u(".loaderWrap",this.domNode).removeClass("hide");setTimeout(k.hitch(this,function(){this.query=k.mixin(this.query,U);this._grid?this._grid.set("query",this.query.toString(),na):(this._createFilters(),this._createGrid());ia.resolve(this._grid)}),60);return ia},_formatThumbnail:function(U){var da=U.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png";U.thumbnailUrl=da;return"\x3cimg class\x3d'grid-item-thumb' width\x3d'187px' height\x3d'125px' alt\x3d'' src\x3d'"+
da+"'\x3e"},_formatInfoPanelImage:function(U){var da=U.screenshots&&U.screenshots.length?U.screenshots[0]:null;return da?U.itemUrl+"/info/"+da:U.thumbnailUrl},_formatItemTitle:function(U){return"\x3ch5\x3e"+(U.title||U.name||"\x3cNo Title\x3e")+"\x3c/h5\x3e"},clear:function(){this._grid.clearSelection()},doProject:function(U,da){var na=[102113,102100,3857],ia=new F;var pa=function(M,ba){!(M&&0<M.length&&M[0]&&"extent"==M[0].type)||isNaN(M[0].xmin)||isNaN(M[0].ymin)||isNaN(M[0].xmax)||isNaN(M[0].ymax)?
M&&0<M.length&&M[0]&&"point"==M[0].type&&!isNaN(M[0].x)&&!isNaN(M[0].y)&&ia.resolve(M,ba):ia.resolve(M,ba)};if(null!=U.spatialReference.wkid&&4326==U.spatialReference.wkid&&null!=da.wkid&&this.contains(na,da.wkid)){U.ymin=Math.max(U.ymin,-89.99);U.ymax=Math.min(U.ymax,89.99);U=ca.geographicToWebMercator(U);if((na=U.spatialReference._getInfo())&&U.xmin>U.xmax){pa=na.valid[1]-U.xmin;var E=U.xmax-na.valid[0];pa>E?U.xmax=na.valid[1]+E:U.xmin=na.valid[0]-pa}U.spatialReference.wkid=da.wkid;ia.resolve([U])}else null!=
U.spatialReference.wkid&&this.contains(na,U.spatialReference.wkid)&&null!=da.wkid&&4326==da.wkid?(U=ca.webMercatorToGeographic(U),(na=U.spatialReference._getInfo())&&U.xmin>U.xmax&&(pa=na.valid[1]-U.xmin,E=U.xmax-na.valid[0],pa>E?U.xmax=na.valid[1]+E:U.xmin=na.valid[0]-pa),ia.resolve([U])):(this.geometryService||(this.geometryService=new ha(R.defaults.geometryService)),this.geometryService.project([U],da,pa));return ia},contains:function(U,da){for(var na=U.length;na--;)if(U[na]===da)return!0;return!1},
_extentToGCS:function(U){U=U.shiftCentralMeridian(!0);return ca.webMercatorToGeographic(U)},_extentToString:function(U){var da="";null!=U&&(U=this._extentToGCS(U),da=this._roundValue(U.xmin,1E4)+","+this._roundValue(U.ymin,1E4)+","+this._roundValue(U.xmax,1E4)+","+this._roundValue(U.ymax,1E4));return da},_roundValue:function(U,da){return Math.round(U*da)/da}});g("extend-esri")&&k.setObject("dijit.BrowseItems",r,D);return r})},"dgrid/extensions/Pagination":function(){define("../_StoreMixin dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/on dojo/query dojo/string dojo/has put-selector/put ../util/misc dojo/i18n!./nls/pagination dojo/_base/sniff xstyle/css!../css/extensions/Pagination.css".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g){function d(p){p.noDataNode?(f(p.noDataNode,"!"),delete p.noDataNode):p.cleanup();p.contentNode.innerHTML=""}function h(p){if(p.loadingNode)f(p.loadingNode,"!"),delete p.loadingNode;else if(p._oldPageNodes){for(var q in p._oldPageNodes)p.removeRow(p._oldPageNodes[q]);delete p._oldPageNodes;p._oldPageObserver&&(p._oldPageObserver.cancel(),p._numObservers--,delete p._oldPageObserver)}delete p._isLoading}return k("dgrid.extensions.Pagination",H,{rowsPerPage:10,pagingTextBox:!1,
previousNextArrows:!0,firstLastArrows:!1,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:!0,i18nPagination:g,showFooter:!0,_currentPage:1,_total:0,buildRendering:function(){this.inherited(arguments);var p=this,q=this.paginationNode=f(this.footerNode,"div.dgrid-pagination"),u=this.paginationStatusNode=f(q,"div.dgrid-status"),v=this.i18nPagination;u.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();u.innerHTML=a.substitute(v.status,{start:1,end:1,total:0});q=this.paginationNavigationNode=
f(q,"div.dgrid-navigation");this.firstLastArrows&&(u=this.paginationFirstNode=f(q,"span.dgrid-first.dgrid-page-link","\u00ab"),u.setAttribute("aria-label",v.gotoFirst),u.tabIndex=0);this.previousNextArrows&&(u=this.paginationPreviousNode=f(q,"span.dgrid-previous.dgrid-page-link","\u2039"),u.setAttribute("aria-label",v.gotoPrev),u.tabIndex=0);this.paginationLinksNode=f(q,"span.dgrid-pagination-links");this.previousNextArrows&&(u=this.paginationNextNode=f(q,"span.dgrid-next.dgrid-page-link","\u203a"),
u.setAttribute("aria-label",v.gotoNext),u.tabIndex=0);this.firstLastArrows&&(u=this.paginationLastNode=f(q,"span.dgrid-last.dgrid-page-link","\u00bb"),u.setAttribute("aria-label",v.gotoLast),u.tabIndex=0);this._listeners.push(l(q,".dgrid-page-link:click,.dgrid-page-link:keydown",function(t){if("keydown"!==t.type||13===t.keyCode)if(t=this.className,!(p._isLoading||-1<t.indexOf("dgrid-page-disabled"))){var x=p._currentPage;var C=Math.ceil(p._total/p.rowsPerPage);this===p.paginationPreviousNode?p.gotoPage(x-
1):this===p.paginationNextNode?p.gotoPage(x+1):this===p.paginationFirstNode?p.gotoPage(1):this===p.paginationLastNode?p.gotoPage(C):"dgrid-page-link"===t&&p.gotoPage(+this.innerHTML)}}))},destroy:function(){this.inherited(arguments);this._pagingTextBoxHandle&&this._pagingTextBoxHandle.remove()},_updatePaginationSizeSelect:function(){var p=this.pageSizeOptions,q=this.paginationSizeSelect;if(p&&p.length){if(!q){q=this.paginationSizeSelect=f(this.paginationNode,"select.dgrid-page-size[aria-label\x3d"+
this.i18nPagination.rowsPerPage+"]");var u=this._paginationSizeChangeHandle=l(q,"change",r.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value)}));this._listeners.push(u)}for(u=q.options.length=0;u<p.length;u++)f(q,"option",p[u],{value:p[u],selected:this.rowsPerPage===p[u]});this._updateRowsPerPageOption()}else p&&p.length||!q||(f(q,"!"),this.paginationSizeSelect=null,this._paginationSizeChangeHandle.remove())},_setPageSizeOptions:function(p){this.pageSizeOptions=p&&p.sort(function(q,
u){return q-u});this._updatePaginationSizeSelect()},_updateRowsPerPageOption:function(){var p=this.rowsPerPage,q=this.pageSizeOptions,u=this.paginationSizeSelect;u&&(0>n.indexOf(q,p)?this._setPageSizeOptions(q.concat([p])):u.value=""+p)},_setRowsPerPage:function(p){this.rowsPerPage=p;this._updateRowsPerPageOption();this.gotoPage(1)},_updateNavigation:function(){function p(G,I){if(u.pagingTextBox&&G==x&&1<F)I=f(t,"input.dgrid-page-input[type\x3dtext][value\x3d$]",x),I.setAttribute("aria-label",v.jumpPage),
u._pagingTextBoxHandle=l(I,"change",function(){var Q=+this.value;!isNaN(Q)&&0<Q&&Q<=F&&u.gotoPage(+this.value)}),w&&"INPUT"===w.tagName&&I.focus();else{var K=G===x;I=f(t,"span"+(K?".dgrid-page-disabled":"")+".dgrid-page-link",G+(I?" ":""));I.setAttribute("aria-label",v.gotoPage);I.tabIndex=K?-1:0;A===G&&(K?G<F?A++:z.focus():I.focus());K||(z=I)}}function q(G,I){f(G,(I?".":"!")+"dgrid-page-disabled");G.tabIndex=I?-1:0}var u=this,v=this.i18nPagination,t=this.paginationLinksNode,x=this._currentPage,C=
this.pagingLinks,B=this.paginationNavigationNode,F=Math.ceil(this._total/this.rowsPerPage),y=this._pagingTextBoxHandle,w=document.activeElement,A,z;w&&e.contains(this.paginationNavigationNode,w)?"dgrid-page-link"===w.className&&(A=+w.innerHTML):w=null;y&&y.remove();t.innerHTML="";b(".dgrid-first, .dgrid-previous",B).forEach(function(G){q(G,1===x)});b(".dgrid-last, .dgrid-next",B).forEach(function(G){q(G,x>=F)});if(C&&0<F){p(1,!0);B=x-C;for(2<B?f(t,"span.dgrid-page-skip","..."):B=2;B<Math.min(x+C+
1,F);B++)p(B,!0);x+C+1<F&&f(t,"span.dgrid-page-skip","...");1<F&&p(F)}else u.pagingTextBox&&p(x);w&&-1===w.tabIndex&&(C=b("[tabindex\x3d'0']",this.paginationNavigationNode),w===this.paginationPreviousNode||w===this.paginationFirstNode?w=C[0]:C.length&&(w=C[C.length-1]),w&&w.focus())},refresh:function(){var p=this;this.inherited(arguments);if(this.store)return this.gotoPage(1).then(function(q){setTimeout(function(){l.emit(p.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:p,results:q})},
0);return q});console.warn("Pagination requires a store to operate.")},_onNotification:function(p){p.length!==this._rowsOnPage&&this.gotoPage(this._currentPage)},renderArray:function(p,q){var u=this,v=this.inherited(arguments);this._lastCollection=null;q||(this._topLevelRequest&&this._topLevelRequest!==p&&(this._topLevelRequest.cancel(),delete this._topLevelRequest),"function"===typeof p.cancel&&(this._topLevelRequest=p),m.when(p,function(){u._topLevelRequest&&delete u._topLevelRequest}));return v},
insertRow:function(){var p=this._oldPageNodes,q=this.inherited(arguments);p&&q===p[q.id]&&delete p[q.id];return q},gotoPage:function(p){var q=this,u=new m;this._trackError(function(){var v=q.rowsPerPage,t=(p-1)*v,x=r.mixin(q.get("queryOptions"),{start:t,count:v}),C=q.contentNode,B;if(q.showLoadingMessage){d(q);var F=q.loadingNode=f(C,"div.dgrid-loading");F.innerHTML=q.loadingMessage}else{q._oldPageNodes=F={};C=C.children;var y=0;for(B=C.length;y<B;y++)F[C[y].id]=C[y];q._oldPageObserver=q.observers.pop()}q._isLoading=
!0;var w=q.store.query(q.query,x);m.when(q.renderArray(w,null,x),function(A){h(q);q.scrollTo({y:0});m.when(w.total,function(z){z||(q.noDataNode&&(f(q.noDataNode,"!"),delete q.noDataNode),q.noDataNode=f(q.contentNode,"div.dgrid-no-data"),q.noDataNode.innerHTML=q.noDataMessage);q.paginationStatusNode.innerHTML=a.substitute(q.i18nPagination.status,{start:Math.min(t+1,z),end:Math.min(z,t+v),total:z});q._total=z;q._currentPage=p;q._rowsOnPage=A.length;q._updateNavigation()});(7>c("ie")||c("ie")&&c("quirks"))&&
q.resize();u.resolve(w)},function(A){h(q);u.reject(A)});return u.promise})||u.reject();return u.promise}})})},"dgrid/extensions/DijitRegistry":function(){define(["dojo/_base/declare","dojo/dom-geometry","dijit/registry"],function(H,k,n){return H("dgrid.extensions.DijitRegistry",null,{minSize:0,maxSize:Infinity,layoutPriority:0,showTitle:!0,buildRendering:function(){n.add(this);this.inherited(arguments);this.domNode.setAttribute("widgetId",this.id)},startup:function(){if(!this._started){this.inherited(arguments);
var r=n.getEnclosingWidget(this.domNode.parentNode);r&&r.isLayoutContainer&&this._resizeHandle.remove()}},destroyRecursive:function(){this.destroy()},destroy:function(){this.inherited(arguments);n.remove(this.id)},getChildren:function(){return[]},isLeftToRight:function(){return!this.isRTL},resize:function(r){r&&k.setMarginBox(this.domNode,r);this.inherited(arguments)},_set:function(r,m){this[r]=m},watch:function(){},getParent:function(){return n.getEnclosingWidget(this.domNode.parentNode)}})})},"dgrid/selector":function(){define("dojo/_base/kernel dojo/_base/array dojo/_base/lang dojo/on dojo/aspect dojo/_base/sniff put-selector/put".split(" "),
function(H,k,n,r,m,l,b){n.getObject("dgrid.selector",!0);return dgrid.selector=function(a,c){function f(v){return!p.allowSelect(p.row(v))}function e(v){return function(t){var x=t.rows,C=x.length;t="false";var B;for(B=0;B<C;B++){var F=p.cell(x[B],a.id).element;F&&(F=(F.contents||F).input)&&!F.disabled&&(F.checked=v,F.setAttribute("aria-checked",v))}if("checkbox"==q.type){x=p.selection;C=!1;for(B in x)if(x[B]!=p.allSelected){C=!0;break}q.indeterminate=C;q.checked=p.allSelected;C?t="mixed":p.allSelected&&
(t="true");q.setAttribute("aria-checked",t)}}}function g(v){if("click"==v.type||32==v.keyCode||!l("opera")&&13==v.keyCode||0===v.keyCode){var t=p.row(v);p._selectionTriggerEvent=v;if(t){if(p.allowSelect(t)){var x=p._lastSelected&&p.row(p._lastSelected);"radio"==c?x&&x.id==t.id||(p.clearSelection(),p.select(t,null,!0),p._lastSelected=t.element):t&&(v.shiftKey?e(!0)({rows:[t]}):x=null,x=v.shiftKey?x:null,p.select(x||t,t,x?void 0:null),p._lastSelected=t.element)}}else b(this,(p.allSelected?"!":".")+
"dgrid-select-all"),p[p.allSelected?"clearSelection":"selectAll"]();p._selectionTriggerEvent=null}}function d(){p._hasSelectorInputListener=!0;h.push(p.on(".dgrid-selector:click,.dgrid-selector:keydown",g));var v=p._handleSelect;p._handleSelect=function(C){this.cell(C).column!=a&&v.apply(this,arguments)};if("function"==typeof a.disabled){var t=p.allowSelect,x=a.disabled;p.allowSelect=function(C){var B=t.call(this,C);return x===f?B:B&&!x.call(a,C.data)}}a.disabled=f;h.push(p.on("dgrid-select",e(!0)));
h.push(p.on("dgrid-deselect",e(!1)))}var h=[],p,q;a||(a={});a.type&&(a.selectorType=a.type,H.deprecated("columndef.type","use columndef.selectorType instead","dgrid 0.4"));a.selectorType=c=c||a.selectorType||"checkbox";a.sortable=!1;var u="function"==typeof c?c:function(v,t,x){var C=t.parentNode;p._hasSelectorInputListener||d();var B=a.disabled;b(C&&C.contents?C:t,".dgrid-selector");t=t.input||(t.input=b(t,"input[type\x3d"+c+"]",{tabIndex:isNaN(a.tabIndex)?-1:a.tabIndex,disabled:B&&("function"==typeof B?
B.call(a,x):B),checked:v}));t.setAttribute("aria-checked",!!v);return t};m.after(a,"init",function(){p=a.grid});m.after(a,"destroy",function(){k.forEach(h,function(v){v.remove()});p._hasSelectorInputListener=!1});a.renderCell=function(v,t,x,C,B){t=(t=v&&p.row(v))&&p.selection[t.id];u(t,x,v)};a.renderHeaderCell=function(v){var t="label"in a?a.label:a.field||"";"radio"!=c&&p.allowSelectAll?u(!1,v,{}):(v.appendChild(document.createTextNode(t)),p._hasSelectorInputListener||d());q=v.lastChild};return a}})},
"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),function(H,k,n,r,m,l,b,a){function c(w){w.preventDefault()}var f={checkbox:1,radio:1,button:1},e=/\bdgrid-cell\b/,g=/\bdgrid-row\b/,d=H("dgrid.Keyboard",null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=r.mixin({},d.defaultKeyMap));
this.headerKeyMap||(this.headerKeyMap=r.mixin({},d.defaultHeaderKeyMap))},postCreate:function(){function w(G){var I=G.target;return I.type&&(!f[I.type]||32==G.keyCode)}function A(G){function I(){z._focusedHeaderNode&&(z._focusedHeaderNode.tabIndex=-1);if(z.showHeader){if(K)for(var W=0,X,ea=z.headerNode.getElementsByTagName("th");X=ea[W];++W){if(Q.test(X.className)){z._focusedHeaderNode=T=X;break}}else z._focusedHeaderNode=T=z.headerNode;T&&(T.tabIndex=z.tabIndex)}}var K=z.cellNavigation,Q=K?e:g,N=
G===z.headerNode,T=G;N?(I(),k.after(z,"renderHeader",I,!0)):k.after(z,"renderArray",function(W){return a.when(W,function(X){var ea=z._focusedNode||T;if(Q.test(ea.className)&&b.contains(G,ea))return X;for(var fa=0,J=G.getElementsByTagName("*"),V;V=J[fa];++fa)if(Q.test(V.className)){ea=z._focusedNode=V;break}ea.tabIndex=z.tabIndex;return X})});z._listeners.push(n(G,"mousedown",function(W){w(W)||z._focusOnNode(W.target,N,W)}));z._listeners.push(n(G,"keydown",function(W){if(!W.metaKey&&!W.altKey){var X=
z[N?"headerKeyMap":"keyMap"][W.keyCode];X&&!w(W)&&X.call(z,W)}}))}this.inherited(arguments);var z=this;this.tabableHeader&&(A(this.headerNode),this._listeners.push(n(this.headerNode,"dgrid-cellfocusin",function(){z.scrollTo({x:this.scrollLeft})})));A(this.contentNode);this._debouncedEnsureScroll=b.debounce(this._ensureScroll,this)},removeRow:function(w){if(!this._focusedNode)return this.inherited(arguments);var A=this,z=document.activeElement===this._focusedNode,G=this[this.cellNavigation?"cell":
"row"](this._focusedNode),I=G.row||G,K;w=w.element||w;w===I.element&&((K=this.down(I,!0))&&K.element!==w||(K=this.up(I,!0)),this._removedFocus={active:z,rowId:I.id,columnId:G.column&&G.column.id,siblingId:K&&K.element!==w?K.id:void 0},setTimeout(function(){A._removedFocus&&A._restoreFocus(I.id)},0),this._focusedNode=null);this.inherited(arguments)},insertRow:function(w){var A=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(A);return A},_restoreFocus:function(w){var A=
this._removedFocus,z;if((w=(w=w&&this.row(w))&&w.element&&w.id===A.rowId?w:"undefined"!==typeof A.siblingId&&this.row(A.siblingId))&&w.element){if(!w.element.parentNode.parentNode){A.wait=!0;return}"undefined"!==typeof A.columnId&&(z=this.cell(w,A.columnId))&&z.element&&(w=z);A.active&&0!==w.element.offsetHeight?this._focusOnNode(w,!1,null):(l(w.element,".dgrid-focus"),w.element.tabIndex=this.tabIndex,this._focusedNode=w.element)}delete this._removedFocus},addKeyHandler:function(w,A,z){return k.after(this[z?
"headerKeyMap":"keyMap"],w,A,!0)},_ensureRowScroll:function(w){var A=this.getScrollPosition().y;A>w.offsetTop?this.scrollTo({y:w.offsetTop}):A+this.contentNode.offsetHeight<w.offsetTop+w.offsetHeight&&this.scrollTo({y:w.offsetTop-this.contentNode.offsetHeight+w.offsetHeight})},_ensureColumnScroll:function(w){var A=this.getScrollPosition().x,z=w.offsetLeft;if(A>z)this.scrollTo({x:z});else{var G=this.bodyNode.clientWidth;w=w.offsetWidth;var I=z+w;A+G<I&&this.scrollTo({x:G>w?I-G:z})}},_ensureScroll:function(w,
A){this.cellNavigation&&(this.columnSets||1<this.subRows.length)&&!A&&this._ensureRowScroll(w.row.element);this.bodyNode.clientWidth<this.contentNode.offsetWidth&&this._ensureColumnScroll(w.element)},_focusOnNode:function(w,A,z){var G="_focused"+(A?"Header":"")+"Node",I=this[G],K=this.cellNavigation?"cell":"row",Q=this[K](w),N;if(w=Q&&Q.element){if(this.cellNavigation){var T=w.getElementsByTagName("input");var W=0;for(N=T.length;W<N;W++){var X=T[W];if((-1!=X.tabIndex||"_dgridLastValue"in X)&&!X.disabled){8>
m("ie")&&(X.style.position="relative");X.focus();8>m("ie")&&(X.style.position="");var ea=!0;break}}}null!==z&&(z=r.mixin({grid:this},z),z.type&&(z.parentType=z.type),z.bubbles||(z.bubbles=!0));I&&(l(I,"!dgrid-focus[!tabIndex]"),8>m("ie")&&(I.style.position=""),z&&(z[K]=this[K](I),n.emit(I,"dgrid-cellfocusout",z)));I=this[G]=w;z&&(z[K]=Q);G=this.cellNavigation?e:g;!ea&&G.test(w.className)&&(8>m("ie")&&(w.style.position="relative"),w.tabIndex=this.tabIndex,w.focus());l(w,".dgrid-focus");z&&n.emit(I,
"dgrid-cellfocusin",z);this._debouncedEnsureScroll(Q,A)}},focusHeader:function(w){this._focusOnNode(w||this._focusedHeaderNode,!0)},focus:function(w){(w=w||this._focusedNode)?this._focusOnNode(w,!1):this.contentNode.focus()}}),h=d.moveFocusVertical=function(w,A){if(this._focusOnNode&&w.target!==this.contentNode){var z=this.cellNavigation,G=this[z?"cell":"row"](w);G=z&&G.column.id;A=this.down(this._focusedNode,A,!0);z&&(A=this.cell(A,G));this._focusOnNode(A,!1,w);w.preventDefault()}};H=d.moveFocusUp=
function(w){h.call(this,w,-1)};var p=d.moveFocusDown=function(w){h.call(this,w,1)},q=d.moveFocusPageUp=function(w){h.call(this,w,-this.pageSkip)},u=d.moveFocusPageDown=function(w){h.call(this,w,this.pageSkip)},v=d.moveFocusHorizontal=function(w,A){if(this.cellNavigation&&w.target!==this.contentNode){var z=!this.row(w);this._focusOnNode(this.right(this["_focused"+(z?"Header":"")+"Node"],A),z,w);w.preventDefault()}},t=d.moveFocusLeft=function(w){v.call(this,w,-1)},x=d.moveFocusRight=function(w){v.call(this,
w,1)},C=d.moveHeaderFocusEnd=function(w,A){if(this.cellNavigation){var z=this.headerNode.getElementsByTagName("th");this._focusOnNode(z[A?0:z.length-1],!0,w)}w.preventDefault()},B=d.moveHeaderFocusHome=function(w){C.call(this,w,!0)},F=d.moveFocusEnd=function(w,A){var z=this,G=this.cellNavigation,I=this.contentNode,K=I.scrollTop+(A?0:I.scrollHeight);I=I[A?"firstChild":"lastChild"];var Q=-1<I.className.indexOf("dgrid-preload"),N=Q?I[(A?"next":"previous")+"Sibling"]:I,T=N.offsetTop+(A?0:N.offsetHeight);
if(Q){for(;N&&0>N.className.indexOf("dgrid-row");)N=N[(A?"next":"previous")+"Sibling"];if(!N)return}if(!Q||1>I.offsetHeight)G&&(N=this.cell(N,this.cell(w).column.id)),this._focusOnNode(N,!1,w);else{m("dom-addeventlistener")||(w=r.mixin({},w));var W=k.after(this,"renderArray",function(X){W.remove();return a.when(X,function(ea){ea=ea[A?0:ea.length-1];G&&(ea=z.cell(ea,z.cell(w).column.id));z._focusOnNode(ea,!1,w)})})}K===T&&w.preventDefault()},y=d.moveFocusHome=function(w){F.call(this,w,!0)};d.defaultKeyMap=
{32:c,33:q,34:u,35:F,36:y,37:t,38:H,39:x,40:p};d.defaultHeaderKeyMap={32:c,35:C,36:B,37:t,39:x};return d})},"dgrid/util/mouse":function(){define(["dojo/_base/lang","dojo/on","dojo/dom","dojo/query"],function(H,k,n){function r(l,b){return function(a,c){return k(a,l+":"+b,function(f){if(!n.isDescendant(f.relatedTarget,this))return c.call(this,f)})}}var m={enterRow:r(".dgrid-content .dgrid-row","mouseover"),enterCell:r(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:r(".dgrid-header .dgrid-cell",
"mouseover"),leaveRow:r(".dgrid-content .dgrid-row","mouseout"),leaveCell:r(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:r(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:r};H.getObject("dgrid.util.mouse",!0);H.mixin(dgrid.util.mouse,m);return m})},"dgrid/util/touch":function(){define(["dojo/on","dojo/query"],function(H,k){function n(m,l,b,a){if(!(1<b.targetTouches.length)){var c=b.changedTouches[0],f=c.screenX,e=c.screenY;a&&b.preventDefault();var g=H(m,"touchend",function(d){var h=
d.changedTouches[0];d.targetTouches.length||(Math.abs(h.screenX-f)<r.tapRadius&&Math.abs(h.screenY-e)<r.tapRadius&&(a&&d.preventDefault(),l.call(this,d)),g.remove())})}}var r={tapRadius:10,dbltapTime:250,selector:function(m,l,b){return function(a,c){var f=l.bubble;f?l=f:!1!==b&&(b=!0);return H(a,l,function(e){var g=e.target;3==g.nodeType&&(g=g.parentNode);for(;!k.matches(g,m,a);)if(g==a||!b||!(g=g.parentNode))return;return c.call(g,e)})}},countCurrentTouches:function(m,l){if(!("touches"in m))return-1;
var b,a,c;for(a=b=0;c=m.touches[b];++b)l.contains(c.target)&&++a;return a},tap:function(m,l){return H(m,"touchstart",function(b){n(m,l,b)})},dbltap:function(m,l){var b,a;return H(m,"touchstart",function(c){b?n(m,function(f){if(b){var e=f.changedTouches[0];Math.abs(e.screenX-b.screenX)<r.tapRadius&&Math.abs(e.screenY-b.screenY)<r.tapRadius&&(a&&clearTimeout(a),b=a=null,l.call(this,f))}},c,!0):n(m,function(f){b=f.changedTouches[0];a=setTimeout(function(){b=a=null},r.dbltapTime)},c)})}};return r})},
"esri/dijit/_AppTemplateFiltersMixin":function(){define(["dojo/_base/declare"],function(){return{rootNodes:{app:{all:{},narrate:{typekeywords:["story"]},collect:{typekeywords:["collect"]},compare:{typekeywords:["compare"]},"3dscene":{typekeywords:["3Dscene"]},analyze:{typekeywords:["summarize"]},present:{typekeywords:["gallery"]},social:{typekeywords:["social"]},local:{typekeywords:["local"]},route:{typekeywords:["route"]},showcase:{typekeywords:["showcase"]}}}}})},"esri/dijit/_RefreshMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/has ../kernel".split(" "),
function(H,k,n,r,m,l){function b(a){"object"!==typeof a&&(a=Error(a));a.grid=this;r.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}H=H(null,{_trackError:function(a){"string"===typeof a&&(a=k.hitch(this,a));try{var c=a()}catch(f){b.call(this,f)}return n.when(c,k.hitch(this,function(){r.emit(this.domNode,"refresh",{cancelable:!0,bubbles:!0})}),k.hitch(this,b))}});m("extend-esri")&&k.setObject("dijit._RefreshMixin",H,l);return H})},"esri/dijit/analysis/PluginAnalysisLayers":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/has ../../kernel dojo/i18n!../../nls/jsapi".split(" "),
function(H,k,n,r,m,l,b){var a=H(null,{filters:{all:{},categoryBoundaries:{tags:["boundaries","places"]},subCategoryBoundaries:{tags:["boundaries"]},subCategoryPlaces:{tags:["places"]},categoryHexBins:{tags:["hex"]},categoryTransportation:{tags:["transportation"]}},constructor:function(c){k.mixin(this,c);this.i18n=k.mixin({},b.browseLayersDlg);this.filterStrings={all:{title:this.i18n.categoryAll},categoryBoundaries:{title:this.i18n.categoryBoundaries},subCategoryBoundaries:{title:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+
this.i18n.subCategoryBoundaries},subCategoryPlaces:{title:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryPlaces},categoryHexBins:{title:this.i18n.categoryHexBins},categoryTransportation:{title:this.i18n.categoryTransportation}}},fetchData:function(){this._portal=this.parent._portal;var c;return this._fetchGroups().then(k.hitch(this,function(f){c=n.map(f||[],function(e){if(e)return'group:"'+e.id+'"'});return this._fetchGroupItems(c)}))},_fetchGroup:function(c,f){this._groups=this._groups||
[];return this._groups[c]||this._portal.queryGroups(f,!0).then(k.hitch(this,function(e){0<e.total&&e.results&&(this._groups[c]=e.results);return this._groups[c]||[]}))},_fetchGroupItems:function(c,f){var e=this._isCustom?['-typekeywords:"Multilayer"']:['typekeywords:"Analysis Ready"'];this._portal&&this._portal.user&&this._portal.user.demographics||e.push('-typekeywords:"Requires Credits"');return this.parent._fetchItems({groups:c,query:f,types:['type:"Map Service"','type:"Feature Service"'],typekeywords:e})},
_fetchGroups:function(){return this._fetchEsriAnalysisLayers()},_fetchEsriAnalysisLayers:function(){if(this._portal&&this._portal.analysisLayersGroupQuery){var c=this._portal.analysisLayersGroupQuery;this._isCustomAnalysisQuery()&&(this.filterStrings=this.filters=null)}return this._fetchGroup("esriAnalysisLayers",{q:c,num:100,start:0}).then(k.hitch(this,function(f){f&&0<f.length&&(this.parent.sortAttribute=f[0].sortField,this.parent.sortDescending="asc"!==f[0].sortOrder);return f}))},_isCustomAnalysisQuery:function(){var c=
'title:"Living Atlas Analysis Layers" AND owner:esri',f=!1;this._portal&&this._portal.isPortal&&(c='title:"Living Atlas Analysis Layers" AND owner:esri_livingatlas');this._portal&&this._portal.analysisLayersGroupQuery&&this._portal.analysisLayersGroupQuery!==c&&(f=!0);return this._isCustom=f}});k.mixin(a,{add:function(c,f){c.plugIn||(f=f||{},f.parent=c,c.plugIn=new a(f))},remove:function(c){c.plugIn&&(c.plugIn.destroy(),delete c.plugIn)}});m("extend-esri")&&k.setObject("dijit.analysis.PluginAnalysisLayers",
a,l);return a})},"esri/dijit/SingleFilter":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/has dojo/json dojo/string dojo/number dojo/dom dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/_base/event dojo/Evented dojo/data/ItemFileWriteStore dojo/date/locale dojo/parser dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/TextBox dijit/form/FilteringSelect dijit/form/RadioButton dijit/form/DateTextBox dijit/form/NumberTextBox ../config ../kernel ../lang ../tasks/GenerateRendererTask ../tasks/UniqueValueDefinition ../tasks/GenerateRendererParameters ../layers/FeatureLayer ../layers/GeoRSSLayer ./analysis/ItemTypes dojo/i18n!../nls/jsapi dojo/text!./templates/SingleFilter.html".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I,K,Q,N,T,W,X,ea,fa,J,V,aa,Z,L,O){H=k([B,F,y,w,A,v],{declaredClass:"esri.dijit.SingleFilter",widgetsInTemplate:!0,templateString:O,valueHandlers:[],onFieldChangeEnabled:!0,onOperatorChangeEnabled:!0,onPromptChangeHandler:null,onHintChangeHandler:null,fieldDomains:{},fieldsStore:null,fieldsInfo:{stringFieldsCount:0,numberFieldsCount:0,dateFieldsCount:0},stringOperatorStore:null,dateOperatorStore:null,numberOperatorStore:null,uniqueValuesStore:null,
isEnableInteractiveFilter:!0,uniqueValuesResults:{},partsObj:null,dayInMS:86399E3,allowAllDateTypes:!1,showUnique:!0,postMixInProperties:function(){this.inherited(arguments);this.i18n={};this.i18n=n.mixin(this.i18n,L.filterDlg)},parseExpressionTemplate:function(){var D=function(na,ia){e.byId(ia).className="attributeValueContainer";"field_dropdown"===na?e.byId(ia).innerHTML=P:"operator_dropdown"===na?e.byId(ia).innerHTML=R:"values_input"===na?e.byId(ia).innerHTML=ca+ha:console.error("problem with expressionTemplate from localization file")},
P='\x3cselect id\x3d"'+this.id+'.fieldsList" class\x3d"attributeField" data-dojo-type\x3d"dijit/form/FilteringSelect" maxHeight\x3d"150" sortByLabel\x3d"true"\x3e\x3c/select\x3e',R='\x3cselect id\x3d"'+this.id+'.operatorList" class\x3d"operator" data-dojo-type\x3d"dijit/form/FilteringSelect" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\x3c/select\x3e',ca='\x3cdiv id\x3d"'+this.id+'.attributeValueContainer"\x3e\x3c/div\x3e',ha='\x3cdiv class\x3d"attributeValueOptions"\x3e\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e  \x3ctbody\x3e    \x3ctr\x3e      \x3ctd nowrap\x3d"nowrap"\x3e        \x3cinput id\x3d"'+
this.id+'.radioValue" class\x3d"radioValue attributeValueRadio" checked\x3d"checked" name\x3d"'+this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+this.i18n.valueTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.valueTooltip+'"\x3e'+this.i18n.value+'        \x3c/label\x3e      \x3c/td\x3e      \x3ctd nowrap\x3d"nowrap" class\x3d"esriLeadingPadding05"\x3e        \x3cinput id\x3d"'+this.id+'.radioFields" class\x3d"radioFields attributeValueRadio" name\x3d"'+
this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+this.i18n.fieldTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.fieldTooltip+'"\x3e'+this.i18n.field+'        \x3c/label\x3e      \x3c/td\x3e      \x3ctd id\x3d"'+this.id+'.radioUniqueColumn" nowrap\x3d"nowrap" class\x3d"esriLeadingPadding05"\x3e        \x3cinput id\x3d"'+this.id+'.radioUnique" class\x3d"radioUnique attributeValueRadio" name\x3d"'+this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+
this.i18n.uniqueValueTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.uniqueValueTooltip+'"\x3e'+this.i18n.uniqueValues+"        \x3c/label\x3e      \x3c/td\x3e    \x3c/tr\x3e  \x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e",oa=this.i18n.expressionTemplate,ma=oa.indexOf("${"),U=oa.substring(0,ma).trim();e.byId(this.id+".column1").innerHTML=U.length?"\x3cdiv class\x3d'attributeText'\x3e"+U+"\x3c/div\x3e":"";U=oa.indexOf("}",ma+1);var da=oa.substring(ma+2,U);D(da,this.id+".column2");
ma=oa.indexOf("${",ma+1);U=oa.substring(U+1,ma).trim();e.byId(this.id+".column3").innerHTML=U.length?"\x3cdiv class\x3d'attributeText'\x3e"+U+"\x3c/div\x3e":"";U=oa.indexOf("}",ma+1);da=oa.substring(ma+2,U);D(da,this.id+".column4");ma=oa.indexOf("${",ma+1);U=oa.substring(U+1,ma).trim();e.byId(this.id+".column5").innerHTML=U.length?"\x3cdiv class\x3d'attributeText'\x3e"+U+"\x3c/div\x3e":"";U=oa.indexOf("}",ma+1);da=oa.substring(ma+2,U);D(da,this.id+".column6");U=oa.substring(U+1,oa.length).trim();
e.byId(this.id+".column7").innerHTML=U.length?"\x3cdiv class\x3d'attributeText'\x3e"+U+"\x3c/div\x3e":""},postCreate:function(){this.inherited(arguments);this.parseExpressionTemplate();this.createOperatorStores();this.createFieldsStore(this.fields);this.readCodedValues();C.parse(e.byId(this.id+".exprTable")).then(n.hitch(this,function(D){m.connect(this.getFieldsList(),"onChange",this,"onChangeField");m.connect(this.getOperatorList(),"onChange",this,"onChangeOperator");m.connect(z.byId(this.id+".radioValue"),
"onClick",this,"showValueInput");m.connect(z.byId(this.id+".radioFields"),"onClick",this,"showFields");m.connect(z.byId(this.id+".radioUnique"),"onClick",this,"showUniqueList");this.version&&10.1>this.version&&this.mapLayer.url&&this.showUnique&&g.set(e.byId(this.id+".radioUniqueColumn"),"display","none");m.connect(e.byId(this.id+".deleteExpression"),"onclick",this,"onClickDeleteExpression");m.connect(this.interactiveCheck,"onclick",this,"onInteractiveClick");m.connect(this.interactiveArrow,"onclick",
this,"onClickShowHideInteractive");this.enableInteractiveHandlers();this.isEnableInteractiveFilter||g.set(this._interactiveFilterRow,"display","none");g.set(e.byId(this.id+".radioUniqueColumn"),"display",this.showUnique?"block":"none");this.own(this.watch("showUnique",n.hitch(this,function(P,R,ca){g.set(e.byId(this.id+".radioUniqueColumn"),"display",ca?"block":"none")})))}))},constructor:function(D,P){this.id=D.id||"";this.owner=D.owner;this.version=D.version;this.part=D.part;this.fields=D.fields;
this.mapLayer=D.mapLayer;!1===D.enableEvents&&(this.onOperatorChangeEnabled=this.onFieldChangeEnabled=!1)},init:function(D){if(!D.part||this.mapLayer&&D.mapLayer&&this.mapLayer.id!==D.mapLayer.id)this.clearAttributeValueDijits(),this.mapLayer=D.mapLayer,this.version=D.version,this.fields=D.fields,this.createOperatorStores(),this.createFieldsStore(this.fields),this.readCodedValues(),this.fillFieldsList(this.fieldsStore),this.onChangeField();D.part&&(this.part=D.part,this.onOperatorChangeEnabled=this.onFieldChangeEnabled=
!1,this.buildEditUIField(this.part,this))},destroy:function(){this.onOperatorChangeEnabled=this.onFieldChangeEnabled=!1;this.clearAttributeValueDijits();r.forEach(z.findWidgets(e.byId(this.id)),function(D){D.destroyRecursive()});this.inherited(arguments)},toJson:function(){var D=null;this.isInteractiveChecked()&&(D={prompt:this.promptText.attr("value"),hint:this.hintText.attr("value")});return{fieldObj:this.getField(),operator:this.getOperator(),valueObj:this.getValue(),interactiveObj:D}},buildFriendlyTextExpr:function(D){var P=
this.i18n.expressionTemplate,R=function(oa,ma,U){return c.substitute(P,{field_dropdown:oa,operator_dropdown:ma,values_input:U})};if(!1===D.valueObj.isValid)return"\x26lt;expression is missing value\x26gt;";var ca="";if("string"===D.fieldObj.shortType)D.operator===this.i18n.stringOperatorIsBlank||D.operator===this.i18n.stringOperatorIsNotBlank?ca=R(D.fieldObj.label,D.operator,""):"field"===D.valueObj.type?ca=R(D.fieldObj.label,D.operator,D.valueObj.label):(ca=this.getDecodedValue(D.interactiveObj?
D.interactiveObj.value:D.valueObj.value,D.fieldObj.name),ca=R(D.fieldObj.label,D.operator,"'"+ca+"'"));else if("number"===D.fieldObj.shortType)if(D.operator===this.i18n.numberOperatorIsBetween||D.operator===this.i18n.numberOperatorIsNotBetween)ca=D.interactiveObj?D.interactiveObj.value2:D.valueObj.value2,ca=R(D.fieldObj.label,D.operator,f.format(D.interactiveObj?D.interactiveObj.value1:D.valueObj.value1,{pattern:"#####0.##########"})+" "+this.i18n.andBetweenValues+" "+f.format(ca,{pattern:"#####0.##########"}));
else if(D.operator===this.i18n.numberOperatorIsBlank||D.operator===this.i18n.numberOperatorIsNotBlank)ca=R(D.fieldObj.label,D.operator,"");else if("field"===D.valueObj.type)ca=R(D.fieldObj.label,D.operator,D.valueObj.label);else{ca=D.interactiveObj?D.interactiveObj.value:D.valueObj.value;var ha=this.getDecodedValue(ca,D.fieldObj.name);ca=R(D.fieldObj.label,D.operator,ca!==ha?"'"+ha+"'":f.format(ca,{pattern:"#####0.##########"}))}else X.isDefined(D.valueObj.value)&&"field"!==D.valueObj.type&&"string"===
typeof D.valueObj.value&&(D.valueObj.value=new Date(D.valueObj.value)),ca=D.operator===this.i18n.dateOperatorIsBetween||D.operator===this.i18n.dateOperatorIsNotBetween?R(D.fieldObj.label,D.operator,(D.interactiveObj?this.formatFriendlyDate(D.interactiveObj.value1):this.formatFriendlyDate(D.valueObj.value1))+" "+this.i18n.andBetweenValues+" "+(D.interactiveObj?this.formatFriendlyDate(D.interactiveObj.value2):this.formatFriendlyDate(this.addDay(D.valueObj.value2)))):D.operator===this.i18n.dateOperatorIsBlank||
D.operator===this.i18n.dateOperatorIsNotBlank?R(D.fieldObj.label,D.operator,""):"field"===D.valueObj.type?R(D.fieldObj.label,D.operator,D.valueObj.label):R(D.fieldObj.label,D.operator,D.interactiveObj?this.formatFriendlyDate(D.interactiveObj.value):this.formatFriendlyDate(D.valueObj.value));return ca},builtSingleFilterString:function(D,P){if(X.isDefined(D.valueObj.isValid)&&!D.valueObj.isValid)return{whereClause:null};var R=D.valueObj.value,ca=D.valueObj.value1,ha=D.valueObj.value2,oa=!1;if(D.interactiveObj){if(!D.interactiveObj.prompt||
!D.interactiveObj.hint)return{whereClause:null};X.isDefined(P)&&(oa=!0,X.isDefined(D.valueObj.value)&&(R="{"+P+"}"),X.isDefined(D.valueObj.value1)&&(ca="{"+P+"}"),X.isDefined(D.valueObj.value2)&&(ha="{"+(P+1)+"}"))}var ma="",U=D.fieldObj.name;this.mapLayer&&this.mapLayer.url&&-1!==this.mapLayer.url.indexOf("BigDataCatalogServer")&&this.hasWhiteSpace(U)&&(U='"'+U+'"');if("string"===D.fieldObj.shortType)switch(P="",R&&"field"!==D.valueObj.type&&this.isHostedService(this.mapLayer.url)&&this.containsNonLatinCharacter(R)&&
(P="N"),D.operator){case this.i18n.stringOperatorIs:ma="field"===D.valueObj.type?U+" \x3d "+R:U+" \x3d "+P+"'"+R.replace(/'/g,"''")+"'";break;case this.i18n.stringOperatorIsNot:ma="field"===D.valueObj.type?U+" \x3c\x3e "+R:U+" \x3c\x3e "+P+"'"+R.replace(/'/g,"''")+"'";break;case this.i18n.stringOperatorStartsWith:ma=U+" LIKE "+P+"'"+R.replace(/'/g,"''")+"%'";break;case this.i18n.stringOperatorEndsWith:ma=U+" LIKE "+P+"'%"+R.replace(/'/g,"''")+"'";break;case this.i18n.stringOperatorContains:ma=U+" LIKE "+
P+"'%"+R.replace(/'/g,"''")+"%'";break;case this.i18n.stringOperatorDoesNotContain:ma=U+" NOT LIKE "+P+"'%"+R.replace(/'/g,"''")+"%'";break;case this.i18n.stringOperatorIsBlank:ma=U+" IS NULL";break;case this.i18n.stringOperatorIsNotBlank:ma=U+" IS NOT NULL"}else if("number"===D.fieldObj.shortType)switch(D.operator){case this.i18n.numberOperatorIs:ma=U+" \x3d "+R;break;case this.i18n.numberOperatorIsNot:ma=U+" \x3c\x3e "+R;break;case this.i18n.numberOperatorIsAtLeast:ma=U+" \x3e\x3d "+R;break;case this.i18n.numberOperatorIsLessThan:ma=
U+" \x3c "+R;break;case this.i18n.numberOperatorIsAtMost:ma=U+" \x3c\x3d "+R;break;case this.i18n.numberOperatorIsGreaterThan:ma=U+" \x3e "+R;break;case this.i18n.numberOperatorIsBetween:ma=U+" BETWEEN "+ca+" AND "+ha;break;case this.i18n.numberOperatorIsNotBetween:ma=U+" NOT BETWEEN "+ca+" AND "+ha;break;case this.i18n.numberOperatorIsBlank:ma=U+" IS NULL";break;case this.i18n.numberOperatorIsNotBlank:ma=U+" IS NOT NULL"}else switch(X.isDefined(R)&&"field"!==D.valueObj.type&&"string"===typeof R&&
(R=this.parseFriendlyDate(R)),D.operator){case this.i18n.dateOperatorIsOn:ma="field"===D.valueObj.type?U+" \x3d "+R:oa?U+" BETWEEN "+(this.supportsStandardizedQuery?"timestamp ":"")+"'{"+P+"}' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'{"+(P+1)+"}'":U+" BETWEEN "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(R)+"' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(this.addDay(R))+"'";break;case this.i18n.dateOperatorIsNotOn:ma="field"===
D.valueObj.type?U+" \x3c\x3e "+R:oa?U+" NOT BETWEEN "+(this.supportsStandardizedQuery?"timestamp ":"")+"'{"+P+"}' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'{"+(P+1)+"}'":U+" NOT BETWEEN "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(R)+"' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(this.addDay(R))+"'";break;case this.i18n.dateOperatorIsBefore:ma="field"===D.valueObj.type?U+" \x3c "+R:U+" \x3c "+(this.supportsStandardizedQuery?"timestamp ":
"")+"'"+this.formatDate(R)+"'";break;case this.i18n.dateOperatorIsAfter:ma="field"===D.valueObj.type?U+" \x3e "+R:U+" \x3e "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(this.addDay(R))+"'";break;case this.i18n.dateOperatorIsBetween:ma=oa?U+" BETWEEN '"+ca+"' AND '"+ha+"'":U+" BETWEEN "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(ca)+"' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(this.addDay(ha))+"'";break;case this.i18n.dateOperatorIsNotBetween:ma=
oa?U+" NOT BETWEEN '"+ca+"' AND '"+ha+"'":U+" NOT BETWEEN "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(ca)+"' AND "+(this.supportsStandardizedQuery?"timestamp ":"")+"'"+this.formatDate(this.addDay(ha))+"'";break;case this.i18n.dateOperatorIsBlank:ma=U+" IS NULL";break;case this.i18n.dateOperatorIsNotBlank:ma=U+" IS NOT NULL"}return{whereClause:ma}},showDeleteIcon:function(){g.set(e.byId(this.id+".deleteExpression"),"display","block")},hideDeleteIcon:function(){g.set(e.byId(this.id+
".deleteExpression"),"display","none")},createFieldsStore:function(D){if(D&&D.length){D=n.clone(D);D=D.sort(function(R,ca){R.label=R.alias||R.name;ca.label=ca.alias||ca.name;return R.label<ca.label?-1:R.label>ca.label?1:0});var P=this.isHostedService(this.mapLayer.url);this.supportsStandardizedQuery=10.2<=this.mapLayer.version&&(this.mapLayer.useStandardizedQueries||this.isBigDataLayer(this.mapLayer));D=r.filter(D,function(R,ca){return"esriFieldTypeString"===R.type||"esriFieldTypeDouble"===R.type||
"esriFieldTypeSingle"===R.type||"esriFieldTypeInteger"===R.type||"esriFieldTypeSmallInteger"===R.type||"esriFieldTypeDate"===R.type&&(this.allowAllDateTypes||P||this.supportsStandardizedQuery)?!0:!1},this);D=r.map(D,function(R,ca){switch(R.type){case "esriFieldTypeString":var ha="string";this.fieldsInfo.stringFieldsCount++;break;case "esriFieldTypeDate":ha="date";this.fieldsInfo.dateFieldsCount++;break;default:ha="number",this.fieldsInfo.numberFieldsCount++}return{id:ca,label:R.label,shortType:ha,
alias:R.alias,editable:R.editable,name:R.name,nullable:R.nullable,type:R.type}},this);D.length&&(this.fieldsStore=new t({data:{identifier:"id",label:"label",items:D}}))}},createOperatorStores:function(){var D=[];D.push({name:this.i18n.stringOperatorIs,name_:this.i18n.stringOperatorIs,id:0});D.push({name:this.i18n.stringOperatorIsNot,name_:this.i18n.stringOperatorIsNot,id:1});D.push({name:this.i18n.stringOperatorStartsWith,name_:this.i18n.stringOperatorStartsWith,id:2});D.push({name:this.i18n.stringOperatorEndsWith,
name_:this.i18n.stringOperatorEndsWith,id:3});D.push({name:this.i18n.stringOperatorContains,name_:this.i18n.stringOperatorContains,id:4});D.push({name:this.i18n.stringOperatorDoesNotContain,name_:this.i18n.stringOperatorDoesNotContain,id:5});D.push({name:this.i18n.stringOperatorIsBlank,name_:this.i18n.stringOperatorIsBlank,id:6});D.push({name:this.i18n.stringOperatorIsNotBlank,name_:this.i18n.stringOperatorIsNotBlank,id:7});this.stringOperatorStore=new t({data:{label:"name",identifier:"id",items:D}});
D=[];D.push({name:this.i18n.dateOperatorIsOn,id:0});D.push({name:this.i18n.dateOperatorIsNotOn,id:1});D.push({name:this.i18n.dateOperatorIsBefore,id:2});D.push({name:this.i18n.dateOperatorIsAfter,id:3});D.push({name:this.i18n.dateOperatorIsBetween,id:6});D.push({name:this.i18n.dateOperatorIsNotBetween,id:7});D.push({name:this.i18n.dateOperatorIsBlank,id:8});D.push({name:this.i18n.dateOperatorIsNotBlank,id:9});this.dateOperatorStore=new t({data:{label:"name",identifier:"id",items:D}});D=[];D.push({name:this.i18n.numberOperatorIs,
name_:this.i18n.numberOperatorIs,id:0});D.push({name:this.i18n.numberOperatorIsNot,name_:this.i18n.numberOperatorIsNot,id:1});D.push({name:this.i18n.numberOperatorIsAtLeast,name_:this.i18n.numberOperatorIsAtLeast,id:2});D.push({name:this.i18n.numberOperatorIsLessThan,name_:this.i18n.numberOperatorIsLessThan,id:3});D.push({name:this.i18n.numberOperatorIsAtMost,name_:this.i18n.numberOperatorIsAtMost,id:4});D.push({name:this.i18n.numberOperatorIsGreaterThan,name_:this.i18n.numberOperatorIsGreaterThan,
id:5});D.push({name:this.i18n.numberOperatorIsBetween,name_:this.i18n.numberOperatorIsBetween,id:6});D.push({name:this.i18n.numberOperatorIsNotBetween,name_:this.i18n.numberOperatorIsNotBetween,id:7});D.push({name:this.i18n.numberOperatorIsBlank,name_:this.i18n.numberOperatorIsBlank,id:8});D.push({name:this.i18n.numberOperatorIsNotBlank,name_:this.i18n.numberOperatorIsNotBlank,id:9});this.numberOperatorStore=new t({data:{label:"name",identifier:"id",items:D}})},readCodedValues:function(){r.forEach(this.mapLayer.fields,
function(D){D.domain&&D.domain.codedValues&&(this.fieldDomains[D.name]=D.domain.codedValues)},this)},getDecodedValue:function(D,P){P=this.getCodedValues(P);var R;if(P)for(R=0;R<P.length;R+=1){var ca=P[R];if(ca.code===D)return ca.name}return D},getCodedValues:function(D){return this.fieldDomains[D]},getFieldsList:function(){return z.byId(this.id+".fieldsList")},getOperatorList:function(){return z.byId(this.id+".operatorList")},getValueFieldsList:function(){return z.byId(this.id+".valueFields")},getAttrValContNode:function(){return e.byId(this.id+
".attributeValueContainer")},getField:function(){var D=this.getFieldsList();return{name:D.store.getValue(D.item,"name"),label:D.store.getValue(D.item,"label"),shortType:D.store.getValue(D.item,"shortType"),type:D.store.getValue(D.item,"type")}},getOperator:function(){var D=this.getOperatorList();return D.item?D.store.getValue(D.item,"name"):""},getValue:function(){return{}},isInteractiveChecked:function(){return this.interactiveCheck.checked},setInteractiveSection:function(D,P,R){this.disableInteractiveHandlers();
this.interactiveCheck.checked=D;this.promptText.attr("value",P);this.hintText.attr("value",R);g.set(this.interactiveSpace,"display","block");this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;";this.enableInteractiveHandlers()},enableInteractiveHandlers:function(){this.onPromptChangeHandler=m.connect(this.promptText,"onChange",this,"onChangeInteractive");this.onHintchangeHandler=m.connect(this.hintText,"onChange",this,"onChangeInteractive")},disableInteractiveHandlers:function(){m.disconnect(this.onPromptChangeHandler);
m.disconnect(this.onHintChangeHandler)},fillFieldsList:function(D){var P=this.getFieldsList();P.set("labelAttr","label");P.set("searchAttr","label");P.set("store",D);P.set("value",0)},fillOperatorList:function(D,P,R){var ca=this.getOperatorList();ca.set("labelAttr","name");ca.set("searchAttr","name");ca.set("query",R?R:{});ca.set("store",D);if(P){var ha=!1;for(R=0;20>R&&(D.fetchItemByIdentity({identity:R,onItem:n.hitch(this,function(oa){oa&&oa.name[0]===P&&(ca.set("value",oa.id[0]),ha=!0)})}),!ha);R++);
}else ca.set("value",0)},createValueString:function(D){var P=this.getAttrValContNode();this.clearAttributeValueDijits();h.empty(P);if(D){P=new I({id:this.id+".value","class":"attributeValue",maxHeight:150,sortByLabel:!0},h.create("div",{},P));var R=this.buildCodedValuesStore(D);P.set("store",R);P.set("value",0);this.valueHandlers.push(m.connect(P,"onChange",this,"onValueChange"))}else P=new G({id:this.id+".value","class":"attributeValue",required:!0,placeHolder:"",intermediateChanges:!0},h.create("div",
{},P)),this.valueHandlers.push(m.connect(P,"onChange",this,"onValueChange"));this.checkDefaultOption();this.getValue=function(){var ca=z.byId(this.id+".value"),ha=!0;D?ca.item?ca=ca.item.code[0]:(ca="",ha=!1):ha=ca=ca.get("value");return{value:ca,isValid:ha}}},createValueDate:function(){var D=this.getAttrValContNode();this.clearAttributeValueDijits();h.empty(D);D=new Q({id:this.id+".value","class":"attributeValue",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},h.create("div",
{},D));this.checkDefaultOption();this.valueHandlers.push(m.connect(D,"onChange",this,"onValueChange"));this.getValue=function(){var P=z.byId(this.id+".value").get("value");return{value:P,isValid:X.isDefined(P)}}},createValueNumber:function(D){var P=this.getAttrValContNode();this.clearAttributeValueDijits();h.empty(P);if(D){P=new I({id:this.id+".value","class":"attributeValue",maxHeight:150,sortByLabel:!0},h.create("div",{},P));var R=this.buildCodedValuesStore(D);P.set("store",R);P.set("value",0);
this.valueHandlers.push(m.connect(P,"onChange",this,"onValueChange"))}else P=new N({id:this.id+".value","class":"attributeValue",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},h.create("div",{},P)),this.valueHandlers.push(m.connect(P,"onChange",this,"onValueChange"));this.checkDefaultOption();this.getValue=function(){var ca=z.byId(this.id+".value"),ha=!0;D?ca.item?ca=ca.item.code[0]:(ca="",ha=!1):(ca=ca.get("value"),ha=X.isDefined(ca)&&!isNaN(ca));return{value:ca,
isValid:ha}}},createValueBetweenDate:function(){var D=this.getAttrValContNode();this.clearAttributeValueDijits();h.empty(D);var P=new Q({id:this.id+".value1","class":"attributeValue1",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},h.create("div",{},D));h.create("span",{innerHTML:this.i18n.andBetweenValues,"class":"attributeBetweenValues"},D);D=new Q({id:this.id+".value2","class":"attributeValue2",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},h.create("div",
{},D));this.checkDefaultOption();this.valueHandlers.push(m.connect(P,"onChange",this,"onValueChange"));this.valueHandlers.push(m.connect(D,"onChange",this,"onValueChange"));this.getValue=function(){var R=z.byId(this.id+".value1").get("value"),ca=z.byId(this.id+".value2").get("value");return{value1:R,value2:ca,isValid:X.isDefined(R)&&X.isDefined(ca)}}},createValueBetweenNumber:function(){var D=this.getAttrValContNode();this.clearAttributeValueDijits();h.empty(D);var P=new N({id:this.id+".value1","class":"attributeValue1",
required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},h.create("div",{},D));h.create("span",{innerHTML:this.i18n.andBetweenValues,"class":"attributeBetweenValues"},D);D=new N({id:this.id+".value2","class":"attributeValue2",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},h.create("div",{},D));this.checkDefaultOption();this.valueHandlers.push(m.connect(P,"onChange",this,"onValueChange"));this.valueHandlers.push(m.connect(D,
"onChange",this,"onValueChange"));this.getValue=function(){var R=z.byId(this.id+".value1").get("value"),ca=z.byId(this.id+".value2").get("value");return{value1:R,value2:ca,isValid:X.isDefined(R)&&X.isDefined(ca)&&!isNaN(R)&&!isNaN(ca)&&R<=ca}}},createValueInTheLastDate:function(){},createValueIsBlank:function(){var D=this.getAttrValContNode();this.clearAttributeValueDijits();h.empty(D);D.innerHTML="\x3cinput id\x3d'"+this.id+".value' class\x3d'attributeValue' type\x3d'text' disabled\x3d'true'/\x3e";
this.checkDefaultOption();this.getValue=function(){return{value:null,isValid:!0}}},createValueFields:function(D,P,R){var ca=this.getAttrValContNode();this.clearAttributeValueDijits();h.empty(ca);var ha=new I({id:this.id+".valueFields","class":"attributeValue",maxHeight:150,labelAttr:"label",searchAttr:"label",store:D,query:P},h.create("div",{},ca));if(R){var oa=!1;for(ca=0;100>ca&&(D.fetchItemByIdentity({identity:ca,onItem:n.hitch(this,function(ma){ma&&ma.shortType[0]===P.shortType&&ma.name[0]!==
R&&(ha.set("value",ma.id),oa=!0)})}),!oa);ca++);}this.valueHandlers.push(m.connect(ha,"onChange",this,"onValueChange"));this.getValue=function(){var ma=z.byId(this.id+".valueFields");return{value:ma.store.getValue(ma.item,"name"),label:ma.store.getValue(ma.item,"label"),type:"field",isValid:!0}}},createValueUnique:function(D){var P=this.getAttrValContNode();this.clearAttributeValueDijits();h.empty(P);D=new I({id:this.id+".valueUnique","class":"attributeValue",maxHeight:150,store:D},h.create("div",
{},P));D.set("value",0);this.valueHandlers.push(m.connect(D,"onChange",this,"onValueChange"));this.getValue=function(){var R=z.byId(this.id+".valueUnique");return{value:R.store.getValue(R.item,"value"),isValid:!0}}},setValue:function(D,P){if(P)for(var R=0;R<P.length;R++){if(D===P[R].code){z.byId(this.id+".value").set("value",R);break}}else"date"===this.part.fieldObj.shortType?z.byId(this.id+".value").set("value",new Date(D)):("number"===this.part.fieldObj.shortType&&(D=Number(D)),z.byId(this.id+".value").set("value",
D))},setValue1:function(D){"date"===this.part.fieldObj.shortType?D=new Date(D):"number"===this.part.fieldObj.shortType&&(D=Number(D));z.byId(this.id+".value1").set("value",D)},setValue2:function(D){"date"===this.part.fieldObj.shortType?D=new Date(D):"number"===this.part.fieldObj.shortType&&(D=Number(D));z.byId(this.id+".value2").set("value",D)},setValueFieldById:function(D){this.getValueFieldsList().set("value",D)},enableOnFieldChange:function(){this.onFieldChangeEnabled=!0},enableOnOperatorChange:function(){this.onOperatorChangeEnabled=
!0},onChangeField:function(D){this.onFieldChangeEnabled&&this._onChangeField(this.getFieldsList(),this)},onChangeOperator:function(D){this.onOperatorChangeEnabled&&this._onChangeOperator(this.getOperatorList(),this)},onClickDeleteExpression:function(D){this._deleteExpression(this)},_onChangeField:function(D,P,R){var ca=!!this.mapLayer&&this.isPortalHostedService(this.mapLayer.url);this.isBigDataLayer(this.mapLayer)||ca&&"esriFieldTypeDate"===this.fieldsStore.getValue(D.item,"type")?g.set(e.byId(this.id+
".radioUniqueColumn"),"display","none"):g.set(e.byId(this.id+".radioUniqueColumn"),"display","");ca=P.getOperatorList();switch(this.fieldsStore.getValue(D.item,"type")){case "esriFieldTypeString":var ha=null;D=this.fieldsStore.getValue(D.item,"name");this.getCodedValues(D)&&(ha=this.i18n.stringOperatorStartsWith,ha+="|"+this.i18n.stringOperatorEndsWith,ha+="|"+this.i18n.stringOperatorContains,ha+="|"+this.i18n.stringOperatorDoesNotContain,ha={name_:new RegExp("^(?!("+ha+")$)")});ca.attr("value")===
this.i18n.stringOperatorIs?(P.fillOperatorList(this.stringOperatorStore,this.i18n.stringOperatorIs,ha),this.onChangeOperator(ca,P,R)):P.fillOperatorList(this.stringOperatorStore,this.i18n.stringOperatorIs,ha);P.createValueString(this.getCodedValues(D));break;case "esriFieldTypeDate":P.fillOperatorList(this.dateOperatorStore,this.i18n.dateOperatorIsOn);P.createValueDate();break;default:ha=null,D=this.fieldsStore.getValue(D.item,"name"),this.getCodedValues(D)&&(ha=this.i18n.numberOperatorIsBetween,
ha+="|"+this.i18n.numberOperatorIsNotBetween,ha+="|"+this.i18n.numberOperatorIsAtLeast,ha+="|"+this.i18n.numberOperatorIsLessThan,ha+="|"+this.i18n.numberOperatorIsAtMost,ha+="|"+this.i18n.numberOperatorIsGreaterThan,ha={name_:new RegExp("^(?!("+ha+")$)")}),ca.attr("value")===this.i18n.numberOperatorIs?(P.fillOperatorList(this.numberOperatorStore,this.i18n.numberOperatorIs,ha),this.onChangeOperator(ca,P,R)):P.fillOperatorList(this.numberOperatorStore,this.i18n.numberOperatorIs,ha),P.createValueNumber(this.getCodedValues(D))}"date"===
this.fieldsStore.getValue(P.getFieldsList().item,"shortType")?P.disableInteractiveCheck():P.enableInteractiveCheck();m.publish("filter-expression-change",this)},_onChangeOperator:function(D,P,R){D=D.item?D.item.name[0]:D.value;R=this.fieldsStore.getValue(P.getFieldsList().item,"shortType");var ca=this.fieldsStore.getValue(P.getFieldsList().item,"name");P.enableOptions();if("date"!==R&&"number"!==R||D!==this.i18n.dateOperatorIsBetween&&D!==this.i18n.numberOperatorIsBetween&&D!==this.i18n.dateOperatorIsNotBetween&&
D!==this.i18n.numberOperatorIsNotBetween)if("date"!==R||D!==this.i18n.dateOperatorInTheLast&&D!==this.i18n.dateOperatorNotInTheLast)if(D===this.i18n.stringOperatorIsBlank||D===this.i18n.dateOperatorIsBlank||D===this.i18n.numberOperatorIsBlank||D===this.i18n.stringOperatorIsNotBlank||D===this.i18n.dateOperatorIsNotBlank||D===this.i18n.numberOperatorIsNotBlank)P.createValueIsBlank(),P.disableOptions();else switch(R){case "string":P.createValueString(this.getCodedValues(ca));break;case "date":P.createValueDate();
break;default:P.createValueNumber(this.getCodedValues(ca))}else P.disableOptions(),P.createValueInTheLastDate();else P.disableOptions(),"date"===R?P.createValueBetweenDate():P.createValueBetweenNumber();m.publish("filter-expression-change",this)},onInteractiveClick:function(D){this.isInteractiveChecked()?(g.set(this.interactiveSpace,"display","block"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;"):(g.set(this.interactiveSpace,"display","none"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9660;");
m.publish("filter-expression-change",this)},onClickShowHideInteractive:function(D){this.interactiveCheck.disabled||("none"===g.set(this.interactiveSpace,"display")?(g.set(this.interactiveSpace,"display","block"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;"):(g.set(this.interactiveSpace,"display","none"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9660;"))},onChangeInteractive:function(){m.publish("filter-expression-change",this)},showValueInput:function(D){this._showValueInput(z.byNode(D.target),
this)},showFields:function(D){this._showFields(z.byNode(D.target),this)},showUniqueList:function(D){this._showUniqueList(z.byNode(D.target),this)},onValueChange:function(){this.onValueChangeHandler&&clearTimeout(this.onValueChangeHandler);this.onValueChangeHandler=setTimeout(n.hitch(this,function(){this.onValueChangeHandler=null;m.publish("filter-expression-change",this)}),800)},_showValueInput:function(D,P,R){P.onChangeOperator(D,P,R);P.enableInteractiveCheck()},_showFields:function(D,P,R){R=P.getFieldsList().item;
D=this.fieldsStore.getValue(R,"shortType");R=this.fieldsStore.getValue(R,"name");P.createValueFields(this.fieldsStore,{shortType:D,name:new RegExp("^(?!"+R+"$)")},R);P.disableInteractiveCheck()},_showUniqueList:function(D,P,R){this.uniqueValuesStore&&delete this.uniqueValuesStore;R=this.fieldsStore.getValue(P.getFieldsList().item,"name");if(10.1<=this.version||!this.mapLayer.url){var ca=null;this.mapLayer.queryServiceUrl?ca=this.mapLayer.queryServiceUrl:this.mapLayer.itemLayers&&r.forEach(this.mapLayer.itemLayers,
function(ha){ha.id===this.layerInfo.id&&ha.layerUrl&&(ca=ha.layerUrl)},this);ca||(ca=this.mapLayer.url);if(this.uniqueValuesResults[this.mapLayer.id+"_"+R])this.onGenerateRendererResults(P,D,this.uniqueValuesResults[this.mapLayer.id+"_"+R]);else this.generateRendererUniqueValues(R,ca,n.hitch(this,"onGenerateRendererResults",P,D),n.hitch(this,function(){this.showValueInput(D,P)}))}else D&&this.showValueInput(D,P)},onGenerateRendererResults:function(D,P,R){var ca=this.fieldsStore.getValue(D.getFieldsList().item,
"name"),ha=this.fieldsStore.getValue(D.getFieldsList().item,"shortType"),oa=this.fieldsStore.getValue(D.getFieldsList().item,"type");this.uniqueValuesResults[this.mapLayer.id+"_"+ca]=R;var ma=null;r.forEach(this.mapLayer.fields,function(U){U.name===ca&&U.domain&&(ma=U.domain)});R=r.filter(R,function(U,da){return"string"===ha?"\x3cNull\x3e"!==U&&""!==U.trim():"\x3cNull\x3e"!==U&&""!==U});R.length?("date"===ha?(R=r.map(R,function(U){return new Date(U)}),R=R.sort(function(U,da){U=U.getTime();da=da.getTime();
return U<da?-1:U>da?1:0}),R=r.map(R,function(U){return this.formatFriendlyDate(U)},this)):"number"===ha?(R=r.map(R,function(U){return"esriFieldTypeDouble"===oa||"esriFieldTypeSingle"===oa?parseFloat(U):parseInt(U,10)}),R=R.sort(function(U,da){return U<da?-1:U>da?1:0})):R=R.sort(function(U,da){return U<da?-1:U>da?1:0}),P=r.map(R,function(U,da){var na=U;"string"===ha&&(na=""===U?"\x3c"+this.i18n.emptyString+"\x3e":U);if(ma&&ma.codedValues){for(var ia=0;ia<ma.codedValues.length;ia++){var pa=ma.codedValues[ia];
if(U===pa.code)return{id:da,name:pa.name||na,value:U}}return{id:da,name:""+na,value:U}}if("esriFieldTypeDouble"===oa||"esriFieldTypeSingle"===oa)na=f.format(U,{pattern:"#####0.##########"});return{id:da,name:""+na,value:U}},this),this.uniqueValuesStore=new t({data:{label:"name",identifier:"id",items:P}}),D.createValueUnique(this.uniqueValuesStore)):this.showValueInput(P,D)},generateRendererUniqueValues:function(D,P,R,ca){D instanceof Array&&(D=D.toString());var ha=new fa;ha.attributeField=D;D=new J;
D.classificationDefinition=ha;this.mapLayer instanceof aa?P=new ea(this.mapLayer):this.mapLayer instanceof V&&!this.mapLayer.url?P=new ea(this.mapLayer):this.hasDynamicLayers(this.mapLayer)?(ha=this.mapLayer.layerDefinitions&&this.mapLayer.layerDefinitions[this.mapLayer.id]?this.mapLayer.layerDefinitions[this.mapLayer.id]:null,D.where=ha?ha:null,P=new ea(this.mapLayer.url+"/dynamicLayer",{source:this.layerInfo.source})):(ha=this.mapLayer.getDefinitionExpression(),D.where=ha?ha:null,P=new ea(P));T.defaults.io.timeout=
1E4;P.execute(D,function(oa){T.defaults.io.timeout=6E4;oa=r.map(oa.infos,function(ma){return ma.value});R(oa)},n.hitch(this,function(oa){T.defaults.io.timeout=6E4;ca()}))},hasDynamicLayers:function(D){return D&&D.supportsDynamicLayers?!0:!1},formatDate:function(D){return x.format(D,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+x.format(D,{selector:"time",timePattern:"HH:mm:ss"})},formatFriendlyDate:function(D){return x.format(D,{formatLength:"short",selector:"date"})},parseFriendlyDate:function(D){return x.parse(D,
{formatLength:"short",selector:"date"})},parseDate:function(D){var P=x.parse(D,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});P||(P=x.parse(D.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(P=x.parse(D.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return P},addDay:function(D){return new Date(D.getTime()+this.dayInMS)},subtractDay:function(D){return new Date(D.getTime()-this.dayInMS)},containsNonLatinCharacter:function(D){for(var P=0;P<D.length;P++)if(255<
D.charCodeAt(P))return!0;return!1},hasWhiteSpace:function(D){return/\s/g.test(D)},buildCodedValuesStore:function(D){D=r.map(D,function(P,R){return{name:P.name,code:P.code,id:R}});return new t({data:{label:"name",identifier:"id",items:D}})},clearAttributeValueDijits:function(){this.valueHandlers&&0!==this.valueHandlers.length&&(r.forEach(this.valueHandlers,n.hitch(this,function(D){m.disconnect(D);D=null})),this.valueHandlers=[],z.byId(this.id+".value")?z.byId(this.id+".value").destroy():e.byId(this.id+
".value")&&this.getAttrValContNode().removeChild(e.byId(this.id+".value")),z.byId(this.id+".value1")?z.byId(this.id+".value1").destroy():e.byId(this.id+".value1")&&this.getAttrValContNode().removeChild(e.byId(this.id+".value1")),z.byId(this.id+".value2")?z.byId(this.id+".value2").destroy():e.byId(this.id+".value2")&&this.getAttrValContNode().removeChild(e.byId(this.id+".value2")),z.byId(this.id+".valueFields")&&z.byId(this.id+".valueFields").destroy(),z.byId(this.id+".valueUnique")&&z.byId(this.id+
".valueUnique").destroy())},checkDefaultOption:function(){p(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(D){z.byNode(D).set("checked",-1<D.className.indexOf("radioValue"))})},disableOptions:function(){p(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(D){z.byNode(D).set("disabled",!0)})},enableOptions:function(){p(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(D){z.byNode(D).set("disabled",!1)})},checkFieldOption:function(){z.byId(this.id+
".radioFields").set("checked",!0)},disableFieldOption:function(){z.byId(this.id+".radioFields").set("disabled",!0)},disableUniqueOption:function(){z.byId(this.id+".radioUnique").set("disabled",!0)},enableInteractiveCheck:function(){this.interactiveCheck.disabled=!1},disableInteractiveCheck:function(){this.interactiveCheck.checked=!1;this.interactiveCheck.disabled=!0},isBigDataLayer:function(D){return!!D.url&&-1!==D.url.indexOf("BigDataCatalogServer")&&("featureClass"===D.type||"table"===D.type)},
isPortalHostedService:function(D){return D?-1!==D.toLowerCase().indexOf("/hosted/"):!1},isHostedService:function(D){if(!D)return!1;var P=-1!==D.indexOf(".arcgis.com/");D=-1!==D.indexOf("//services")||-1!==D.indexOf("//tiles")||-1!==D.indexOf("//features");return P&&D},buildEditUIField:function(D,P,R){this.getFieldItemByName({name:D.fieldObj.name},n.hitch(this,function(ca){P.getFieldsList().set("value",ca.id[0],!1);this.buildEditUIOperator(D,P,R)}),n.hitch(this,function(){P.getFieldsList().set("value",
0);this.buildEditUIOperator(D,P,R)}))},buildEditUIOperator:function(D,P,R){switch(D.fieldObj.shortType){case "string":P.fillOperatorList(this.stringOperatorStore,D.operator);break;case "date":P.fillOperatorList(this.dateOperatorStore,D.operator);break;default:P.fillOperatorList(this.numberOperatorStore,D.operator)}setTimeout(n.hitch(this,function(){this.getOperatorItemByName(P.getOperatorList().store,{name:D.operator},n.hitch(this,function(ca){P.getOperatorList().set("value",ca.id[0],!1);this.buildEditUIValue(D,
P,R)}),n.hitch(this,function(){P.getOperatorList().set("value",0);this.buildEditUIValue(D,P,R)}))}),100)},buildEditUIValue:function(D,P,R){this.onOperatorChangeEnabled=this.onFieldChangeEnabled=!0;var ca=D.operator;this.onChangeOperator(P.getOperatorList(),P);P.enableOptions();setTimeout(n.hitch(this,function(){ca===this.i18n.stringOperatorIsBlank||ca===this.i18n.dateOperatorIsBlank||ca===this.i18n.numberOperatorIsBlank||ca===this.i18n.stringOperatorIsNotBlank||ca===this.i18n.dateOperatorIsNotBlank||
ca===this.i18n.numberOperatorIsNotBlank?(P.createValueIsBlank(),P.disableOptions()):"field"===D.valueObj.type?(P.createValueFields(this.fieldsStore,{shortType:D.fieldObj.shortType,name:new RegExp("^(?!"+D.fieldObj.name+"$)")}),P.checkFieldOption(),this.getFieldItemByName({name:D.valueObj.value},n.hitch(this,function(ha){P.setValueFieldById(ha.id[0])}),n.hitch(this,function(){P.setValueFieldById(0)}))):X.isDefined(D.valueObj.value1)?(P.setValue1(D.valueObj.value1),P.setValue2(D.valueObj.value2)):P.setValue(D.valueObj.value,
this.getCodedValues(D.fieldObj.name))}),100)},getFieldItemByName:function(D,P,R){this.fieldsStore.fetch({query:D,onComplete:n.hitch(this,function(ca){ca&&ca.length?P(ca[0]):R()})})},getOperatorItemByName:function(D,P,R,ca){D.fetch({query:P,onComplete:n.hitch(this,function(ha){ha&&ha.length?R(ha[0]):ca()})})}});b("extend-esri")&&n.setObject("dijit.SingleFilter",H,W);return H})},"esri/tasks/GenerateRendererTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/number dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ../urlUtils ../renderers/jsonUtils ./StatisticDefinition ./Task ./QueryTask ./query dojo/has!extend-esri?./GenerateRendererParameters dojo/has!extend-esri?./ClassificationDefinition dojo/has!extend-esri?./ClassBreaksDefinition dojo/has!extend-esri?./UniqueValueDefinition dojo/has!extend-esri?./ColorRamp dojo/has!extend-esri?./AlgorithmicColorRamp dojo/has!extend-esri?./MultipartColorRamp".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u){k=k(p,{declaredClass:"esri.tasks.GenerateRendererTask",_eventMap:{complete:["renderer"]},constructor:function(v,t){!n.isObject(v)||"esri.layers.FeatureLayer"!==v.declaredClass&&"esri.layers.CSVLayer"!==v.declaredClass?(this.url=v,this._url.path+="/generateRenderer"):v.url&&n.isString(v.url)&&"esri.layers.CSVLayer"!==v.declaredClass?(this.url=v.url,this._url=g.urlToObject(this.url),this._url.path+="/generateRenderer"):this._features=v.graphics;this._handler=
n.hitch(this,this._handler);this.source=t&&t.source;this.gdbVersion=t&&t.gdbVersion;this.checkValueRange=t&&t.checkValueRange;this.registerConnectEvents()},_handler:function(v,t,x,C,B){try{if("esri.renderer.ClassBreaksRenderer"===v.declaredClass||"esri.renderer.UniqueValueRenderer"===v.declaredClass)var F=v;else F=d.fromJson(v),"classBreaks"===v.type&&F.setMaxInclusive(!0);if(this.checkValueRange){var y=new q(this.url),w=new u,A=new h;A.statisticType="min";A.onStatisticField=this._field;var z=new h;
z.statisticType="max";z.onStatisticField=this._field;w.outStatistics=[A,z];y.execute(w).then(n.hitch(this,function(G){G=G.features[0].attributes;for(var I in G)if(0===I.toLowerCase().indexOf("min"))var K=G[I];else var Q=G[I];F=this._processRenderer(F,this._prefix,this._unitLabel,this._formatLabel,this._precision,K,Q);this._successHandler([F],"onComplete",x,B)}))}else F=this._processRenderer(F,this._prefix,this._unitLabel,this._formatLabel,this._precision),this._successHandler([F],"onComplete",x,B)}catch(G){this._errorHandler(G,
C,B)}},_processRenderer:function(v,t,x,C,B,F,y){"esri.renderer.ClassBreaksRenderer"===v.declaredClass?r.forEach(v.infos,function(w,A){0===A&&void 0!==F&&null!==F&&(w.minValue=F);A===v.infos.length-1&&void 0!==y&&null!==y&&(w.classMaxValue=w.maxValue=y);B&&(w.classMaxValue=w.maxValue=Math.round(w.maxValue/B)*B,w.minValue=Math.round(w.minValue/B)*B);C&&(w.label=m.format(w.minValue)+" - "+m.format(w.maxValue));t&&(w.label=t+" "+w.label);x&&(w.label=w.label+" "+x)}):r.forEach(v.infos,function(w,A){0===
A&&void 0!==F&&null!==F&&(w.value=F);A===v.infos.length-1&&void 0!==y&&null!==y&&(w.value=y);C&&(w.label=m.format(w.value));t&&(w.label=t+" "+w.label);x&&(w.label=w.label+" "+x)});return v},execute:function(v,t,x){var C=this._handler,B=this._errorHandler;this._precision=v.precision;this._prefix=v.prefix;this._unitLabel=v.unitLabel;this._formatLabel=v.formatLabel;if(this._features=v.features||this._features){var F=new b;var y=this._features;H(["./generateRenderer"],function(z){var G;"esri.tasks.ClassBreaksDefinition"===
v.classificationDefinition.declaredClass?G=z.createClassBreaksRenderer({features:y,definition:v.classificationDefinition}):"esri.tasks.UniqueValueDefinition"===v.classificationDefinition.declaredClass&&(G=z.createUniqueValueRenderer({features:y,definition:v.classificationDefinition}));G?C(G,null,t,x,F):B(null,x,F)})}else{var w=n.mixin(v.toJson(),{f:"json"});this._field="esri.tasks.ClassBreaksDefinition"===v.classificationDefinition.declaredClass?v.classificationDefinition.classificationField:v.classificationDefinition.attributeField;
if(this.source){var A={source:this.source.toJson()};w.layer=l.toJson(A)}this.gdbVersion&&(w.gdbVersion=this.gdbVersion);F=new b(e._dfdCanceller);F._pendingDfd=f({url:this._url.path,content:w,callbackParamName:"callback",load:function(z,G){C(z,G,t,x,F)},error:function(z){B(z,x,F)}})}return F},onComplete:function(){}});a("extend-esri")&&n.setObject("tasks.GenerateRendererTask",k,c);return k})},"esri/tasks/UniqueValueDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel",
"./ClassificationDefinition"],function(H,k,n,r,m){H=H(m,{declaredClass:"esri.tasks.UniqueValueDefinition",type:"uniqueValueDef",attributeField:null,attributeField2:null,attributeField3:null,fieldDelimiter:null,toJson:function(){var l=this.inherited(arguments);this.uniqueValueFields=[];this.attributeField&&this.uniqueValueFields.push(this.attributeField);this.attributeField2&&this.uniqueValueFields.push(this.attributeField2);this.attributeField3&&this.uniqueValueFields.push(this.attributeField3);k.mixin(l,
{type:this.type,uniqueValueFields:this.uniqueValueFields});this.fieldDelimiter&&k.mixin(l,{fieldDelimiter:this.fieldDelimiter});return l}});n("extend-esri")&&k.setObject("tasks.UniqueValueDefinition",H,r);return H})},"esri/tasks/ClassificationDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(H,k,n,r){H=H(null,{declaredClass:"esri.tasks.ClassificationDefinition",type:null,baseSymbol:null,colorRamp:null,toJson:function(){var m={};this.baseSymbol&&
k.mixin(m,{baseSymbol:this.baseSymbol.toJson()});this.colorRamp&&!k.isString(this.colorRamp)&&k.mixin(m,{colorRamp:this.colorRamp.toJson()});return m}});n("extend-esri")&&k.setObject("tasks.ClassificationDefinition",H,r);return H})},"esri/tasks/GenerateRendererParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(H,k,n,r,m){H=H(null,{declaredClass:"esri.tasks.GenerateRendererParameters",classificationDefinition:null,where:null,precision:null,
prefix:null,unitLabel:null,formatLabel:null,toJson:function(){return{classificationDef:n.toJson(this.classificationDefinition.toJson()),where:this.where}}});r("extend-esri")&&k.setObject("tasks.GenerateRendererParameters",H,m);return H})},"esri/layers/GeoRSSLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../config ../request ../urlUtils ./ServiceGeneratedFeatureCollection".split(" "),function(H,k,n,r,m,l,b,a,c){H=H([c],{declaredClass:"esri.layers.GeoRSSLayer",
serviceUrl:a.getProtocolForWebResource()+"//utility.arcgis.com/sharing/rss",constructor:function(f,e){this._url=a.urlToObject(this.url=f);l.defaults.geoRSSService&&(this.serviceUrl=l.defaults.geoRSSService);this._createLayer()},parse:function(){return this._io=b({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?n.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(f){this.inherited(arguments);this.loaded||(this.loaded=!0,
this.onLoad(this))}});r("extend-esri")&&k.setObject("layers.GeoRSSLayer",H,m);return H})},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/webMercatorUtils ../renderers/SimpleRenderer ./layer ./FeatureLayer ../dijit/PopupTemplate".split(" "),function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p){H=H([d],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",
constructor:function(q,u){this.pointSymbol=u&&u.pointSymbol;this.polylineSymbol=u&&u.polylineSymbol;this.polygonSymbol=u&&u.polygonSymbol;this._outSR=u&&(u.outSpatialReference||u.outSR)||new c({wkid:4326});this._options=n.mixin({},u)},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var q=[];this._fLayers&&(q=q.concat(this._fLayers));return q},onRefresh:function(){},onOpacityChange:function(){},refresh:function(){this.loaded&&this._map&&!this._io&&
this.visible&&this._createLayer()},_createLayer:function(q){var u=this;this._fireUpdateStart();q=this.parse(q);q.addCallback(function(v){u._io=null;u._initLayer(v)});q.addErrback(function(v){u._io=null;v=n.mixin(Error(),v);v.message="Unable to load resource: "+u.url+" "+(v.message||"");u._fireUpdateEnd(v);u.onError(v)})},_initLayer:function(q){this.loaded&&this._removeInternalLayers();this.name=q.name;this.description=q.description;this.snippet=q.snippet;this.featureInfos=q.featureInfos;this.fullExtent=
this.initialExtent=new f(q.lookAtExtent);this.copyright=q.author||q.copyright;var u;(q=n.getObject("featureCollection.layers",!1,q))&&0<q.length&&(this._fLayers=[],r.forEach(q,function(v,t){var x=n.getObject("featureSet.features",!1,v);x&&0<x.length&&(u=n.mixin({outFields:["*"],infoTemplate:v.popupInfo?new p(v.popupInfo):null,editable:!1},this._options),u.id&&(u.id=u.id+"_"+t),u.webgl=!1,v.layerDefinition.capabilities="Query,Data",v=new h(v,u),v.geometryType&&(this["_"+v.geometryType]=v),this._fLayers.push(v))},
this),0===this._fLayers.length&&delete this._fLayers);this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(q=new g(this.pointSymbol),this._esriGeometryPoint.setRenderer(q)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(q=new g(this.polylineSymbol),this._esriGeometryPolyline.setRenderer(q)));this._esriGeometryPolygon&&(this.items=this.items.concat(this._esriGeometryPolygon.graphics),
this.polygonSymbol&&(q=new g(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(q)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var q=this._map;this._fireUpdateStart();var u=q.spatialReference,v=this._outSR;if(u.wkid)var t=u._isWebMercator()&&v._isWebMercator()||u.wkid===v.wkid;else if(u.wkt)t=u.wkt===v.wkt;else{console.log("_setMap - map has invalid spatial reference");return}if(!t)if(u._isWebMercator()&&4326===v.wkid)this._converter=
e.geographicToWebMercator;else if(v._isWebMercator()&&4326===u.wkid)this._converter=e.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(u=this._fLayers)&&0<u.length&&r.forEach(u,function(x){if(this._converter){var C=x.graphics,B,F,y=C?C.length:0;for(B=0;B<y;B++)(F=C[B].geometry)&&C[B].setGeometry(this._converter(F))}q.addLayer(x)},this);this.setVisibility(this.visible);
this._fireUpdateEnd()},_removeInternalLayers:function(){var q=this._map;q&&r.forEach(this.getFeatureLayers(),q.removeLayer,q)},setScaleRange:function(q,u){this.inherited(arguments);r.forEach(this.getFeatureLayers(),function(v){v.setScaleRange(q,u)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},setOpacity:function(q){this.opacity!=q&&(r.forEach(this.getFeatureLayers(),function(u){u.setOpacity(q)}),this.opacity=this._options.opacity=q,this.onOpacityChange(q))},onVisibilityChange:function(q){this._fireUpdateStart();
r.forEach(this.getFeatureLayers(),function(u){u.setVisibility(q)});this._fireUpdateEnd()},_setMap:function(q,u){this.inherited(arguments);this._map=q;var v=this._div=m.create("div",null,u);l.set(v,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return v},_unsetMap:function(q,u){this._io&&this._io.cancel();k.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var v=this._div;v&&(u.removeChild(v),m.destroy(v));this._div=null;this.inherited(arguments)}});
b("extend-esri")&&n.setObject("layers._ServiceGeneratedFeatureCollection",H,a);return H})},"esri/dijit/analysis/ItemTypes":function(){define(["dojo/_base/lang","dojo/has","../../kernel"],function(H,k,n){var r={BIGDATA:"Big Data File Share",CSV:"CSV",XLS:"Microsoft Excel",FS:"Feature Service",MS:"Map Service",IS:"Image Service",FLAYER:"Feature Layer",BDATAFEATURE:"featureClass",TABLE:"Table",BTABLE:"table",FLAYERVIEW:"FeatureLayerView",MVGRID:"Multi-Variable Grid",GPSERVICE:"Geoprocessing Service",
RFT:"Raster function template",BDFSTEMPLATE:"bdfstemplate",DLPK:"Deep Learning Package",FILE:"files",DOC:"documents",IMG:"images",PDF:"pdfs",CSVS:"csvs"};k("extend-esri")&&H.setObject("dijit.analysis.itemTypes",r,n);return r})},"esri/dijit/analysis/FeatureRecordSetLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../tasks/DataFile","../../kernel"],function(H,k,n,r,m){H=H(r,{declaredClass:"esri.dijit.analysis.FeatureRecordSetLayer",constructor:function(l){l&&k.mixin(this,
l)},toJson:function(){var l={};this.url&&(l.url=this.url);this.filter&&(l.filter=this.filter);this.serviceToken&&(l.serviceToken=this.serviceToken);this.featureSet&&(l.featureSet=this.featureSet);this.layerDefinition&&(l.layerDefinition=this.layerDefinition);this.time&&(l.time=this.time);return l}});n("extend-esri")&&k.setObject("dijit.analysis.FeatureRecordSetLayer",H,m);return H})},"esri/dijit/analysis/PluginLayers":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/Deferred dojo/promise/all dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-style dojo/query dojo/store/Memory dojo/store/Observable dojo/Evented dojo/has ./ItemTypes ../../request ../../kernel ../../lang dgrid/OnDemandGrid dgrid/Selection ./AnalysisRegistry dojo/i18n!../../nls/jsapi".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F){var y=H([h],{infoPanelTemplate:'\x3cdiv\x3e\x3cdiv class\x3d"template-info-showing"\x3e\x3cdiv\x3e\x3cimg width\x3d\'16px\' height\x3d\'16px\' alt\x3d\'\' src\x3d\'${item.iconUrl}\'\x3e\x3c/div\x3e\x3ch4\x3e${item.title}\x3c/h4\x3e\x3cdiv class\x3d"template-info"\x3e\x3cp class\x3d""\x3e${item.snippet}\x3c/p\x3e${item:plugIn._showLayers}\x3cdiv id\x3d"${item.id}_details" class\x3d"quiet-scroll layer-container"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-actions"\x3e${item:plugIn._addLayerToMap}\x3cbutton class\x3d"btn blue btn-main disabled" id\x3d"add-layer"\x3e${i18n.common.addLayerBtnLabel}\x3c/button\x3e\x3cbutton class\x3d"btn btn-cancel" id\x3d"close-panel"\x3e${i18n.common.close}\x3c/button\x3e\x3c/div\x3e\x3cdiv\x3e',
geometryTypes:[B.GeometryTypes.Point,B.GeometryTypes.Point.MultiPoint,B.GeometryTypes.Line,B.GeometryTypes.Polygon],layerTypes:[q.FLAYER,q.BDATAFEATURE,q.BTABLE,q.TABLE],timeTypes:[B.TimeTypes.Instant,B.TimeTypes.Interval],checkGeometryType:!0,checkLayerType:!1,checkTimeFilter:!1,fetchType:['type:"'+q.MS+'"','type:"'+q.FS+'"'],constructor:function(w){k.mixin(this,w);this.filters={all:{},mycontent:{owners:this.self?[this.self.user.username]:[]},esriBoundaryLayers:{owners:["esri_boundaries"]}};this.i18n=
k.mixin({},F.browseLayersDlg);k.mixin(this.i18n,F.browseItems);k.mixin(this.i18n,F.common);this.filterStrings={all:{title:this.self&&this.self.isPortal?this.i18n.items.portalOrg:this.i18n.items.organizationLabel},mycontent:{title:this.i18n.items.contentLabel},esriBoundaryLayers:{title:this.i18n.esriBoundaryLayers}}},fetchData:function(){this._portal=this.parent._portal;this._user=this._portal.getPortalUser();this.filters.mycontent.owner=this._user;this.parent.fetchType&&(this.fetchType=this.parent.fetchType);
return this._fetchItems()},_fetchItems:function(){return this.parent._fetchItems({types:this.fetchType})},_fetchServiceInfo:function(w){var A=new m,z,G={f:"json"};w.url?(-1!==window.location.protocol.indexOf("https:")&&(w.url=w.url.replace("http:","https:")),u({url:w.url,content:G}).then(function(I){A.resolve(I)},k.hitch(this,function(I){z=I.details&&I.details.length?I.details.shift():"";I&&403===I.httpCode&&-1<z.indexOf("SSL Required")?(w.set("url",w.url.replace("http:","https:")),this._fetchServiceInfo(w).then(function(K){A.resolve(K)})):
(w.isLoaded=!0,A.resolve({error:I}))}))):A.resolve(null);return A},_addLayerToMap:function(w){return w.type===q.BIGDATA||w.type===q.CSV||w.type===q.XLS?"":'\x3cdiv class\x3d"esriFloatLeading esriLeadingPadding1 padding-trailer-half js-add-layer-node"\x3e\x3clabel\x3e\x3cinput name\x3d"addlayertomap" class\x3d"js-add-layer-checkbox" type\x3d"checkbox"\x3e\x3cspan class\x3d"esriLeadingPadding1"\x3e'+this.i18n.common.addLayer+"\x3c/span\x3e\x3c/label\x3e\x3c/div\x3e"},_showLayers:function(w){if(w&&-1!==
n.indexOf([q.FS,q.MS,q.IS,q.BIGDATA,q.CSV,q.XLS],w.type)){if(w.type===q.CSV||w.type===q.XLS)w.url=w.itemUrl;this.plugIn._fetchServiceInfo(w).then(k.hitch(this,function(A){var z=[],G={f:"json"};A.layers&&(z=[].concat(z).concat(A.layers));A.tables&&0<A.tables.length&&(z=[].concat(z).concat(A.tables));A.children&&(z=A.children);!w||w.type!==q.CSV&&w.type!==q.XLS&&w.type!==q.IS||(z=[w]);if(!z.length)var I=this.plugIn.i18n.noDataMessages.noItemInfo;this.plugIn._createLayerGrid(r.create("div",null,b.byId(w.id+
"_details")),I);n.forEach(z,function(K,Q){w.type===q.BIGDATA?(K.url=w.url+"/"+K.name,K.url=encodeURI(K.url)):K.url=w.type===q.CSV?w.itemUrl:w.type===q.IS?w.url:w.url+"/"+Q;-1!==window.location.protocol.indexOf("https:")&&(K.url=K.url.replace("http:","https:"));u({url:K.url,content:G}).then(k.hitch(this,function(N){K=k.mixin(K,N);this.plugIn._store.put(K);this.plugIn._grid.refresh()}),k.hitch(this,function(N){this.plugIn._grid.noDataMessage=this.plugIn.i18n.noDataMessages.noLayerInfo;this.plugIn._grid.refresh()}))},
this)}))}return""},_getLayerHead:function(){return"\x3ctr\x3e\x3cth\x3e\x3c/th\x3e\x3cth\x3eLayer Name\x3c/th\x3e\x3cth\x3e Geometry Type\x3c/th\x3e\x3c/tr\x3e"},_getLayerNode:function(w,A,z){A=w.name;var G='\x3ctr\x3e\x3ctd\x3e\x3cinput type\x3d"checkbox" class\x3d"js-layer-check" name\x3d"layers" value\x3d"'+A+' checked"\x3e\x3c/td\x3e\x3ctd\x3e',I="\x3c/td\x3e\x3ctd\x3e"+w.geometryType+"\x3c/td\x3e\x3c/tr\x3e";return w.itemUrl||w.url?G+'\x3ca class\x3d"'+(z||"")+'"\x3e'+A+"\x3c/a\x3e"+I:G+A+I},
_createLayerGrid:function(w,A){var z=H([x,C]);this._store=d(new g({idProperty:"name"}));this._atleastALayerAvailable=!1;this._grid=new z({store:this._store,query:k.hitch(this,function(G){var I=!0,K=!0,Q=!0,N=!0;this.checkGeometryType&&G.type!==q.IS&&(Q=-1!==n.indexOf(this.geometryTypes,G.geometryType));this.checkTimeFilter&&(I=-1!==n.indexOf(this.timeTypes,this.getTimeType(G)));this.checkLayerType&&(K=-1!==n.indexOf(this.layerTypes,G.type));"function"===typeof this.customCheckHandler&&(N=this.customCheckHandler(G));
G=G&&Q&&I&&K&&N;G||(this._grid.noDataMessage=this.getNoDataMessage({geomCheck:Q,timeCheck:I,typeCheck:K,customCheck:N}));!this._atleastALayerAvailable&&G&&(this._atleastALayerAvailable=G);e(".js-add-layer-checkbox",this.parent.infoPanel).forEach(function(T){a.set(T,"disabled",!this._atleastALayerAvailable)},this);return G}),selectionMode:"single","class":"esriAnalysisLayersGrid quiet-scroll",noDataMessage:A||this.i18n.noValidLayerMsg,allowSelect:k.hitch(this,function(G){var I;this.checkLayerType&&
G.data&&(I=-1!==n.indexOf(this.layerTypes,G.data.type));I=G.data.geometryType?-1!==n.indexOf(this.geometryTypes,G.data.geometryType)||this.checkLayerType&&I:!0;return G&&G.data&&I}),renderRow:k.hitch(this,this._renderer)},w);this._grid.startup();this._grid.on("dgrid-select,dgrid-deselect",k.hitch(this,function(G){G=G.grid.selection;var I=[];for(K in G)G[K]&&I.push(this._grid.row(K).data);var K={selection:I};e(".panel-actions .btn-main",this.parent.infoPanel).forEach(function(Q){c.toggle(Q,"disabled",
0===I.length)},this);I[0]&&(this._selectedLayer=I[0]);this.emit("layer-change",K)}))},hasTimeInfo:function(w){return w&&w.timeInfo},getTimeType:function(w){return w?t.isDefined(w.timeInfo)&&t.isDefined(w.timeInfo.startTimeField)&&!t.isDefined(w.timeInfo.endTimeField)?B.TimeTypes.Instant:t.isDefined(w.timeInfo)&&t.isDefined(w.timeInfo.startTimeField)&&t.isDefined(w.timeInfo.endTimeField)?B.TimeTypes.Interval:t.isDefined(w.time)&&t.isDefined(w.time.timeType)?w.time.timeType:!1:!1},getNoDataMessage:function(w){if(w.geomCheck)if(w.timeCheck){if(!w.typeCheck)return this.i18n.noDataMessages.typeCheckFailure;
if(!w.customCheck)return this.customCheckFailureMessage}else return this.i18n.noDataMessages.timeCheckFailure;else return this.i18n.noDataMessages.geomCheckFailure},getDateFields:function(w){return n.filter(w&&w.fields||[],function(A){return A&&"esriFieldTypeDate"===A.type})},_renderer:function(w){w.snippet=w.snippet||"";var A=r.create("div"),z=this._getLabel(w);r.place('\x3cdiv class\x3d"panel panel-white panel-bordered panel-compact border-bottom-clear"\x3e\x3ch5 class\x3d"trailer-0 font-size-0 word-break"\x3e\x3ca\x3e'+
w.name+'\x3c/a\x3e\x3c/h5\x3e\x3cnav class\x3d"inline-block"\x3e\x3ca class\x3d"link-gray font-size--2 esriTrailingPadding1 esriTrailingMargin05"\x3e\x3cspan class\x3d"'+z.icon+'"\x3e\x3c/span\x3e'+z.name+"\x3c/a\x3e"+(w.timeInfo||w.time&&"instant"===w.time.timeType?'\x3ca class\x3d"link-gray font-size--2 esriTrailingPadding1" data-action\x3d"timeSettings" data-layerid\x3d"0"\x3e\x3cspan class\x3d"esri-icon-time-clock"\x3e\x3c/span\x3e'+this.i18n.timeEnabled+"\x3c/a\x3e":'\x3ca class\x3d"esriTrailingPadding1"\x3e\x3c/a\x3e')+
"\x3c/nav\x3e\x3c/div\x3e",A);return A},_getLabel:function(w){var A={icon:"",name:""},z=w.geometryType;z===B.GeometryTypes.Point||z===B.GeometryTypes.MultiPoint?(A.name=this.i18n.points,A.icon="esri-icon-map-pin"):z===B.GeometryTypes.Polygon?(A.name=this.i18n.areas,A.icon="esri-icon-polygon"):z===B.GeometryTypes.Line?(A.name=this.i18n.lines,A.icon="esri-icon-polyline"):w.type===q.IS?(A.name=this.i18n.imageService,A.icon="esri-icon-layers"):(A.name=this.i18n.table,A.icon="esri-icon-table");return A}});
k.mixin(y,{add:function(w,A){w.plugIn||(A=A||{},A.parent=w,A.self=w.self,w.plugIn=new y(A))},remove:function(w){w.plugIn&&(w.plugIn.destroy(),delete w.plugIn)}});p("extend-esri")&&k.setObject("dijit.analysis.PluginLayers",y,v);return y})},"esri/dijit/analysis/AnalysisRegistry":function(){define(["dojo/_base/lang","dojo/has","../../kernel"],function(H,k,n){var r={Modes:{Raster:"raster",Bigdata:"bigdata",Standard:"standard",Feature:"feature"},Tools:{FindCentroids:"FindCentroids",ChooseBestFacilities:"ChooseBestFacilities"},
ProcessInfoTools:{DescribeDataset:{Name:"DescribeDataset",Gax:!0,Std:!1},GeneralizedLinearRegression:{Name:"GeneralizedLinearRegression",Gax:!0,Std:!1},ForestBasedClassificationAndRegression:{Name:"ForestBasedClassificationAndRegression",Gax:!0,Std:!1},GeographicallyWeightedRegression:{Name:"GeographicallyWeightedRegression",Gax:!0,Std:!1},FindSimilarLocations:{Name:"FindSimilarLocations",Gax:!0,Std:!0},FindHotSpots:{Name:"FindHotSpots",Gax:!1,Std:!0},FindOutliers:{Name:"FindOutliers",Gax:!0,Std:!0}},
ToolCategory:{Gax:"GeoAnalyticsTools",Std:"SpatialAnalysisTools"},GeometryTypes:{Polygon:"esriGeometryPolygon",Line:"esriGeometryPolyline",Point:"esriGeometryPoint",MultiPoint:"esriGeometryMultipoint"},PseudoGeometryTypes:{Point:"point",Line:"line",Polygon:"polygon"},TimeTypes:{Instant:"instant",Interval:"interval"},FieldTypes:{ObjectId:"esriFieldTypeOID",String:"esriFieldTypeString",Short:"esriFieldTypeSmallInteger",Integer:"esriFieldTypeInteger",Float:"esriFieldTypeSingle",Double:"esriFieldTypeDouble",
Date:"esriFieldTypeDate"},PseudoFieldTypes:{Number:"number",String:"string",Date:"date"},Shapes:{square:"SQUARE",hexagon:"HEXAGON",transverseHexagon:"TRANSVERSEHEXAGON",triangle:"TRIANGLE",diamond:"DIAMOND"},DistanceMethods:{geodesic:"Geodesic",planar:"Planar"}};k("extend-esri")&&H.setObject("dijit.analysis.AnalysisRegistry",r,n);return r})},"esri/dijit/analysis/PCSList":function(){define(["dojo/_base/lang","dojo/has","../../kernel"],function(H,k,n){var r=[2E3,2001,2002,2003,2004,2005,2006,2007,2008,
2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2070,2071,2072,2073,2074,2075,2076,2077,2078,2079,2080,2081,2082,2083,2084,2085,2086,2087,2088,2089,2090,2091,2092,2093,2094,2095,2096,2097,2098,2099,2100,2101,2102,2103,2104,2105,2106,2107,2108,2109,2110,2111,2112,2113,2114,2115,2116,2117,2118,2119,
2120,2121,2122,2123,2124,2125,2126,2127,2128,2129,2130,2131,2132,2133,2134,2135,2136,2137,2138,2139,2140,2141,2142,2143,2144,2145,2146,2147,2148,2149,2150,2151,2152,2153,2154,2155,2157,2158,2159,2160,2161,2162,2163,2164,2165,2166,2167,2168,2169,2170,2172,2173,2174,2175,2176,2177,2178,2179,2180,2181,2182,2183,2184,2185,2186,2187,2188,2189,2190,2191,2192,2193,2195,2196,2197,2198,2200,2201,2202,2203,2204,2205,2206,2207,2208,2209,2210,2211,2212,2213,2214,2215,2216,2217,2219,2220,2222,2223,2224,2225,2226,
2227,2228,2229,2230,2231,2232,2233,2234,2235,2236,2237,2238,2239,2240,2241,2242,2243,2244,2245,2246,2247,2248,2249,2250,2251,2252,2253,2254,2255,2256,2257,2258,2259,2260,2261,2262,2263,2264,2265,2266,2267,2268,2269,2270,2271,2272,2273,2274,2275,2276,2277,2278,2279,2280,2281,2282,2283,2284,2285,2286,2287,2288,2289,2290,2291,2292,2294,2295,2308,2309,2310,2311,2312,2313,2314,2315,2316,2317,2318,2319,2320,2321,2322,2323,2324,2325,2326,2327,2328,2329,2330,2331,2332,2333,2334,2335,2336,2337,2338,2339,2340,
2341,2342,2343,2344,2345,2346,2347,2348,2349,2350,2351,2352,2353,2354,2355,2356,2357,2358,2359,2360,2361,2362,2363,2364,2365,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2384,2385,2386,2387,2388,2389,2390,2391,2392,2393,2394,2395,2396,2397,2398,2399,2400,2401,2402,2403,2404,2405,2406,2407,2408,2409,2410,2411,2412,2413,2414,2415,2416,2417,2418,2419,2420,2421,2422,2423,2424,2425,2426,2427,2428,2429,2430,2431,2432,2433,2434,2435,2436,2437,2438,2439,2440,2441,
2442,2443,2444,2445,2446,2447,2448,2449,2450,2451,2452,2453,2454,2455,2456,2457,2458,2459,2460,2461,2462,2463,2464,2465,2466,2467,2468,2469,2470,2471,2472,2473,2474,2475,2476,2477,2478,2479,2480,2481,2482,2483,2484,2485,2486,2487,2488,2489,2490,2491,2494,2495,2496,2497,2498,2499,2500,2501,2502,2503,2504,2505,2506,2507,2508,2509,2510,2511,2512,2513,2514,2515,2516,2517,2518,2519,2520,2521,2522,2523,2524,2525,2526,2527,2528,2529,2530,2531,2532,2533,2534,2535,2536,2537,2538,2539,2540,2541,2542,2543,2544,
2545,2546,2547,2548,2549,2550,2551,2552,2553,2554,2555,2556,2557,2558,2559,2560,2561,2562,2563,2564,2565,2566,2567,2568,2569,2570,2571,2572,2573,2574,2575,2576,2577,2578,2579,2580,2581,2582,2583,2584,2585,2586,2587,2588,2589,2590,2591,2592,2593,2594,2595,2596,2597,2598,2599,2600,2601,2602,2603,2604,2605,2606,2607,2608,2609,2610,2611,2612,2613,2614,2615,2616,2617,2618,2619,2620,2621,2622,2623,2624,2625,2626,2627,2628,2629,2630,2631,2632,2633,2634,2635,2636,2637,2638,2639,2640,2641,2642,2643,2644,2645,
2646,2647,2648,2649,2650,2651,2652,2653,2654,2655,2656,2657,2658,2659,2660,2661,2662,2663,2664,2665,2666,2667,2668,2669,2670,2671,2672,2673,2674,2675,2676,2677,2678,2679,2680,2681,2682,2683,2684,2685,2686,2687,2688,2689,2690,2691,2692,2693,2694,2695,2696,2697,2698,2699,2700,2701,2702,2703,2704,2705,2706,2707,2708,2709,2710,2711,2712,2713,2714,2715,2716,2717,2718,2719,2720,2721,2722,2723,2724,2725,2726,2727,2728,2729,2730,2731,2732,2733,2734,2735,2736,2737,2738,2739,2740,2741,2742,2743,2744,2745,2746,
2747,2748,2749,2750,2751,2752,2753,2754,2755,2756,2757,2758,2759,2760,2761,2762,2763,2764,2765,2766,2767,2768,2769,2770,2771,2772,2773,2774,2775,2776,2777,2778,2779,2780,2781,2782,2783,2784,2785,2786,2787,2788,2789,2790,2791,2792,2793,2794,2795,2796,2797,2798,2799,2800,2801,2802,2803,2804,2805,2806,2807,2808,2809,2810,2811,2812,2813,2814,2815,2816,2817,2818,2819,2820,2821,2822,2823,2824,2825,2826,2827,2828,2829,2830,2831,2832,2833,2834,2835,2836,2837,2838,2839,2840,2841,2842,2843,2844,2845,2846,2847,
2848,2849,2850,2851,2852,2853,2854,2855,2856,2857,2858,2859,2860,2861,2862,2863,2864,2865,2866,2867,2868,2869,2870,2871,2872,2873,2874,2875,2876,2877,2878,2879,2880,2881,2882,2883,2884,2885,2886,2887,2888,2891,2892,2893,2894,2895,2896,2897,2898,2899,2900,2901,2902,2903,2904,2905,2906,2907,2908,2909,2910,2911,2912,2913,2914,2915,2916,2917,2918,2919,2920,2921,2922,2923,2924,2925,2926,2927,2928,2929,2930,2931,2932,2933,2934,2935,2936,2937,2938,2939,2940,2941,2942,2943,2944,2945,2946,2947,2948,2949,2950,
2951,2952,2953,2954,2955,2956,2957,2958,2959,2960,2961,2962,2964,2965,2966,2967,2968,2969,2970,2971,2972,2973,2975,2976,2977,2978,2979,2980,2981,2982,2983,2984,2985,2986,2987,2988,2989,2990,2991,2992,2993,2994,2995,2996,2997,2998,2999,3E3,3001,3002,3003,3004,3005,3006,3007,3008,3009,3010,3011,3012,3013,3014,3015,3016,3017,3018,3019,3020,3021,3022,3023,3024,3025,3026,3027,3028,3029,3030,3031,3032,3033,3034,3035,3036,3037,3038,3039,3040,3041,3042,3043,3044,3045,3046,3047,3048,3049,3050,3051,3054,3055,
3056,3057,3058,3059,3060,3061,3062,3063,3064,3065,3066,3067,3068,3069,3070,3071,3072,3073,3074,3075,3076,3077,3078,3079,3080,3081,3082,3083,3084,3085,3086,3087,3088,3089,3090,3091,3092,3093,3094,3095,3096,3097,3098,3099,3100,3101,3102,3106,3107,3108,3109,3110,3111,3112,3113,3114,3115,3116,3117,3118,3119,3120,3121,3122,3123,3124,3125,3126,3127,3128,3129,3130,3131,3132,3133,3134,3135,3136,3137,3138,3141,3142,3146,3147,3148,3149,3150,3151,3153,3154,3155,3156,3157,3158,3159,3160,3161,3162,3163,3164,3165,
3166,3167,3168,3169,3170,3171,3172,3174,3175,3176,3177,3178,3179,3180,3181,3182,3183,3184,3185,3186,3187,3188,3189,3190,3191,3192,3193,3194,3195,3196,3197,3198,3199,3200,3201,3202,3203,3294,3295,3296,3297,3298,3299,3300,3301,3302,3303,3304,3305,3306,3307,3308,3309,3310,3311,3312,3313,3314,3315,3316,3317,3318,3319,3320,3321,3322,3323,3324,3325,3326,3327,3328,3329,3330,3331,3332,3333,3334,3335,3336,3337,3338,3339,3340,3341,3342,3343,3344,3345,3346,3347,3348,3349,3350,3351,3352,3353,3354,3355,3356,3357,
3358,3359,3360,3361,3362,3363,3364,3365,3366,3367,3368,3369,3370,3371,3372,3373,3374,3375,3376,3377,3378,3379,3380,3381,3382,3383,3384,3385,3386,3387,3388,3389,3390,3391,3392,3393,3394,3395,3396,3397,3398,3399,3400,3401,3402,3403,3404,3405,3406,3407,3408,3409,3410,3411,3412,3413,3414,3415,3416,3417,3418,3419,3420,3421,3422,3423,3424,3425,3426,3427,3428,3429,3430,3431,3432,3433,3434,3435,3436,3437,3438,3439,3440,3441,3442,3443,3444,3445,3446,3447,3448,3449,3450,3451,3452,3453,3454,3455,3456,3457,3458,
3459,3460,3461,3462,3463,3464,3465,3466,3467,3468,3469,3470,3471,3472,3473,3474,3475,3476,3477,3478,3479,3480,3481,3482,3483,3484,3485,3486,3487,3488,3489,3490,3491,3492,3493,3494,3495,3496,3497,3498,3499,3500,3501,3502,3503,3504,3505,3506,3507,3508,3509,3510,3511,3512,3513,3514,3515,3516,3517,3518,3519,3520,3521,3522,3523,3524,3525,3526,3527,3528,3529,3530,3531,3532,3533,3534,3535,3536,3537,3538,3539,3540,3541,3542,3543,3544,3545,3546,3547,3548,3549,3550,3551,3552,3553,3554,3555,3556,3557,3558,3559,
3560,3561,3562,3563,3564,3565,3566,3567,3568,3569,3570,3571,3572,3573,3574,3575,3576,3577,3578,3579,3580,3581,3582,3583,3584,3585,3586,3587,3588,3589,3590,3591,3592,3593,3594,3595,3596,3597,3598,3599,3600,3601,3602,3603,3604,3605,3606,3607,3608,3609,3610,3611,3612,3613,3614,3615,3616,3617,3618,3619,3620,3621,3622,3623,3624,3625,3626,3627,3628,3629,3630,3631,3632,3633,3634,3635,3636,3637,3638,3639,3640,3641,3642,3643,3644,3645,3646,3647,3648,3649,3650,3651,3652,3653,3654,3655,3656,3657,3658,3659,3660,
3661,3662,3663,3664,3665,3666,3667,3668,3669,3670,3671,3672,3673,3674,3675,3676,3677,3678,3679,3680,3681,3682,3683,3684,3685,3686,3687,3688,3689,3690,3691,3692,3693,3694,3695,3696,3697,3698,3699,3700,3701,3702,3703,3704,3705,3706,3707,3708,3709,3710,3711,3712,3713,3714,3715,3716,3717,3718,3719,3720,3721,3722,3723,3724,3725,3726,3727,3728,3729,3730,3731,3732,3733,3734,3735,3736,3737,3738,3739,3740,3741,3742,3743,3744,3745,3746,3747,3748,3749,3750,3751,3753,3754,3755,3756,3757,3758,3759,3760,3761,3762,
3763,3764,3765,3766,3767,3768,3769,3770,3771,3772,3773,3775,3776,3777,3779,3780,3781,3783,3784,3785,3788,3789,3790,3791,3793,3794,3797,3798,3799,3800,3801,3802,3812,3814,3815,3816,3825,3826,3827,3828,3829,3832,3833,3834,3835,3836,3837,3838,3839,3840,3841,3844,3845,3846,3847,3848,3849,3850,3851,3852,3854,3857,3873,3874,3875,3876,3877,3878,3879,3880,3881,3882,3883,3884,3885,3890,3891,3892,3893,3907,3908,3909,3910,3911,3912,3920,3942,3943,3944,3945,3946,3947,3948,3949,3950,3968,3969,3970,3973,3974,3975,
3976,3978,3979,3986,3987,3988,3989,3991,3992,3994,3995,3996,3997,4026,4037,4038,4048,4049,4050,4051,4056,4057,4058,4059,4060,4061,4062,4063,4071,4082,4083,4087,4088,4093,4094,4095,4096,4217,4390,4391,4392,4393,4394,4395,4396,4397,4398,4399,4400,4401,4402,4403,4404,4405,4406,4407,4408,4409,4410,4411,4412,4413,4414,4415,4417,4418,4419,4420,4421,4422,4423,4424,4425,4426,4427,4428,4429,4430,4431,4432,4433,4434,4437,4438,4439,4455,4456,4457,4462,4467,4471,4474,4484,4485,4486,4487,4488,4489,4491,4492,4493,
4494,4495,4496,4497,4498,4499,4500,4501,4502,4503,4504,4505,4506,4507,4508,4509,4510,4511,4512,4513,4514,4515,4516,4517,4518,4519,4520,4521,4522,4523,4524,4525,4526,4527,4528,4529,4530,4531,4532,4533,4534,4535,4536,4537,4538,4539,4540,4541,4542,4543,4544,4545,4546,4547,4548,4549,4550,4551,4552,4553,4554,4559,4568,4569,4570,4571,4572,4573,4574,4575,4576,4577,4578,4579,4580,4581,4582,4583,4584,4585,4586,4587,4588,4589,4647,4652,4653,4654,4655,4656,4766,4767,4768,4769,4770,4771,4772,4773,4774,4775,4776,
4777,4778,4779,4780,4781,4782,4783,4784,4785,4786,4787,4788,4789,4790,4791,4792,4793,4794,4795,4796,4797,4798,4799,4800,4822,4826,4839,5014,5015,5016,5018,5048,5069,5070,5071,5072,5105,5106,5107,5108,5109,5110,5111,5112,5113,5114,5115,5116,5117,5118,5119,5120,5121,5122,5123,5124,5125,5126,5127,5128,5129,5130,5167,5168,5173,5174,5175,5176,5177,5178,5179,5180,5181,5182,5183,5184,5185,5186,5187,5188,5221,5223,5234,5235,5243,5247,5253,5254,5255,5256,5257,5258,5259,5266,5269,5270,5271,5272,5273,5274,5275,
5292,5293,5294,5295,5296,5297,5298,5299,5300,5301,5302,5303,5304,5305,5306,5307,5308,5309,5310,5311,5316,5320,5321,5325,5329,5330,5331,5337,5343,5344,5345,5346,5347,5348,5349,5355,5356,5357,5361,5362,5367,5382,5383,5387,5388,5389,5396,5456,5457,5459,5460,5461,5462,5463,5469,5472,5479,5480,5481,5482,5490,5513,5514,5518,5519,5520,5523,5530,5531,5532,5533,5534,5535,5536,5537,5538,5539,5550,5551,5552,5559,5562,5563,5564,5565,5566,5567,5568,5569,5570,5571,5572,5573,5574,5575,5576,5577,5578,5579,5580,5581,
5582,5583,5588,5589,5596,5623,5624,5625,5627,5629,5631,5632,5633,5634,5635,5636,5637,5638,5639,5641,5643,5644,5646,5649,5650,5651,5652,5653,5654,5655,5659,5663,5664,5665,5666,5667,5668,5669,5670,5671,5672,5673,5674,5675,5676,5677,5678,5679,5680,5682,5683,5684,5685,5700,5825,5836,5837,5839,5842,5844,5858,5875,5876,5877,5879,5880,5887,5890,5921,5922,5923,5924,5925,5926,5927,5928,5929,5930,5931,5932,5933,5934,5935,5936,5937,5938,5939,5940,6050,6051,6052,6053,6054,6055,6056,6057,6058,6059,6060,6061,6062,
6063,6064,6065,6066,6067,6068,6069,6070,6071,6072,6073,6074,6075,6076,6077,6078,6079,6080,6081,6082,6083,6084,6085,6086,6087,6088,6089,6090,6091,6092,6093,6094,6095,6096,6097,6098,6099,6100,6101,6102,6103,6104,6105,6106,6107,6108,6109,6110,6111,6112,6113,6114,6115,6116,6117,6118,6119,6120,6121,6122,6123,6124,6125,6128,6129,6141,6204,6210,6211,6244,6245,6246,6247,6248,6249,6250,6251,6252,6253,6254,6255,6256,6257,6258,6259,6260,6261,6262,6263,6264,6265,6266,6267,6268,6269,6270,6271,6272,6273,6274,6275,
6307,6312,6316,6328,6329,6330,6331,6332,6333,6334,6335,6336,6337,6338,6339,6340,6341,6342,6343,6344,6345,6346,6347,6348,6350,6351,6352,6353,6354,6355,6356,6362,6366,6367,6368,6369,6370,6371,6372,6381,6382,6383,6384,6385,6386,6387,6391,6393,6394,6395,6396,6397,6398,6399,6400,6401,6402,6403,6404,6405,6406,6407,6408,6409,6410,6411,6412,6413,6414,6415,6416,6417,6418,6419,6420,6421,6422,6423,6424,6425,6426,6427,6428,6429,6430,6431,6432,6433,6434,6435,6436,6437,6438,6439,6440,6441,6442,6443,6444,6445,6446,
6447,6448,6449,6450,6451,6452,6453,6454,6455,6456,6457,6458,6459,6460,6461,6462,6463,6464,6465,6466,6467,6468,6469,6470,6471,6472,6473,6474,6475,6476,6477,6478,6479,6480,6481,6482,6483,6484,6485,6486,6487,6488,6489,6490,6491,6492,6493,6494,6495,6496,6497,6498,6499,6500,6501,6502,6503,6504,6505,6506,6507,6508,6509,6510,6511,6512,6513,6514,6515,6516,6518,6519,6520,6521,6522,6523,6524,6525,6526,6527,6528,6529,6530,6531,6532,6533,6534,6535,6536,6537,6538,6539,6540,6541,6542,6543,6544,6545,6546,6547,6548,
6549,6550,6551,6552,6553,6554,6555,6556,6557,6558,6559,6560,6561,6562,6563,6564,6565,6566,6567,6568,6569,6570,6571,6572,6573,6574,6575,6576,6577,6578,6579,6580,6581,6582,6583,6584,6585,6586,6587,6588,6589,6590,6591,6592,6593,6594,6595,6596,6597,6598,6599,6600,6601,6602,6603,6605,6606,6607,6608,6609,6610,6611,6612,6613,6614,6615,6616,6617,6618,6619,6620,6621,6622,6623,6624,6625,6626,6627,6628,6629,6630,6631,6632,6633,6634,6635,6636,6637,6646,6669,6670,6671,6672,6673,6674,6675,6676,6677,6678,6679,6680,
6681,6682,6683,6684,6685,6686,6687,6688,6689,6690,6691,6692,6703,6707,6708,6709,6720,6721,6722,6723,6732,6733,6734,6735,6736,6737,6738,6784,6785,6786,6787,6788,6789,6790,6791,6792,6793,6794,6795,6796,6797,6798,6799,6800,6801,6802,6803,6804,6805,6806,6807,6808,6809,6810,6811,6812,6813,6814,6815,6816,6817,6818,6819,6820,6821,6822,6823,6824,6825,6826,6827,6828,6829,6830,6831,6832,6833,6834,6835,6836,6837,6838,6839,6840,6841,6842,6843,6844,6845,6846,6847,6848,6849,6850,6851,6852,6853,6854,6855,6856,6857,
6858,6859,6860,6861,6862,6863,6867,6868,6870,6875,6876,6879,6880,6884,6885,6886,6887,6915,6922,6923,6924,6925,6931,6932,6933,6956,6957,6958,6959,6962,6984,6991,7005,7006,7007,7057,7058,7059,7060,7061,7062,7063,7064,7065,7066,7067,7068,7069,7070,7074,7075,7076,7077,7078,7079,7080,7081,7082,7109,7110,7111,7112,7113,7114,7115,7116,7117,7118,7119,7120,7121,7122,7123,7124,7125,7126,7127,7128,7131,7132,7257,7258,7259,7260,7261,7262,7263,7264,7265,7266,7267,7268,7269,7270,7271,7272,7273,7274,7275,7276,7277,
7278,7279,7280,7281,7282,7283,7284,7285,7286,7287,7288,7289,7290,7291,7292,7293,7294,7295,7296,7297,7298,7299,7300,7301,7302,7303,7304,7305,7306,7307,7308,7309,7310,7311,7312,7313,7314,7315,7316,7317,7318,7319,7320,7321,7322,7323,7324,7325,7326,7327,7328,7329,7330,7331,7332,7333,7334,7335,7336,7337,7338,7339,7340,7341,7342,7343,7344,7345,7346,7347,7348,7349,7350,7351,7352,7353,7354,7355,7356,7357,7358,7359,7360,7361,7362,7363,7364,7365,7366,7367,7368,7369,7370,7374,7375,7376,7528,7529,7530,7531,7532,
7533,7534,7535,7536,7537,7538,7539,7540,7541,7542,7543,7544,7545,7546,7547,7548,7549,7550,7551,7552,7553,7554,7555,7556,7557,7558,7559,7560,7561,7562,7563,7564,7565,7566,7567,7568,7569,7570,7571,7572,7573,7574,7575,7576,7577,7578,7579,7580,7581,7582,7583,7584,7585,7586,7587,7588,7589,7590,7591,7592,7593,7594,7595,7596,7597,7598,7599,7600,7601,7602,7603,7604,7605,7606,7607,7608,7609,7610,7611,7612,7613,7614,7615,7616,7617,7618,7619,7620,7621,7622,7623,7624,7625,7626,7627,7628,7629,7630,7631,7632,7633,
7634,7635,7636,7637,7638,7639,7640,7641,7642,7643,7644,7645,7845,7846,7847,7848,7849,7850,7851,7852,7853,7854,7855,7856,7857,7858,7859,20002,20003,20004,20005,20006,20007,20008,20009,20010,20011,20012,20013,20014,20015,20016,20017,20018,20019,20020,20021,20022,20023,20024,20025,20026,20027,20028,20029,20030,20031,20032,20062,20063,20064,20065,20066,20067,20068,20069,20070,20071,20072,20073,20074,20075,20076,20077,20078,20079,20080,20081,20082,20083,20084,20085,20086,20087,20088,20089,20090,20091,
20092,20135,20136,20137,20138,20248,20249,20250,20251,20252,20253,20254,20255,20256,20257,20258,20348,20349,20350,20351,20352,20353,20354,20355,20356,20357,20358,20436,20437,20438,20439,20440,20499,20538,20539,20790,20791,20822,20823,20824,20934,20935,20936,21035,21036,21037,21095,21096,21097,21148,21149,21150,21291,21292,21413,21414,21415,21416,21417,21418,21419,21420,21421,21422,21423,21473,21474,21475,21476,21477,21478,21479,21480,21481,21482,21483,21500,21780,21781,21782,21817,21818,21891,21892,
21893,21894,21896,21897,21898,21899,22032,22033,22091,22092,22171,22172,22173,22174,22175,22176,22177,22181,22182,22183,22184,22185,22186,22187,22191,22192,22193,22194,22195,22196,22197,22234,22235,22236,22332,22391,22392,22521,22522,22523,22524,22525,22700,22770,22780,22832,22991,22992,22993,22994,23028,23029,23030,23031,23032,23033,23034,23035,23036,23037,23038,23090,23095,23239,23240,23433,23700,23830,23831,23832,23833,23834,23835,23836,23837,23838,23839,23840,23841,23842,23843,23844,23845,23846,
23847,23848,23849,23850,23851,23852,23853,23866,23867,23868,23869,23870,23871,23872,23877,23878,23879,23880,23881,23882,23883,23884,23886,23887,23888,23889,23890,23891,23892,23893,23894,23946,23947,23948,24047,24048,24100,24200,24305,24306,24311,24312,24313,24342,24343,24344,24345,24346,24347,24370,24371,24372,24373,24374,24375,24376,24377,24378,24379,24380,24381,24382,24383,24500,24547,24548,24571,24600,24718,24719,24720,24721,24817,24818,24819,24820,24821,24877,24878,24879,24880,24881,24882,24891,
24892,24893,25E3,25231,25391,25392,25393,25394,25395,25828,25829,25830,25831,25832,25833,25834,25835,25836,25837,25838,25884,25932,26191,26192,26193,26194,26195,26237,26331,26332,26391,26392,26393,26432,26591,26592,26632,26692,26701,26702,26703,26704,26705,26706,26707,26708,26709,26710,26711,26712,26713,26714,26715,26716,26717,26718,26719,26720,26721,26722,26729,26730,26731,26732,26733,26734,26735,26736,26737,26738,26739,26740,26741,26742,26743,26744,26745,26746,26747,26748,26749,26750,26751,26752,
26753,26754,26755,26756,26757,26758,26759,26760,26761,26762,26763,26764,26765,26766,26767,26768,26769,26770,26771,26772,26773,26774,26775,26776,26777,26778,26779,26780,26781,26782,26783,26784,26785,26786,26787,26788,26789,26790,26791,26792,26793,26794,26795,26796,26797,26798,26799,26801,26802,26803,26811,26812,26813,26847,26848,26849,26850,26851,26852,26853,26854,26855,26856,26857,26858,26859,26860,26861,26862,26863,26864,26865,26866,26867,26868,26869,26870,26891,26892,26893,26894,26895,26896,26897,
26898,26899,26901,26902,26903,26904,26905,26906,26907,26908,26909,26910,26911,26912,26913,26914,26915,26916,26917,26918,26919,26920,26921,26922,26923,26929,26930,26931,26932,26933,26934,26935,26936,26937,26938,26939,26940,26941,26942,26943,26944,26945,26946,26948,26949,26950,26951,26952,26953,26954,26955,26956,26957,26958,26959,26960,26961,26962,26963,26964,26965,26966,26967,26968,26969,26970,26971,26972,26973,26974,26975,26976,26977,26978,26979,26980,26981,26982,26983,26984,26985,26986,26987,26988,
26989,26990,26991,26992,26993,26994,26995,26996,26997,26998,27037,27038,27039,27040,27120,27200,27205,27206,27207,27208,27209,27210,27211,27212,27213,27214,27215,27216,27217,27218,27219,27220,27221,27222,27223,27224,27225,27226,27227,27228,27229,27230,27231,27232,27258,27259,27260,27291,27292,27391,27392,27393,27394,27395,27396,27397,27398,27429,27492,27493,27500,27561,27562,27563,27564,27571,27572,27573,27574,27581,27582,27583,27584,27591,27592,27593,27594,27700,28191,28192,28193,28232,28348,28349,
28350,28351,28352,28353,28354,28355,28356,28357,28358,28402,28403,28404,28405,28406,28407,28408,28409,28410,28411,28412,28413,28414,28415,28416,28417,28418,28419,28420,28421,28422,28423,28424,28425,28426,28427,28428,28429,28430,28431,28432,28462,28463,28464,28465,28466,28467,28468,28469,28470,28471,28472,28473,28474,28475,28476,28477,28478,28479,28480,28481,28482,28483,28484,28485,28486,28487,28488,28489,28490,28491,28492,28600,28991,28992,29100,29101,29118,29119,29120,29121,29122,29168,29169,29170,
29171,29172,29177,29178,29179,29180,29181,29182,29183,29184,29185,29187,29188,29189,29190,29191,29192,29193,29194,29195,29220,29221,29333,29635,29636,29701,29738,29739,29849,29850,29871,29872,29873,29900,29901,29902,29903,30161,30162,30163,30164,30165,30166,30167,30168,30169,30170,30171,30172,30173,30174,30175,30176,30177,30178,30179,30200,30339,30340,30491,30492,30493,30494,30591,30592,30729,30730,30731,30732,30791,30792,30800,31028,31121,31154,31170,31171,31251,31252,31253,31254,31255,31256,31257,
31258,31259,31265,31266,31267,31268,31275,31276,31277,31278,31279,31281,31282,31283,31284,31285,31286,31287,31288,31289,31290,31291,31292,31293,31294,31295,31296,31297,31370,31461,31462,31463,31464,31465,31466,31467,31468,31469,31491,31492,31493,31494,31495,31528,31529,31600,31700,31838,31839,31900,31901,31917,31918,31919,31920,31921,31922,31965,31966,31967,31968,31969,31970,31971,31972,31973,31974,31975,31976,31977,31978,31979,31980,31981,31982,31983,31984,31985,31986,31987,31988,31989,31990,31991,
31992,31993,31994,31995,31996,31997,31998,31999,32E3,32001,32002,32003,32005,32006,32007,32008,32009,32010,32011,32012,32013,32014,32015,32016,32017,32018,32019,32020,32021,32022,32023,32024,32025,32026,32027,32028,32029,32030,32031,32033,32034,32035,32036,32037,32038,32039,32040,32041,32042,32043,32044,32045,32046,32047,32048,32049,32050,32051,32052,32053,32054,32055,32056,32057,32058,32059,32060,32061,32062,32064,32065,32066,32067,32074,32075,32076,32077,32081,32082,32083,32084,32085,32086,32098,
32099,32100,32104,32107,32108,32109,32110,32111,32112,32113,32114,32115,32116,32117,32118,32119,32120,32121,32122,32123,32124,32125,32126,32127,32128,32129,32130,32133,32134,32135,32136,32137,32138,32139,32140,32141,32142,32143,32144,32145,32146,32147,32148,32149,32150,32151,32152,32153,32154,32155,32156,32157,32158,32161,32164,32165,32166,32167,32180,32181,32182,32183,32184,32185,32186,32187,32188,32189,32190,32191,32192,32193,32194,32195,32196,32197,32198,32199,32201,32202,32203,32204,32205,32206,
32207,32208,32209,32210,32211,32212,32213,32214,32215,32216,32217,32218,32219,32220,32221,32222,32223,32224,32225,32226,32227,32228,32229,32230,32231,32232,32233,32234,32235,32236,32237,32238,32239,32240,32241,32242,32243,32244,32245,32246,32247,32248,32249,32250,32251,32252,32253,32254,32255,32256,32257,32258,32259,32260,32301,32302,32303,32304,32305,32306,32307,32308,32309,32310,32311,32312,32313,32314,32315,32316,32317,32318,32319,32320,32321,32322,32323,32324,32325,32326,32327,32328,32329,32330,
32331,32332,32333,32334,32335,32336,32337,32338,32339,32340,32341,32342,32343,32344,32345,32346,32347,32348,32349,32350,32351,32352,32353,32354,32355,32356,32357,32358,32359,32360,32601,32602,32603,32604,32605,32606,32607,32608,32609,32610,32611,32612,32613,32614,32615,32616,32617,32618,32619,32620,32621,32622,32623,32624,32625,32626,32627,32628,32629,32630,32631,32632,32633,32634,32635,32636,32637,32638,32639,32640,32641,32642,32643,32644,32645,32646,32647,32648,32649,32650,32651,32652,32653,32654,
32655,32656,32657,32658,32659,32660,32661,32662,32664,32665,32666,32667,32701,32702,32703,32704,32705,32706,32707,32708,32709,32710,32711,32712,32713,32714,32715,32716,32717,32718,32719,32720,32721,32722,32723,32724,32725,32726,32727,32728,32729,32730,32731,32732,32733,32734,32735,32736,32737,32738,32739,32740,32741,32742,32743,32744,32745,32746,32747,32748,32749,32750,32751,32752,32753,32754,32755,32756,32757,32758,32759,32760,32761,32766,53001,53002,53003,53004,53008,53009,53010,53011,53012,53013,
53014,53015,53016,53017,53018,53019,53021,53022,53023,53024,53025,53026,53027,53028,53029,53030,53031,53032,53034,53042,53043,53044,53045,53046,53048,53049,53074,53075,53076,53077,53078,53079,53080,54001,54002,54003,54004,54008,54009,54010,54011,54012,54013,54014,54015,54016,54017,54018,54019,54021,54022,54023,54024,54025,54026,54027,54028,54029,54030,54031,54032,54034,54042,54043,54044,54045,54046,54048,54049,54050,54051,54052,54053,54074,54075,54076,54077,54078,54079,54080,65061,65062,65161,65163,
102001,102002,102003,102004,102005,102006,102007,102008,102009,102010,102011,102012,102013,102014,102015,102016,102017,102018,102019,102020,102021,102022,102023,102024,102025,102026,102027,102028,102029,102030,102031,102032,102033,102034,102035,102036,102037,102038,102039,102040,102041,102042,102043,102044,102045,102046,102047,102048,102049,102050,102051,102052,102053,102054,102055,102056,102057,102058,102059,102060,102061,102062,102063,102064,102065,102066,102067,102068,102069,102070,102071,102072,
102073,102074,102075,102076,102077,102078,102079,102080,102081,102082,102083,102084,102085,102086,102087,102088,102089,102090,102091,102092,102093,102094,102095,102096,102097,102098,102099,102100,102101,102102,102103,102104,102105,102106,102107,102108,102109,102110,102111,102112,102113,102114,102115,102116,102117,102118,102119,102120,102121,102122,102123,102124,102125,102126,102127,102128,102129,102130,102131,102132,102133,102134,102135,102136,102137,102138,102139,102140,102141,102142,102143,102144,
102145,102146,102147,102148,102149,102150,102151,102152,102153,102154,102155,102156,102157,102158,102159,102160,102161,102162,102163,102164,102165,102166,102167,102168,102169,102170,102171,102172,102173,102174,102175,102176,102177,102178,102179,102180,102181,102182,102183,102184,102185,102186,102187,102188,102189,102190,102191,102192,102193,102194,102195,102196,102197,102198,102199,102200,102201,102202,102203,102204,102205,102206,102207,102208,102209,102210,102211,102212,102213,102214,102215,102216,
102217,102218,102219,102220,102221,102222,102223,102224,102225,102226,102227,102228,102229,102230,102231,102232,102233,102234,102235,102236,102237,102238,102239,102240,102241,102242,102243,102244,102245,102246,102247,102248,102249,102250,102251,102252,102253,102254,102255,102256,102257,102258,102259,102260,102261,102262,102263,102264,102265,102266,102267,102268,102269,102270,102271,102272,102273,102274,102275,102276,102277,102278,102279,102280,102281,102282,102283,102284,102285,102286,102287,102288,
102289,102290,102291,102292,102293,102294,102295,102296,102297,102298,102299,102300,102301,102302,102303,102304,102305,102306,102307,102308,102309,102310,102311,102312,102313,102314,102315,102316,102317,102318,102319,102320,102321,102322,102323,102324,102325,102326,102327,102328,102329,102330,102331,102332,102333,102334,102335,102336,102337,102338,102339,102340,102341,102342,102343,102344,102345,102346,102347,102348,102349,102350,102351,102352,102353,102354,102355,102356,102357,102358,102359,102360,
102361,102362,102363,102364,102365,102366,102367,102368,102369,102370,102371,102372,102373,102374,102375,102376,102377,102378,102379,102380,102381,102382,102383,102384,102385,102386,102387,102388,102389,102390,102391,102392,102393,102394,102395,102396,102397,102398,102399,102400,102401,102402,102403,102404,102405,102406,102407,102408,102409,102410,102411,102412,102413,102414,102415,102416,102417,102418,102419,102420,102421,102422,102423,102424,102425,102426,102427,102428,102429,102430,102431,102432,
102433,102434,102435,102436,102437,102438,102439,102440,102441,102442,102443,102444,102445,102446,102447,102448,102449,102450,102451,102452,102453,102454,102455,102456,102457,102458,102459,102460,102461,102462,102463,102464,102465,102466,102467,102468,102469,102470,102471,102472,102473,102474,102475,102476,102477,102478,102479,102480,102481,102482,102483,102484,102485,102486,102487,102488,102489,102490,102491,102492,102493,102494,102495,102496,102500,102501,102502,102503,102504,102505,102506,102507,
102508,102509,102510,102511,102512,102513,102514,102515,102516,102517,102518,102519,102520,102521,102522,102523,102524,102525,102526,102527,102528,102529,102530,102531,102532,102533,102534,102535,102536,102537,102538,102539,102540,102541,102542,102543,102544,102545,102546,102547,102548,102549,102550,102551,102552,102553,102554,102555,102556,102557,102558,102559,102560,102561,102570,102571,102572,102573,102574,102575,102576,102577,102578,102579,102580,102581,102582,102583,102584,102585,102586,102587,
102588,102589,102590,102591,102592,102593,102594,102595,102596,102597,102598,102599,102600,102601,102602,102603,102604,102605,102606,102607,102608,102609,102610,102611,102612,102613,102614,102615,102616,102617,102618,102619,102620,102621,102622,102623,102624,102625,102626,102627,102628,102629,102630,102631,102632,102633,102634,102635,102636,102637,102638,102639,102640,102641,102642,102643,102644,102645,102646,102647,102648,102649,102650,102651,102652,102653,102654,102655,102656,102657,102658,102659,
102660,102661,102662,102663,102664,102665,102666,102667,102668,102669,102670,102671,102672,102673,102674,102675,102676,102677,102678,102679,102680,102681,102682,102683,102684,102685,102686,102687,102688,102689,102690,102691,102692,102693,102694,102695,102696,102697,102698,102699,102700,102701,102702,102703,102704,102705,102706,102707,102708,102709,102710,102711,102712,102713,102714,102715,102716,102717,102718,102719,102720,102721,102722,102723,102724,102725,102726,102727,102728,102729,102730,102733,
102734,102735,102736,102737,102738,102739,102740,102741,102742,102743,102744,102745,102746,102747,102748,102749,102750,102751,102752,102753,102754,102755,102756,102757,102758,102761,102762,102763,102764,102765,102766,102767,102768,102769,102770,102771,102772,102773,102774,102775,102776,102777,102778,102779,102780,102781,102782,102783,102784,102785,102786,102787,102788,102789,102790,102791,102792,102793,102794,102795,102796,102797,102798,102962,102963,102965,102966,102967,102968,102969,102970,102971,
102972,102973,102974,102975,102976,102977,102978,102979,102980,102981,102982,102983,102984,102985,102986,102987,102988,102989,102990,102991,102992,102993,102994,102995,102996,102997,102998,102999,103E3,103001,103002,103003,103004,103005,103006,103007,103008,103009,103010,103011,103012,103013,103014,103015,103016,103017,103018,103019,103020,103021,103022,103023,103024,103025,103026,103027,103028,103029,103030,103031,103032,103033,103034,103035,103036,103037,103038,103039,103040,103041,103042,103043,
103044,103045,103046,103047,103048,103049,103050,103051,103052,103053,103054,103055,103056,103057,103058,103059,103060,103061,103062,103063,103064,103065,103066,103067,103068,103069,103070,103071,103072,103073,103074,103075,103076,103077,103078,103079,103080,103081,103082,103083,103084,103085,103086,103087,103088,103089,103090,103091,103092,103093,103094,103095,103096,103097,103098,103099,103100,103101,103102,103103,103104,103105,103106,103107,103108,103109,103110,103111,103112,103113,103114,103115,
103116,103117,103118,103119,103120,103121,103122,103123,103124,103125,103126,103127,103128,103129,103130,103131,103132,103133,103134,103135,103136,103137,103138,103139,103140,103141,103142,103143,103144,103145,103146,103147,103148,103149,103150,103151,103152,103153,103154,103155,103156,103157,103158,103159,103160,103161,103162,103163,103164,103165,103166,103167,103168,103169,103170,103171,103172,103173,103174,103175,103176,103177,103178,103179,103180,103181,103182,103183,103184,103185,103186,103187,
103188,103189,103190,103191,103192,103193,103194,103195,103196,103197,103198,103199,103200,103201,103202,103203,103204,103205,103206,103207,103208,103209,103210,103211,103212,103213,103214,103215,103216,103217,103218,103219,103220,103221,103222,103223,103224,103225,103226,103227,103228,103229,103230,103231,103232,103233,103234,103235,103236,103237,103238,103239,103240,103241,103242,103243,103244,103245,103246,103247,103248,103249,103250,103251,103252,103253,103254,103255,103256,103257,103258,103259,
103260,103261,103262,103263,103264,103265,103266,103267,103268,103269,103270,103271,103272,103273,103274,103275,103276,103277,103278,103279,103280,103281,103282,103283,103284,103285,103286,103287,103288,103289,103290,103291,103292,103293,103294,103295,103296,103297,103298,103299,103300,103301,103302,103303,103304,103305,103306,103307,103308,103309,103310,103311,103312,103313,103314,103315,103316,103317,103318,103319,103320,103321,103322,103323,103324,103325,103326,103327,103328,103329,103330,103331,
103332,103333,103334,103335,103336,103337,103338,103339,103340,103341,103342,103343,103344,103345,103346,103347,103348,103349,103350,103351,103352,103353,103354,103355,103356,103357,103358,103359,103360,103361,103362,103363,103364,103365,103366,103367,103368,103369,103370,103371,103372,103373,103374,103375,103376,103377,103378,103379,103380,103381,103382,103383,103384,103385,103386,103387,103388,103389,103390,103391,103392,103393,103394,103395,103396,103397,103398,103399,103400,103401,103402,103403,
103404,103405,103406,103407,103408,103409,103410,103411,103412,103413,103414,103415,103416,103417,103418,103419,103420,103421,103422,103423,103424,103425,103426,103427,103428,103429,103430,103431,103432,103433,103434,103435,103436,103437,103438,103439,103440,103441,103442,103443,103444,103445,103446,103447,103448,103449,103450,103451,103452,103453,103454,103455,103456,103457,103458,103459,103460,103461,103462,103463,103464,103465,103466,103467,103468,103469,103470,103471,103472,103473,103474,103475,
103476,103477,103478,103479,103480,103481,103482,103483,103484,103485,103486,103487,103488,103489,103490,103491,103492,103493,103494,103495,103496,103497,103498,103499,103500,103501,103502,103503,103504,103505,103506,103507,103508,103509,103510,103511,103512,103513,103514,103515,103516,103517,103518,103519,103520,103521,103522,103523,103524,103525,103526,103527,103528,103529,103530,103531,103532,103533,103534,103535,103536,103537,103538,103539,103540,103541,103542,103543,103544,103545,103546,103547,
103548,103549,103550,103551,103552,103553,103554,103555,103556,103557,103558,103559,103560,103561,103562,103563,103564,103565,103566,103567,103568,103569,103570,103571,103572,103573,103574,103575,103576,103577,103578,103579,103580,103581,103582,103583,103584,103585,103600,103601,103602,103603,103604,103605,103606,103607,103608,103609,103610,103611,103612,103613,103614,103615,103616,103617,103618,103619,103620,103621,103622,103623,103624,103625,103626,103627,103628,103629,103630,103631,103632,103633,
103634,103635,103636,103637,103638,103639,103640,103641,103642,103643,103644,103645,103646,103647,103648,103649,103650,103651,103652,103653,103654,103655,103656,103657,103658,103659,103660,103661,103662,103663,103664,103665,103666,103667,103668,103669,103670,103671,103672,103673,103674,103675,103676,103677,103678,103679,103680,103681,103682,103683,103684,103685,103686,103687,103688,103689,103690,103691,103692,103693,103694,103695,103700,103701,103702,103703,103704,103705,103706,103707,103708,103709,
103710,103711,103712,103713,103714,103715,103716,103717,103718,103719,103720,103721,103722,103723,103724,103725,103726,103727,103728,103729,103730,103731,103732,103733,103734,103735,103736,103737,103738,103739,103740,103741,103742,103743,103744,103745,103746,103747,103748,103749,103750,103751,103752,103753,103754,103755,103756,103757,103758,103759,103760,103761,103762,103763,103764,103765,103766,103767,103768,103769,103770,103771,103772,103773,103774,103775,103776,103777,103778,103779,103780,103781,
103782,103783,103784,103785,103786,103787,103788,103789,103790,103791,103792,103793,103794,103795,103796,103797,103798,103799,103800,103801,103802,103803,103804,103805,103806,103807,103808,103809,103810,103811,103812,103813,103814,103815,103816,103817,103818,103819,103820,103821,103822,103823,103824,103825,103826,103827,103828,103829,103830,103831,103832,103833,103834,103835,103836,103837,103838,103839,103840,103841,103842,103843,103844,103845,103846,103847,103848,103849,103850,103851,103852,103853,
103854,103855,103856,103857,103858,103859,103860,103861,103862,103863,103864,103865,103866,103867,103868,103869,103870,103871,103900,103901,103902,103903,103904,103905,103906,103907,103908,103909,103910,103911,103912,103913,103914,103915,103916,103917,103918,103919,103920,103921,103922,103923,103924,103925,103926,103927,103928,103929,103930,103931,103932,103933,103934,103935,103936,103937,103938,103939,103940,103941,103942,103943,103944,103945,103946,103947,103948,103949,103950,103951,103952,103953,
103954,103955,103956,103957,103958,103959,103960,103961,103962,103963,103964,103965,103966,103967,103968,103969,103970,103971];k("extend-esri")&&H.setObject("dijit.analysis.PCSList",r,n);return r})},"esri/layers/RasterXLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/dom-construct dojo/dom-style dojo/on dojox/gfx/matrix dojo/when dojo/DeferredList ../kernel ../config ../lang ../domUtils ../urlUtils ../graphic ../request ../renderers/ClassBreaksRenderer ../renderers/StretchRenderer ../renderers/UniqueValueRenderer ../renderers/ColormapRenderer ../renderers/ShadedReliefRenderer ../geometry/Extent ../SpatialReference ../geometry/Point ./Field ./TimeInfo ./MosaicRule ./DimensionalDefinition ./PixelBlock ./ImageServiceLayerMixin ./rasterLib/raster/rasterFactory ./rasterLib/raster/rasterProjectionHelper ./rasterLib/renderer/rasterRendererHelper ./rasterLib/tile/RasterTileInfo ./rasterLib/tile/RasterTileManager ./rasterLib/tile/RasterHandler ./layer".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I,K,Q,N,T,W,X,ea,fa,J,V,aa){var Z=h.defaults.map.zoomDuration;H=H([aa],{declaredClass:"esri.layers.RasterXLayer",managedSuspension:!0,opacity:1,tileMode:!0,useWebGL:!0,drawMode:!0,_eventMap:{"raster-change":!0,"renderer-change":!0},_lastPopup:[],_rasterFieldPrefix:"Raster.",_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(L,O){O=O||{};this.tileMode=null!=O.tileMode?O.tileMode:this.tileMode;this.useWebGL=null!=
O.useWebGL?O.useWebGL:this.useWebGL;this.roaming=null!=O.roaming?O.roaming:this.roaming;this.drawMode=null!=O.drawMode?O.drawMode:this.drawMode;this.bandIds=O.bandIds&&0<O.bandIds.length?O.bandIds:null;this.renderer=O.renderer;this._customModules=O.customModules;this.useMapTime=O.useMapTime;if(O.multidimensionalDefinition&&0<O.multidimensionalDefinition.length){var D=new K;D.multidimensionalDefinition=O.multidimensionalDefinition.map(function(P){return P.toJson?P:new Q(P)});D.method=K.METHOD_NONE;
this.mosaicRule=D}this.infoTemplate=O.infoTemplate;this.drawMode||(this._contextType=O._contextType||O.drawType);this._supportLegacyPropMethods=!1!==O.legacySupport;this._rasterHandler=new V({customModules:this._customModules});this._workInitPromise=this._rasterHandler.start();this.pixelData=null;this._initialize(L,O);c(this,"load",k.hitch(this,function(){e(this._rasterHandler._connected||this._rasterHandler._connectionPromise,k.hitch(this,function(){this._rasterHandler.setLayer({layerId:this.id,
raster:{rasterInfo:this.raster.rasterInfo,rasterFunction:this.raster.rasterFunction&&this.raster.rasterFunction.toJson()},bandCount:this.raster.rasterInfo.bandCount});this.raster.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this.id,data:this.raster.rasterFunction.toJson(!0)});this._rasterRenderer&&this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)})}))}));this._animatePan2d=k.hitch(this,this._animatePan2d)},setOpacity:function(L){this.opacity!==
L&&(this.opacity=L,this.onOpacityChange(L))},onOpacityChange:function(){},onRendererChange:function(){},refresh:function(){if(this.loaded&&this._map)if(!this._canDraw()||10>l("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(L,O,D,P){this._canDraw()&&(this.useWebGL||(D?this._context.clearRect(L,O,D,P):this._context.clearRect(0,0,this._map.width,this._map.height)))},getContext:function(){return this._context},
onResume:function(){this.inherited(arguments);this._toggleTime();q.show(this._div);if("css-transforms"===this._map.navigationMode){var L=this._map.__visibleDelta;this._left=this._tdx=L.x;this._top=this._tdy=L.y;a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(k.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._fireUpdateEnd();this._toggleTime();
q.hide(this._div);clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!1);var L=this.tileMode?this.tileManager.originalPixelData:this.originalPixelData;if(this.tileMode?L&&(L.src||L.texture):L)if(this.tileMode)if(this.useWebGL)this._updateAllTilesOnce(L);else{this.tileManager.tiles.forEach(function(D){D&&(D.update=null,D.completed=!1,D.processedPixelBlock=null,D.renderedPixelBlock=null)});L.processedPixelBlock=
null;var O=this.raster.rasterFunction?this.raster.rasterFunction.read(L):{extent:L.extent,pixelBlock:L.src[this.tileManager.identifiers[0]]&&L.src[this.tileManager.identifiers[0]].pixelBlock};L.renderedPixelBlock=null;L=this._rasterRenderer?this._rasterRenderer.draw(O):O;this._drawOneFrame(L)}else this._supportLegacyPropMethods&&this.pixelFilter?this._setPixelData(this.originalPixelData):(L.processedPixelBlock=null,O=this.raster.rasterFunction?this.raster.rasterFunction.read(L):{extent:L.extent,pixelBlock:L.src?
L.src[this.tileManager.identifiers[0]]&&L.src[this.tileManager.identifiers[0]].pixelBlock:L.pixelBlock},L.renderedPixelBlock=null,L=this._rasterRenderer?this._rasterRenderer.draw(O):O,this._drawOneFrame(L))},getCurrentResolution:function(){var L=this._map.extent;return new z((L.xmax-L.xmin)/this._map.width,(L.ymax-L.ymin)/this._map.height,L.spatialReference)},getCustomRasterFields:function(L){var O=L?L.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix,D={name:this._rasterFieldPrefix+"ServicePixelValue",
alias:"Pixel Value",domain:null,editable:!1,length:50,type:10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString"};L=this.fields?k.clone(this.fields):[];L.push(D);(D=this.rasterAttributeTable&&this.rasterAttributeTable.fields)&&0<D.length&&(D=r.filter(D,function(P){return"esriFieldTypeOID"!==P.type&&"value"!==P.name.toLowerCase()}),D=r.map(D,function(P){var R=k.clone(P);R.name=O+P.name;return R}),L=L.concat(D));return L},setRenderer:function(L,O){if(this.loaded&&L){if(L.declaredClass&&-1<
L.declaredClass.indexOf("esri.layers.rasterLib")){this._rasterRenderer=L;this._rasterRenderer.bind({layer:this});var D=this.bandIds=L.bandIndex;this.raster&&this.raster.setFetchParameters({bandIds:D});this._params&&(this._params.bandIds=D&&0<D.length?D.join(","):null);this.renderer=this._getCommonRenderer(L)}else D=k.clone(L.toJson?L.toJson():L),"rasterStretch"===D.type&&(D.bandIndex=this.bandIds,D.bandIndex&&1<D.bandIndex.length||!D.bandIndex&&this.raster&&1<this.raster.rasterInfo.bandCount)&&(D.type=
"rgb"),this._rasterRenderer=ea.create(D),this.renderer=L.declaredClass?L:this._getCommonRenderer(this._rasterRenderer),this._rasterRenderer.bind({layer:this});if(this._map){if(this.loaded&&this._rasterHandler._connected){var P=this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)});this._updateTilingEffects()}O||(P?P.then(k.hitch(this,function(){this.redraw()})):this.redraw());this.onRendererChange()}}},setBandIds:function(L,O){this.bandIds=L;this.raster&&this.raster.setFetchParameters({bandIds:L});
this._params&&(this._params.bandIds=L&&0<L.length?L.join(","):null);this.setRenderer(this.renderer,O)},_setTime:function(L){L=L?L.toJson():null;this._params&&(this._params.time=L);this.raster.setFetchParameters({time:L});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles()},setInfoTemplate:function(L){this.infoTemplate=L;this._updateInfoTemplateFields(this.fields)},setMultiDimensionalDefinition:function(L,O){var D=L&&L.multidimensionalDefinition;if(D&&this.loaded){var P=D&&D[0].variableName;
""===P&&(P=this._multidimensionalInfo.variables[0].name,D.forEach(function(ca){ca.variableName=P}));if("ImageService"===this.raster.sourceType){var R=this.raster._getAllDimensionDefinition(D,P);R.defChanged&&(L.multidimensionalDefinition=R.definition,this.setMosaicRule(L,!0))}this.raster.setFetchParameters({multidimensionalDefinition:D});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles();P&&this._updateRasterInfo(P);O||this.refresh()}},_updateRasterInfo:function(L){var O=this.raster.rasterInfo,
D=this.getHistograms(L);L=this.getStatistics(L);(new g([D,L])).then(k.hitch(this,function(P){P[0][0]&&(O.histograms=P[0][1].histograms);P[1][0]&&(O.statistics=P[1][1]);this.refresh()}))},_updateInfoTemplateFields:function(L){if(L&&!(1>L.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var O,D;var P=this.infoTemplate.info.fieldInfos;for(O=0;O<L.length;O++){var R=L[O];for(D=0;D<P.length;D++)if(P[D].fieldName.toLowerCase()===
R.name.toLowerCase()&&P[D].fieldName!==R.name){P[D].fieldName=R.name;break}}}},getPixelData:function(L){return this.tileMode?L?this.tileManager&&this.tileManager.originalPixelData&&this.tileManager.originalPixelData.src&&this.tileManager.originalPixelData.src[this.tileManager.identifiers[0]]:null:this.inherited(arguments)},fetchPopupFromTiles:function(L){var O=new m;this.identify(L.geometry).then(function(D){var P=D.pixelValue;this.hasStdTime()&&P&&P.length&&null!=P[0]&&(P=P.map(function(ha){return this.getStdTimeValue(ha)}.bind(this)).join(", "));
if(P){D={ObjectId:0,"Raster.ServicePixelValue":P};var R=this.rasterAttributeTable&&this.rasterAttributeTable.features;if(R&&0<R.length&&(R=r.filter(R,function(ha){if(ha&&ha.attributes)return ha.attributes.hasOwnProperty("Value")?ha.attributes.Value==P:ha.attributes.VALUE==P}),0<R.length&&(R=k.clone(R[0]))))for(var ca in R.attributes)R.attributes.hasOwnProperty(ca)&&(D[this._rasterFieldPrefix+ca]=R.attributes[ca]);ca=new v(new w(this.projectedFullExtent||this.fullExtent),null,D);ca.setInfoTemplate(this.infoTemplate);
ca._layer=this;this._lastPopup=[ca];O.resolve([ca])}else this._lastPopup=[],O.resolve()}.bind(this),function(D){this._lastPopup=[];O.resolve(D)});return O},getPopupFromTiles:function(){return this._lastPopup},identify:function(L,O){return this.raster?this.raster.identify(L):(L=new m,L.reject("layer must be initialized to identify"),L.promise)},_getCommonRenderer:function(L){switch(L.rendererName){case "RGB":case "Stretch":return new C(L.toCommonRendererJson());case "UniqueValue":return new B(L.toCommonRendererJson());
case "ClassBreaks":return new x(L.toCommonRendererJson());case "Colormap":return new F(L.toCommonRendererJson());case "ShadedRelief":return new y(L.toCommonRendererJson())}},_getProjectedFullExtent:function(L){return this.raster.getProjectedFullExtent(L).then(k.hitch(this,function(O){this.projectedFullExtent=O}))},_initialize:function(L,O){O=O||{};this._supportLegacyPropMethods&&this.constructor._onMap&&(this.constructor._onMap["rendering-change"]={method:"onRenderingChange"},this.constructor._onMap["mosaic-rule-change"]=
{method:"onMosaicRuleChange"},this.constructor._onMap["spatial-reference-change"]={method:"onSpatialReferenceChange"});this.raster={};var D=O.raster?O.raster.url:L;D&&-1<D.toLowerCase().indexOf("/imageserver")&&this._supportLegacyPropMethods&&this._addLegacySupport(D,O);var P=k.hitch(this,function(){this.loaded=!0;this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length&&this.setMultiDimensionalDefinition(this.mosaicRule,!0);this.raster._setRasterHandler(this._rasterHandler);
this.onLoad(this);var R=this._loadCallback;R&&(delete this._loadCallback,R(this))});(L?W.create(k.mixin({url:L},O)):O.raster&&O.raster.open()).then(k.hitch(this,function(R){if(R){this.raster=R;var ca=this._getSourceImageServiceRaster();this.url||(this.url=ca&&ca.url);this.url&&(this._url=u.urlToObject(L));var ha=O.minScale,oa=O.maxScale,ma=R.tileInfo&&"Raster"===R.tileInfo.tileType;null==oa&&(oa=ma&&O.zoomFactor?R.tileInfo.lods[R.tileInfo.lods.length-1].scale/O.zoomFactor:this.maxScale);null==ha&&
(ha=ma&&O.zoomFactor?R.tileInfo.lods[0].scale*O.zoomFactor:this.minScale);ca&&"ImageService"===ca.sourceType&&this._supportLegacyPropMethods&&this._addGeneralProperties(L,O);this.initialExtent=this.fullExtent=this.extent=this.raster.rasterInfo.extent;this.spatialReference=this.extent.spatialReference;this.timeInfo=this.raster.rasterInfo.timeInfo?new I(this.raster.rasterInfo.timeInfo):null;this.rasterAttributeTable=this.raster.rasterInfo.vat;this._multidimensionalInfo=this.raster.rasterInfo.multidimensionalInfo;
this.rasterAttributeTable&&(this._rasterAttributeTableFields=this.rasterAttributeTable.fields);this.mosaicRule&&this.raster.setFetchParameters({multidimensionalDefinition:this.mosaicRule.multidimensionalDefinition});this._multidimensionalInfo&&(this._getDefaultMultidimensionalDefinition(this._multidimensionalInfo,!0,!0),this.mosaicRule||(this.mosaicRule=this.defaultMosaicRule,this.raster.setFetchParameters({multidimensionalDefinition:this._defaultMultidimensionalDefinition})),this.raster.defaultMultidimensionalDefinition=
this._defaultMultidimensionalDefinition);null==ha||this._hasMin||this.setMinScale(ha);null==oa||this._hasMax||this.setMaxScale(oa);this._workInitPromise?this._workInitPromise.then(P,P):P()}else console.error("cannot create rasterx layer as the raster data source cannot be opened")}),this._errorHandler)},_getSourceImageServiceRaster:function(){var L=this.raster&&"Function"===this.raster.sourceType?1===this.raster.getMemberRasters().length?this.raster.getMemberRasters()[0]:null:this.raster;if(L&&"ImageService"===
L.sourceType)return L},_addLegacySupport:function(L,O){this._url=u.urlToObject(L);O=O||{};this.format=(L=O.imageServiceParameters)&&L.format;this.compressionTolerance=L&&L.compressionTolerance?L.compressionTolerance:.01;this.interpolation=L?L.interpolation:null;this.compressionQuality=L?L.compressionQuality:null;this.bandIds=L&&L.bandIds||O&&O.bandIds||null;this.mosaicRule||(this.mosaicRule=L?L.mosaicRule:null);this.renderingRule||(this.renderingRule=L?L.renderingRule:null);this.useMapDimensionValue=
O.hasOwnProperty("useMapDimensionValue")?!!O.useMapDimensionValue:!0;this.hasImageFilter=O.hasImageFilter;this.activeMapDimensions=O.activeMapDimensions;this._params=k.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},L?L.toJson():{});this.pixelFilter=O.pixelFilter;this.originalPixelData=this.pixelData=null;this._queryVisibleRastersHandler=k.hitch(this,this._queryVisibleRastersHandler);
this._useRenderingRuleAttributeTable=!1;this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this._setDefaultFilter=function(){};var D={setInterpolation:"interpolation",setCompressionQuality:"compressionQuality",setCompressionTolerance:"compressionTolerance",setBandIds:"bandIds",setDefaultBandIds:"bandIds",setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setImageFormat:"format"},P,R=new T;Object.keys(D).forEach(k.hitch(this,function(ca){this[ca]=k.hitch(this,function(ha,
oa){P={};P[D[ca]]=ha;this.raster&&(this.raster.setFetchParameters(P),R[ca].bind(this)(ha,oa))})}));this.setDisableClientCaching=function(ca){R.setDisableClientCaching.bind(this)(ca);var ha=this._getSourceImageServiceRaster();ha?ha.disableClientCaching=ca:null}.bind(this);this.setDefinitionExpression=R.setDefinitionExpression.bind(this);this.setUseMapTime=R.setUseMapTime.bind(this);this._toggleTime=R._toggleTime.bind(this);this._onTimeExtentChangeHandler=R._onTimeExtentChangeHandler.bind(this);this.setPixelFilter=
R.setPixelFilter.bind(this);this.getHistograms=R.getHistograms.bind(this);this.getRasterFunctionInfos=R.getRasterFunctionInfos.bind(this);this.getKeyProperties=R.getKeyProperties.bind(this);this.getRasterAttributeTable=R.getRasterAttributeTable.bind(this);this.getRenderingRuleServiceInfo=R.getRenderingRuleServiceInfo.bind(this);this._getRenderingRuleId=R._getRenderingRuleId.bind(this);this._isRenderingRuleAProcessingTemplate=R._isRenderingRuleAProcessingTemplate.bind(this);this.handleSpatialReferenceChange=
R.handleSpatialReferenceChange.bind(this);this.onRenderingChange=this.onRenderingChange||function(){};this.onSpatialReferenceChange=this.onSpatialReferenceChange||function(){};this.onMosaicRuleChange=this.onMosaicRuleChange||function(ca){};this.setRasterRenderer=this.setRenderer;this.getMultidimensionalInfo=R.getMultidimensionalInfo.bind(this);this.getColormap=R.getColormap.bind(this);this.getRenderingRuleColormap=R.getRenderingRuleColormap.bind(this);this.getDefaultMultidimensionalDefinition=R.getDefaultMultidimensionalDefinition.bind(this);
this._getDefaultMultidimensionalDefinition=R._getDefaultMultidimensionalDefinition.bind(this);this._getDefaultDimensionValue=R._getDefaultDimensionValue.bind(this);this.getStatistics=R.getStatistics.bind(this)},_addGeneralProperties:function(){var L=this._getSourceImageServiceRaster();if(L){var O=["minScale","maxScale","tileInfo"];Object.keys(L.serviceInfo).forEach(function(R){null==this[R]&&-1===O.indexOf(R)&&(this[R]=L.serviceInfo[R])}.bind(this));this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=
parseFloat(this.pixelSizeY);this.bands=L.rasterInfo.statistics;var D,P=[];this.fields=this.fields||[];for(D=0;D<this.fields.length;D++)P.push(new G(this.fields[D]));this.fields=P;this.version=this.currentVersion;this.defaultMosaicRule=L.serviceInfo.defaultMosaicRule}},setDefaultRenderer:function(){if(this.loaded&&this._canvas&&!this.pixelFilter){var L=ea.createDefaultRenderer(this);if(null!=L){var O=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length;
if(this._multidimensionalInfo&&O&&"Stretch"===L.rendererName){var D=this.mosaicRule.multidimensionalDefinition[0].variableName;(O=this._multidimensionalInfo.variables.filter(function(P){return P.name===D})[0])&&O.histograms&&O.histograms.length&&(L.histograms=O.histograms,6===L.stretchType&&(L.dra=!1));O&&O.statistics&&O.statistics.length&&(L.statistics=O.statistics.map(function(P){return[P.min,P.max,P.mean,P.stddev||P.standardDeviation]}),6!==L.stretchType&&(L.dra=!1))}this.setRenderer(L,!0)}}},
setDefaultInterpolation:function(){if(this.loaded&&this._canvas){var L=this.raster.serviceInfo&&this.raster.serviceInfo.defaultResamplingMethod;if(L)switch(L.toLowerCase()){case "bilinear":this.interpolation="RSP_BilinearInterpolation";break;case "cubic":this.interpolation="RSP_CubicConvolution";break;case "majority":this.interpolation="RSP_Majority";break;case "nearest":this.interpolation="RSP_NearestNeighbor"}else{L=this.raster.dataType&&this.raster.dataType.toLowerCase();var O=!!this.raster.rasterInfo.colormap;
this.raster.rasterInfo.vat||O||"thematic"===L||"StdTime"===L?"RSP_NearestNeighbor":"RSP_BilinearInterpolation"}}},_toggleTime:function(){},_updateTilingEffects:function(){(this._hasTilingEffects=this._rasterRenderer&&this._rasterRenderer.hasTilingEffects()||this.raster&&this.raster.rasterFunction&&this.raster.rasterFunction.hasTilingEffects())&&this._map&&this.tileMode&&this.useWebGL&&this.tileManager&&(this._hasTilingEffects=!1)},_setMap:function(L,O){this.inherited(arguments);L.spatialReference&&
(L.spatialReference.ics||L.spatialReference.icsId)&&(this.roaming=this.useWebGL=this.tileMode=!1);if(this.tileMode){this.virtualTileInfo=new fa(null,{refTileInfo:L.tileInfo,spatialReference:L.spatialReference,extent:this.raster.rasterInfo.extent});var D=this.raster.tileInfo&&(-1<["Elevation","Raster"].indexOf(this.raster.tileInfo.tileType)||3===this.raster.rasterInfo.bandCount&&"U8"===this.raster.rasterInfo.pixelType)?this.raster.tileInfo:this.virtualTileInfo;this._tileParams=this._tileParams||{};
this._tileParams.size=D.cols+","+D.rows;this.tileManager=new J({tileInfo:D,layer:this,mapSR:L.spatialReference})}this._dragOrigin={x:0,y:0};D=this._div=b.create("div",null,O);var P={width:L.width+"px",height:L.height+"px",position:"absolute"};"css-transforms"===L.navigationMode?this.roaming&&this.tileMode&&this.useWebGL||(P[d._css.names.transform]=d._css.translate(L.__visibleDelta.x,L.__visibleDelta.y),this._left=L.__visibleDelta.x,this._top=L.__visibleDelta.y):this._left=this._top=0;a.set(D,P);this._canvas=
b.create("canvas",{width:L.width+"px",height:L.height+"px",style:"position: absolute;"},D);p.isDefined(this.opacity)&&a.set(D,"opacity",this.opacity);this._contextType?(this._context=this._canvas.getContext(this._contextType,null),this.useWebGL=this._context instanceof WebGLRenderingContext):this.useWebGL?(this._context=this._canvas.getContext("webgl",null)||this._canvas.getContext("experimental-webgl",null),this.drawMode=!1):(this._context=this._canvas.getContext("2d"),this.drawMode=!0);this._context||
console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this.useWebGL&&(L.acquireWebGLContext(this),this._glSetting={gl:this._context,branchCount:this.raster.rasterFunction?this.raster.rasterFunction.branchCount:0,pingpong:null,branches:null,drawMesh:this._drawMesh,programUniforms:{}});this.raster.rasterFunction&&(this._updateTilingEffects(),this.raster.setProcessingContext({layer:this}));this.setRenderer(this.renderer,!0);this._rasterRenderer||this.setDefaultRenderer();
this.interpolation||this.setDefaultInterpolation();this._mapWidth=L.width;this._mapHeight=L.height;this._connects=[];this._connects.push(n.connect(L,"onPan",this,this._panHandler));this._connects.push(n.connect(L,"onPanEnd",this,this._panEndHandler));"css-transforms"===L.navigationMode?this._connects.push(n.connect(L,"onScale",this,this._onScaleHandler)):(this._connects.push(n.connect(L,"onZoom",this,this._onZoomHandler)),this._connects.push(n.connect(L,"onZoomEnd",this,this._onZoomEndHandler)));
this._connects.push(n.connect(L,"onResize",this,this._onResizeHandler));this._connects.push(n.connect(L,"onExtentChange",this,this._extentChangeHandler));this._connects.push(n.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(n.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:L.width,height:L.height};this.evaluateSuspension();if(this.suspended&&!L.loaded)var R=n.connect(L,"onLoad",this,function(){n.disconnect(R);
R=null;this.evaluateSuspension()});return D},_unsetMap:function(L,O){this.useWebGL&&L.releaseWebGLContext(this);r.forEach(this._connects,n.disconnect,this);var D=this._div;D&&(O.removeChild(D),b.destroy(D));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(L){"CancelError"!==L.name&&(this.clear(),
this.onError(L))},_clonePixelData:function(L){if(null===L||L.texture)return L;var O={};L.extent&&(O.extent=k.clone(L.extent));var D=L.pixelBlock;null!=D&&(O.pixelBlock=D.clone());O.texture=L.texture;return O},_setPixelData:function(L){if(L){L=this._clonePixelData(L);this.pixelFilter&&(this.pixelFilter.filter?(this.pixelFilter.renderTexture=!0,this.pixelFilter.filter(L)):this.pixelFilter(L));this.pixelData=L;if(this._rasterReadPromise&&this._rasterReadPromise.isCanceled())return;this._drawPixelData()}this._rasterReadPromise=
null},_requestData:function(L,O,D){this._rasterReadPromise&&this._rasterReadPromise.cancel();L=k.clone(L)._normalize(!0);this._rasterReadPromise=this.raster.read({extent:L,width:this._map.width,height:this._map.height});this._rasterReadPromise.then(k.hitch(this,function(P){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=P&&P.srcData?{extent:P.extent,src:P.srcData}:P,this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!0),this._setPixelData(P))}),k.hitch(this,
this._requestDataErrorHandler));return this._rasterReadPromise},_drawPixelData:function(L){a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,
d._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});this.useWebGL&&this._rasterRenderer&&this._rasterRenderer.draw(this.pixelData);if(this._canDraw()&&this.drawMode&&this.drawMode&&(L=L||this.pixelData)&&L.pixelBlock){var O=this.pixelFilter?this.pixelData:this._rasterRenderer?this._rasterRenderer.draw(L):L;L=O.pixelBlock;var D=this._context,P=D.createImageData(L.width,L.height);P.data.set(L.getAsRGBA());O=O.extent;var R=this._map.extent,ca=this.getCurrentResolution(),ha=0,oa=0;Math.abs(O.xmin-
R.xmin)>ca.x&&(ha=Math.round((O.xmin-R.xmin)/ca.x));Math.abs(R.ymax-O.ymax)>ca.y&&(oa=Math.round((R.ymax-O.ymax)/ca.y));"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,d._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,
{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};this.tileMode?this.clear(ha,oa,L.width,L.height):this.clear();D.putImageData(P,ha,oa,0,0,L.width,L.height);this._fireUpdateEnd()}},hasStdTime:function(){if(!this.hasMultidimensions||"StdTime"!==this.raster.dataType)return!1;var L=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition,O=L&&L.length?L[0].variableName:this._defaultMultidimensionalDefinition[0].variableName;return this.raster.rasterInfo.multidimensionalInfo.variables.some(function(D){if(D.name===
O)return D.dimensions.some(function(P){return"StdTime"===P.name})})},getStdTimeValue:function(L){return(new Date(864E5*(L-25569))).toString()},_animatePan2d:function(){this._oldDelta&&this._delta.x===this._oldDelta.x&&this._delta.y===this._oldDelta.y||(this.tileManager.updateTile(this.tileManager.originalPixelData,!0),this._oldDelta={x:this._delta.x,y:this._delta.y});this._roamingAnimation&&this.tileMode&&this.useWebGL&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))},_cancelAnimation:function(){this._animation&&
(cancelAnimationFrame(this._animation),this._animation=null)},_updateAllTilesOnce:function(L,O){return this.tileManager.updateTile(L,!0).then(k.hitch(this,function(D){(this._hasTilingEffects||this.useWebGL||O)&&this._drawOneFrame(D)}))},_drawOneFrame:function(L,O){if(!(this.suspended||!this._map||this.tileMode&&!this._drawTile||(this.tileMode&&this.useWebGL&&this.tileManager.originalPixelData.isEmpty&&this._context.clear(this._context.COLOR_BUFFER_BIT),this.tileMode&&this.useWebGL&&this.tileManager.xformSetting&&
this.tileManager.xformSetting.requireProjection&&!this.tileManager.xformSetting.gridConfig))){if(!this._resetCss||this._levelChange)this._levelChange=!1,this._resetDrawing();if(L&&(L.renderedPixelBlock||L.pixelBlock)&&this._canDraw()&&this.drawMode){O=L.extent;var D=this._map.extent;if(!this._isExtentOutSide(O,D)){var P=L.pixelBlock||L.renderedPixelBlock,R=this._context,ca=R.createImageData(P.width,P.height);ca.data.set((L.renderedPixelBlock||L.pixelBlock).getAsRGBA());L=this.getCurrentResolution();
var ha=0,oa=0;Math.abs(O.xmin-D.xmin)>L.x&&(ha=Math.round((O.xmin-D.xmin)/L.x));Math.abs(D.ymax-O.ymax)>L.y&&(oa=Math.round((D.ymax-O.ymax)/L.y));R.putImageData(ca,ha,oa,0,0,P.width,P.height)}}else this._fireUpdateEnd()}},_isExtentOutSide:function(L,O){return L.xmax<=O.xmin||L.xmin>=O.xmax||L.ymax<=O.ymin||L.ymin>=O.ymax},_resetDrawing:function(){this._resetCss=!0;if(!this.useWebGL)if(this._multiply||this._startRect.width!==this._map.width||this._startRect.height!==this._map.height)this.clear();else{var L=
this._context.getImageData(0,0,this._map.width,this._map.height);this.clear();this._context.putImageData(L,this._startRect.left,this._startRect.top)}this._dragOrigin={x:0,y:0};this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});"css-transforms"===this._map.navigationMode?(this.roaming&&this.tileMode&&this.useWebGL&&(this._delta=null),this._tdx=this._left,this._tdy=this._top,
this._multiply=null,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),a.set(this._canvas,d._css.names.transform,d._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}))},_drawAllFrames:function(){if(!this.suspended&&this._map&&(!this.tileMode||this._drawTile))if(this._resetCss){var L=this._frames,
O=0,D;for(D=0;D<L.length;D++)if(L[D].completed)O++;else if(L[D].tileData.renderedPixelBlock){L[D].completed=!0;var P=L[D].tileData;break}else if(L[D].tileData._fetched&&!L[D].tileData.src){L[D].completed=!0;break}else if(L[D].tileData.update&&L[D].tileData.update.isFulfilled()&&!L[D].tileData.renderedPixelBlock){L[D].completed=!0;break}else L[D].tileData.fetch&&(!0===L[D].tileData.fetch||L[D].tileData.fetch.isCanceled()||L[D].tileData.fetch.isRejected())?(L[D].completed=!0,O++):this._isExtentOutSide(L[D].tileData.extent,
this._map.extent)&&(L[D].completed=!0,O++);if(P){O++;var R=P.extent,ca=this._map.extent,ha=this.getCurrentResolution(),oa=D=0;Math.abs(R.xmin-ca.xmin)>ha.x&&(D=Math.round((R.xmin-ca.xmin)/ha.x));Math.abs(ca.ymax-R.ymax)>ha.y&&(oa=Math.round((ca.ymax-R.ymax)/ha.y));P.renderedPixelBlock?(R=P.renderedPixelBlock,ca=this._context.createImageData(R.width,R.height),ca.data.set(P.renderedPixelBlock.getAsRGBA()),this._context.putImageData(ca,D,oa,0,0,R.width,R.height)):this.clear(D,oa,P.width,P.height)}O===
L.length?(this._animation=null,this._fireUpdateEnd()):this._animation=requestAnimationFrame(k.hitch(this,this._drawAllFrames))}else this._resetDrawing(),this._animation=requestAnimationFrame(k.hitch(this,this._drawAllFrames))},_fetchTiles:function(L,O){if(!this.suspended&&this.loaded){this._cancelAnimation();var D=this.tileManager,P=!(D.xformSetting.requireProjection&&D.xformSetting.requirePE)||X.load();e(P,k.hitch(this,function(){D.updateExtent(L,this.getCurrentResolution());this._resetCss=!1;D.fetchTiles(O);
O&&(this._hasTilingEffects||this.useWebGL?this.useWebGL&&0<D.tiles.length?(D.fillupTiles(),D._validateRawPixelBlocks(D.originalPixelData)?this._updateAllTilesOnce(D.originalPixelData):D.originalPixelData&&D.originalPixelData.src&&D.tiles.some(function(R){return R.updateCompleted})&&this._context.clear(this._context.COLOR_BUFFER_BIT),D.tiles.forEach(k.hitch(this,function(R){R.update&&!R.updateCompleted&&R.update.then(function(ca){R.updateCompleted||(R.updateCompleted=!0);(this._hasTilingEffects||this.useWebGL)&&
this._drawOneFrame(ca)}.bind(this))}))):this._hasTilingEffects&&e(D.fetchAllCompleted.isResolved()||D.fetchAllCompleted,k.hitch(this,function(){this._updateAllTilesOnce(D.originalPixelData)})):(this._frames=D.tiles.map(function(R){return{completed:!1,tileData:R}}),this._drawAllFrames()))}))}},_redrawTiles:function(){this._fetchTiles(this._map.extent,!0)},_panHandler:function(L,O){this._drawTile=!1;"css-transforms"===this._map.navigationMode?this.roaming&&this.tileMode&&this.useWebGL?(this._delta=
O,!this._roamingAnimation&&this.tileMode&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))):(this._left=this._map.__visibleDelta.x+O.x,this._top=this._map.__visibleDelta.y+O.y,a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top))):a.set(this._div,{left:this._startRect.left+O.x+"px",top:this._startRect.top+O.y+"px"});this.tileMode&&this._fetchTiles(L)},_panEndHandler:function(L,O){O&&(this._startRect.left+=O.x,this._startRect.top+=O.y);this.oldData=null;this._roamingAnimation&&
(cancelAnimationFrame(this._roamingAnimation),this._oldDelta=this._roamingAnimation=null)},_onScaleHandler:function(L,O){var D={},P=d._css.names;a.set(this._canvas,P.transition,O?"none":P.transformName+" "+Z+"ms ease");this._matrix=L;L=this._multiply?f.multiply(L,this._multiply):L;if(this._tdx||this._tdy)L=f.multiply(L,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});D[P.transform]=d._css.matrix(L);a.set(this._canvas,D)},_onZoomHandler:function(L,O,D){var P=this._startRect;L=P.width*O;O*=P.height;
var R=P.left-(L-P.width)*(D.x-P.left)/P.width;D=P.top-(O-P.height)*(D.y-P.top)/P.height;a.set(this._canvas,{left:R+"px",top:D+"px",width:L+"px",height:O+"px"});this._endRect={left:R,top:D,width:L,height:O}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(L,O,D){a.set(this._div,{width:O+"px",height:D+"px"});a.set(this._canvas,{width:O+"px",height:D+"px"});this._startRect.width=this._canvas.width=O;this._startRect.height=this._canvas.height=D;this.useWebGL&&
this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null)},_extentChangeHandler:function(L,O,D,P){if(this.loaded&&!this.suspended&&(!O||0!==O.x||0!==O.y||D)){this._drawTile=!0;"css-transforms"===this._map.navigationMode&&(O&&(this._dragOrigin.x+=O.x,this._dragOrigin.y+=O.y),this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,this.roaming&&this.tileMode&&this.useWebGL||D||a.set(this._div,d._css.names.transform,d._css.translate(this._left,this._top)),D&&(a.set(this._canvas,
d._css.names.transition,"none"),this._multiply=this._multiply?f.multiply(this._matrix,this._multiply):this._matrix,this._levelChange=!0));this._fireUpdateStart();var R=this._map;O=this.raster.rasterFunction?this.raster.getMemberRasters().map(function(ha){return ha._rasterId}):[this.raster._rasterId];var ca={};this.tileMode?((this.roaming||this.useWebGL)&&this.tileMode||(O.forEach(function(ha,oa){ca[ha]={extent:R.extent,pixelBlock:new N({width:R.width,height:R.height,pixels:[],pixelType:"",mask:null,
statistics:[]})}}),this.tileManager.originalPixelData={extent:R.extent,src:ca}),this.projectedFullExtent?this._fetchTiles(L,!0):this._getProjectedFullExtent(R.spatialReference).then(k.hitch(this,function(){this._fetchTiles(L,!0)}))):this._requestData(R.extent,R.width,R.height)}},_visibilityChangeHandler:function(L){L?q.show(this._div):q.hide(this._div)},_opacityChangeHandler:function(L){a.set(this._div,"opacity",L)}});l("extend-esri")&&k.setObject("layers.RasterXLayer",H,d);return H})},"esri/layers/rasterLib/raster/rasterFactory":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u){H={customDrivers:[],create:function(v){if(v){if(v.url){var t=d.urlToObject(v.url);var x=t.path;var C=t.query}t=v.serviceInfo;var B=v.rasterFxArgs||{},F=new r,y=n.hitch(this,function(G){console.error(G);this._trycustomDrivers(n.mixin({url:x},v),0,F)});if(x)if(-1===x.toLowerCase().indexOf("imageserver")&&-1===x.toLowerCase().indexOf("mapserver")){var w=new q(n.mixin({},v,{url:x}));v.rasterFx&&(w=new u({rasterFx:v.rasterFx,rasterFxArgs:n.mixin({},B,{raster:w})}));
var A=w}else{A=new r;t=t||this._getServiceInfo(x,C);var z=n.hitch(this,function(G){G.bandCount?w=G.capabilities&&-1<G.capabilities.toLowerCase().indexOf("tileonly")?new p(n.mixin({},{serviceInfo:G},C,v,{url:x})):new h(n.mixin({},{serviceInfo:G},C,v,{url:x})):G.tileInfo&&(w=new p(n.mixin({},{serviceInfo:G},C,this._options,{url:x})));v.rasterFx&&(w=new u({rasterFx:v.rasterFx,rasterFxArgs:n.mixin({},B,{raster:w})}));A.resolve(w)});a(t,z,y)}else A=w=new u({rasterFx:v.rasterFx,rasterFxArgs:n.mixin({},
B,{raster:w})});a(A,n.hitch(this,function(G){G?G.open().then(n.hitch(this,function(I){F.resolve(G)}),y):y(Error("There is no raster to open"))}),y);return F.promise}},register:function(v){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(t){return t.sourceType===v.prototype.sourceType}).length||this.customDrivers.push(v)},_trycustomDrivers:function(v,t,x){x=x||new r;var C=this.customDrivers[t];if(C){var B=new C(v);B.open().then(n.hitch(this,function(F){x.resolve(B)}),
n.hitch(this,function(F){this._trycustomDrivers(v,t+1,x)}))}else x.reject("cannot load layer "+(v&&v.url||""));return x.promise},_getServiceInfo:function(v,t){t=t||{};var x=t.bandIds;t=t.renderingRule;var C=new r(g._dfdCanceller),B={f:"json"};x&&(B.bandIds=x);t&&(B.renderingRule=t.toJson?JSON.stringify(t.toJson()):JSON.stringify(t));C._pendingDfd=e({url:v,content:B,handleAs:"json",callbackParamName:"callback"});C._pendingDfd.then(function(F){C.callback(F)},function(F){C.errback(F)});return C.promise}};
b("extend-esri")&&n.setObject("layers.rasterLib.raster.rasterFactory",H,c);return H})},"esri/layers/rasterLib/raster/ImageServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../WKIDUnitConversion ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ./RasterInfo ./BasicRaster ../../rasterFormats/rasterCodec ../tile/RasterTileInfo".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A){H=k([y],{declaredClass:"esri.layers.rasterLib.raster.ImageServiceRaster",sourceType:"ImageService",constructor:function(z){z&&(this._imageServiceParams=z.imageServiceParameters,this._commonReqParams=z._commonReqParams,this._imageServiceParams||(this._imageServiceParams={interpolation:z.interpolation,pixelType:z.pixelType,format:z.format||"lerc",compressionQuality:z.compressionQuality,bandIds:z.bandIds,noDataInterpretation:z.noDataInterpretation,
adjustAspectRatio:z.adjustAspectRatio,mosaicRule:z.mosaicRule,renderingRule:z.interpolation}))},open:function(){var z=new r;if(this.serviceInfo&&this.rasterInfo)return this.loaded=!0,this._findCredential(),this.setFetchParameters(this._imageServiceParams),z.resolve(this),z.promise;var G=this.serviceInfo||this._generateServiceInfo(this._imageServiceParams&&this._imageServiceParams.renderingRule),I=n.hitch(this,function(Q){this._fixServiceInfo(Q);this.serviceInfo=Q;this._findCredential();var N=this._parseRasterInfo(Q),
T={};Q.defaultMosaicMethod?(T.method=Q.defaultMosaicMethod,T.operation=Q.mosaicOperator,T.sortField=Q.sortField,T.sortValue=Q.sortValue):T.method=x.METHOD_NONE;this.serviceInfo.defaultMosaicRule=new x(T);this.serviceInfo.defaultMosaicRule.ascending=!0;Q=this._getColormap(this);T=this._getHistograms(this);var W=this._getRasterAttributeTable(this),X=this._getKeyProperties(this),ea=this._getMultidimensionalInfo(),fa=this._getSlices();(new c([Q,T,W,X,ea,fa])).then(n.hitch(this,function(J){J[0][0]&&(N.colormap=
J[0][1]);J[1][0]&&(N.histograms=J[1][1]);J[2][0]&&(N.vat=J[2][1]);J[3][0]&&(N.keyProperties=J[3][1]);J[4][0]&&(N.multidimensionalInfo=J[4][1]);this._slices=J[5][0]?J[5][1]:null;N.keyProperties&&N.keyProperties.DataType&&(this.dataType=N.keyProperties.DataType);this.loaded=!0;this.rasterInfo=N;this.setFetchParameters(this._imageServiceParams);z.resolve(this)}))}),K=n.hitch(this,function(Q){this.loaded=!0;z.reject(Q)});f(G,I,K);return z.promise},setFetchParameters:function(z,G){if(G)this.imageServiceParams=
z;else{var I=this.imageServiceParams;I&&z?Object.keys(z).forEach(function(K){I[K]=z[K]}):this.imageServiceParams=z}this._constructGetImageParams();this._getRasterIdentifier(!0)},read:function(z){if(z.pixelBlock||z.texture){var G=new r;G.resolve(z);return G.promise}if(!1===z.virtual&&this.tileInfo&&!this.tileInfo.virtual)return this.readTile(z);if(this._slices){var I=this._getSliceId();if(null==I)return G=new r,G.resolve(z),G.promise}var K=z.extent,Q=K.spatialReference.wkid||b.toJson(K.spatialReference.toJson(!1)),
N=z.timeExtent?z.timeExtent.toJson().join(","):null;G=this.url+"/exportImage";var T={};this._slices&&(T.sliceid=I);this.disableClientCaching&&(T._ts=(new Date).getTime());I=n.mixin({},this._commonReqParams,{bbox:K.xmin+","+K.ymin+","+K.xmax+","+K.ymax,imageSR:Q,bboxSR:Q,size:z.width+","+z.height,time:N},T);return this._requestPixels({url:G,payload:I,decodeParams:{width:z.width,height:z.height,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:!1},tileOptions:z})},readTile:function(z){var G=
this.tileBoundary&&this.tileBoundary[z.level];if(G&&(G.minRow>z.row||G.maxRow<z.row||G.minCol>z.col||G.maxCol<z.col)){var I=new r;I.resolve(z);return I.promise}if(this._slices&&(I=this._getSliceId(),null==I))return I=new r,I.resolve(z),I.promise;G=this.url+"/tile/"+z.level+"/"+z.row+"/"+z.col;var K={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===z.tileType.toLowerCase()?!0:!1};I=this._slices?"sliceid\x3d"+I+"\x26":"";
I=this.disableClientCaching?"_ts\x3d "+(new Date).getTime():I.replace(/&$/,"");return this._requestPixels({url:G+(0<I.length?"?"+I:""),payload:{},decodeParams:K,tileOptions:z})},toJson:function(){return{url:this.url,tileInfo:this.tileInfo,rasterInfo:this.rasterInfo,serviceInfo:this.serviceInfo,sourceType:this.sourceType,_commonReqParams:this._commonReqParams,_rasterId:this._rasterId}},_getSliceId:function(){var z=n.clone(this._imageServiceParams.multidimensionalDefinition),G=n.clone(this._imageServiceParams.time);
if(null==this._slices||null==G&&(null==z||0===z.length))return 0;var I=z||this.defaultMultidimensionalDefinition,K=I[0].variableName;I=this._getAllDimensionDefinition(I,K).definition;z=null;if(null==I||0===I.length)return null;if(G&&this.serviceInfo.timeInfo){if(null==G[1]||G[1]===G[0])var Q=G[0];else{var N=this.serviceInfo.timeInfo.startTimeField;Q=this.rasterInfo.multidimensionalInfo.variables.find(function(X){return X.name===K}).dimensions.find(function(X){return X.name===N}).values.filter(function(X){return Array.isArray(X)?
Math.max(X[0],G[0])<Math.min(X[1],G[1]):X>=G[0]&&X<=G[1]}).sort(function(X,ea){X=Array.isArray(X)?X[1]:X;ea=Array.isArray(ea)?X[1]:ea;return Math.abs(G[1]-X)-Math.abs(G[1]-ea)})[0]||[G[1]]}I.some(function(X){if(X.dimensionName===N)return X.values[0]=Q,!0;if(!X.dimensionName)return X.dimensionName=N,X.isSlice=!0,X.values=[Q],!0})||I.push({variableName:K,dimensionName:N,isSlice:!0,values:[Q]})}for(var T=0;T<this._slices.length;T++){var W=this._slices[T].multidimensionalDefinition;if(W.length===I.length&&
!W.some(function(X){var ea=I.filter(function(J){return X.variableName===J.variableName&&J.dimensionName===X.dimensionName})[0];if(!ea)return!0;var fa=Array.isArray(X.values[0])?X.values[0][0]:X.values[0];ea=Array.isArray(ea.values[0])?ea.values[0][0]:ea.values[0];return fa!==ea})){z=T;break}}return z},_getAllDimensionDefinition:function(z,G){var I=z.map(function(Q){return Q.dimensionName}),K=!1;this.rasterInfo.multidimensionalInfo.variables.forEach(function(Q){Q.name!==G||Q.dimensions.length===z.length&&
I[0]||(Q.dimensions.forEach(function(N){0>I.indexOf(N.name)&&(I[0]?z.push({variableName:G,dimensionName:N.name,values:[N.values[0]]}):(z[0].dimensionName=N.name,z[0].values=[N.values[0]],N[0]=N.name))}),K=!0)},this);return{defChanged:K,definition:z}},_generateServiceInfo:function(z){var G=this.url,I=new r(v._dfdCanceller);I._pendingDfd=d({url:G,content:{f:"json",renderingRule:z?b.toJson(z.toJson()):null},handleAs:"json",callbackParamName:"callback"});I._pendingDfd.then(function(K){I.callback(K)},
function(K){I.errback(K)});return I},_fixServiceInfo:function(z){var G=z.spatialReference.wkid;z.tileInfo&&0===z.extent.xmin&&360===z.extent.xmax&&G&&null==u[G]&&(z.tileInfo.applyGCS360Transform=!0)},_parseRasterInfo:function(z){var G=new F;G.bandCount=z.bandCount;G.extent=new h(z.fullExtent);G.spatialReference=z.spatialReference;G.pixelType=z.pixelType;G.width=Math.floor((z.fullExtent.xmax-z.fullExtent.xmin)/z.pixelSizeX+.5);G.height=Math.floor((z.fullExtent.ymax-z.fullExtent.ymin)/z.pixelSizeY+
.5);G.cellSize=new p({x:z.pixelSizeX,y:z.pixelSizeY,spatialReference:z.spatialReference});var I;if(z.minValues&&0<z.minValues.length&&z.maxValues&&z.stdvValues&&z.meanValues){var K=[];for(I=0;I<z.minValues.length;I++)K.push({min:z.minValues[I],max:z.maxValues[I],mean:z.meanValues[I],stddev:z.stdvValues[I]});z.bandCount!==K.length&&(K=null)}this.dataType=z.serviceDataType?z.serviceDataType.replace("esriImageServiceDataType",""):"Generic";G.statistics=K;z.objectIdField&&z.fields&&(G.catalogInfo={objectIdField:z.objectIdField,
fields:z.fields});G.timeInfo=z.timeInfo;if(z.tileInfo){this.tileInfo=new A(z.tileInfo);this.tileInfo.tileType=z.cacheType||"Map";G.tileInfo=this.tileInfo;var Q=G.extent,N=this.tileInfo.origin,T=this.tileInfo.cols,W=this.tileInfo.rows;this.tileBoundary=this.tileInfo.lods.map(function(X){return{minCol:Math.floor((Q.xmin-N.x+.1*X.resolution)/T/X.resolution),maxCol:Math.floor((Q.xmax-N.x-.1*X.resolution)/T/X.resolution),minRow:Math.floor((N.y-Q.ymax+.1*X.resolution)/W/X.resolution),maxRow:Math.floor((N.y-
Q.ymin-.1*X.resolution)/W/X.resolution)}})}return G},_getColormap:function(z){z=this.url+"/colormap";var G=new r(v._dfdCanceller),I={f:"json"},K=this.serviceInfo.hasColormap||this.rasterInfo&&this.rasterInfo.hasColormap;10<this.serviceInfo.currentVersion&&K?(G._pendingDfd=d({url:z,content:I,handleAs:"json",callbackParamName:"callback"}),G._pendingDfd.then(function(Q){G.callback(Q.colormap)},function(Q){G.errback(Q)})):G.callback(null);return G},_getHistograms:function(z){var G=this.url+"/histograms",
I=new r(v._dfdCanceller),K={f:"json"},Q=this.serviceInfo.hasHistograms||this.rasterInfo&&this.rasterInfo.hasHistograms;z&&z.renderingRule&&(K.renderingRule=b.toJson(z.renderingRule.toJson()),Q=!0);10<this.serviceInfo.currentVersion&&Q?(I._pendingDfd=d({url:G,content:K,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(N){I.callback(N.histograms)},function(N){I.errback(N)})):I.callback(null);return I},_getRasterAttributeTable:function(z){var G=this.url+"/rasterAttributeTable",
I=new r(v._dfdCanceller),K={f:"json"},Q=this.serviceInfo.hasRasterAttributeTable;z&&z.renderingRule&&(K.renderingRule=b.toJson(z.renderingRule.toJson()),Q=!0);10<this.serviceInfo.currentVersion&&Q?(I._pendingDfd=d({url:G,content:K,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(N){I.callback(N)},function(N){I.errback(N)})):I.callback(null);return I},_getKeyProperties:function(z){var G=this.url+"/keyProperties",I=new r(v._dfdCanceller),K={f:"json"};z&&z.renderingRule&&(K.renderingRule=
b.toJson(z.renderingRule.toJson()));10<this.serviceInfo.currentVersion?(I._pendingDfd=d({url:G,content:K,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(Q){I.callback(Q)},function(Q){I.errback(Q)})):I.callback(null);return I},_getMultidimensionalInfo:function(){var z=this.url+"/multidimensionalInfo",G=new r(v._dfdCanceller);10.3<=this.serviceInfo.currentVersion&&this.serviceInfo.hasMultidimensions?(G._pendingDfd=d({url:z,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),
G._pendingDfd.then(n.hitch(this,function(I){G.callback(I.multidimensionalInfo)}),function(I){G.errback(I)})):G.callback(null);return G},_getSlices:function(){var z=this.url+"/slices",G=new r(v._dfdCanceller);this.serviceInfo.hasMultidimensions?(G._pendingDfd=d({url:z,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),G._pendingDfd.then(n.hitch(this,function(I){G.callback(I.slices)}),function(I){G.errback(I)})):G.callback(null);return G},_initializationFailed:function(){},_constructGetImageParams:function(){var z=
this.imageServiceParams||{},G=n.mixin({},this._query,{f:"image",interpolation:z.interpolation,pixelType:z.pixelType,format:z.format||"lerc",compressionQuality:z.compressionQuality,bandIds:z.bandIds?z.bandIds.join(","):null,noData:null!=z.noData?z.noData.join(","):null,noDataInterpretation:z.noDataInterpretation,adjustAspectRatio:null==z.adjustAspectRatio?null:z.adjustAspectRatio,mosaicRule:z.mosaicRule?b.toJson(z.mosaicRule.toJson()):null,renderingRule:z.renderingRule?b.toJson(z.renderingRule.toJson()):
null,token:this.credential&&this.credential.token||null});"lerc"===G.format.toLowerCase()?(G.compressionTolerance=z.compressionTolerance,10.5<=this.serviceInfo.currentVersion&&(G.lercVersion=z.lercVersion||2)):"tiff"===G.format.toLowerCase()?G.compression=z.compression:-1<["jpg","jpeg","jpg","jpgpng"].indexOf(G.format.toLowerCase())&&(G.compression=z.compression);this._commonReqParams=G},_getRasterIdentifier:function(z){if(this._rasterId)return this._rasterId;z=this.url.replace("http:","").replace("https:",
"");var G=[],I=this.imageServiceParams||{};G.push(z);G.push(I.interpolation);G.push(I.pixelType);G.push(I.compressionQuality);G.push(I.bandIds?I.bandIds.join(","):"");G.push(I.mosaicRule?b.toJson(I.mosaicRule.toJson()):"");G.push(I.renderingRule?b.toJson(I.renderingRule.toJson()):"");z=G.join("|");return this._rasterId=this._computeSignature(z)},_wrapExtent:function(z){var G=z.spatialReference._getInfo();if(G){var I=G.valid[0];G=G.valid[1];if(z.xmin<I-this.resolution.x||z.xmax>G+this.resolution.y){var K=
new h((z.xmin-I)%(G-I),z.ymin,(z.xmax-G)%(G-I),z.ymax,z.spatialReference);K.xmax<K.xmin&&(K=null)}}return K||z}});a("extend-esri")&&n.setObject("layers.rasterLib.raster.ImageServiceRaster",H,e);return H})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(H,k,n,r,m,l){H=H(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,
interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(b){var a=this.bbox||this.extent;b=(a=a&&b&&a._normalize(!0))?a.spatialReference.wkid||n.toJson(a.spatialReference.toJson()):null;var c=this.imageSpatialReference;a={bbox:a?a.xmin+","+a.ymin+","+a.xmax+","+a.ymax:null,bboxSR:b,size:null!==this.width&&null!==this.height?this.width+","+this.height:
null,imageSR:c?c.wkid||n.toJson(c.toJson()):b,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?n.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?n.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?n.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,compressionTolerance:this.compressionTolerance,
adjustAspectRatio:this.adjustAspectRatio,lercVersion:this.lercVersion};b=this.timeExtent;a.time=b?b.toJson().join(","):null;return l.filter(a,function(f){if(null!==f&&void 0!==f)return!0})}});k.mixin(H,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});r("extend-esri")&&k.setObject("layers.ImageServiceParameters",
H,m);return H})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(H,k,n,r,m){return H(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",bandCount:null,pixelType:null,extent:null,spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,
cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(l){k.mixin(this,l);this.extent=this.extent?this.extent.toJson?this.extent:new n(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?this.spatialReference:new r(this.spatialReference):null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new m(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,
extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?k.clone(this.colormap):null,attributeTable:this.attributeTable?k.clone(this.attributeTable):null,multiDimensionalInfo:this.multiDimensionalInfo?k.clone(this.multiDimensionalInfo):null,statistics:this.statistics?k.clone(this.statistics):null,histograms:this.histograms?
k.clone(this.histograms):null,catalogInfo:this.catalogInfo?k.clone(this.catalogInfo):null,keyProperties:this.keyProperties?k.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?k.clone(this.geodataXform):null}},
clone:function(){return new this.constructor(this.toJson())}})})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),function(H,k,n,r,m,l,b){return H([b],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,
c){if(a||c){var f=c&&c.refTileInfo;a?this.virtual=!1:(this.virtual=!0,k.mixin(this,{rows:c.rows||this.rows,cols:c.cols||this.cols,compressionQuality:c.compressionQuality||95,lercError:c.compressionTolerance||.01,spatialReference:c.spatialReference,origin:c.origin}),this.width=this.cols,this.height=this.rows,this.origin||(f?this.origin=f.origin:c.spatialReference.isWebMercator()||c.extent&&360<=Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:
-1<[4326,4269].indexOf(c.spatialReference.wkid)||360>Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:c.extent.xmin,y:c.extent.ymax}))}},toJson:function(){var a=b.prototype.toJson.apply(this);a.tileType=this.tileType;a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},"esri/layers/rasterLib/raster/BasicRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterHandler ./rasterProjectionHelper ./RasterInfo".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w){return k([g],{url:null,dataType:null,rasterInfo:null,tileInfo:null,serviceInfo:null,loaded:null,constructor:function(A){if(A){var z=A.url;z&&(z=v.urlToObject(z),this.url=z.path,this._query=z.query);this.dataType=A.dataType;this.serviceInfo=A.serviceInfo;this.rasterInfo=A.rasterInfo;this.tileInfo=A.tileInfo;this.serviceInfo=A.serviceInfo}},open:function(){},read:function(A){},identify:function(A){var z=new r,G=this.rasterInfo.extent;if(y.requirePE(G.spatialReference,
A.spatialReference))y.load().then(n.hitch(this,function(){I=y.project(A,G.spatialReference);z.resolve(I)}),function(){z.reject(Error("cannot project into this spatial reference"))});else{var I=y.project(A,G.spatialReference);z.resolve(I)}return z.then(n.hitch(this,function(K){var Q=this.tileInfo,N=Q.origin,T=Q.lods[Q.lods.length-1],W=(K.x-N.x)/Q.cols/T.resolution;K=(N.y-K.y)/Q.rows/T.resolution;var X=Math.round((K-Math.floor(K))*Q.rows)*Q.cols+Math.round((W-Math.floor(W))*Q.cols);N=new h(N.x+T.resolution*
Q.cols*W,N.y-T.resolution*Q.rows*(K+1),N.x+T.resolution*Q.cols*(W+1),N.y-T.resolution*Q.rows*K,G.spatialReference);var ea=this.getMemberRasters?this.getMemberRasters()[0]:this;return ea.read({level:T.level,row:Math.floor(K),col:Math.floor(W),extent:N,width:Q.cols,height:Q.rows,virtual:ea.tileInfo.virtual,tileType:ea.tileInfo.tileType}).then(function(fa){return(fa=fa&&fa.pixelBlock)&&fa.pixels&&0<fa.pixels.length&&(!fa.mask||fa.mask[X])?{pixelValue:fa.pixels.map(function(J){return J[X]})}:{pixelValue:null}})}))},
getProjectedFullExtent:function(A,z){var G=new r;if(this.projectedFullExtent&&!z)return G.resolve(this.projectedFullExtent),G.promise;var I=this.rasterInfo.extent;if(y.requirePE(this.rasterInfo.extent.spatialReference,A))y.load().then(n.hitch(this,function(){K=y.project(I,A);this.projectedFullExtent=K=new h(K.toJson());G.resolve(K)}),function(){G.reject(Error("cannot project into this spatial reference"))});else{var K=y.project(I,A);this.projectedFullExtent=K=new h(K.toJson());G.resolve(K)}return G.promise},
setFetchParameters:function(A,z){},_setRasterHandler:function(A){this._rasterHandler=A;this.getMemberRasters&&this.getMemberRasters().forEach(n.hitch(this,function(z){z._rasterHandler=A}))},_findCredential:function(){this.url&&((this._credential=e.id&&e.id.findCredential(this.url))&&this._credential.ssl||this.serviceInfo&&this.serviceInfo._ssl)&&(this.url=this.url.replace(/^http:/i,"https:"))},_initWorker:function(){this._rasterHandler=new F;this._rasterHandler.start().then(function(){this._rasterHandlerInitialized=
!0}.bind(this))},_requestPixels:function(A){var z=A.url,G=A.payload,I=A.decodeParams,K=A.tileOptions,Q=new r(u._dfdCanceller);this._rasterHandler||this._initWorker();var N=this._rasterHandler,T={};z={url:z,handleAs:"arraybuffer",content:G};A.headers&&(z.headers=A.headers);Q._pendingDfd=d(z).then(n.hitch(this,function(W){(N&&this._rasterHandlerInitialized?N.decode({encodedData:W,decodeParams:I}):B.decode(W,I)).then(function(X){T.pixelBlock=new C(X);T.extent=K.extent;T.level=K.level;T.row=K.row;T.col=
K.col;T.width=K.width;T.height=K.height;u._resDfd(Q,[T])},function(X){u._resDfd(Q,[X],!0)})}),function(W){u._resDfd(Q,[W],!0)});return Q},_computeSignature:function(A){if("string"===typeof A){for(var z=new Uint8Array(A.length),G=0;G<A.length;G++)z[G]=A.charCodeAt(G);A=z}G=z=65535;for(var I=A.length,K=Math.floor(I/2),Q=0;K;){var N=359<=K?359:K;K-=N;do z+=A[Q++]<<8,G+=z+=A[Q++];while(--N);z=(z&65535)+(z>>>16);G=(G&65535)+(G>>>16)}I&1&&(G+=z+=A[Q]<<8);return((G&65535)+(G>>>16)<<16|(z&65535)+(z>>>16))>>>
0}})})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),function(H,k,n,r,m,l,b,a,c,f,e){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var g=new ArrayBuffer(4),d=new Uint8Array(g);(new Uint32Array(g))[0]=
1;return 1===d[0]}(),decode:function(g,d){if(void 0===d||null===d)throw"missing decode options";var h;d.format&&(h=d.format.toUpperCase());"BSQ"!==h&&"BIP"!==h&&(h=this._getFormat(g));var p=d.decodeFunc;if(void 0===p||null===p)p=this._getFormatDecoderDfd(h);return p(g,d)},_getFormatDecoderDfd:function(g){var d=null;switch(g){case "LERC":d=this._decodeLerc;break;case "LERC2":d=this._decodeLerc2;break;case "JPEG":d=this._decodeJpeg;break;case "PNG":d=this._decodePng;break;case "BSQ":d=this._decodeBsq;
break;case "BIP":d=this._decodeBip;break;case "TIFF":d=this._decodeTiff;break;default:d=function(h,p){throw"The raster format is not supported";}}d=n.hitch(this,d);return function(h,p){var q=new r;p.isPoint&&p.width&&(p.width++,p.height++);h=d(h,p);p.isPoint&&p.width&&(this._interpolatePointGrid(h),p.width--,p.height--);q.resolve(h);return q}.bind(this)},_getFormat:function(g){g=new Uint8Array(g,0,10);var d="";if(255===g[0]&&216===g[1])d="JPEG";else if(137===g[0]&&80===g[1]&&78===g[2]&&71===g[3])d=
"PNG";else if(67===g[0]&&110===g[1]&&116===g[2]&&90===g[3]&&73===g[4]&&109===g[5]&&97===g[6]&&103===g[7]&&101===g[8]&&32===g[9])d="LERC";else if(76===g[0]&&101===g[1]&&114===g[2]&&99===g[3]&&50===g[4]&&32===g[5])d="LERC2";else if(-1<String.fromCharCode.apply(null,g).toLowerCase().indexOf("error"))d="ERROR";else if(73===g[0]&&73===g[1]&&42===g[2]&&0===g[3]||77===g[0]&&77===g[1]&&0===g[2]&&42===g[3])d="TIFF";return d},_validateDecodeParams:function(g){if(!g.height||Math.floor(g.height)!==g.height)throw"Height not provided.";
if(!g.width||Math.floor(g.width)!==g.width)throw"Width not provided.";},_decodeJpeg:function(g,d){if(!a)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(d);g=(new a).decode(g);if(!this._verifyResult(g,d))throw"The decoded image dimensions are incorrect.";d=new m({width:g.width,height:g.height,pixels:g.pixels,pixelType:"U8",mask:g.mask,statistics:null});d.calculateStatistics();return d},_decodePng:function(g,d){if(!c)throw"The png decoder module is not loaded.";this._validateDecodeParams(d);
g=new Uint8Array(g);var h=new c(g);g=new Uint8Array(d.width*d.height*4);h.copyToImageData(g,h.decodePixels());var p=h=0;p=new Uint8Array(d.width*d.height);for(h=0;h<d.width*d.height;h++)p[h]=g[4*h+3];var q=new m({width:d.width,height:d.height,pixels:[],pixelType:"U8",mask:p,statistics:[]});for(h=0;3>h;h++){var u=new Uint8Array(d.width*d.height);for(p=0;p<d.width*d.height;p++)u[p]=g[4*p+h];q.addData({pixels:u})}q.calculateStatistics();return q},_decodeBsq:function(g,d){if(!f)throw"The bsq decoder module is not loaded.";
this._validateDecodeParams(d);var h=d.noDataValue;d.pixelType=this._getpixelTypeAndNoData(d.pixelType);g=f.decodeBSQ(g,{bandCount:d.planes,width:d.width,height:d.height,pixelType:d.pixelType,noDataValue:h});d=new m({width:d.width,height:d.height,pixels:g.pixels,pixelType:d.pixelType,mask:g.maskData,statistics:null});d.calculateStatistics();return d},_decodeBip:function(g,d){this._validateDecodeParams(d);var h=d.noDataValue;d.pixelType=this._getpixelTypeAndNoData(d.pixelType);g=f.decodeBIP(g,{bandCount:d.planes,
width:d.width,height:d.height,pixelType:d.pixelType,noDataValue:h});d=new m({width:d.width,height:d.height,pixels:g.pixels,pixelType:d.pixelType,mask:g.maskData,statistics:null});d.calculateStatistics();return d},_decodeTiff:function(g,d){this._validateDecodeParams(d);d.pixelType=this._getpixelTypeAndNoData(d.pixelType);g=e.decode(g);g=new m({width:g.width,height:g.height,pixels:g.pixels,pixelType:g.pixelType,mask:g.maskData,statistics:null});g.calculateStatistics();return g},_decodeLerc:function(g,
d){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(d);var h=d.noDataValue;d.pixelType=this._getpixelTypeAndNoData(d.pixelType);for(var p=0,q,u=0,v,t=g.byteLength-10;u<t;){var x=l.decode(g,{inputOffset:u,encodedMaskData:q,returnMask:0===p?!0:!1,returnEncodedMask:0===p?!0:!1,returnFileInfo:!0,pixelType:d.pixelType,noDataValue:h});u=x.fileInfo.eofOffset;0===p&&(q=x.encodedMaskData,v=new m({width:d.width,height:d.height,pixels:[],
pixelType:d.pixelType,mask:x.maskData,statistics:[]}));p++;if(!this._verifyResult(x,d))throw"The decoded image dimensions are incorrect";v.addData({pixels:x.pixelData,statistics:{minValue:x.minValue,maxValue:x.maxValue,noDataValue:x.noDataValue}})}return v},_decodeLerc2:function(g,d){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(d);d.pixelType=this._getpixelTypeAndNoData(d.pixelType);for(var h=0,p,q,u,v=0,t,x=g.byteLength-
10,C=[],B,F=0;v<x;){q=b.decode(g,{inputOffset:v,maskData:p,returnFileInfo:!0});v=q.fileInfo.eofOffset;p=q.maskData;0===h&&(u=q.fileInfo.numValidPixel,t=new m({width:d.width,height:d.height,pixels:[],dimCount:q.dimCount||1,pixelType:q.fileInfo.pixelType,mask:p,statistics:[]}));q.fileInfo.mask&&0<q.fileInfo.mask.numBytes&&F++;p&&C.push(p);h++;if(!this._verifyResult(q,d))throw"The decoded image dimensions are incorrect";t.addData({pixels:q.pixelData,statistics:{minValue:q.minValue,maxValue:q.maxValue,
noDataValue:q.noDataValue,dimStats:q.dimStats}})}if(1<F){d=t.width*t.height;t.bandMasks=C;p=new Uint8Array(d);p.set(C[0]);for(u=1;u<C.length;u++)for(B=C[u],g=0;g<d;g++)p[g]&=B[g];for(g=u=0;g<d;g++)u+=B[g];t.mask=p}t.validPixelCount=u;return t},_interpolatePointGrid:function(g,d){var h=g.pixels;if(h&&0!==h.length){var p=h.length,q=g.width,u=g.mask,v=q-1,t=g.height-1,x=[],C,B;if(0===(null==d?1:d)){for(d=0;d<p;d++){var F=h[d];var y=new F.constructor(v*t);for(C=0;C<t;C++){var w=C*q;for(B=0;B<v;B++)y[C*
v+B]=F[w+B]}x.push(y)}if(u){var A=new Uint8Array(v*t);for(C=0;C<t;C++)for(w=C*q,B=0;B<v;B++)A[C*v+B]=u[w+B]}}else{for(d=0;d<p;d++){F=h[d];y=new F.constructor(v*t);for(C=0;C<t;C++)for(w=C*q,B=0;B<v;B++)y[C*v+B]=(F[w+B]+F[w+B+1]+F[w+q+B]+F[w+q+B+1])/4;x.push(y)}if(u)for(A=new Uint8Array(v*t),C=0;C<t;C++)for(w=C*q,B=0;B<v;B++)A[C*v+B]=Math.min.apply(null,[u[w+B],u[w+B+1],u[w+q+B],u[w+q+B+1]])}g.width=v;g.height=t;g.mask=A;g.pixels=x;return g}},_getpixelTypeAndNoData:function(g){return"U1"===g||"U2"===
g||"U4"===g||"U8"===g?"U8":g},_verifyResult:function(g,d){return g.height!==d.height||g.width!==d.width?!1:!0}}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(H,k,n){return H(null,{constructor:function(){},decode:function(r){var m=new Uint8Array(r);r=new n;r.parse(m);var l=r.numComponents,b=r.getData(r.width,r.height,!0),a=r.width*r.height,c=r.eof,f=0,e=0,g=0;if(c<m.length-1){e=(new k(m.subarray(c))).getBytes();var d=new Uint8Array(a);for(f=
m=0;f<e.length;f++)for(g=7;0<=g;g--)d[m++]=e[f]>>g&1}m=[];if(1===l)m=[b,b,b];else{for(f=0;3>f;f++)l=new Uint8Array(a),m.push(l);for(e=g=0;e<a;e++)for(f=0;3>f;f++)m[f][e]=b[g++]}return{width:r.width,height:r.height,pixels:m,mask:d}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var H=function(){function k(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}k.prototype={ensureBuffer:function(n){var r=this.buffer,m=r?r.byteLength:0;if(n<m)return r;for(var l=512;l<n;)l<<=
1;n=new Uint8Array(l);for(l=0;l<m;++l)n[l]=r[l];return this.buffer=n},getByte:function(){for(var n=this.pos;this.bufferLength<=n;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(n){var r=this.pos;if(n){this.ensureBuffer(r+n);for(n=r+n;!this.eof&&this.bufferLength<n;)this.readBlock();var m=this.bufferLength;n>m&&(n=m)}else{for(;!this.eof;)this.readBlock();n=this.bufferLength}this.pos=n;return this.buffer.subarray(r,n)},lookChar:function(){for(var n=this.pos;this.bufferLength<=
n;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var n=this.pos;this.bufferLength<=n;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(n,r,m){for(var l=n+r;this.bufferLength<=l&&!this.eof;)this.readBlock();return new Stream(this.buffer,n,r,m)},skip:function(n){n||(n=1);this.pos+=n},reset:function(){this.pos=0}};return k}();return function(){function k(c){throw Error(c);
}function n(c){var f=0,e=c[f++],g=c[f++];-1!=e&&-1!=g||k("Invalid header in flate stream");8!=(e&15)&&k("Unknown compression method in flate stream");0!=((e<<8)+g)%31&&k("Bad FCHECK in flate stream");g&32&&k("FDICT bit set in flate stream");this.bytes=c;this.bytesPos=f;this.codeBuf=this.codeSize=0;H.call(this)}if(!self||!self.Uint32Array)return null;var r=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),m=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,
131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),l=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),b=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,
459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,
459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,
459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,
459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,
459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,
459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,
459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,
327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];n.prototype=Object.create(H.prototype);n.prototype.getBits=function(c){for(var f=this.codeSize,e=this.codeBuf,g=this.bytes,d=this.bytesPos,h;f<c;)"undefined"==typeof(h=g[d++])&&k("Bad encoding in flate stream"),e|=h<<f,f+=8;this.codeBuf=e>>c;this.codeSize=f-=c;this.bytesPos=d;return e&(1<<c)-1};n.prototype.getCode=function(c){var f=c[0],e=c[1];c=this.codeSize;for(var g=
this.codeBuf,d=this.bytes,h=this.bytesPos;c<e;){var p;"undefined"==typeof(p=d[h++])&&k("Bad encoding in flate stream");g|=p<<c;c+=8}e=f[g&(1<<e)-1];f=e>>16;e&=65535;(0==c||c<f||0==f)&&k("Bad encoding in flate stream");this.codeBuf=g>>f;this.codeSize=c-f;this.bytesPos=h;return e};n.prototype.generateHuffmanTable=function(c){for(var f=c.length,e=0,g=0;g<f;++g)c[g]>e&&(e=c[g]);for(var d=1<<e,h=new Uint32Array(d),p=1,q=0,u=2;p<=e;++p,q<<=1,u<<=1)for(var v=0;v<f;++v)if(c[v]==p){var t=0,x=q;for(g=0;g<p;++g)t=
t<<1|x&1,x>>=1;for(g=t;g<d;g+=u)h[g]=p<<16|v;++q}return[h,e]};n.prototype.readBlock=function(){function c(t,x,C,B,F){for(t=t.getBits(C)+B;0<t--;)x[q++]=F}var f=this.getBits(3);f&1&&(this.eof=!0);f>>=1;if(0==f){var e=this.bytes,g=this.bytesPos,d;"undefined"==typeof(d=e[g++])&&k("Bad block header in flate stream");var h=d;"undefined"==typeof(d=e[g++])&&k("Bad block header in flate stream");h|=d<<8;"undefined"==typeof(d=e[g++])&&k("Bad block header in flate stream");f=d;"undefined"==typeof(d=e[g++])&&
k("Bad block header in flate stream");(f|d<<8)!=(~h&65535)&&k("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;d=this.bufferLength;f=this.ensureBuffer(d+h);this.bufferLength=h=d+h;for(var p=d;p<h;++p){if("undefined"==typeof(d=e[g++])){this.eof=!0;break}f[p]=d}this.bytesPos=g}else{if(1==f)g=b,d=a;else if(2==f){f=this.getBits(5)+257;d=this.getBits(5)+1;e=this.getBits(4)+4;g=Array(r.length);for(var q=0;q<e;)g[r[q++]]=this.getBits(3);g=this.generateHuffmanTable(g);q=e=0;d=
f+d;for(h=Array(d);q<d;)p=this.getCode(g),16==p?c(this,h,2,3,e):17==p?c(this,h,3,3,e=0):18==p?c(this,h,7,11,e=0):h[q++]=e=p;g=this.generateHuffmanTable(h.slice(0,f));d=this.generateHuffmanTable(h.slice(f,d))}else k("Unknown block type in flate stream");h=(f=this.buffer)?f.length:0;for(p=this.bufferLength;;){var u=this.getCode(g);if(256>u)p+1>=h&&(f=this.ensureBuffer(p+1),h=f.length),f[p++]=u;else{if(256==u){this.bufferLength=p;break}u-=257;u=m[u];var v=u>>16;0<v&&(v=this.getBits(v));e=(u&65535)+v;
u=this.getCode(d);u=l[u];v=u>>16;0<v&&(v=this.getBits(v));u=(u&65535)+v;p+e>=h&&(f=this.ensureBuffer(p+e),h=f.length);for(v=0;v<e;++v,++p)f[p]=f[p-u]}}}};return n}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var H=function(){function k(n){this.message="JPEG error: "+n}k.prototype=Error();k.prototype.name="JpegError";return k.constructor=k}();return function(){function k(){this.decodeTransform=null;this.colorTransform=-1}function n(a,c){for(var f=0,e=[],g,d,h=16;0<h&&!a[h-
1];)h--;e.push({children:[],index:0});var p=e[0],q;for(g=0;g<h;g++){for(d=0;d<a[g];d++){p=e.pop();for(p.children[p.index]=c[f];0<p.index;)p=e.pop();p.index++;for(e.push(p);e.length<=g;)e.push(q={children:[],index:0}),p.children[p.index]=q.children,p=q;f++}g+1<h&&(e.push(q={children:[],index:0}),p.children[p.index]=q.children,p=q)}return e[0].children}function r(a,c,f,e,g,d,h,p,q){function u(){if(0<I)return I--,G>>I&1;G=a[c++];if(255===G){var O=a[c++];if(O)throw new H("unexpected marker "+(G<<8|O).toString(16));
}I=7;return G>>>7}function v(O){for(;;){O=O[u()];if("number"===typeof O)return O;if("object"!==typeof O)throw new H("invalid huffman sequence");}}function t(O){for(var D=0;0<O;)D=D<<1|u(),O--;return D}function x(O){if(1===O)return 1===u()?1:-1;var D=t(O);return D>=1<<O-1?D:D+(-1<<O)+1}function C(O,D){var P=v(O.huffmanTableDC);P=0===P?0:x(P);O.blockData[D]=O.pred+=P;for(P=1;64>P;){var R=v(O.huffmanTableAC),ca=R&15;R>>=4;if(0===ca){if(15>R)break;P+=16}else P+=R,O.blockData[D+b[P]]=x(ca),P++}}function B(O,
D){var P=v(O.huffmanTableDC);P=0===P?0:x(P)<<q;O.blockData[D]=O.pred+=P}function F(O,D){O.blockData[D]|=u()<<q}function y(O,D){if(0<K)K--;else for(var P=d;P<=h;){var R=v(O.huffmanTableAC),ca=R&15;R>>=4;if(0===ca){if(15>R){K=t(R)+(1<<R)-1;break}P+=16}else P+=R,O.blockData[D+b[P]]=x(ca)*(1<<q),P++}}function w(O,D){for(var P=d,R=0,ca;P<=h;){ca=b[P];switch(Q){case 0:R=v(O.huffmanTableAC);ca=R&15;R>>=4;if(0===ca)15>R?(K=t(R)+(1<<R),Q=4):(R=16,Q=1);else{if(1!==ca)throw new H("invalid ACn encoding");N=x(ca);
Q=R?2:3}continue;case 1:case 2:O.blockData[D+ca]?O.blockData[D+ca]+=u()<<q:(R--,0===R&&(Q=2===Q?3:0));break;case 3:O.blockData[D+ca]?O.blockData[D+ca]+=u()<<q:(O.blockData[D+ca]=N<<q,Q=0);break;case 4:O.blockData[D+ca]&&(O.blockData[D+ca]+=u()<<q)}P++}4===Q&&(K--,0===K&&(Q=0))}var A=f.mcusPerLine,z=c,G=0,I=0,K=0,Q=0,N,T=e.length,W,X,ea,fa;p=f.progressive?0===d?0===p?B:F:0===p?y:w:C;var J=0;f=1===T?e[0].blocksPerLine*e[0].blocksPerColumn:A*f.mcusPerColumn;for(var V,aa;J<f;){var Z=g?Math.min(f-J,g):
f;for(W=0;W<T;W++)e[W].pred=0;K=0;if(1===T){var L=e[0];for(fa=0;fa<Z;fa++)p(L,64*((L.blocksPerLine+1)*(J/L.blocksPerLine|0)+J%L.blocksPerLine)),J++}else for(fa=0;fa<Z;fa++){for(W=0;W<T;W++)for(L=e[W],V=L.h,aa=L.v,X=0;X<aa;X++)for(ea=0;ea<V;ea++)p(L,64*((L.blocksPerLine+1)*((J/A|0)*L.v+X)+(J%A*L.h+ea)));J++}I=0;(L=l(a,c))&&L.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+L.invalid),c=L.offset);L=L&&L.marker;if(!L||65280>=L)throw new H("marker was not found");if(65488<=L&&
65495>=L)c+=2;else break}(L=l(a,c))&&L.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+L.invalid),c=L.offset);return c-z}function m(a,c){a=c.blocksPerLine;for(var f=c.blocksPerColumn,e=new Int16Array(64),g=0;g<f;g++)for(var d=0;d<a;d++){var h=void 0,p=void 0,q=void 0,u=void 0,v=void 0,t=void 0,x=void 0,C=void 0,B=v=t=u=p=h=void 0,F=void 0,y=void 0,w=void 0,A=64*((c.blocksPerLine+1)*g+d),z=e,G=c.quantizationTable,I=c.blockData;if(!G)throw new H("missing required Quantization Table.");
for(var K=0;64>K;K+=8)h=I[A+K],C=I[A+K+1],x=I[A+K+2],t=I[A+K+3],v=I[A+K+4],u=I[A+K+5],q=I[A+K+6],p=I[A+K+7],h*=G[K],0===(C|x|t|v|u|q|p)?(h=5793*h+512>>10,z[K]=h,z[K+1]=h,z[K+2]=h,z[K+3]=h,z[K+4]=h,z[K+5]=h,z[K+6]=h,z[K+7]=h):(C*=G[K+1],x*=G[K+2],t*=G[K+3],v*=G[K+4],u*=G[K+5],q*=G[K+6],p*=G[K+7],w=5793*h+128>>8,y=5793*v+128>>8,F=x,B=q,v=2896*(C-p)+128>>8,p=2896*(C+p)+128>>8,t<<=4,u<<=4,w=w+y+1>>1,y=w-y,h=3784*F+1567*B+128>>8,F=1567*F-3784*B+128>>8,B=h,v=v+u+1>>1,u=v-u,p=p+t+1>>1,t=p-t,w=w+B+1>>1,B=
w-B,y=y+F+1>>1,F=y-F,h=2276*v+3406*p+2048>>12,v=3406*v-2276*p+2048>>12,p=h,h=799*t+4017*u+2048>>12,t=4017*t-799*u+2048>>12,u=h,z[K]=w+p,z[K+7]=w-p,z[K+1]=y+u,z[K+6]=y-u,z[K+2]=F+t,z[K+5]=F-t,z[K+3]=B+v,z[K+4]=B-v);for(G=0;8>G;++G)h=z[G],C=z[G+8],x=z[G+16],t=z[G+24],v=z[G+32],u=z[G+40],q=z[G+48],p=z[G+56],0===(C|x|t|v|u|q|p)?(h=5793*h+8192>>14,h=-2040>h?0:2024<=h?255:h+2056>>4,I[A+G]=h,I[A+G+8]=h,I[A+G+16]=h,I[A+G+24]=h,I[A+G+32]=h,I[A+G+40]=h,I[A+G+48]=h,I[A+G+56]=h):(w=5793*h+2048>>12,y=5793*v+2048>>
12,F=x,B=q,v=2896*(C-p)+2048>>12,p=2896*(C+p)+2048>>12,w=(w+y+1>>1)+4112,y=w-y,h=3784*F+1567*B+2048>>12,F=1567*F-3784*B+2048>>12,B=h,v=v+u+1>>1,u=v-u,p=p+t+1>>1,t=p-t,w=w+B+1>>1,B=w-B,y=y+F+1>>1,F=y-F,h=2276*v+3406*p+2048>>12,v=3406*v-2276*p+2048>>12,p=h,h=799*t+4017*u+2048>>12,t=4017*t-799*u+2048>>12,u=h,h=w+p,p=w-p,C=y+u,q=y-u,x=F+t,u=F-t,t=B+v,v=B-v,h=16>h?0:4080<=h?255:h>>4,C=16>C?0:4080<=C?255:C>>4,x=16>x?0:4080<=x?255:x>>4,t=16>t?0:4080<=t?255:t>>4,v=16>v?0:4080<=v?255:v>>4,u=16>u?0:4080<=u?
255:u>>4,q=16>q?0:4080<=q?255:q>>4,p=16>p?0:4080<=p?255:p>>4,I[A+G]=h,I[A+G+8]=C,I[A+G+16]=x,I[A+G+24]=t,I[A+G+32]=v,I[A+G+40]=u,I[A+G+48]=q,I[A+G+56]=p)}return c.blockData}function l(a,c,f){var e=a.length-1;f=f<c?f:c;if(c>=e)return null;var g=a[c]<<8|a[c+1];if(65472<=g&&65534>=g)return{invalid:null,marker:g,offset:c};for(c=a[f]<<8|a[f+1];!(65472<=c&&65534>=c);){if(++f>=e)return null;c=a[f]<<8|a[f+1]}return{invalid:g.toString(16),marker:c,offset:f}}if(!self||!self.Uint8ClampedArray)return null;var b=
new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);k.prototype={parse:function(a){function c(){var G=a[g]<<8|a[g+1];g+=2;return G}function f(){var G=c();G=g+G-2;var I=l(a,G,g);I&&I.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+I.invalid),G=I.offset);G=a.subarray(g,G);g+=G.length;return G}function e(G){for(var I=Math.ceil(G.samplesPerLine/
8/G.maxH),K=Math.ceil(G.scanLines/8/G.maxV),Q=0;Q<G.components.length;Q++){z=G.components[Q];var N=Math.ceil(Math.ceil(G.samplesPerLine/8)*z.h/G.maxH),T=Math.ceil(Math.ceil(G.scanLines/8)*z.v/G.maxV);z.blockData=new Int16Array(64*K*z.v*(I*z.h+1));z.blocksPerLine=N;z.blocksPerColumn=T}G.mcusPerLine=I;G.mcusPerColumn=K}var g=0,d=null,h=null,p=[],q=[],u=[],v=c();if(65496!==v)throw new H("SOI not found");for(v=c();65497!==v;){switch(v){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var t=
f();65504===v&&74===t[0]&&70===t[1]&&73===t[2]&&70===t[3]&&0===t[4]&&(d={version:{major:t[5],minor:t[6]},densityUnits:t[7],xDensity:t[8]<<8|t[9],yDensity:t[10]<<8|t[11],thumbWidth:t[12],thumbHeight:t[13],thumbData:t.subarray(14,14+3*t[12]*t[13])});65518===v&&65===t[0]&&100===t[1]&&111===t[2]&&98===t[3]&&101===t[4]&&(h={version:t[5]<<8|t[6],flags0:t[7]<<8|t[8],flags1:t[9]<<8|t[10],transformCode:t[11]});break;case 65499:v=c()+g-2;for(var x;g<v;){var C=a[g++],B=new Uint16Array(64);if(0===C>>4)for(t=
0;64>t;t++)x=b[t],B[x]=a[g++];else if(1===C>>4)for(t=0;64>t;t++)x=b[t],B[x]=c();else throw new H("DQT - invalid table spec");p[C&15]=B}break;case 65472:case 65473:case 65474:if(F)throw new H("Only single frame JPEGs supported");c();var F={};F.extended=65473===v;F.progressive=65474===v;F.precision=a[g++];F.scanLines=c();F.samplesPerLine=c();F.components=[];F.componentIds={};t=a[g++];for(v=B=C=0;v<t;v++){x=a[g];var y=a[g+1]>>4;var w=a[g+1]&15;C<y&&(C=y);B<w&&(B=w);y=F.components.push({h:y,v:w,quantizationId:a[g+
2],quantizationTable:null});F.componentIds[x]=y-1;g+=3}F.maxH=C;F.maxV=B;e(F);break;case 65476:x=c();for(v=2;v<x;){C=a[g++];B=new Uint8Array(16);for(t=y=0;16>t;t++,g++)y+=B[t]=a[g];w=new Uint8Array(y);for(t=0;t<y;t++,g++)w[t]=a[g];v+=17+y;(0===C>>4?u:q)[C&15]=n(B,w)}break;case 65501:c();var A=c();break;case 65498:c();x=a[g++];t=[];for(v=0;v<x;v++){C=F.componentIds[a[g++]];var z=F.components[C];C=a[g++];z.huffmanTableDC=u[C>>4];z.huffmanTableAC=q[C&15];t.push(z)}v=a[g++];x=a[g++];C=a[g++];v=r(a,g,
F,t,A,v,x,C>>4,C&15);g+=v;break;case 65535:255!==a[g]&&g--;break;default:if(255===a[g-3]&&192<=a[g-2]&&254>=a[g-2])g-=3;else throw new H("unknown marker "+v.toString(16));}v=c()}this.width=F.samplesPerLine;this.height=F.scanLines;this.jfif=d;this.eof=g;this.adobe=h;this.components=[];for(v=0;v<F.components.length;v++){z=F.components[v];if(d=p[z.quantizationId])z.quantizationTable=d;this.components.push({output:m(F,z),scaleX:z.h/F.maxH,scaleY:z.v/F.maxV,blocksPerLine:z.blocksPerLine,blocksPerColumn:z.blocksPerColumn})}this.numComponents=
this.components.length},_getLinearizedBlockData:function(a,c){var f=this.width/a,e=this.height/c,g,d,h=0,p=this.components.length,q=a*c*p,u=new Uint8ClampedArray(q),v=new Uint32Array(a);for(d=0;d<p;d++){var t=this.components[d];var x=t.scaleX*f;var C=t.scaleY*e;h=d;var B=t.output;var F=t.blocksPerLine+1<<3;for(g=0;g<a;g++)t=0|g*x,v[g]=(t&4294967288)<<3|t&7;for(x=0;x<c;x++)for(t=0|x*C,t=F*(t&4294967288)|(t&7)<<3,g=0;g<a;g++)u[h]=B[t+v[g]],h+=p}if(c=this.decodeTransform)for(d=0;d<q;)for(a=t=0;t<p;t++,
d++,a+=2)u[d]=(u[d]*c[a]>>8)+c[a+1];return u},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var c,f,e,g=0,d=a.length;g<d;g+=3)c=a[g],f=a[g+1],e=a[g+2],a[g]=c-179.456+1.402*e,a[g+1]=c+135.459-.344*f-.714*e,a[g+2]=c-226.816+1.772*f;return a},_convertYcckToRgb:function(a){for(var c,f,e,g,d=0,h=0,p=a.length;h<p;h+=4)c=a[h],f=a[h+1],e=a[h+2],g=a[h+3],a[d++]=
-122.67195406894+f*(-6.60635669420364E-5*f+4.37130475926232E-4*e-5.4080610064599E-5*c+4.8449797120281E-4*g-.154362151871126)+e*(-9.57964378445773E-4*e+8.17076911346625E-4*c-.00477271405408747*g+1.53380253221734)+c*(9.61250184130688E-4*c-.00266257332283933*g+.48357088451265)+g*(-3.36197177618394E-4*g+.484791561490776),a[d++]=107.268039397724+f*(2.19927104525741E-5*f-6.40992018297945E-4*e+6.59397001245577E-4*c+4.26105652938837E-4*g-.176491792462875)+e*(-7.78269941513683E-4*e+.00130872261408275*c+7.70482631801132E-4*
g-.151051492775562)+c*(.00126935368114843*c-.00265090189010898*g+.25802910206845)+g*(-3.18913117588328E-4*g-.213742400323665),a[d++]=-20.810012546947+f*(-5.70115196973677E-4*f-2.63409051004589E-5*e+.0020741088115012*c-.00288260236853442*g+.814272968359295)+e*(-1.53496057440975E-5*e-1.32689043961446E-4*c+5.60833691242812E-4*g-.195152027534049)+c*(.00174418132927582*c-.00255243321439347*g+.116935020465145)+g*(-3.43531996510555E-4*g+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var c,
f,e,g=0,d=a.length;g<d;g+=4)c=a[g],f=a[g+1],e=a[g+2],a[g]=434.456-c-1.402*e,a[g+1]=119.541-c+.344*f+.714*e,a[g+2]=481.816-c-1.772*f;return a},_convertCmykToRgb:function(a){for(var c,f,e,g,d=0,h=1/255,p=0,q=a.length;p<q;p+=4)c=a[p]*h,f=a[p+1]*h,e=a[p+2]*h,g=a[p+3]*h,a[d++]=255+c*(-4.387332384609988*c+54.48615194189176*f+18.82290502165302*e+212.25662451639585*g-285.2331026137004)+f*(1.7149763477362134*f-5.6096736904047315*e-17.873870861415444*g-5.497006427196366)+e*(-2.5217340131683033*e-21.248923337353073*
g+17.5119270841813)-g*(21.86122147463605*g+189.48180835922747),a[d++]=255+c*(8.841041422036149*c+60.118027045597366*f+6.871425592049007*e+31.159100130055922*g-79.2970844816548)+f*(-15.310361306967817*f+17.575251261109482*e+131.35250912493976*g-190.9453302588951)+e*(4.444339102852739*e+9.8632861493405*g-24.86741582555878)-g*(20.737325471181034*g+187.80453709719578),a[d++]=255+c*(.8842522430003296*c+8.078677503112928*f+30.89978309703729*e-.23883238689178934*g-14.183576799673286)+f*(10.49593273432072*
f+63.02378494754052*e+50.606957656360734*g-112.23884253719248)+e*(.03296041114873217*e+115.60384449646641*g-193.58209356861505)-g*(22.33816807309886*g+180.12613974708367);return a},getData:function(a,c,f){if(4<this.numComponents)throw new H("Unsupported color mode");a=this._getLinearizedBlockData(a,c);if(1===this.numComponents&&f){f=a.length;c=new Uint8ClampedArray(3*f);for(var e=0,g=0;g<f;g++){var d=a[g];c[e++]=d;c[e++]=d;c[e++]=d}return c}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);
if(4===this.numComponents){if(this._isColorConversionNeeded())return f?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(f)return this._convertCmykToRgb(a)}return a}};return k}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(H){return function(){function k(r){var m,l;this.data=r;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(l=null;;){var b=this.readUInt32();var a=r=void 0;r=[];for(a=0;4>a;++a)r.push(String.fromCharCode(this.data[this.pos++]));
r=r.join("");switch(r){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(b);break;case "fcTL":l&&this.animation.frames.push(l);this.pos+=
4;l={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};r=this.readUInt16();b=this.readUInt16()||100;l.delay=1E3*r/b;l.disposeOp=this.data[this.pos++];l.blendOp=this.data[this.pos++];l.data=[];break;case "IDAT":case "fdAT":"fdAT"===r&&(this.pos+=4,b-=4);r=(null!=l?l.data:void 0)||this.imgData;for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)r.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=
this.read(b);b=255-this.transparency.indexed.length;if(0<b)for(r=0;0<=b?r<b:r>b;0<=b?++r:--r)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(b)[0];break;case 2:this.transparency.rgb=this.read(b)}break;case "tEXt":a=this.read(b);b=a.indexOf(0);r=String.fromCharCode.apply(String,a.slice(0,b));this.text[r]=String.fromCharCode.apply(String,a.slice(b+1));break;case "IEND":l&&this.animation.frames.push(l);a:{switch(this.colorType){case 0:case 3:case 4:l=1;break a;
case 2:case 6:l=3;break a}l=void 0}this.colors=l;this.hasAlphaChannel=4===(m=this.colorType)||6===m;m=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*m;a:{switch(this.colors){case 1:m="DeviceGray";break a;case 3:m="DeviceRGB";break a}m=void 0}this.colorSpace=m;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=b}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}k.load=function(r,m,l){"function"===typeof m&&(l=m);var b=new XMLHttpRequest;
b.open("GET",r,!0);b.responseType="arraybuffer";b.onload=function(){var a=new Uint8Array(b.response||b.mozResponseArrayBuffer);a=new k(a);"function"===typeof(null!=m?m.getContext:void 0)&&a.render(m);return"function"===typeof l?l(a):void 0};return b.send(null)};k.prototype.read=function(r){var m;var l=[];for(m=0;0<=r?m<r:m>r;0<=r?++m:--m)l.push(this.data[this.pos++]);return l};k.prototype.readUInt32=function(){var r=this.data[this.pos++]<<24;var m=this.data[this.pos++]<<16;var l=this.data[this.pos++]<<
8;var b=this.data[this.pos++];return r|m|l|b};k.prototype.readUInt16=function(){var r=this.data[this.pos++]<<8;var m=this.data[this.pos++];return r|m};k.prototype.decodePixels=function(r){var m,l,b,a,c,f,e,g;null==r&&(r=this.imgData);if(0===r.length)return new Uint8Array(0);r=new H(r);r=r.getBytes();var d=this.pixelBitlength/8;var h=d*this.width;var p=new Uint8Array(h*this.height);var q=r.length;for(l=a=c=0;a<q;){switch(r[a++]){case 0:for(b=m=0;m<h;b=m+=1)p[l++]=r[a++];break;case 1:for(b=f=0;f<h;b=
f+=1){m=r[a++];var u=b<d?0:p[l-d];p[l++]=(m+u)%256}break;case 2:for(b=u=0;u<h;b=u+=1){m=r[a++];var v=(b-b%d)/d;f=c&&p[(c-1)*h+v*d+b%d];p[l++]=(f+m)%256}break;case 3:for(b=g=0;g<h;b=g+=1)m=r[a++],v=(b-b%d)/d,u=b<d?0:p[l-d],f=c&&p[(c-1)*h+v*d+b%d],p[l++]=(m+Math.floor((u+f)/2))%256;break;case 4:for(b=g=0;g<h;b=g+=1){m=r[a++];v=(b-b%d)/d;u=b<d?0:p[l-d];0===c?f=e=0:(f=p[(c-1)*h+v*d+b%d],e=v&&p[(c-1)*h+(v-1)*d+b%d]);var t=u+f-e;b=Math.abs(t-u);v=Math.abs(t-f);t=Math.abs(t-e);u=b<=v&&b<=t?u:v<=t?f:e;p[l++]=
(m+u)%256}break;default:throw Error("Invalid filter algorithm: "+r[a-1]);}c++}return p};k.prototype.decodePalette=function(){var r,m,l,b,a;var c=this.palette;var f=this.transparency.indexed||[];var e=new Uint8Array((f.length||0)+c.length);var g=l=r=m=0;for(b=c.length;l<b;g=l+=3)e[m++]=c[g],e[m++]=c[g+1],e[m++]=c[g+2],e[m++]=null!=(a=f[r++])?a:255;return e};k.prototype.copyToImageData=function(r,m){var l,b;var a=this.colors;var c=null;var f=this.hasAlphaChannel;this.palette.length&&(c=null!=(l=this._decodedPalette)?
l:this._decodedPalette=this.decodePalette(),a=4,f=!0);r=r.data||r;var e=r.length;var g=c||m;l=b=0;if(1===a)for(;l<e;)a=c?4*m[l/4]:b,b=g[a++],r[l++]=b,r[l++]=b,r[l++]=b,r[l++]=f?g[a++]:this.transparency.grayscale&&this.transparency.grayscale===b?0:255,b=a;else for(;l<e;)a=c?4*m[l/4]:b,r[l++]=g[a++],r[l++]=g[a++],r[l++]=g[a++],r[l++]=f?g[a++]:this.transparency.rgb&&this.transparency.rgb[1]===g[a-3]&&this.transparency.rgb[3]===g[a-2]&&this.transparency.rgb[5]===g[a-1]?0:255,b=a};k.prototype.decode=function(){var r=
new Uint8Array(this.width*this.height*4);this.copyToImageData(r,this.decodePixels());return r};var n=function(r){(void 0).clearRect(0,0,r.width,r.height);(void 0).putImageData(r,0,0);r=new Image;r.src=(void 0).toDataURL();return r};k.prototype.decodeFrames=function(r){var m,l;if(this.animation){var b=this.animation.frames;var a=[];var c=m=0;for(l=b.length;m<l;c=++m){c=b[c];var f=r.createImageData(c.width,c.height);var e=this.decodePixels(new Uint8Array(c.data));this.copyToImageData(f,e);c.imageData=
f;a.push(c.image=n(f))}return a}};k.prototype.renderFrame=function(r,m){var l=this.animation.frames;var b=l[m];l=l[m-1];0===m&&r.clearRect(0,0,this.width,this.height);1===(null!=l?l.disposeOp:void 0)?r.clearRect(l.xOffset,l.yOffset,l.width,l.height):2===(null!=l?l.disposeOp:void 0)&&r.putImageData(l.imageData,l.xOffset,l.yOffset);0===b.blendOp&&r.clearRect(b.xOffset,b.yOffset,b.width,b.height);return r.drawImage(b.image,b.xOffset,b.yOffset)};k.prototype.animate=function(r){var m,l=this;var b=0;var a=
this.animation;var c=a.numFrames;var f=a.frames;var e=a.numPlays;return(m=function(){var g=b++%c;var d=f[g];l.renderFrame(r,g);if(1<c&&b/c<e)return l.animation._timeout=setTimeout(m,d.delay)})()};k.prototype.stopAnimation=function(){var r;return clearTimeout(null!=(r=this.animation)?r._timeout:void 0)};k.prototype.render=function(r){r._png&&r._png.stopAnimation();r._png=this;r.width=this.width;r.height=this.height;r=r.getContext("2d");if(this.animation)return this.decodeFrames(r),this.animate(r);
var m=r.createImageData(this.width,this.height);this.copyToImageData(m,this.decodePixels());return r.putImageData(m,0,0)};return k}()})},"esri/layers/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(H,k){var n=k.pixelType,r=k.bandCount,m=[],l=k.width*k.height,b=this.getBandCount(H,k);r=r||b;var a=H.byteLength-H.byteLength%(l*this._getPixelLength(n)),c=new n(H,0,l*b),f,e,g;for(f=0;f<r;f++){var d=new n(l);for(e=0;e<l;e++)d[e]=c[e*b+f];m.push(d)}a<H.byteLength-1&&(g=this._decodeMask(H.slice(a),
k));return{pixels:m,maskData:g}},decodeBSQ:function(H,k){var n=k.pixelType,r=k.bandCount;if(void 0===r||null===r)r=this.getBandCount(H,k);var m=[],l=k.width*k.height,b=l*r,a=H.byteLength-H.byteLength%(l*this._getPixelLength(n));n=new n(H,0,b);var c;for(b=0;b<r;b++)m.push(n.subarray(b*l,(b+1)*l));a<H.byteLength-1&&(c=this._decodeMask(H.slice(a),k));return{pixels:m,maskData:c}},getBandCount:function(H,k){return Math.floor(H.byteLength/(k.width*k.height*this._getPixelLength(k.pixelType)))},_getPixelLength:function(H){var k=
1;switch(H){case Uint8Array:case Int8Array:case Uint8ClampedArray:k=1;break;case Uint16Array:case Int16Array:k=2;break;case Uint32Array:case Int32Array:case Float32Array:k=4;break;case Float64Array:k=8}return k},_decodeMask:function(H,k){var n=k.width*k.height;if(8*H.byteLength<n)return null;H=new Uint8Array(H,0,Math.ceil(n/8));k=new Uint8Array(k.width*k.height);var r=0,m=0,l=0,b=0;for(l=0;l<H.length-1;l++)for(m=H[l],b=7;0<=b;b--)k[r++]=m>>b&1;for(b=7;r<n-1;)m=H[H.length-1],k[r++]=m>>b&1,b--;return k}}})},
"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(H,k){var n=function(){var b=new ArrayBuffer(4),a=new Uint8Array(b);b=new Uint32Array(b);a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===b[0]},r=function(){var b=[];b[254]="NEWSUBFILETYPE";b[255]="SUBFILETYPE";b[256]="IMAGEWIDTH";b[257]="IMAGELENGTH";b[258]="BITSPERSAMPLE";b[259]="COMPRESSION";b[262]="PHOTOMETRICINTERPRETATION";b[263]="THRESHHOLDING";b[264]="CELLWIDTH";b[265]="CELLLENGTH";b[266]="FILLORDER";b[269]=
"DOCUMENTNAME";b[270]="IMAGEDESCRIPTION";b[271]="MAKE";b[272]="MODEL";b[273]="STRIPOFFSETS";b[274]="ORIENTATION";b[277]="SAMPLESPERPIXEL";b[278]="ROWSPERSTRIP";b[279]="STRIPBYTECOUNTS";b[280]="MINSAMPLEVALUE";b[281]="MAXSAMPLEVALUE";b[282]="XRESOLUTION";b[283]="YRESOLUTION";b[284]="PLANARCONFIGURATION";b[285]="PAGENAME";b[286]="XPOSITION";b[287]="YPOSITION";b[288]="FREEOFFSETS";b[289]="FREEBYTECOUNTS";b[290]="GRAYRESPONSEUNIT";b[291]="GRAYRESPONSECURVE";b[292]="T4OPTIONS";b[293]="T6OPTIONS";b[296]=
"RESOLUTIONUNIT";b[297]="PAGENUMBER";b[300]="COLORRESPONSEUNIT";b[301]="TRANSFERFUNCTION";b[305]="SOFTWARE";b[306]="DATETIME";b[315]="ARTIST";b[316]="HOSTCOMPUTER";b[317]="PREDICTOR";b[318]="WHITEPOINT";b[319]="PRIMARYCHROMATICITIES";b[320]="COLORMAP";b[321]="HALFTONEHINTS";b[322]="TILEWIDTH";b[323]="TILELENGTH";b[324]="TILEOFFSETS";b[325]="TILEBYTECOUNTS";b[326]="BADFAXLINES";b[327]="CLEANFAXDATA";b[328]="CONSECUTIVEBADFAXLINES";b[330]="SUBIFD";b[332]="INKSET";b[333]="INKNAMES";b[334]="NUMBEROFINKS";
b[336]="DOTRANGE";b[337]="TARGETPRINTER";b[338]="EXTRASAMPLES";b[339]="SAMPLEFORMAT";b[340]="SMINSAMPLEVALUE";b[341]="SMAXSAMPLEVALUE";b[342]="TRANSFERRANGE";b[347]="JPEGTABLES";b[512]="JPEGPROC";b[513]="JPEGIFOFFSET";b[514]="JPEGIFBYTECOUNT";b[515]="JPEGRESTARTINTERVAL";b[517]="JPEGLOSSLESSPREDICTORS";b[518]="JPEGPOINTTRANSFORM";b[519]="JPEGQTABLES";b[520]="JPEGDCTABLES";b[521]="JPEGACTABLES";b[529]="YCBCRCOEFFICIENTS";b[530]="YCBCRSUBSAMPLING";b[531]="YCBCRPOSITIONING";b[532]="REFERENCEBLACKWHITE";
b[33550]="GEOPIXELSCALE";b[33922]="GEOTIEPOINTS";b[33432]="COPYRIGHT";b[42112]="GDAL_METADATA";b[42113]="GDAL_NODATA";b[50844]="RPCCOEFFICIENT";b[34735]="GEOKEYDIRECTORY";b[34736]="GEODOUBLEPARAMS";b[34737]="GEOASCIIPARAMS";return b}(),m=[0,1,1,2,4,8,1,1,2,4,8,4,8],l=function(b,a){var c="UNKNOWN";3===b?c="F32":1===b?8>=a?c="U8":16>=a?c="U16":32>=a&&(c="U32"):2===b&&(8>=a?c="S8":16>=a?c="S16":32>=a&&(c="S32"));return c};return{decode:function(b){var a=new DataView(b,0,8),c=a.getUint16(0,!1);if(18761===
c)var f=!0;else if(19789===c)f=!1;else throw"unexpected endianess byte";if(42!==a.getUint16(2,f))throw"unexpected tiff identifier";var e=a.getUint32(4,f);var g=f;var d,h;var p=e;for(var q=[];p;){var u=(new DataView(b,p,2)).getUint16(0,g);var v=p+2;p=(new DataView(b,v+12*u,4)).getUint32(0,g);var t={};for(d=0;d<u;d++){var x=new DataView(b,v,12);var C=x.getUint16(0,g);var B=x.getUint16(2,g);var F=x.getUint32(4,g);var y=x.getUint32(8,g);v+=12;if(!(7===B||12<B)){var w=h={fieldTag:C,fieldType:B,fieldValueCount:F,
fieldValueOffset:y},A=void 0,z=void 0,G=b,I=g,K=[],Q=h.fieldType,N=h.fieldValueCount,T=h.fieldValueOffset,W=T,X=m[Q],ea=8*X,fa=N*X,J=N*m[Q]*8;if(32>=J)if(I||(T>>>=32-J),1===N)K=[T];else for(A=0;A<N;A++)K.push(T<<ea*A>>>32-ea);else for(W=T;W<T+fa;W+=X){switch(Q){case 1:z=(new DataView(G,W,1)).getUint8(0);break;case 2:z=(new DataView(G,W,1)).getUint8(0);break;case 3:z=(new DataView(G,W,2)).getUint16(0,I);break;case 4:z=(new DataView(G,W,4)).getUint32(0,I);break;case 5:z=(new DataView(G,W,4)).getUint32(0,
I)/(new DataView(G,W+4,4)).getUint32(0,I);break;case 6:z=(new DataView(G,W,1)).getInt8(0);break;case 8:z=(new DataView(G,W,2)).getInt16(0,I);break;case 9:z=(new DataView(G,W,4)).getInt32(0,I);break;case 10:z=(new DataView(G,W,4)).getInt32(0,I)/(new DataView(G,W+4,4)).getInt32(0,I);break;case 11:z=(new DataView(G,W,4)).getFloat32(0,I);break;case 12:z=(new DataView(G,W,8)).getFloat64(0,I);break;case 7:z=null;break;default:z=null}K.push(z)}if(2===Q){var V="",aa=K;K=[];for(A=0;A<aa.length;A++)0===aa[A]&&
""!==V?(K.push(V),V=""):V+=String.fromCharCode(aa[A]);""===V&&0!==K.length||K.push(V)}w.fieldValues=K;var Z=t,L=r[C];void 0===L&&(L="unknown"+C);Z[L]={type:B,values:h.fieldValues}}}q.push(t)}if(0===q.length)throw"no valid image file directory";var O,D=q[0],P=void 0===D.GDAL_NODATA||null===D.GDAL_NODATA?null:parseFloat(D.GDAL_NODATA.values[0]);if(D.TILEOFFSETS){var R=n()===g,ca=D.TILEOFFSETS?D.TILEOFFSETS.values:void 0;if(void 0===ca)var ha=void 0;else{var oa=D.TILEBYTECOUNTS.values,ma=D.TILEWIDTH.values[0],
U=D.TILELENGTH.values[0],da=D.IMAGEWIDTH.values[0],na=D.IMAGELENGTH.values[0],ia=da*na,pa=D.BITSPERSAMPLE.values[0],E=D.SAMPLESPERPIXEL.values[0],M=D.SAMPLEFORMAT?D.SAMPLEFORMAT.values[0]:1,ba=l(M,pa);if(1!==(D.PLANARCONFIGURATION?D.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var Y=D.COMPRESSION?D.COMPRESSION.values[0]:1;if(1!==Y&&6!==Y&&8!==Y&&32946!==Y)throw console.log("this compression is not supported at this moment"),
"this compression is not supported at this moment";if(3<M)ha=void 0;else{if(3===M){var ka=new Float32Array(ia*E);var S=Float32Array}else 1===M?8>=pa?(ka=new Uint8Array(ia*E),S=Uint8Array):16>=pa?(ka=new Uint16Array(ia*E),S=Uint16Array):32>=pa&&(ka=new Uint32Array(ia*E),S=Uint32Array):2===M&&(8>=pa?(ka=new Int8Array(ia*E),S=Int8Array):16>=pa?(ka=new Int16Array(ia*E),S=Int16Array):32>=pa&&(ka=new Int32Array(ia*E),S=Int32Array));var ja,la,qa,ta,Ba,wa=Math.ceil(da/ma);if(0===pa%8)for(ja=0;ja<ca.length;ja++){var ua=
Math.floor(ja/wa)*U;var ra=ja%wa*ma;var sa=(ua*da+ra)*E;if("U8"===ba||"S8"===ba||R)if(8===Y||32946===Y){var va=new Uint8Array(b,ca[ja],oa[ja]);var za=new k(va);var Oa=za.getBytes();var Ea=new ArrayBuffer(Oa.length);va=new Uint8Array(Ea);va.set(Oa);va.length!==ma*U*E*pa/8&&console.log("tile byte counts is different than expected")}else if(6===Y){va=new Uint8Array(b,ca[ja],oa[ja]);var Aa=new H;Aa.parse(va);var Wa=Aa.getData(Aa.width,Aa.height);Ea=new ArrayBuffer(Wa.length);va=new Uint8Array(Ea);va.set(Wa)}else 1===
Y&&(oa[ja]!==ma*U*E*pa/8&&console.log("tile byte counts is different than expected"),Ea=b.slice(ca[ja],ca[ja]+oa[ja]));else{if(8===Y||32946===Y){va=new Uint8Array(b,ca[ja],oa[ja]);za=new k(va);va=za.getBytes();Ea=new ArrayBuffer(va.length);var Pa=new Uint8Array(Ea);va.length!==ma*U*E*pa/8&&console.log("tile byte counts is different than expected")}else 1===Y&&(oa[ja]!==ma*U*E*pa/8&&console.log("tile byte counts is different than expected"),Ea=new ArrayBuffer(oa[ja]),va=new Uint8Array(b,ca[ja],oa[ja]),
Pa=new Uint8Array(Ea));switch(ba){case "U16":case "S16":for(qa=0;qa<va.length;qa+=2)Pa[qa]=va[qa+1],Pa[qa+1]=va[qa];break;case "U32":case "S32":case "F32":for(qa=0;qa<va.length;qa+=4)Pa[qa]=va[qa+3],Pa[qa+1]=va[qa+2],Pa[qa+2]=va[qa+1],Pa[qa+3]=va[qa]}}var hb=new S(Ea);var ab=0;var bb=sa;var ib=Math.min(ma,da-ra);var jb=Math.min(U,na-ua);for(ta=0;ta<jb;ta++)for(bb=sa+ta*da*E,ab=ta*ma*E,Ba=0;Ba<ib*E;Ba++,bb++,ab++)ka[bb]=hb[ab]}var Xa={width:da,height:na,pixelType:ba};if(1===E)Xa.pixels=[ka];else for(Xa.pixels=
[],ja=0;ja<E;ja++){var db=new S(ia);for(la=0;la<ia;la++)db[la]=ka[la*E+ja];Xa.pixels.push(db)}ha=Xa}}}else if(D.STRIPOFFSETS){var kb=n()===g,Ja=D.STRIPOFFSETS?D.STRIPOFFSETS.values:void 0;if(void 0===Ja)ha=void 0;else{var Ka=D.STRIPBYTECOUNTS.values,Ra=D.ROWSPERSTRIP.values,La=D.IMAGEWIDTH.values[0],Sa=D.IMAGELENGTH.values[0],Ma=La*Sa,Fa=D.BITSPERSAMPLE.values[0],Da=D.SAMPLESPERPIXEL.values[0],Ta=D.SAMPLEFORMAT?D.SAMPLEFORMAT.values[0]:1,Ya=l(Ta,Fa);if(1!==(D.PLANARCONFIGURATION?D.PLANARCONFIGURATION.values[0]:
1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var Ga=D.COMPRESSION?D.COMPRESSION.values[0]:1;if(1!==Ga&&6!==Ga&&8!==Ga&&32946!==Ga)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";if(3<Ta)ha=void 0;else{if(3===Ta){var Ha=new Float32Array(Ma*Da);var Na=Float32Array}else 1===Ta?8>=Fa?(Ha=new Uint8Array(Ma*Da),Na=Uint8Array):16>=Fa?(Ha=new Uint16Array(Ma*Da),Na=Uint16Array):
32>=Fa&&(Ha=new Uint32Array(Ma*Da),Na=Uint32Array):2===Ta&&(8>=Fa?(Ha=new Int8Array(Ma*Da),Na=Int8Array):16>=Fa?(Ha=new Int16Array(Ma*Da),Na=Int16Array):32>=Fa&&(Ha=new Int32Array(La*Sa*Da),Na=Int32Array));var xa,Ua,Ca,Va=Ra;if(0===Fa%8)for(xa=0;xa<Ja.length;xa++){var lb=xa*Ra*La*Da;Va=(xa+1)*Ra>Sa?Sa-xa*Ra:Ra;if("U8"===Ya||"S8"===Ya||kb)if(8===Ga||32946===Ga){var ya=new Uint8Array(b,Ja[xa],Ka[xa]);var cb=new k(ya);var eb=cb.getBytes();var Ia=new ArrayBuffer(eb.length);ya=new Uint8Array(Ia);ya.set(eb);
ya.length!==Va*La*Da*Fa/8&&console.log("strip byte counts is different than expected")}else if(6===Ga){ya=new Uint8Array(b,Ja[xa],Ka[xa]);var Za=new H;Za.parse(ya);var fb=Za.getData(Za.width,Za.height);Ia=new ArrayBuffer(fb.length);ya=new Uint8Array(Ia);ya.set(fb)}else 1===Ga&&(Ka[xa]!==Va*La*Da*Fa/8&&console.log("strip byte counts is different than expected"),Ia=b.slice(Ja[xa],Ja[xa]+Ka[xa]));else{if(6===Ga||8===Ga||32946===Ga){ya=new Uint8Array(b,Ja[xa],Ka[xa]);cb=new k(ya);ya=cb.getBytes();Ia=
new ArrayBuffer(ya.length);var Qa=new Uint8Array(Ia);ya.length!==Va*La*Da*Fa/8&&console.log("strip byte counts is different than expected")}else 1===Ga&&(Ka[xa]!==Va*La*Da*Fa/8&&console.log("strip byte counts is different than expected"),Ia=new ArrayBuffer(Ka[xa]),ya=new Uint8Array(b,Ja[xa],Ka[xa]),Qa=new Uint8Array(Ia));switch(Ya){case "U16":case "S16":for(Ca=0;Ca<ya.length;Ca+=2)Qa[Ca]=ya[Ca+1],Qa[Ca+1]=ya[Ca];break;case "U32":case "S32":case "F32":for(Ca=0;Ca<ya.length;Ca+=4)Qa[Ca]=ya[Ca+3],Qa[Ca+
1]=ya[Ca+2],Qa[Ca+2]=ya[Ca+1],Qa[Ca+3]=ya[Ca]}}var mb=new Na(Ia);Ha.set(mb,lb)}var $a={width:La,height:Sa,pixelType:Ya};if(1===Da)$a.pixels=[Ha];else for($a.pixels=[],xa=0;xa<Da;xa++){var gb=new Na(Ma);for(Ua=0;Ua<Ma;Ua++)gb[Ua]=Ha[Ua*Da+xa];$a.pixels.push(gb)}ha=$a}}}if(null!==P){ha.maskData=new Uint8Array(ha.width*ha.height);if(1E24<Math.abs(P))for(O=0;O<ha.width*ha.height;O++)ha.maskData[O]=1E-6>Math.abs((ha.pixels[0][O]-P)/P)?0:1;else for(O=0;O<ha.width*ha.height;O++)ha.maskData[O]=ha.pixels[0][O]===
P?0:1;ha.noDataValue=P}return ha}}})},"esri/layers/rasterLib/tile/RasterHandler":function(){define("require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),function(H,k,n,r,m,l,b,a,c,f,e,g){function d(h){var p=new r;m(h).then(function(q){p.resolve()});return p.promise}
return function(){function h(p){this.customModules=p&&p.customModules}h.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};h.prototype.start=function(){this.stop();var p=new r,q=0,u=this.customModules?this.customModules.length+1:1,v=c.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",H,n),t=b.open(v,{client:this}).then(function(x){this._connection=x;q++;q===u&&(this._connected=!0,p.resolve())}.bind(this));this._openDL=[t];this.customModules&&this.customModules.forEach(function(x){t=
b.open(x,{client:this}).then(function(C){q++;q===u&&(this._connected=!0,p.resolve())});this._openDL.push(t);console.log(x)}.bind(this));return this._connectionPromise=p.promise};h.prototype.stop=function(){this._openDL?this._openDL.forEach(function(p){p.isFulfilled()||p.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();this._connection&&(this._connection.close(),this._connection=null)};h.prototype.decode=function(p){if(!this._connectionPromise.isFulfilled()||
!this._connection)return a.reject(Error("no connection"));var q={id:null};return this._connection.invoke("decode",p,[],q).then(function(u){u.targetWorker=q;return u})};h.prototype.process=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var q={id:null};p.layerId=this.rasterLayer.layerId;var u=new r;this._connection.invoke("process",p,[],q).then(function(v){v.targetWorker=q;v.src?Object.keys(v.src).forEach(function(t){v.src[t].pixelBlock=
new l(v.src[t].pixelBlock)}):v.src=null;v.pixelBlock&&(v.pixelBlock=new l(v.pixelBlock));u.resolve(v)});return u.promise};h.prototype.render=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var q={id:null};p.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",p,[],q).then(function(u){u.targetWorker=q;u.pixelBlock=u.pixelBlock?new l(u.pixelBlock):null;return u})};h.prototype.setLayer=function(p){if(!this._connectionPromise.isFulfilled()||
!this._connection)return a.reject(Error("no connection"));this.rasterLayer=p;p=this._connection.broadcast("setLayer",p,[],{id:null});return d(p)};h.prototype.setRasterFunction=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));p=this._connection.broadcast("setRasterFunction",p,[],{id:null});return d(p)};h.prototype.setRasterRenderer=function(p){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));
p=this._connection.broadcast("setRasterRenderer",p,[],{id:null});return d(p)};return h}()})},"esri/layers/vectorTiles/core/workers":function(){define(["require","exports","./workers/workers"],function(H,k,n){Object.defineProperty(k,"__esModule",{value:!0});for(var r in n)k.hasOwnProperty(r)||(k[r]=n[r])})},"esri/layers/vectorTiles/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),function(H,
k,n,r,m,l,b,a,c){function f(){if(q)return q;for(var u=e+g,v=[],t=function(C){var B=c.create(C).then(function(F){return p[C]=F});v.push(B)},x=0;x<u;x++)t(x);return q=r(v).then(function(){})}Object.defineProperty(k,"__esModule",{value:!0});k.Connection=b;k.RemoteClient=a;(b=navigator.hardwareConcurrency)||(b=n("safari")&&n("mac")||n("trident")?8:2);var e=n("esri-workers-debug")?1:Math.max(1,Math.ceil(b/2)),g=n("esri-workers-debug")?1:Math.max(1,Math.floor(b/2)),d=m.getLogger("esri.core.workers"),h=
0,p=[];k.initialize=function(){f()};k.open=function(u,v,t){void 0===v&&(v={});if(Array.isArray(u))return new k.Connection(u.map(function(B){return new k.RemoteClient(B,v.client)}));if("string"!==typeof u){d.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var x=u;u=v;v={client:x,strategy:t?"dedicated":"distributed"}}var C=v.strategy||"distributed";return"local"===C?l.create(function(B){H([u],function(F){B(k.RemoteClient.connect(F))})}).then(function(B){return new k.Connection([new k.RemoteClient(B,
v.client)])}):f().then(function(){if("dedicated"===C){var B=e+h++;h%=g;return p[B].open(u).then(function(F){return new k.Connection([new k.RemoteClient(F,v.client)])})}return l.all(p.map(function(F){return F.open(u)})).then(function(F){return new k.Connection(F.map(function(y){return new k.RemoteClient(y,v.client)}))})})};k.terminate=function(){for(var u=0;u<p.length;u++)p[u]&&p[u].terminate();p.length=0};var q})},"esri/layers/vectorTiles/core/Logger":function(){define(["require","exports","dojo/has"],
function(H,k,n){var r={info:0,warn:1,error:2};H=function(){function m(l){void 0===l&&(l={});this.module=l.module||"";this.writer=l.writer||null;this.level=l.level||null;null!=l.enabled&&(this.enabled=!!l.enabled);m._loggers[this.module]=this;l=this.module.lastIndexOf(".");-1!==l&&(this.parent=m.getLogger(this.module.slice(0,l)))}m.prototype.log=function(l){for(var b=[],a=1;a<arguments.length;a++)b[a-1]=arguments[a];this._isEnabled()&&this._matchLevel(l)&&(a=this._inheritedWriter())&&a.apply(void 0,
[l,this.module].concat(b))};m.prototype.error=function(){for(var l=[],b=0;b<arguments.length;b++)l[b]=arguments[b];this.log.apply(this,["error"].concat(l))};m.prototype.warn=function(){for(var l=[],b=0;b<arguments.length;b++)l[b]=arguments[b];this.log.apply(this,["warn"].concat(l))};m.prototype.info=function(){for(var l=[],b=0;b<arguments.length;b++)l[b]=arguments[b];this.log.apply(this,["info"].concat(l))};m.prototype.getLogger=function(l){return m.getLogger(this.module+"."+l)};m.getLogger=function(l){var b=
m._loggers[l];b||(b=new m({module:l}));return b};m.prototype._parentWithMember=function(l,b){for(var a=this;a&&null==a[l];)a=a.parent;return a?a[l]:b};m.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)};m.prototype._consoleWriter=function(l,b){for(var a=[],c=2;c<arguments.length;c++)a[c-2]=arguments[c];console[l].apply(console,["["+b+"]"].concat(a))};m.prototype._matchLevel=function(l){return r[this._parentWithMember("level","error")]<=r[l]};m.prototype._isEnabled=
function(){return this._parentWithMember("enabled",!0)};m._loggers={};return m}();k=H.getLogger("esri");n("dojo-debug-messages")?k.level="info":k.level="warn";return H})},"esri/layers/vectorTiles/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),function(H,k,n,r,m,l){function b(a){if(a){if("function"!==typeof a.forEach){var c=Object.keys(a),f=c.map(function(h){return a[h]});return b(f).then(function(h){var p={};c.forEach(function(q,
u){return p[q]=h[u]});return p})}var e=new n,g=[],d=a.length;0===d&&e.resolve(g);a.forEach(function(h){var p={promise:h};g.push(p);h.then(function(q){p.value=q}).catch(function(q){p.error=q}).then(function(){--d;0===d&&e.resolve(g)})});return e.promise}}Object.defineProperty(k,"__esModule",{value:!0});k.all=function(a){return m(a)};k.filter=function(a,c){var f=a.slice();return m(a.map(function(e,g){return c(e,g)})).then(function(e){return f.filter(function(g,d){return e[d]})})};k.eachAlways=b;k.create=
function(a,c){var f=new n(c);a(function(e){void 0===e&&(e=null);return r(e).then(f.resolve)},f.reject);return f.promise};k.reject=function(a){var c=new n;c.reject(a);return c.promise};k.resolve=function(a){void 0===a&&(a=null);var c=new n;c.resolve(a);return c.promise};k.after=function(a,c){void 0===c&&(c=null);var f=0,e=new n(function(){f&&(clearTimeout(f),f=0)});f=setTimeout(function(){e.resolve(c)},a);return e.promise};k.timeout=function(a,c,f){var e=0,g=new n(a.cancel);a.then(function(d){g.isFulfilled()||
(g.resolve(d),e&&(clearTimeout(e),e=0))});a.catch(function(d){g.isFulfilled()||(g.reject(d),e&&(clearTimeout(e),e=0))});e=setTimeout(function(){var d=f||new l("promiseUtils:timeout","The wrapped promise did not resolve within "+c+" ms");g.reject(d)},c);return g.promise};k.wrapCallback=function(a){var c=!1,f=new n(function(){return c=!0});a(function(e){c||f.resolve(e)});return f.promise};k.isThenable=function(a){return a&&"function"===typeof a.then};k.when=function(a){return r(a)}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(H,k,n,r,m){H=function(l){function b(a,c,f){var e=l.call(this,a,c,f)||this;return e instanceof b?e:new b(a,c,f)}n(b,l);b.prototype.toJSON=function(){return{name:this.name,message:this.message,details:r.clone(this.details),dojoType:this.dojoType}};b.fromJSON=function(a){var c=new b(a.name,a.message,a.details);null!=a.dojoType&&(c.dojoType=a.dojoType);return c};return b}(m);H.prototype.type="error";return H})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,n){k.__proto__=n}||function(k,n){for(var r in n)n.hasOwnProperty(r)&&(k[r]=n[r])};return function(k,n){function r(){this.constructor=k}H(k,n);k.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(H,k,n,r,
m,l){function b(h){return void 0!==h&&null!==h}function a(h){return b(h)?h:""}function c(h,p,q){var u=q.match(/([^\(]+)(\([^\)]+\))?/i),v=k.trim(u[1]);q=p[h];u=JSON.parse((u[2]?k.trim(u[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var t=u.utcOffset;if(-1===g.indexOf(v))v=k.getObject(v),k.isFunction(v)&&(q=v(q,h,p,u));else if("number"===typeof q||"string"===typeof q&&q&&!isNaN(Number(q)))switch(q=
Number(q),v){case "NumberFormat":h=k.mixin({},u);p=parseFloat(h.places);if(isNaN(p)||0>p)h.places=Infinity;return r.format(q,h);case "DateString":q=new Date(q);if(u.local||u.systemLocale)return u.systemLocale?q.toLocaleDateString()+(u.hideTime?"":" "+q.toLocaleTimeString()):q.toDateString()+(u.hideTime?"":" "+q.toTimeString());q=q.toUTCString();u.hideTime&&(q=q.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return q;case "DateFormat":return q=new Date(q),b(t)&&(q=n.add(q,"minute",q.getTimezoneOffset()-
t)),m.format(q,u)}return a(q)}function f(h,p){var q;if(p)for(q in h)h.hasOwnProperty(q)&&(void 0===h[q]?delete h[q]:h[q]instanceof Object&&f(h[q],!0));else for(q in h)h.hasOwnProperty(q)&&void 0===h[q]&&delete h[q];return h}function e(h){if(!h||"object"!=typeof h||k.isFunction(h))return h;if(h instanceof Int8Array||h instanceof Uint8Array||h instanceof Uint8ClampedArray||h instanceof Int16Array||h instanceof Int32Array||h instanceof Uint16Array||h instanceof Uint32Array||h instanceof Float32Array||
h instanceof Float64Array||h instanceof Date)return new h.constructor(h);if(h instanceof ArrayBuffer)return h.slice(0,h.byteLength);if("function"===typeof h.clone)h=h.clone();else if("function"===typeof h.map&&"function"===typeof h.forEach)h=h.map(e);else if("function"===typeof h.notifyChange&&"function"===typeof h.watch)h=h.clone();else{var p={},q,u={};for(q in h){var v=h[q];var t=!(q in u)||u[q]!==v;if(!(q in p)||p[q]!==v&&t)p[q]=e?e(v):v}h=p}return h}var g=["NumberFormat","DateString","DateFormat"],
d=/<\/?[^>]+>/g;return{equals:function(h,p){return h===p||"number"===typeof h&&isNaN(h)&&"number"===typeof p&&isNaN(p)||k.isFunction((h||{}).getTime)&&k.isFunction((p||{}).getTime)&&h.getTime()==p.getTime()||k.isFunction((h||{}).equals)&&h.equals(p)||k.isFunction((p||{}).equals)&&p.equals(h)||!1},mixin:k.mixin,valueOf:function(h,p){for(var q in h)if(h[q]==p)return q;return null},stripTags:function(h){if(h){var p=typeof h;if("string"===p)h=h.replace(d,"");else if("object"===p)for(var q in h)(p=h[q])&&
"string"===typeof p&&(p=p.replace(d,"")),h[q]=p}return h},substitute:function(h,p,q){if(b(q))if(k.isObject(q)){var u=q.first;var v=q.dateFormat;var t=q.numberFormat}else u=q;if(p&&"{*}"!==p)return k.replace(p,k.hitch({obj:h},function(C,B){C=B.split(":");return 1<C.length?(B=C[0],C.shift(),c(B,this.obj,C.join(":"))):v&&-1!==(v.properties||[]).indexOf(B)?c(B,this.obj,v.formatter||"DateString"):t&&-1!==(t.properties||[]).indexOf(B)?c(B,this.obj,t.formatter||"NumberFormat"):a(this.obj[B])}));p=[];var x;
p.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+l.fieldsSummary+'"\x3e\x3ctbody\x3e');for(x in h)if(q=h[x],v&&-1!==(v.properties||[]).indexOf(x)?q=c(x,h,v.formatter||"DateString"):t&&-1!==(t.properties||[]).indexOf(x)&&(q=c(x,h,t.formatter||"NumberFormat")),p.push("\x3ctr\x3e\x3cth\x3e"+x+"\x3c/th\x3e\x3ctd\x3e"+a(q)+"\x3c/td\x3e\x3c/tr\x3e"),u)break;p.push("\x3c/tbody\x3e\x3c/table\x3e");return p.join("")},filter:function(h,p,q){p=[k.isString(h)?h.split(""):h,q||H.global,k.isString(p)?
new Function("item","index","array",p):p];q={};var u;h=p[0];for(u in h)p[2].call(p[u],h[u],u,h)&&(q[u]=h[u]);return q},startsWith:function(h,p,q){q=q||0;return h.indexOf(p,q)===q},endsWith:function(h,p,q){if("number"!==typeof q||!isFinite(q)||Math.floor(q)!==q||q>h.length)q=h.length;q-=p.length;h=h.indexOf(p,q);return-1!==h&&h===q},isDefined:b,fixJson:f,clone:e}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(H,k,n){return function(){function r(m,
l,b){this instanceof r&&(this.name=m,this.message=l&&n.substitute(l,b,function(a){return null==a?"":a})||"",this.details=b)}r.prototype.toString=function(){return"["+this.name+"]: "+this.message};return r}()})},"esri/layers/vectorTiles/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],function(H,k,n){return function(){function r(m){this._clientIdx=0;this._clients=m}r.prototype.broadcast=function(m,l,b){for(var a=[],c=0,f=this._clients;c<f.length;c++)a.push(f[c].invoke(m,
l,b));return a};r.prototype.close=function(){for(var m=0,l=this._clients;m<l.length;m++)l[m].close();this._clients=[]};r.prototype.invoke=function(m,l,b,a){var c=a&&a.client;if(!this._clients||!this._clients.length)return n.reject(Error("Connection closed"));null!=c&&-1!==this._clients.indexOf(c)||this._clients.some(function(f){return f.isBusy()?!1:(c=f,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,c=this._clients[this._clientIdx]);m=c.invoke(m,l,b);a&&(a.client=c);return m};r.prototype.openPorts=
function(){return n.all(this._clients.map(function(m){return m.openPort()}))};return r}()})},"esri/layers/vectorTiles/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(H,k,n,r,m,l){function b(h,p){h["delete"](p)}var a=l.MessageType.CLOSE,c=l.MessageType.CANCEL,f=l.MessageType.INVOKE,e=l.MessageType.RESPONSE,g=l.MessageType.OPEN_PORT,d=function(){function h(p){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=
[];this._invoke=p;this._timer=null;this._process=this._process.bind(this)}h.prototype.push=function(p){p.type===l.MessageType.CANCEL?this._cancelledJobIds.add(p.jobId):(this._invokeMessages.push(p),null===this._timer&&(this._timer=setTimeout(this._process,0)))};h.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};h.prototype._process=function(){this._timer=null;for(var p=0,q=this._invokeMessages;p<q.length;p++){var u=q[p];this._cancelledJobIds.has(u.jobId)||
this._invoke(u)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return h}();return function(){function h(p,q,u){this._outJobs=new Map;this._inJobs=new Map;this._queue=new d(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=q;this._port=p;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=u}h.connect=function(p){var q=new MessageChannel;p="function"===typeof p?new p:"default"in p&&"function"===typeof p.default?new p.default:
p;p.remoteClient=new h(q.port1,p,q);return q.port2};h.prototype.close=function(){this._post({type:a});this._close()};h.prototype.isBusy=function(){return 0<this._outJobs.size};h.prototype.invoke=function(p,q,u){var v=this;if(!this._port)return m.reject(new r("remote-client:port-closed","Can't invoke(), port is closed"));var t=l.newJobId(),x=new n(function(){b(v._outJobs,t);v._post({type:c,jobId:t})});this._outJobs.set(t,x);this._post({type:f,jobId:t,methodName:p},q,u);return x.promise};h.prototype.openPort=
function(){var p=this,q=l.newJobId(),u=new n(function(){b(p._outJobs,q);p._post({type:c,jobId:q})});this._outJobs.set(q,u);this._post({type:g,jobId:q});return u.promise};h.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(p){p.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};h.prototype._onMessage=function(p){if(p=l.receiveMessage(p))switch(p.type){case e:this._onResponse(p);
break;case f:this._queue.push(p);break;case c:this._onCancel(p);break;case a:this._close();break;case g:this._onOpenPort(p)}};h.prototype._onCancel=function(p){var q=this._inJobs,u=p.jobId,v=q.get(u);this._queue.push(p);v&&(b(q,u),v.cancel())};h.prototype._onInvoke=function(p){var q=this,u=p.methodName,v=p.jobId;p=p.data;var t=this._inJobs,x=this._client,C=x[u];try{if(!C&&u&&-1!==u.indexOf("."))for(var B=u.split("."),F=0;F<B.length-1;F++)x=x[B[F]],C=x[B[F+1]];if("function"!==typeof C)throw new TypeError(u+
" is not a function");var y=C.call(x,p,this)}catch(w){this._post({type:e,jobId:v,error:l.toInvokeError(w)});return}m.isThenable(y)?(t.set(v,y),y.then(function(w){t.has(v)&&(b(t,v),q._post({type:e,jobId:v},w))}).catch(function(w){t.has(v)&&(b(t,v),w&&"cancel"===w.dojoType||q._post({type:e,jobId:v,error:l.toInvokeError(w||{message:"Error encountered at method "+u})}))})):this._post({type:e,jobId:v},y)};h.prototype._onOpenPort=function(p){var q=new MessageChannel;new h(q.port1,this._client);this._post({type:e,
jobId:p.jobId},q.port2,[q.port2])};h.prototype._onResponse=function(p){var q=p.jobId,u=p.error;p=p.data;var v=this._outJobs;if(v.has(q)){var t=v.get(q);b(v,q);u?t.reject(r.fromJSON(JSON.parse(u))):t.resolve(p)}};h.prototype._post=function(p,q,u){return l.postMessage(this._port,p,q,u)};return h}()})},"esri/layers/vectorTiles/core/workers/utils":function(){define(["require","exports","dojo/has"],function(H,k,n){function r(l){return l&&"object"===typeof l&&("result"in l||"transferList"in l)}Object.defineProperty(k,
"__esModule",{value:!0});(function(l){l[l.HANDSHAKE=0]="HANDSHAKE";l[l.CONFIGURE=1]="CONFIGURE";l[l.CONFIGURED=2]="CONFIGURED";l[l.OPEN=3]="OPEN";l[l.OPENED=4]="OPENED";l[l.RESPONSE=5]="RESPONSE";l[l.INVOKE=6]="INVOKE";l[l.CANCEL=7]="CANCEL";l[l.CLOSE=8]="CLOSE";l[l.OPEN_PORT=9]="OPEN_PORT"})(k.MessageType||(k.MessageType={}));var m=0;k.newJobId=function(){return m++};k.isTranferableResult=r;k.toInvokeError=function(l){return l?l.toJSON?JSON.stringify(l):JSON.stringify({name:l.name,message:l.message,
details:l.details,stack:l.stack}):null};k.postMessage=function(l,b,a,c){2===arguments.length||void 0===a&&void 0===c?l.postMessage(b):(n("esri-workers-supports-transfer-arraybuffer")||(c?(c=c.filter(function(f){return!(f instanceof ArrayBuffer)}),c.length||(c=null)):r(a)&&a.transferList&&(a.transferList=a.transferList.filter(function(f){return!(f instanceof ArrayBuffer)}),a.transferList.length||(a.transferList=null))),c?(b.data=a,l.postMessage(b,c)):r(a)?(b.data=a.result,a.transferList?l.postMessage(b,
a.transferList):l.postMessage(b)):(b.data=a,l.postMessage(b)))};k.receiveMessage=function(l){return l?(l=l.data)?"string"===typeof l?JSON.parse(l):l:null:null}})},"esri/layers/vectorTiles/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(H,k,n,r,m,l,b,a,c){var f=l.getLogger("esri.core.workers"),e=a.MessageType.CANCEL,g=a.MessageType.INVOKE,d=a.MessageType.OPEN,h=a.MessageType.OPENED,
p=a.MessageType.RESPONSE;return function(){function q(u,v){this._outJobs=new Map;this._inJobs=new Map;this.worker=u;this.id=v;u.addEventListener("message",this._onMessage.bind(this));u.addEventListener("error",function(t){t.preventDefault();f.error(t)})}q.create=function(u){return c.createWorker().then(function(v){return new q(v,u)})};q.prototype.terminate=function(){this.worker.terminate()};q.prototype.open=function(u){var v=this,t=a.newJobId(),x=new n(function(C){v._outJobs["delete"](t);v._post({type:e,
jobId:t})});this._outJobs.set(t,x);this._post({type:d,jobId:t,modulePath:u});return x.promise};q.prototype._onMessage=function(u){if(u=a.receiveMessage(u))switch(u.type){case h:case p:this._onResponse(u);break;case e:this._onCancel(u);break;case g:this._onInvoke(u)}};q.prototype._onCancel=function(u){(u=this._inJobs.get(u.jobId))&&u.cancel()};q.prototype._onInvoke=function(u){var v=this,t=u.methodName,x=u.jobId;u=u.data;var C=this._inJobs,B=r.workerMessages[t];try{if("function"!==typeof B)throw new TypeError(t+
" is not a function");var F=B.call(null,u)}catch(y){this._post({type:p,jobId:x,error:a.toInvokeError(y)});return}b.isThenable(F)?(C.set(x,F),F.then(function(y){C["delete"](x);v._post({type:p,jobId:x},y)}).catch(function(y){C["delete"](x);y||(y={message:"Error encountered at method"+t});y.dojoType&&"cancel"===y.dojoType||v._post({type:p,jobId:x,error:a.toInvokeError(y)})})):this._post({type:p,jobId:x},F)};q.prototype._onResponse=function(u){var v=u.jobId,t=u.error;u=u.data;var x=this._outJobs.get(v);
x&&(this._outJobs["delete"](v),t?x.reject(m.fromJSON(JSON.parse(t))):x.resolve(u))};q.prototype._post=function(u,v,t){return a.postMessage(this.worker,u,v,t)};return q}()})},"esri/layers/vectorTiles/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(H,k,n,r,m,l,b,a,c,f,e,g,d){function h(B){return a.create(function(F){function y(A){if(A=
g.receiveMessage(A))switch(A.type){case C:A=B;var z=m.workers.loaderUrl||e.DEFAULT_LOADER_URL;if(null!=m["default"]){var G=n({},m);delete G["default"];G=JSON.parse(JSON.stringify(G))}else G=JSON.parse(JSON.stringify(m));var I=m.workers.loaderConfig;I=e.default({baseUrl:I.baseUrl,locale:r.locale,has:n({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":c("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":c("esri-workers-supports-transfer-arraybuffer"),
"events-keypress-typed":0,"host-webworker":1},I.has),map:n({},I.map),paths:n({},I.paths),packages:I.packages||[]});A.postMessage({type:x,configure:{esriConfig:G,loaderUrl:z,loaderConfig:I}});break;case t:B.removeEventListener("message",y),B.removeEventListener("error",w),F(B)}}function w(A){A.preventDefault();B.removeEventListener("message",y);B.removeEventListener("error",w);u.warn("Failed to create Worker. Fallback to execute module in main thread",A);B=new d;B.addEventListener("message",y);B.addEventListener("error",
w)}B.addEventListener("message",y);B.addEventListener("error",w)})}Object.defineProperty(k,"__esModule",{value:!0});var p=f.normalize(H.toUrl("./worker.js")),q=!f.hasSameOrigin(p,location.href),u=b.getLogger("esri.core.workers"),v=null,t=g.MessageType.CONFIGURED,x=g.MessageType.CONFIGURE,C=g.MessageType.HANDSHAKE;k.createWorker=function(){if(!c("esri-workers"))return h(new d);if(!q){var B=void 0;try{B=new Worker(p)}catch(F){u.warn("Failed to create Worker. Fallback to execute module in main thread",
event),B=new d}return h(B)}v||(v=l(p,{responseType:"text"}));return v.then(function(F){return new Worker(URL.createObjectURL(new Blob([F.data],{type:"text/javascript"})))}).catch(function(F){u.warn("Failed to create Worker. Fallback to execute module in main thread",F);return new d}).then(function(F){return h(F)})}})},"esri/layers/vectorTiles/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(H){for(var k,n=1,r=arguments.length;n<r;n++){k=arguments[n];for(var m in k)Object.prototype.hasOwnProperty.call(k,
m)&&(H[m]=k[m])}return H}})},"esri/layers/vectorTiles/config":function(){define(["require","exports","esri/config"],function(H,k,n){Object.defineProperty(n,"workers",{get:function(){return n.defaults.workers},set:function(r){return n.defaults.workers=r}});return n})},"esri/layers/vectorTiles/request":function(){define(["require","exports","esri/request","dojo/_base/lang","dojo/Deferred"],function(H,k,n,r,m){return function(l,b){l=r.mixin({},{url:l,failOk:!0},b);"array-buffer"===b.responseType?(l.handleAs=
"arraybuffer",delete l.responseType):b.responseType&&(l.handleAs=b.responseType,delete l.responseType);null!==b.query&&(l.content=l.query,delete l.query);if(b.hasOwnProperty("allowImageDataAccess")){var a={allowImageDataAccess:b.allowImageDataAccess};delete l.allowImageDataAccess}var c=new m(function(){f.isFulfilled()||f.cancel()});var f=n(l,a).then(function(e){c.resolve({data:e})}).catch(function(e){e&&null!=e.httpCode&&(e.details=e.details||{},e.details.httpStatus=e.httpCode);c.reject(e)});return c.promise}})},
"esri/layers/vectorTiles/core/sniff":function(){define(["require","exports","dojo/sniff","./global","../views/webgl/context-util"],function(H,k,n,r,m){function l(){var f={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1},e=document.createElement("canvas");if(!e)return f;var g=m.createContext(e,{failIfMajorPerformanceCaveat:!0},"webgl");!g&&(g=m.createContext(e,{},"webgl"))&&
(f.majorPerformanceCaveat=!0);if(!g)return f;e=g.getParameter(g.VERSION);if(!e)return f;if(e=e.match(/^WebGL\s+([\d.]*)/))f.version=parseFloat(e[1]),f.available=.94<=f.version,e=g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.HIGH_FLOAT),f.supportsHighPrecisionFragment=e&&0<e.precision,f.supportsVertexShaderSamplers=0<g.getParameter(g.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f.supportsElementIndexUint=null!==g.getExtension("OES_element_index_uint"),f.supportsStandardDerivatives=null!==g.getExtension("OES_standard_derivatives");
return f}function b(){var f={available:!1,version:0},e=document.createElement("canvas");if(!e)return f;e=m.createContext(e,{},"webgl2");if(!e)return f;f.available=!0;e=e.getParameter(e.VERSION);if(!e)return f;if(e=e.match(/^WebGL\s+([\d.]*)/))f.version=parseFloat(e[1]);return f}(function(){var f=navigator.userAgent,e=f.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);f=f.match(/iPhone/i);e&&n.add("esri-mobile",e);f&&n.add("esri-iPhone",f);n.add("esri-phonegap",!!r.cordova);
n.add("esri-cors",n("esri-phonegap")||"XMLHttpRequest"in r&&"withCredentials"in new XMLHttpRequest);n.add("esri-geolocation",function(){return!!navigator.geolocation});n.add("esri-canvas-svg-support",function(){return!(n("trident")||n("ie"))});n.add("esri-secure-context",function(){if("isSecureContext"in r)return r.isSecureContext;if(r.location&&r.location.origin)return 0===r.location.origin.indexOf("https:")});n.add("esri-wasm","WebAssembly"in r);n("host-webworker")||(n.add("esri-workers","Worker"in
r),n.add("esri-script-sandbox",function(){return"MessageChannel"in r&&"HTMLIFrameElement"in r&&"sandbox"in HTMLIFrameElement.prototype}),n.add("esri-url-encodes-apostrophe",function(){var g=r.document.createElement("a");g.href="?'";return-1<g.href.indexOf("?%27")}),a||(a=l()),n.add("esri-webgl",a.available),n.add("esri-webgl-high-precision-fragment",a.supportsHighPrecisionFragment),n.add("esri-webgl-vertex-shader-samplers",a.supportsVertexShaderSamplers),n.add("esri-webgl-element-index-uint",a.supportsElementIndexUint),
n.add("esri-webgl-standard-derivatives",a.supportsStandardDerivatives),n.add("esri-webgl-major-performance-caveat",a.majorPerformanceCaveat),n.add("esri-featurelayer-webgl-labeling",!0),c||(c=b()),n.add("esri-webgl2",c.available))})();var a=null,c=null;return n})},"esri/layers/vectorTiles/core/global":function(){define(["require","exports"],function(H,k){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},
"esri/layers/vectorTiles/views/webgl/context-util":function(){define(["require","exports"],function(H,k){function n(b,a,c){void 0===a&&(a={});switch(c){case "webgl":var f=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":f=["webgl2"];break;default:f=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}c=null;for(var e=0;e<f.length;e++){var g=f[e];try{c=b.getContext(g,a)}catch(d){}if(c)break}return c}function r(b,a){(b=b.parentNode)&&(b.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}Object.defineProperty(k,"__esModule",{value:!0});k.createContextOrErrorHTML=function(b,a,c){void 0===a&&(a={});if(!window.WebGLRenderingContext)return r(b,m),null;a=n(b,a,c);return a?a:(r(b,l),null)};k.createContext=n;var m='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',l='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"esri/layers/vectorTiles/core/urlUtils":function(){define(["require","exports","esri/urlUtils","dojo/_base/url"],function(H,k,n,r){function m(x){return n.normalize(x)}function l(x){return"data:"===x.slice(0,5)}function b(x){return a(x)||v.test(x)}function a(x){return x&&"/"===x[0]&&"/"===x[1]}function c(x){return n.urlToObject(x)}function f(x){if("string"===typeof x)return new r(g(x));x.scheme||(x.scheme=k.appUrl.scheme);return x}function e(x){if(l(x))return null;var C=x.indexOf("://");if(-1===C&&
a(x))C=2;else if(-1!==C)C+=3;else return null;C=x.indexOf("/",C);return-1===C?x:x.slice(0,C)}function g(x,C,B){void 0===C&&(C=k.appBaseUrl);if(a(x))return B&&B.preserveProtocolRelative?x:"http"===k.appUrl.scheme&&k.appUrl.authority===e(x).slice(2)?"http:"+x:"https:"+x;if(v.test(x))return x;"/"===x[0]&&(B=C.indexOf("//"),B=C.indexOf("/",B+2),C=-1===B?C:C.slice(0,B));return h(C,x)}function d(x,C,B){void 0===B&&(B=!1);x=f(x);C=f(C);return B||x.scheme===C.scheme?x.host.toLowerCase()===C.host.toLowerCase()&&
x.port===C.port:!1}function h(){for(var x=[],C=0;C<arguments.length;C++)x[C]=arguments[C];if(x&&x.length){C=[];if(b(x[0])){var B=x[0],F=B.indexOf("//");C.push(B.slice(0,F+1));u.test(x[0])&&(C[0]+="/");x[0]=B.slice(F+2)}else"/"===x[0][0]&&C.push("");x=x.reduce(function(y,w){return w?y.concat(w.split("/")):y},[]);for(B=0;B<x.length;B++)F=x[B],".."===F&&0<C.length?C.pop():!F||"."===F&&0!==C.length||C.push(F);return C.join("/")}}function p(x,C,B){if(!(C&&B&&x&&b(x)))return x;var F=x.indexOf("//"),y=x.indexOf("/",
F+2),w=x.indexOf(":",F+2);y=Math.min(0>y?x.length:y,0>w?x.length:w);if(x.slice(F+2,y).toLowerCase()!==C.toLowerCase())return x;C=x.slice(0,F+2);x=x.slice(y);return""+C+B+x}function q(x,C,B){void 0===C&&(C=k.appBaseUrl);if(!b(x))return x;var F=m(x),y=F.toLowerCase();C=m(C).toLowerCase().replace(/\/+$/,"");if((B=B?m(B).toLowerCase().replace(/\/+$/,""):null)&&0!==C.indexOf(B))return x;for(var w=function(G,I,K){K=G.indexOf(I,K);return-1===K?G.length:K},A=w(y,"/",y.indexOf("//")+2),z=-1;y.slice(0,A+1)===
C.slice(0,A)+"/";){z=A+1;if(A===y.length)break;A=w(y,"/",A+1)}if(-1===z||B&&z<B.length)return x;x=F.slice(z);F=C.slice(z-1).replace(/[^/]+/g,"").length;if(0<F)for(y=0;y<F;y++)x="../"+x;else x="./"+x;return x}Object.defineProperty(k,"__esModule",{value:!0});k.normalize=m;k.canUseXhr=function(x){return n.canUseXhr(x)};k.removeTrailingSlash=function(x){return x.replace(/\/+$/,"")};H=Function("return this")();k.appUrl=new r(H.location);k.appBaseUrl=function(){var x=k.appUrl.path;x=x.substring(0,x.lastIndexOf(x.split("/")[x.split("/").length-
1]));return k.appUrl.scheme+"://"+k.appUrl.host+(null!=k.appUrl.port?":"+k.appUrl.port:"")+x}();var u=/^\s*file:/i,v=/^\s*[a-z][a-z0-9-+.]*:[^0-9]/i;k.isDataProtocol=l;k.isAbsolute=b;k.isProtocolRelative=a;k.urlToObject=c;k.getOrigin=e;k.makeAbsolute=g;k.hasSameOrigin=d;k.join=h;k.removeFile=function(x){var C=0;if(b(x)){var B=x.indexOf("//");-1!==B&&(C=B+2)}B=x.lastIndexOf("/");return B<C?x:x.slice(0,B+1)};k.addProxy=function(x){return n.addProxy(x)};k.makeData=function(x){return x.isBase64?"data:"+
x.mediaType+";base64,"+x.data:"data:"+x.mediaType+","+x.data};var t=/^data:(.*?)(;base64)?,(.*)$/;k.dataComponents=function(x){return(x=x.match(t))?{mediaType:x[1],isBase64:!!x[2],data:x[3]}:null};k.changeDomain=p;k.read=function(x,C){var B=C&&C.url&&C.url.path;x&&B&&(x=g(x,B,{preserveProtocolRelative:!0}));(C=C&&C.portal)&&!C.isPortal&&C.urlKey&&C.customBaseUrl?(B=C.urlKey+"."+C.customBaseUrl,C=d(k.appUrl,k.appUrl.scheme+"://"+B)?p(x,C.portalHostname,B):p(x,B,C.portalHostname)):C=x;return C};k.write=
function(x,C){if(!x)return x;!b(x)&&C&&C.blockedRelativeUrls&&C.blockedRelativeUrls.push(x);var B=g(x);if(C){var F=C.verifyItemRelativeUrls&&C.verifyItemRelativeUrls.rootPath||C.url&&C.url.path;F&&(B=q(B,F,F),B!==x&&C.verifyItemRelativeUrls&&C.verifyItemRelativeUrls.writtenUrls.push(B))}x=B;B=(C=C&&C.portal)&&!C.isPortal&&C.urlKey&&C.customBaseUrl?p(x,C.urlKey+"."+C.customBaseUrl,C.portalHostname):x;return B};k.makeRelative=q;k.removeQueryParameters=function(x){x=c(x);Object.keys(x.query||{});return x.path}})},
"esri/layers/vectorTiles/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(H,k,n,r,m){Object.defineProperty(k,"__esModule",{value:!0});k.DEFAULT_LOADER_URL=m.makeAbsolute(m.removeQueryParameters(H.toUrl("./worker-init.js")));k.DEFAULT_CONFIG={baseUrl:function(){var l=m.removeQueryParameters(H.toUrl("dojo/x.js"));return m.makeAbsolute(l.slice(0,l.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},
{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};k.default=
function(l){var b={async:l.async,isDebug:l.isDebug,locale:l.locale,baseUrl:l.baseUrl,has:n({},l.has),map:n({},l.map),packages:l.packages&&l.packages.concat()||[],paths:n({},l.paths)};l.hasOwnProperty("async")||(b.async=!0);l.hasOwnProperty("isDebug")||(b.isDebug=!1);l.baseUrl||(b.baseUrl=k.DEFAULT_CONFIG.baseUrl);k.DEFAULT_CONFIG.packages.forEach(function(e){a:{for(var g=b.packages,d=0;d<g.length;d++)if(g[d].name===e.name)break a;e=n({},e);d=m.removeQueryParameters(H.toUrl(e.name+"/x.js"));d=d.slice(0,
d.length-5);e.location=m.makeAbsolute(d);g.push(e)}});l=b.map=b.map||{};for(var a=0,c=Object.keys(k.DEFAULT_CONFIG.map);a<c.length;a++){var f=c[a];l[f]||(l[f]=k.DEFAULT_CONFIG.map[f])}return b}})},"esri/layers/vectorTiles/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(H,k,n,r,m){var l=function(){return function(){var c=this,f=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(e){c[e]=
function(){for(var g=[],d=0;d<arguments.length;d++)g[d]=arguments[d];return f[e].apply(f,g)}})}}(),b=r.MutationObserver||r.WebKitMutationObserver,a=function(){if(r.process&&r.process.nextTick)var c=function(g){r.process.nextTick(g)};else if(r.Promise)c=function(g){r.Promise.resolve().then(g)};else if(b){var f=[],e=document.createElement("div");(new b(function(){for(;0<f.length;)f.shift()()})).observe(e,{attributes:!0});c=function(g){f.push(g);e.setAttribute("queueStatus","1")}}return c}();return function(){function c(){this._dispatcher=
new l;this._isInitialized=!1;this._workerPostMessage({type:m.MessageType.HANDSHAKE})}c.prototype.terminate=function(){};Object.defineProperty(c.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(f){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=f)&&this.addEventListener("message",f)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(f){this._onerrorHandler&&
this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=f)&&this.addEventListener("error",f)},enumerable:!0,configurable:!0});c.prototype.postMessage=function(f,e){var g=this;a(function(){g._workerMessageHandler(new MessageEvent("message",{data:f}))})};c.prototype.dispatchEvent=function(f){return this._dispatcher.dispatchEvent(f)};c.prototype.addEventListener=function(f,e,g){this._dispatcher.addEventListener(f,e,g)};c.prototype.removeEventListener=function(f,e,g){this._dispatcher.removeEventListener(f,
e,g)};c.prototype._workerPostMessage=function(f,e){var g=this;a(function(){g.dispatchEvent(new MessageEvent("message",{data:f}))})};c.prototype._workerMessageHandler=function(f){var e=this;if(f=m.receiveMessage(f)){var g=f.jobId;switch(f.type){case m.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:m.MessageType.CONFIGURED});break;case m.MessageType.OPEN:f=f.modulePath,n("esri-webpack")?H(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline",
"esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",f],function(d,h,p,q,u,v,t,x){switch(x){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":h=p;break;case "esri/views/3d/layers/PointCloudWorker":h=q;break;case "esri/views/3d/layers/SceneLayerWorker":h=u;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":h=
v;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":h=t;break;default:h=x}d=d.connect(h);e._workerPostMessage({type:m.MessageType.OPENED,jobId:g,data:d})}):H(["./RemoteClient",f],function(d,h){d=d.connect(h);e._workerPostMessage({type:m.MessageType.OPENED,jobId:g,data:d})})}}};return c}()})},"esri/layers/vectorTiles/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(H,k,n){function r(m,l){if(Array.isArray(l)){var b=new n;m(l,function(){for(var a=
[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.resolve(a)});return b.promise}return r(m,[l]).then(function(a){return a[0]})}Object.defineProperty(k,"__esModule",{value:!0});k.when=r;k.getAbsMid=function(m,l,b){return l.toAbsMid?l.toAbsMid(m):b.id.replace(/\/[^\/]*$/gi,"/")+m}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(H,k,n){return{create:function(r,m){if(r){var l=r.renderTexture,b=Object.keys(r);
if(r.read&&!m)return r;r.read&&m&&(r=r.toJson());-1<b.indexOf("name")&&b.indexOf(!1)?(r=k.mixin({},r),m=this._parseV2(r,m)):(r="esri.layers.RasterFunction"===r.declaredClass?r.toJson():k.mixin({},r),m=this._parseV1(r,m));m.branchCount=m.updateBranchStructure();m.renderTexture||(m.renderTexture=!!l);return m}},_parseV1:function(r,m){var l=r.rasterFunction,b=r.rasterFunctionArguments,a=r.renderTexture||r.rasterFunctionArguments.renderTexture||!1,c,f,e,g,d,h,p;(g=b.raster||b.Raster)&&g.rasterFunction&&
(c=this._parseV1(g,m));(g=b.raster2||b.Raster2)&&g.rasterFunction&&(f=this._parseV1(g,m));(g=b.rasters||b.Rasters)&&0<g.length&&(e=g.map(k.hitch(this,function(q){return q&&q.rasterFunction?this._parseV1(q,m):q})));(g=b.dem||b.DEM)&&(g.functionName||g.rasterFunction)&&(d=this._parseV1(g,m));(g=b.fillRaster||b.FillRaster)&&(g.functionName||g.rasterFunction)&&(h=this._parseV1(g,m));g=n.functions[l];if(!g)return console.error("Function is not currently supported: "+l),null;l=new g(b);l.variableName&&
(g=b[l.variableName])&&(g.functionName||g.rasterFunction)&&(p=this._parseV1(g,m));r.outputPixelType&&(l.pixelType=r.outputPixelType);"$$"===c?l.functionArguments.raster=m&&m.raster:null!=c?l.functionArguments.raster=c:l.functionArguments.raster||(l.functionArguments.raster=m&&m.raster);null!=f&&(l.functionArguments.raster2=f);null!=e&&(l.functionArguments.rasters=e.map(function(q){"$$"===q&&(q=m&&m.raster);return q}));null!=d&&(l.functionArguments.dem=d);null!=h&&(l.functionArguments.fillRaster=h);
null!=p&&(l.functionArguments[l.variableName]=p);l.renderTexture=a;return l},_parseV2:function(r,m){if(!r)return null;r=k.clone(r);this._bindV2Args(r,m);var l={};this._convertTov1(r,l);return this._parseV1(l,m)},_bindV2Args:function(r,m){(r||m)&&Object.keys(r).forEach(function(l){r[l]["function"]&&r[l].arguments?this._bindV2Args(r[l].arguments,m):null!=m[r[l].name]&&(r[l].value=m[r[l].name])}.bind(this))},_convertV2Types:function(r){if(!r)return null;"ArgumentArray"===r.type?r.elements&&"RasterStatistics"===
r.elements[0].type&&(r=r.elements):r instanceof Array&&0===r.length&&(r=null);return r},_convertTov1:function(r,m){if((r||m)&&r["function"]){var l=r["function"],b=r.arguments;m.rasterFunction=l.type.replace("Function","");m.outputPixelType="UNKNOWN"===l.pixelType?"Unknown":l.pixelType;m.rasterFunctionArguments={};var a;Object.keys(b).forEach(function(c){b[c]["function"]&&b[c].arguments?(m.rasterFunctionArguments[c]={},this._convertTov1(b[c],m.rasterFunctionArguments[c])):(a=b[c].value,m.rasterFunctionArguments[c]=
"object"!==typeof a||a.functionArguments?a:this._convertV2Types(a))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v){return function(){function t(F){F.prototype.supportWebGL&&(C[F.prototype.functionName]=F);F.prototype.support2D&&(x[F.prototype.functionName]=F);B[F.prototype.functionName]=F}var x={},C={},B={};t(n);t(r);t(m);t(l);t(b);t(a);t(c);t(f);t(e);t(g);t(d);t(h);t(p);t(q);t(u);t(v);return{cpu:x,gpu:C,functions:B,register:t,getFunction:function(F){return B[F]},support:function(F,y){return!!("gpu"===y?C:"cpu"===y?x:B)[F]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(H,k,n,r,m,l,b,a){return H([n,b],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({raster:null},c)},bind:function(){var c=this.getSourceRasterInfo();if(!c.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=k.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=a.aspect(c.raster);this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:l.aspect,fragmentName:"Aspect"});var f=this._setupTextureData(c.raster),e=this.bindFrameBuffer(),g=this.gl,d=g.drawingBufferWidth;g=g.drawingBufferHeight;var h=f.extent;
this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/d,1/g],u_cellSize:[(h.xmax-h.xmin)/d,(h.ymax-h.ymin)/g]});this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:e.texture}}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),
function(H,k,n,r,m,l){return H(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(b){b&&(this.pixelType=b.outputPixelType||b.OutputPixelType||this.pixelType,this.renderTexture=b.renderTexture,this._initFunction())},mixinIgnoreCase:function(b,a){var c=Object.keys(b),f=Object.keys(a),e,g,d=c.length;for(e=0;e<f.length;e++){var h=a[f[e]];if(null!=h)for(g=0;g<d;g++)if(c[g].toLowerCase()===f[e].toLowerCase()){b[c[g]]=h;break}}return b},bind:function(b){},
setProcessingContext:function(b){if(!b)throw"cannot bind to layer without options";this.useWebGL=!!b.useWebGL;this._tileMode=!!b.tileMode;this._glSetting=b.glSetting;this._rawRasterInfo=b.rawRasterInfo;this._xformSetting=b.xformSetting||this._xformSetting;if(!this.useWebGL||this._glSetting&&this._glSetting.gl){this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var a=this.functionArguments.raster,c=this.functionArguments.raster2,
f=this.functionArguments.dem,e=this.functionArguments.fillRaster,g=this.functionArguments.rasters;a&&a.functionArguments&&a.setProcessingContext(b);c&&c.functionArguments&&c.setProcessingContext(b);f&&f.functionArguments&&f.setProcessingContext(b);e&&e.functionArguments&&e.setProcessingContext(b);if(g)for(a=0;a<g.length;a++)g[a]&&g[a].functionArguments&&g[a].setProcessingContext(b);this.bind()}},updateBranchStructure:function(){var b=0,a=this.functionArguments;a.raster&&a.raster.read&&a.raster.functionArguments&&
(b+=a.raster.updateBranchStructure());a.raster2&&a.raster2.read&&a.raster2.functionArguments&&(b+=a.raster2.updateBranchStructure(),a.raster2.isBranch=!0,a.raster&&a.raster.read&&(a.raster.isBranch=!0));a.rasters&&(b=a.rasters.length,a.rasters.forEach(function(c){c.read&&c.functionArguments&&(c.isBranch=!0)}));a.dem&&a.dem.read&&a.dem.functionArguments&&(b+=a.dem.updateBranchStructure());return 1===b?0:b},read:function(b){b=this.processRasterArgument(b);return this.useWebGL?this.readGL(b):this.read2D(b)},
hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var b,a={};if(this.functionArguments.raster2)a.functionArguments.raster=this._bindRaster(this.functionArguments.raster),a.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(a.rasters=[],b=0;b<this.functionArguments.rasters.length;b++)a.rasters[b]=this._bindRaster(this.functionArguments.rasters[b]);else a.raster=this._bindRaster(this.functionArguments.raster);
return this.sourceRasterInfo=a},processRasterArgument:function(b){var a=this.bind();if(!0!==a)throw a;var c={};if(this.functionArguments.raster2)c.raster=this._readRaster(this.functionArguments.raster,b),c.raster2=this._readRaster(this.functionArguments.raster2,b);else if(this.functionArguments.rasters)for(c.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)c.rasters[a]=this._readRaster(this.functionArguments.rasters[a],b);else c.raster=this._readRaster(this.functionArguments.raster,b);return c},
toJson:function(){var b=this.functionArguments,a=b.raster,c=b.raster2;b=b.rasters;a=a?a.toJson?a.toJson():a:null;c=c?c.toJson?c.toJson():c:null;var f;b&&0<b.length&&(f=b.map(function(e){return e.toJson?e.toJson():e}));b=k.mixin({},this.functionArguments);b.raster=a;b.raster2=c;b.rasters=f;b=this._fixRasterFunctionJson(b);return{rasterFunction:this.functionName,rasterFunctionArguments:b,outputPixelType:this.pixelType}},_initFunction:function(b){},_getIntegerRange:function(b){switch(b){case "U8":var a=
[0,255];break;case "U16":a=[0,65535];break;case "U32":a=[0,4294967295];break;case "S8":a=[-128,127];break;case "S16":a=[-32768,32767];break;case "S32":a=[-2147483648,2147483647]}return a},_calculatePixelType:function(b,a){return b&&"unknown"!==b.toLowerCase()?b:a},_clonePixelData:function(b){if(null==b)return b;var a={};b.extent&&(a.extent=new m(b.extent.xmin,b.extent.ymin,b.extent.xmax,b.extent.ymax,b.extent.spatialReference));b=b.pixelBlock;if(null==b)return a;a.pixelBlock=b.clone?b.clone():l.prototype.clone(b);
return a},_readRaster:function(b,a){if(null==b||"$$"===b)var c=this._clonePixelData(a.src[Object.keys(a.src)[0]]);else b&&b.rasterInfo&&!b.functionArguments?c=this._clonePixelData(a.src[b._rasterId]):isNaN(b)?b.read&&(c=b.functionArguments?b.read(a):this._clonePixelData(a)):(c=a.src?a.src[Object.keys(a.src)[0]]:a,a=c.pixelBlock,a=new Float32Array(a.width*a.height),a.fill(parseFloat(b)),c=this._clonePixelData(c),c.pixelBlock.pixels=[a],c.isConstant=!0);return c},_bindRaster:function(b){if(b&&"$$"!==
b)isNaN(b)?b.rasterInfo?a=b.rasterInfo:b.bind&&b.bind()&&(a=b.rasterInfo):a={};else var a=this._rawRasterInfo;a&&(a=a.clone?a.clone():new r(a),a.bandCount=a.bandCount||3);return a},_getOutputBand:function(b,a){switch(b){case "U8":b=new Uint8Array(a);break;case "U16":b=new Uint16Array(a);break;case "U32":b=new Uint32Array(a);break;case "S8":b=new Int8Array(a);break;case "S16":b=new Int16Array(a);break;case "S32":b=new Int32Array(a);break;case "U32":b=new Uint32Array(a);break;case "F32":b=new Float32Array(a);
break;case "F64":b=new Float64Array(a);break;default:b=new Float32Array(a)}return b},_clampBand:function(b,a,c){if(("F64"===a||"F32"===a)&&!c)return b;var f,e=this._getIntegerRange(a),g=b.length;if(e)for(c=e[1],e=e[0],a=this._getOutputBand(a,g),f=0;f<g;f++){var d=b[f];a[f]=d>c?c:d<e?e:d}else a=b;return a},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||new Date)-this._start}.bind(this)},
_addPerformanceMetric:function(b){n.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(b),50<self.rasterFunctionPerformance.length&&self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(b){for(var a in b)b.hasOwnProperty(a)&&(null==b[a]?delete b[a]:b[a]instanceof Object&&!b[a].sourceType&&this._fixRasterFunctionJson(b[a],!0));return b}})})},"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./pixelShaderScripts"],function(H,k,n){H={shaderType:"fragment",getShader:function(r,m){var l=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(l,m);r.compileShader(l);r.getShaderParameter(l,r.COMPILE_STATUS)||(l=null);return l}};k.mixin(H,n);return H})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nif (u_bandCount \x3d\x3d 1) {\nfloat alpha \x3d vp_ul.a * vp_ur.a * vp_ll.a * vp_lr.a;\nvec4 vp_nn \x3d texture2D(u_image, coords);\nreturn alpha \x3d\x3d 0.0 ? vp_nn : vec4(vp.rgb, alpha);\n}\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(H,k,n,r,m,l,b){return H(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var c=this._glSetting;this.isBranch?(c.branchIndex=(c.branchIndex+1)%c.branchCount,c=c.branches[c.branchIndex]):(c.pingpongIndex=(c.pingpongIndex+1)%c.pingpong.length,c=c.pingpong[c.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,c.frameBuffer);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return c},_initializeProgram:function(a){if(this.gl)try{var c=this.gl;c.viewport(0,
0,c.drawingBufferWidth,c.drawingBufferHeight);var f=this._glSetting.programUniforms,e="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,g=f[e];if(g)this._uniforms=g.uniforms,this.rasterProgram=g.program;else{var d=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?m.mesh:m.basic,h=m.getShader(c,a.vertex||d),p=r.getShader(c,a.fragment),q=this._loadProgram(h,p),u={rasterProgram:l.getUniforms(c,q)};f[e]={uniforms:u,program:q};this.rasterProgram=
q;this._uniforms=u}c.useProgram(this.rasterProgram);var v=c.getAttribLocation(this.rasterProgram,"a_texCoord"),t=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,t);var x=l.createMesh(this._xformSetting.meshSize);c.bufferData(c.ARRAY_BUFFER,x,c.STATIC_DRAW);c.enableVertexAttribArray(v);c.vertexAttribPointer(v,2,c.FLOAT,!1,0,0);c.disable(c.DEPTH_TEST);c.blendFunc(c.SRC_ALPHA,c.ZERO);c.disable(c.BLEND);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:a.fragmentName}}catch(C){console.error("webgl exception: "+C.message)}else console.error("WebGL is required.")},_setUniform:function(a,c,f){null!=c&&(f&&!this._uniforms[f]&&(this._uniforms[f]=l.getUniforms(this.gl,this[f])),f=f?this._uniforms[f]:this._uniforms.rasterProgram,(a=f[a]||f[a+"[0]"])&&l.setUniform(this.gl,a,c))},_setUniforms:function(a,c){var f=Object.keys(a),e,g=f.length;for(e=0;e<g;e++)this._setUniform(f[e],a[f[e]],c);this.rawInput?this._setUniform("u_flipY",!0,c):this._setUniform("u_flipY",
!1,c);this._tileMode?(this.rawInput?(a=this._xformSetting.offset,f=this._xformSetting.scale):(a=[0,0],f=[1,1]),this._setUniform("u_xformOffset",a,c),this._setUniform("u_xformScale",f,c),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,c),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,c),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,c),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,
this.gl.drawingBufferHeight]),c)):this._setUniform("u_projection",!1,c))):(a=[0,0],f=[1,1],this._setUniform("u_xformOffset",a,c),this._setUniform("u_xformScale",f,c));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(a,c){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&
(a=a.raster);this.rawInput=!0;var f=c&&c.notOriginal,e=c&&c.bandIDs;c&&c.reCreate?c=!1:(c=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(c=e?this._originalBandIDs.join("")===e.join(""):!1);0<this._glSetting.branchCount&&(c=!1);if(c&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};c=this._createTexture();f||(this.originalTexture=c,this._originalBandIDs=e);f=this.gl;var g=a.pixelBlock;this._rawResolution=g?[1/a.pixelBlock.width,
1/a.pixelBlock.height]:[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var d=0;e&&0<e.length&&g&&(d=Math.max.apply(null,e),g.pixels.length>d&&e&&(g.pixels=e.map(function(p){return g.pixels[p]}),g.statistics&&(g.statistics=e.map(function(p){return g.statistics[p]}))));e=g.width;d=g.height;f.getExtension("OES_texture_float");var h=g.getAsRGBAFloat();f.texImage2D(f.TEXTURE_2D,0,f.RGBA,e,d,0,f.RGBA,f.FLOAT,h);return{extent:a.extent,texture:c}},_setupPingPongTextures:function(){var a=this._glSetting;
if(!a||!a.pingpong){a.pingpong=[];var c=l.createBufferTexture(this.gl,!1);a.pingpong.push(c);c=l.createBufferTexture(this.gl,!1);a.pingpong.push(c);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var c=0,f=a.branchCount;if(0<f){for(c=0;c<f;c++){var e=l.createBufferTexture(this.gl,!1);a.branches.push(e)}a.branchIndex=f-1}}},_setupXformTexture:function(a){for(var c=this._createTexture(),f=this.gl,e=4*this._xformSetting.gridConfig.size[0],
g=this._xformSetting.gridConfig.size[1],d=new Float32Array(e*g*4),h=0,p=0;p<this._xformSetting.gridConfig.coefficients.length;p++)d[h++]=this._xformSetting.gridConfig.coefficients[p],2===p%3&&(d[h++]=1);f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,f.RGBA,e,g,0,f.RGBA,f.FLOAT,d);this._bindTexture(c,"u_transformGrid",a)},_createTexture:function(a){return l.createTexture(this.gl,a)},_bindTexture:function(a,c,f){c=c||"u_image";f=this._uniforms[f||"rasterProgram"];var e=this._getTextureIndex(c);
if(-1!==e){var g=this.gl;g.uniform1i(f[c].location,e);g.activeTexture(g.TEXTURE0+e);g.bindTexture(g.TEXTURE_2D,a)}},_getTextureIndex:function(a,c){c=this._uniforms[c||"rasterProgram"];if(!c||!c[a]||c[a].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===a)return 0;a="u_image"===a?0:parseInt(a.replace("u_image",""));return this._xformSetting.requireProjection?a+1:a},_drawGL:function(a){var c=this.gl;this.renderTexture?(c.enable(c.BLEND),c.bindFramebuffer(c.FRAMEBUFFER,null)):c.disable(c.BLEND);
a||c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);a=this._xformSetting.meshSize||[1,1];c.drawArrays(c.TRIANGLES,0,a[0]*a[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var c=a.getAttribLocation(this.meshProgram,"a_texCoord"),f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f);f=this._xformSetting.meshSize||
[1,1];var e=l.createMesh(f,!0);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.enableVertexAttribArray(c);a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,f[0]*f[1]*10)}},_setupMeshProgram:function(){var a=m.getShader(this.gl,m.mesh),c=r.getShader(this.gl,r.constant);return this._loadProgram(a,c)},_loadProgram:function(a,c){return l.loadProgram(this.gl,a,c)},_getShaderScript:function(a,
c){c=document.getElementById(c);if(!c)return null;a="";for(c=c.firstChild;c;)3==c.nodeType&&(a+=c.textContent),c=c.nextSibling;return a}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(H,k,n){H={shaderType:"vertex",getShader:function(r,m){var l=r.createShader(r.VERTEX_SHADER);r.shaderSource(l,m);r.compileShader(l);r.getShaderParameter(l,r.COMPILE_STATUS)||(l=null);return l}};k.mixin(H,n);return H})},"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],
function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var H={getUniforms:function(k,n){var r=k.getProgramParameter(n,k.ACTIVE_UNIFORMS),m,l,b={};for(m=0;m<r;m++)(l=k.getActiveUniform(n,m))&&(b[l.name]={location:k.getUniformLocation(n,l.name),info:l});return b},setUniform:function(k,n,r){var m=n.info,l=n.location,b=m.type;if(null==r)console.log("uniform "+n.info.name+" has null or undefined value");else switch(b){case k.FLOAT:1<m.size?0===r.length?console.log("uniform "+n.info.name+
" has length 0"):k.uniform1fv(l,r):k.uniform1f(l,r);break;case k.FLOAT_VEC2:if(0===r.length){console.log("uniform "+n.info.name+" has length 0");break}k.uniform2fv(l,r);break;case k.FLOAT_VEC3:if(0===r.length){console.log("uniform "+n.info.name+" has length 0");break}k.uniform3fv(l,r);break;case k.FLOAT_VEC4:if(0===r.length){console.log("uniform "+n.info.name+" has length 0");break}k.uniform4fv(l,r);break;case k.INT:case k.BOOL:1<m.size?0===r.length?console.log("uniform "+n.info.name+" has length 0"):
k.uniform1iv(l,r):k.uniform1i(l,r);break;case k.INT_VEC2:case k.BOOL_VEC2:if(0===r.length){console.log("uniform "+n.info.name+" has length 0");break}k.uniform2iv(l,r);break;case k.INT_VEC3:case k.BOOL_VEC3:if(0===r.length){console.log("uniform "+n.info.name+" has length 0");break}k.uniform3iv(l,r);break;case k.INT_VEC4:case k.BOOL_VEC4:0===r.length?console.log("uniform "+n.info.name+" has length 0"):k.uniform4iv(l,r)}},createTexture:function(k,n){var r=k.createTexture();k.bindTexture(k.TEXTURE_2D,
r);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,n?k.LINEAR:k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,n?k.LINEAR:k.NEAREST);return r},createBufferTexture:function(k,n,r){n=H.createTexture(k,n);k.getExtension("OES_texture_float");r=r||[k.drawingBufferWidth,k.drawingBufferHeight];k.texImage2D(k.TEXTURE_2D,0,k.RGBA,r[0],r[1],0,k.RGBA,k.FLOAT,null);r=k.createFramebuffer();
k.bindFramebuffer(k.FRAMEBUFFER,r);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,n,0);return{texture:n,frameBuffer:r}},getShader:function(k,n,r){r=r?k.createShader(k.VERTEX_SHADER):k.createShader(k.FRAGMENT_SHADER);k.shaderSource(r,n);k.compileShader(r);k.getShaderParameter(r,k.COMPILE_STATUS)||(console.log(k.getShaderInfoLog(r)),r=null);return r},loadProgram:function(k,n,r){var m=k.createProgram();k.attachShader(m,n);k.attachShader(m,r);k.linkProgram(m);k.getProgramParameter(m,
k.LINK_STATUS)||(console.warn("failed to load webgl program: "+k.getProgramInfoLog(m)),k.deleteProgram(m),m=null);return m},createMesh:function(k,n){if(!k||1===k[0]&&1===k[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var r=k&&n?new Float32Array(k[0]*k[1]*20):new Float32Array(k[0]*k[1]*12);var m=.9998/k[1],l=.9998/k[0],b,a,c=0;for(b=0;b<k[1];b++)for(a=0;a<k[0];a++){var f=1E-4+m*b;var e=1E-4+l*a;k&&!n?(r[c++]=f,r[c++]=e,r[c++]=f+m,r[c++]=e,r[c++]=f,r[c++]=e+l,r[c++]=f,r[c++]=e+l,r[c++]=f+m,
r[c++]=e,r[c++]=f+m,r[c++]=e+l):(r[c++]=f,r[c++]=e,r[c++]=f,r[c++]=e+l,r[c++]=f,r[c++]=e+l,r[c++]=f+m,r[c++]=e+l,r[c++]=f+m,r[c++]=e+l,r[c++]=f+m,r[c++]=e,r[c++]=f,r[c++]=e,r[c++]=f+m,r[c++]=e,r[c++]=f,r[c++]=e+l,r[c++]=f+m,r[c++]=e)}return r}};return H})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var H={Default:[0,0,0,0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,
-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,
.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,
.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(k){switch(k){case 0:return H.LineDetectionHorizontal;case 1:return H.LineDetectionVertical;case 2:return H.LineDetectionLeftDiagonal;case 3:return H.LineDetectionRightDiagonal;case 4:return H.GradientNorth;case 5:return H.GradientWest;case 6:return H.GradientEast;case 7:return H.GradientSouth;case 8:return H.GradientNorthEast;case 9:return H.GradientNorthWest;case 10:return H.SmoothArithmeticMean;case 11:return H.Smoothing3x3;case 12:return H.Smoothing5x5;
case 13:return H.Sharpening3x3;case 14:return H.Sharpening5x5;case 15:return H.Laplacian3x3;case 16:return H.Laplacian5x5;case 17:return H.SobelHorizontal;case 18:return H.SobelVertical;case 19:return H.Sharpen;case 20:return H.Sharpen2;case 21:return H.PointSpread;default:return H.Default}}};return H})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(H){return{hillshade:function(k,n){if(null!==k&&null!==k.pixelBlock&&null!==k.pixelBlock.pixels){var r=
this._clonePixelBlock(k.pixelBlock),m=n.altitude,l=n.azimuth,b=n.zFactor,a=n.psPower,c=n.psFactor,f=n.hillshadeType,e=n.slopeType,g=n.isGCS;1===f&&(b*=2);n=r.width;var d=r.height,h=r.pixels[0],p=r.mask,q=new Uint8Array(n*d);p&&q.set(p);var u=new Uint8Array(n*d),v=(k.extent.xmax-k.extent.xmin)/n,t=(k.extent.ymax-k.extent.ymin)/d,x=b/(8*v),C=b/(8*t);.001<b&&g&&(x/=111E3,C/=111E3);3===e&&(g?(x=111E3*v,C=111E3*t,x=(b+Math.pow(x,a)*c)/(8*x),C=(b+Math.pow(C,a)*c)/(8*C)):(x=(b+Math.pow(v,a)*c)/(8*v),C=(b+
Math.pow(t,a)*c)/(8*t)));g=(90-m)*Math.PI/180;m=Math.cos(g);var B=(360-l+90)*Math.PI/180;l=Math.sin(g)*Math.cos(B);g=Math.sin(g)*Math.sin(B);b=[];a=[];c=[];v=[315,270,225,360,180,0];var F=[60,60,60,60,60,90];e=[3,5,3,2,1,4];var y=e.reduce(function(T,W){return T+W});t=e.map(function(T){return T/y});if(1===f){var w=v.length;for(e=0;e<w;e++)m=F[e],l=v[e],g=(90-m)*Math.PI/180,m=Math.cos(g),B=(360-l+90)*Math.PI/180,l=Math.sin(g)*Math.cos(B),g=Math.sin(g)*Math.sin(B),b.push(m),a.push(l),c.push(g)}var A=
0;for(e=1;e<d-1;e++)for(F=e*n,v=1;v<n-1;v++)if(p&&!p[F+v])u[F+v]=0;else{B=0;if(p&&(B=p[F-n+v-1]+p[F-n+v]+p[F-n+v+1]+p[F+v-1]+p[F+v+1]+p[F+n+v-1]+p[F+n+v]+p[F+n+v+1],7>B)){u[F+v]=0;q[F+v]=0;continue}if(7===B){var z=p[F-n+v-1]?h[F-n+v-1]:h[F+v];var G=p[F-n+v]?h[F-n+v]:h[F+v];var I=p[F-n+v+1]?h[F-n+v+1]:h[F+v];B=p[F+v-1]?h[F+v-1]:h[F+v];var K=p[F+v+1]?h[F+v+1]:h[F+v];A=p[F+n+v-1]?h[F+n+v-1]:h[F+v];var Q=p[F+n+v]?h[F+n+v]:h[F+v];var N=p[F+n+v+1]?h[F+n+v+1]:h[F+v]}else z=h[F-n+v-1],G=h[F-n+v],I=h[F-n+
v+1],B=h[F+v-1],K=h[F+v+1],A=h[F+n+v-1],Q=h[F+n+v],N=h[F+n+v+1];B=(I+K+K+N-(z+B+B+A))*x;G=(A+Q+Q+N-(z+G+G+I))*C;I=Math.sqrt(1+B*B+G*G);A=0;if(0===f)Q=g*G-l*B,Q=255*(m+Q)/I,0>Q&&(Q=0),A=Q;else if(1===f)for(z=0;z<w;z++)Q=c[z]*G-a[z]*B,Q=255*(b[z]+Q)/I,0>Q&&(Q=0),A+=Q*t[z];u[F+v]=A}for(e=0;e<d;e++)u[e*n]=u[e*n+1],u[(e+1)*n-1]=u[(e+1)*n-2];for(e=1;e<n-1;e++)u[e]=u[e+n],u[e+(d-1)*n]=u[e+(d-2)*n];r.pixelType="U8";r.pixels=[u];r.statistics=[{minValue:0,maxValue:255}];p&&(r.mask=q);return{extent:k.extent,
pixelBlock:r}}},slope:function(k,n){if(null!==k&&null!==k.pixelBlock&&null!==k.pixelBlock.pixels){var r=this._clonePixelBlock(k.pixelBlock),m=n.zFactor,l=n.psPower,b=n.psFactor,a=n.slopeType,c=n.isGCS;n=r.width;var f=r.height,e=r.pixels[0],g=r.mask,d=new Uint8Array(n*f);g&&d.set(g);var h=new Float32Array(n*f),p=(k.extent.xmax-k.extent.xmin)/n,q=(k.extent.ymax-k.extent.ymin)/f,u=m/(8*p),v=m/(8*q);1E-4>Math.abs(m-1)&&c&&(u/=111E3,v/=111E3);3===a&&(c?(u=111E3*p,v=111E3*q,u=(m+Math.pow(u,l)*b)/(8*u),
v=(m+Math.pow(v,l)*b)/(8*v)):(u=(m+Math.pow(p,l)*b)/(8*p),v=(m+Math.pow(q,l)*b)/(8*q)));for(m=1;m<f-1;m++)for(b=m*n,l=1;l<n-1;l++)if(g&&!g[b+l])h[b+l]=0;else{q=0;if(g&&(q=g[b-n+l-1]+g[b-n+l]+g[b-n+l+1]+g[b+l-1]+g[b+l+1]+g[b+n+l-1]+g[b+n+l]+g[b+n+l+1],7>q)){h[b+l]=0;d[b+l]=0;continue}if(7===q){q=g[b-n+l-1]?e[b-n+l-1]:e[b+l];c=g[b-n+l]?e[b-n+l]:e[b+l];p=g[b-n+l+1]?e[b-n+l+1]:e[b+l];var t=g[b+l-1]?e[b+l-1]:e[b+l];var x=g[b+l+1]?e[b+l+1]:e[b+l];var C=g[b+n+l-1]?e[b+n+l-1]:e[b+l];var B=g[b+n+l]?e[b+n+
l]:e[b+l];var F=g[b+n+l+1]?e[b+n+l+1]:e[b+l]}else q=e[b-n+l-1],c=e[b-n+l],p=e[b-n+l+1],t=e[b+l-1],x=e[b+l+1],C=e[b+n+l-1],B=e[b+n+l],F=e[b+n+l+1];t=(p+x+x+F-(q+t+t+C))*u;q=(C+B+B+F-(q+c+c+p))*v;q=Math.sqrt(t*t+q*q);h[b+l]=1===a||3===a?57.2957795*Math.atan(q):100*q}for(m=0;m<f;m++)h[m*n]=h[m*n+1],h[(m+1)*n-1]=h[(m+1)*n-2];for(m=1;m<n-1;m++)h[m]=h[m+n],h[m+(f-1)*n]=h[m+(f-2)*n];r.pixelType="F32";r.pixels=[h];r.statistics=[{minValue:0,maxValue:255}];g&&(r.mask=d);return{extent:k.extent,pixelBlock:r}}},
aspect:function(k){if(null!==k&&null!==k.pixelBlock&&null!==k.pixelBlock.pixels){var n=this._clonePixelBlock(k.pixelBlock),r=n.width,m=n.height,l=n.pixels[0],b=n.mask,a=new Uint8Array(r*m);b&&a.set(b);var c=new Float32Array(r*m),f=1/((k.extent.xmax-k.extent.xmin)/r),e=1/((k.extent.ymax-k.extent.ymin)/m),g,d;for(g=1;g<m-1;g++){var h=g*r;for(d=1;d<r-1;d++)if(b&&!b[h+d])c[h+d]=0;else{var p=0;if(b&&(p=b[h-r+d-1]+b[h-r+d]+b[h-r+d+1]+b[h+d-1]+b[h+d+1]+b[h+r+d-1]+b[h+r+d]+b[h+r+d+1],7>p)){c[h+d]=0;a[h+d]=
0;continue}if(7===p){p=b[h-r+d-1]?l[h-r+d-1]:l[h+d];var q=b[h-r+d]?l[h-r+d]:l[h+d];var u=b[h-r+d+1]?l[h-r+d+1]:l[h+d];var v=b[h+d-1]?l[h+d-1]:l[h+d];var t=b[h+d+1]?l[h+d+1]:l[h+d];var x=b[h+r+d-1]?l[h+r+d-1]:l[h+d];var C=b[h+r+d]?l[h+r+d]:l[h+d];var B=b[h+r+d+1]?l[h+r+d+1]:l[h+d]}else p=l[h-r+d-1],q=l[h-r+d],u=l[h-r+d+1],v=l[h+d-1],t=l[h+d+1],x=l[h+r+d-1],C=l[h+r+d],B=l[h+r+d+1];v=(u+t+t+B-(p+v+v+x))*f;p=(x+C+C+B-(p+q+q+u))*e;0===v&&0===p?p=-1:(p=90-57.29578*Math.atan2(p,-v),0>p&&(p+=360),360===p?
p=0:360<p&&(p%=360));c[h+d]=p}}for(g=0;g<m;g++)c[g*r]=c[g*r+1],c[(g+1)*r-1]=c[(g+1)*r-2];for(g=1;g<r-1;g++)c[g]=c[g+r],c[g+(m-1)*r]=c[g+(m-2)*r];n.pixelType="F32";n.pixels=[c];n.statistics={minValue:0,maxValue:360};b&&(n.mask=a);return{extent:k.extent,pixelBlock:n}}},_clonePixelBlock:function(k){return k.clone?k.clone():H.clone(k)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),
function(H,k,n,r,m,l,b){return H([n,l],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=k.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:
1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=b.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);
return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.bandArithmetic,fragmentName:"bandArithmetic"});var c=this.functionArguments.bandIndexes.trim().split(" ").map(function(d){return parseInt(d,10)});this._infraredBandID=c[0]-1;this._visibleBandID=c[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==c.length?{bandIDs:[this._infraredBandID,this._visibleBandID,
this._infraredBandID]}:{bandIDs:[c[0]-1,c[1]-1,c[2]-1]});var f=this.bindFrameBuffer(),e=this.functionArguments.method,g=2<c.length?c.slice(2):null;this._alterBand?this._setUniforms({u_method:e,u_bandId_nir:0,u_bandId_red:1,u_constants:g}):this._setUniforms({u_method:e,u_bandId_nir:c[0]-1,u_bandId_red:c[1]-1,u_constants:g});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:f.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],
function(H){return{calculate:function(k,n){if(k&&k.pixels&&k.pixels.length){var r=n&&n.bandIndexes;n=n&&n.method;var m=r.trim().split(" ").map(function(a){return parseInt(a,10)}).filter(function(a){return null!=a});k=this._clonePixelBlock(k);var l=k.pixels,b=k.mask;switch(n){case 1:l=this._calculateNDVI(b,l[m[0]-1],l[m[1]-1]);break;case 2:l=this._calculateSAVI(b,l[m[0]-1],l[m[1]-1],m[2]);break;case 3:l=this._calculateTSAVI(b,l[m[0]-1],l[m[1]-1],m[2],m[3],m[4]);break;case 4:l=this._calculateMSAVI(b,
l[m[0]-1],l[m[1]-1]);break;case 5:l=this._calculateGEMI(b,l[m[0]-1],l[m[1]-1]);break;case 6:l=this._calculatePVI(b,l[m[0]-1],l[m[1]-1],m[2],m[3]);break;case 7:l=this._calculateGVITM(b,l[m[0]-1],l[m[1]-1],l[m[2]-1],l[m[3]-1],l[m[4]-1],l[m[5]-1]);break;case 8:l=this._calculateSultan(b,l[m[0]-1],l[m[1]-1],l[m[2]-1],l[m[3]-1],l[m[4]-1],l[m[5]-1]);break;case 9:l=this._calculateVARI(b,l[m[0]-1],l[m[1]-1],l[m[2]-1]);break;case 0:l=this._calculateUserDefined(b,l,r)}k.pixels=l;k.pixelType="F32";k.calculateStatistics();
return k}},_clonePixelBlock:function(k){return k.clone?k.clone():H.clone(k)},_parseUserDefined:function(k,n){k=k.replace(" ","");0===k.indexOf("-")&&(k="0"+k);0===k.indexOf("+")&&(k=k.slice(1,k.length));k=k.split("");var r=[],m=[],l="+-*/()".split(""),b,a="";for(b=0;b<k.length;b++){var c=k[b];l.some(function(f){return f===c})?(""!==a&&m.push(parseFloat(a)),r.push(c),a=""):"b"===c.toLowerCase()?(b++,a=c.concat(k[b]),m.push(n[parseInt(a[1],10)-1]),a=""):(a=a.concat(c),b===k.length-1&&m.push(parseFloat(a)))}return{ops:r,
nums:m}},_op:function(k,n,r,m){if(r.constructor===Number&&m.constructor===Number)return r+m;var l;if(r.constructor===Number){var b=m.length;var a=r;r=new Float32Array(b);for(l=0;l<b;l++)r[l]=a}else if(b=r.length,m.constructor===Number)for(a=m,m=new Float32Array(b),l=0;l<b;l++)m[l]=a;a=new Float32Array(b);if(null==k)if("+"===n)for(l=0;l<b;l++)a[l]=r[l]+m[l];else if("-"===n)for(l=0;l<b;l++)a[l]=r[l]-m[l];else if("*"===n)for(l=0;l<b;l++)a[l]=r[l]*m[l];else{if("/"===n)for(l=0;l<b;l++)a[l]=r[l]/m[l]}else if("+"===
n)for(l=0;l<b;l++)k[l]&&(a[l]=r[l]+m[l]);else if("-"===n)for(l=0;l<b;l++)k[l]&&(a[l]=r[l]-m[l]);else if("*"===n)for(l=0;l<b;l++)k[l]&&(a[l]=r[l]*m[l]);else if("/"===n)for(l=0;l<b;l++)k[l]&&(a[l]=r[l]/m[l]);return a},_shrinkOp:function(k,n){k.splice(n,1);var r=n=0,m=0;do{for(n=m=r=0;n<k.length;n++)if("("===k[n])r=n;else if(")"===k[n]){m=n;break}m===r+1&&k.splice(r,2)}while(m===r+1);return k},_getPriorityOpIndex:function(k,n){if(1===k.length)return{opIndex:0,numIndex:0};var r=n=0,m=0,l=-1,b=0;for(n=
0;n<k.length;n++)if("("===k[n])r=n;else if(")"===k[n]){m=n;break}var a=0===m?k:k.slice(r+1,m);for(n=0;n<a.length;n++)if("*"===a[n]||"/"===a[n]){l=n;break}if(!(-1<l))for(n=0;n<a.length;n++)if("+"===a[n]||"-"===a[n]){l=n;break}0<m&&(l+=r+1);for(n=0;n<l;n++)"("===k[n]&&b++;return{opIndex:l,numIndex:l-b}},_calculateUserDefined:function(k,n,r){n=this._parseUserDefined(r,n);r=n.ops;for(var m=n.nums,l,b,a;0<r.length&&(n=this._getPriorityOpIndex(r,m),l=r[n.opIndex],b=m[n.numIndex],a=m[n.numIndex+1],l=this._op(k,
l,b,a),1!==r.length);)r=this._shrinkOp(r,n.opIndex),m.splice(n.numIndex,2,l);return[l]},_calculateNDVI:function(k,n,r){var m=r.length,l=new Float32Array(m),b;if(null==k)for(b=0;b<m;b++){var a=r[b];var c=n[b];l[b]=(c-a)/(c+a)}else for(b=0;b<m;b++)k[b]&&(a=r[b],c=n[b],l[b]=(c-a)/(c+a));return[l]},_calculateSAVI:function(k,n,r,m){var l=r.length,b=new Float32Array(l),a;if(null==k)for(a=0;a<l;a++){var c=r[a];var f=n[a];b[a]=(f-c)/(f+c+m)*(1+m)}else for(a=0;a<l;a++)k[a]&&(c=r[a],f=n[a],b[a]=(f-c)/(f+c+
m)*(1+m));return[b]},_calculateTSAVI:function(k,n,r,m,l,b){var a=r.length,c=new Float32Array(a),f=-l*m+b*(1+m*m);if(null==k)for(b=0;b<a;b++){var e=r[b];var g=n[b];c[b]=m*(g-m*e-l)/(l*g+e+f)}else for(b=0;b<a;b++)k[b]&&(e=r[b],g=n[b],c[b]=m*(g-m*e-l)/(l*g+e+f));return[c]},_calculateMSAVI:function(k,n,r){var m=r.length,l=new Float32Array(m),b;if(null==k)for(b=0;b<m;b++){var a=r[b];var c=n[b];l[b]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*c+1,2)-8*(c-a)))}else for(b=0;b<m;b++)k[b]&&(l[b]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*
c+1,2)-8*(c-a))));return[l]},_calculateGEMI:function(k,n,r){var m=r.length,l=new Float32Array(m),b;if(null==k)for(b=0;b<m;b++){var a=r[b];var c=n[b];c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5);l[b]=c*(1-.25*c)-(a-.125)/(1-a)}else for(b=0;b<m;b++)k[b]&&(a=r[b],c=n[b],c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5),l[b]=c*(1-.25*c)-(a-.125)/(1-a));return[l]},_calculatePVI:function(k,n,r,m,l){var b=r.length,a=new Float32Array(b),c,f=Math.sqrt(1+m*m);if(null==k)for(c=0;c<b;c++){var e=r[c];var g=n[c];a[c]=(g-m*e-l)/f}else for(c=
0;c<b;c++)k[c]&&(e=r[c],g=n[c],a[c]=(g-m*e-l)/f);return[a]},_calculateGVITM:function(k,n,r,m,l,b,a){var c=n.length,f=new Float32Array(c),e;if(null==k)for(e=0;e<c;e++)f[e]=-.2848*n[e]-.2435*r[e]-.5436*m[e]+.7243*l[e]+.084*b[e]-1.18*a[e];else for(e=0;e<c;e++)k[e]&&(f[e]=-.2848*n[e]-.2435*r[e]-.5436*m[e]+.7243*l[e]+.084*b[e]-1.18*a[e]);return[f]},_calculateSultan:function(k,n,r,m,l,b,a){r=n.length;var c=new Float32Array(r),f=new Float32Array(r),e=new Float32Array(r),g;if(null==k)for(g=0;g<r;g++)c[g]=
b[g]/a[g]*100,f[g]=b[g]/n[g]*100,e[g]=m[g]/l[g]*(b[g]/l[g])*100;else for(g=0;g<r;g++)k[g]&&(c[g]=b[g]/a[g]*100,f[g]=b[g]/n[g]*100,e[g]=m[g]/l[g]*(b[g]/l[g])*100);return[c,f,e]},_calculateVARI:function(k,n,r,m){var l=n.length,b=new Float32Array(l),a;if(null==k)for(a=0;a<l;a++){var c=n[a];var f=r[a];var e=m[a];b[a]=(f-c)/(f+c-e)}else for(a=0;a<l;a++)if(k[a])for(a=0;a<l;a++)c=n[a],f=r[a],e=m[a],b[a]=(f-c)/(f+c-e);return[b]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,k,n,r,m,l,b){return H([r,l],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;if(a){if(a.features||a[0].attributes){a=a.features||a;var c=Object.keys(a[0].attributes);var f=c.filter(function(q){return"alpha"===
q.toLowerCase()})[0];var e=c.filter(function(q){return"value"===q.toLowerCase()})[0];var g=c.filter(function(q){return"red"===q.toLowerCase()})[0];var d=c.filter(function(q){return"green"===q.toLowerCase()})[0];var h=c.filter(function(q){return"blue"===q.toLowerCase()})[0];if(!(e&&g&&d&&h))throw"invalid colormap";a=a.map(function(q){return f?[q.attributes[e],q.attributes[g],q.attributes[d],q.attributes[h],q.attributes[f]]:[q.attributes[e],q.attributes[g],q.attributes[d],q.attributes[h]]});var p=1.1>
Math.max.apply(null,a.map(function(q){return q[1]}));c=f&&1.1>Math.max.apply(null,a.map(function(q){return q[4]}));if(p)for(p=0;p<a.length;p++)a[p][1]=Math.round(255*a[p][1]),a[p][2]=Math.round(255*a[p][2]),a[p][3]=Math.round(255*a[p][3]),c&&(a[p][4]=Math.round(255*a[p][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=k.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var c=b.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:c}},_binarySearchClr:function(a,c){for(var f=0,e=a.length-1,g=0,d=0;f<e;)if(g=Math.floor((f+e)/2),d=a[g],d[0]<c)f=g;else if(d[0]>c)e=g;else return d.slice(1);return null},_sortClr:function(a,c){var f,e=[];for(f=0;f<a.length;f++)e.push(a[f]);for(f=0;f<e.length-1;f++){var g=e[f];for(a=f+1;a<e.length;a++)g[0]>e[a][0]&&(g=e[a],e[a]=e[f],
e[f]=g)}if(c)for(f=0;f<e.length/2;f++)g=e[f],e[e.length-1-f]=e[f],e[f]=g;return e},_invertColorRamp:function(a){if(!a)return a;var c={type:a.type};"random"===a.type?c=a:"multipart"===a.type?c.colorRamps=a.colorRamps.map(function(f){return{fromColor:f.toColor,toColor:f.fromColor}}).reverse():(c.fromColor=a.toColor,c.toColor=a.fromColor);return c},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var a=b.buildIndexedColormap(this.functionArguments.colormap);this._alphaSpecified=
a&&a.alphaSpecified;this._indexedColormap=a&&a.indexedColormap;this._indexedColormapOffset=a&&a.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?n.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):n.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?n.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
n.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=n.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var c=0;0>a[0][0]&&(c=a[0][0]);var f=[],e=5===a[0].length,g;for(g=0;g<a.length;g++)f[a[g][0]-c]=e?a[g].slice(1):a[g].slice(1).concat([255]);return f},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:m.colormap,fragmentName:"Colormap"});var c=this._indexedColormap,f=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));var e=this._clrTexture,g=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:f,u_indexedColormapMaxIndex:c.length/4-1});this._bindTexture(e,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:g.texture}},_setupColormapTexture:function(a){var c=
this._createTexture(),f=this.gl,e=a.length/4,g=new Float32Array(a.length),d,h=this.renderTexture?255:1;for(d=0;d<a.length;d++)g[d]=a[d]/h;f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,f.RGBA,e,1,0,f.RGBA,f.FLOAT,g);return c}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(H,k,n){return{createAlgorithmicColorRamp:function(r,m){if(!r)return null;var l=r.fromColor,b=r.toColor;if(!l||!b)return null;
void 0===l.r&&3<=l.length&&(l={r:l[0],g:l[1],b:l[2]});void 0===b.r&&3<=b.length&&(b={r:b[0],g:b[1],b:b[2]});var a=r.size||256;r=r.algorithm||"cie-lab";if(1===a)var c=[l.r,l.g,l.b,255];else if(2===a)c=[l.r,l.g,l.b,255,b.r,b.g,l.b,255];else if(-1<r.toLowerCase().indexOf("hsv")){c=n.toHSV(l);b=n.toHSV(b);a=a||256;var f=0===c.s,e=0===b.s;l=c.h;r=b.h;f&&!e?l=c.h=r:e&&!f&&(r=b.h=l);f=Math.abs(r-l);180>f?r=(r-l)/(a-1):(f=360-f,r=l>r?f/(a-1):-f/(a-1));f=(b.s-c.s)/(a-1);e=(b.v-c.v)/(a-1);var g=c.s;c=c.v;var d,
h=new Uint8Array(4*a);for(d=0;d<a-1;d++){var p=n.toRGB({h:l,s:g,v:c});h[4*d]=p.r;h[4*d+1]=p.g;h[4*d+2]=p.b;h[4*d+3]=255;l+=r;g+=f;c+=e;360<l?l-=360:0>l&&(l+=360)}p=n.toRGB(b);h[4*(a-1)]=p.r;h[4*(a-1)+1]=p.g;h[4*(a-1)+2]=p.b;h[4*(a-1)+3]=255;c=h}else if(-1<r.toLowerCase().indexOf("lch")){g=n.toLCH(l);b=n.toLCH(b);a=a||256;c=(b.l-g.l)/(a-1);l=(b.c-g.c)/(a-1);r=(b.h-g.h)/(a-1);f=g.l;e=g.c;g=g.h;h=new Uint8Array(4*a);for(d=0;d<a-1;d++)p=n.toRGB({l:f,c:e,h:g}),h[4*d]=p.r,h[4*d+1]=p.g,h[4*d+2]=p.b,h[4*
d+3]=255,f+=c,e+=l,g+=r;p=n.toRGB(b);h[4*(a-1)]=p.r;h[4*(a-1)+1]=p.g;h[4*(a-1)+2]=p.b;h[4*(a-1)+3]=255;c=h}else if(-1<r.toLowerCase().indexOf("lab")){g=n.toLAB(l);b=n.toLAB(b);a=a||256;c=(b.l-g.l)/(a-1);l=(b.a-g.a)/(a-1);r=(b.b-g.b)/(a-1);f=g.l;e=g.a;g=g.b;h=new Uint8Array(4*a);for(d=0;d<a-1;d++)p=n.toRGB({l:f,a:e,b:g}),h[4*d]=p.r,h[4*d+1]=p.g,h[4*d+2]=p.b,h[4*d+3]=255,f+=c,e+=l,g+=r;p=n.toRGB(b);h[4*(a-1)]=p.r;h[4*(a-1)+1]=p.g;h[4*(a-1)+2]=p.b;h[4*(a-1)+3]=255;c=h}if(m&&!1===m.flattened)for(m=c,
c=[],b=0;b<c/4;b++)c[b]=m.slice(4*b,4*b+4);return c},createMultiPartColorRamp:function(r,m){if(!r)return null;m=m&&k.clone(m)||{flattened:!0};var l=r.colorRamps;if(!l||0===l.length)return null;var b=r.size||256;r=Math.max(Math.floor(b/l.length),1);var a=Math.max(r,b-(l.length-1)*r),c=!1!==m.flattened;m.flattened=!0;b=(l.length-1)*r+a;var f=new Uint8Array(4*b);for(b=0;b<l.length;b++){var e={fromColor:l[b].fromColor,toColor:l[b].toColor,size:b===l.length-1?a:r};f instanceof Array?f.concat(this.createAlgorithmicColorRamp(e,
m)):f.set(this.createAlgorithmicColorRamp(e,m),r*b*4)}if(!c)for(m=f,f=[],b=0;b<f/4;b++)f[b]=m.slice(4*b,4*b+4);return f},createRandomColorRamp:function(r){r=r||{};var m=r.size||256,l=!1===r.flattened;var b=l?new Uint8Array(4*m):[];for(r=0;r<m;r++)l?(b[4*r]=Math.round(255*Math.random()),b[4*r+1]=Math.round(255*Math.random()),b[4*r+2]=Math.round(255*Math.random()),b[4*r+3]=255):b[r]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return b}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(H){return{mask:function(k,n){if(k&&k.pixels&&k.pixels.length){k=this._clonePixelBlock(k);var r=n.includedRanges,m=n.noDataInterpretation;n=n.noDataValues;if(null===r&&null===n)return k;var l=k.pixels,b=k.mask,a=k.width*k.height,c=l.length,f;if(null!==n&&n.length!==c)throw"expect "+c+" elements in noDataValues";if(null!==r&&r.length!==2*c)throw"expect "+2*c+" elements in IncludeRanges";if(null==b){b=new Uint8Array(a);for(f=0;f<a;f++)b[f]=1;k.mask=b}if(0===m)for(m=0;m<c;m++){var e=l[m];var g=
null===r?null:r[2*m];var d=null===r?null:r[2*m+1];var h=null===n?null:parseFloat(n[m]);if(null===g||null===d)for(f=0;f<a;f++){if(b[f]){var p=e[f];p===h&&(b[f]=0)}}else if(null===h)for(f=0;f<a;f++)b[f]&&(p=e[f],p<g||p>d)&&(b[f]=0);else for(f=0;f<a;f++)b[f]&&(p=e[f],p<g||p>d||p===h)&&(b[f]=0)}else{var q=new Uint8Array(a);for(f=0;f<a;f++)q[f]=b[f];for(m=0;m<c;m++)if(e=l[m],g=null===r?null:r[2*m],d=null===r?null:r[2*m+1],h=null===n?null:parseFloat(n[m]),null===g||null===d)for(f=0;f<a;f++)q[f]&&(p=e[f],
p!==h&&(q=0));else if(null===h)for(f=0;f<a;f++)q[f]&&(p=e[f],p<=g&&p<=d&&(q=0));else for(f=0;f<a;f++)q[f]&&(p=e[f],p<=g&&p<=d&&p!==h&&(q=0));for(f=0;f<a;f++)b[f]&&q[f]&&(b[f]=0)}return k}},calculateStatisticsHistograms:function(k,n){k=this._clonePixelBlock(k);n=k.pixelType;var r=k.pixels,m=k.mask,l=r.length,b,a,c=[],f;for(b=0;b<l;b++){var e={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var g=e.counts;var d=r[b];if("U8"===n)if(m)for(a=0;a<k.width*k.height;a++)m[a]&&g[d[a]]++;else for(a=
0;a<k.width*k.height;a++)g[d[a]]++;else{var h=k.statistics[b].minValue;var p=k.statistics[b].maxValue;e.min=h;e.max=p;p=(p-h)/256;var q=new Uint32Array(257);if(m)for(a=0;a<k.width*k.height;a++)m[a]&&q[Math.floor((d[a]-h)/p)]++;else for(a=0;a<k.width*k.height;a++)q[Math.floor((d[a]-h)/p)]++;for(a=0;255>a;a++)g[a]=q[a];g[255]=q[255]+q[256]}c.push(e);h=k.statistics[b].minValue;p=k.statistics[b].maxValue;for(a=q=f=d=0;a<e.size;a++)d+=g[a],f+=a*g[a];f/=d;for(a=0;a<e.size;a++)q+=g[a]*Math.pow(a-f,2);g=
Math.sqrt(q/(d-1));a=(f+.5)*(e.max-e.min)/e.size+e.min;e=g*(e.max-e.min)/e.size;k.statistics[b]={min:h,minValue:h,max:p,maxValue:p,mean:a,stddev:e}}k.histograms=c;return k},buildIndexedColormap:function(k,n){if(!k)return null;var r=0;0>k[0][0]&&(r=k[0][0]);var m=Math.max(256,k[k.length-1][0]-r);if(65536<m)return null;var l=new Uint8Array(4*m),b=[],a=0,c=5===k[0].length;if(n)for(b=k[a],n=b[0]-r;n<m;n++)l[4*n]=b[1],l[4*n+1]=b[2],l[4*n+2]=b[3],l[4*n+3]=c?b[4]:255,n===b[0]-r&&(b=a===k.length-1?b:k[++a]);
else for(n=0;n<k.length;n++)b=k[n],a=4*(b[0]-r),l[a]=b[1],l[a+1]=b[2],l[a+2]=b[3],l[a+3]=c?b[4]:255;return{indexedColormap:l,offset:r,alphaSpecified:c}},colorize:function(k,n){if(null!==k&&null!==k.pixels){k=this._clonePixelBlock(k);var r=k.pixels,m=k.width*k.height,l=k.mask,b=n.indexedColormap,a=n.indexedColormapOffset,c=b&&b.length-1,f=n.indexed2DColormap;n=n.alphaSpecified;if(3<=r.length)throw"colormap only works on single band image";var e=r[0],g=new Uint8Array(e.length),d=new Uint8Array(e.length),
h=new Uint8Array(e.length),p=0;if(b)if(l)for(r=0;r<m;r++)l[r]&&(p=4*(e[r]-a),p<a||p>c?l[r]=0:(g[r]=b[p],d[r]=b[p+1],h[r]=b[p+2],l[r]=b[p+3]));else{l=new Uint8Array(m);for(r=0;r<m;r++)p=4*(e[r]-a),p<a||p>c?l[r]=0:(g[r]=b[p],d[r]=b[p+1],h[r]=b[p+2],l[r]=b[p+3]);k.mask=l}else if(l)for(r=0;r<m;r++)l[r]&&(b=f[e[r]],g[r]=b[0],d[r]=b[1],h[r]=b[2],l[r]=b[3]);else{l=new Uint8Array(m);for(r=0;r<m;r++)b=f[e[r]],g[r]=b[0],d[r]=b[1],h[r]=b[2],l[r]=b[3];k.mask=l}k.pixels=[g,d,h];k.statistics=null;k.pixelType="U8";
k.maskIsAlpha=n;return k}},convolute:function(k,n){k=this._clonePixelBlock(k);var r=k.pixels,m=k.width,l=k.height,b=m*l,a=r.length,c,f,e,g,d=[],h=[],p=n.normalizedKernel,q=n.kernelRows,u=n.kernelCols;for(n=0;n<a;n++){var v=r[n];var t=new Float32Array(b);t.set(v);for(e=1;e<l-1;e++){var x=e*m;for(g=1;g<m-1;g++){for(c=h=0;c<q;c++)for(f=0;f<u;f++)h+=v[x+g+(c-1)*m+f-1]*p[c*u+f];t[x+g]=h}}d.push(t)}k.pixels=d;return k},contrastBrightnessStretch:function(k,n){if(null!==k&&null!==k.pixels){k=this._clonePixelBlock(k);
var r=k.pixels,m=k.mask,l=k.width*k.height,b=r.length;var a=n&&n.contrastOffset;n=n&&n.brightnessOffset;if("U8"!==k.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var c=this._createContrastBrightnessLUT(a,n);if(null==m)for(a=0;a<l;a++)for(n=0;n<b;n++)r[n][a]=c[r[n][a]];else for(a=0;a<l;a++)if(m[a])for(n=0;n<b;n++)r[n][a]=c[r[n][a]];k.pixelType="U8";return k}},isNull:function(k,n){if(null!==k&&null!==k.pixels){k=this._clonePixelBlock(k);n=k.mask;var r=
k.pixels[0],m=r.length,l;if(n){for(l=0;l<m;l++)r[l]=n[l]?0:1;k.mask=null}else if(r.fill)r.fill(0);else for(l=0;l<m;l++)r[l]=0;return k}},setNull:function(k){if(null!==n&&null!==n.pixels){var n=this._clonePixelBlock(k);k=n.mask;var r=n.pixels[0],m=r.length,l;k=k||new Uint8Array(m);for(l=0;l<m;l++)k[l]=r[l]?0:1;n.mask=k;return n}},local:function(k,n){if(!n)return k[0];var r=n.rasterCountNeeded;n=n.functor;var m=this._clonePixelBlock(k[0]);if(null!==m&&null!==m.pixels){var l=m.width*m.height,b;k=(b=
k[1])&&b.pixels[0];var a=b&&b.mask,c=m.mask,f=m.pixels[0];if(2===r)if(!c&&a)c=a;else if(c&&a)for(b=0;b<l;b++)c[b]=c[b]&&a[b]?1:0;m.mask=c;if(1===r)if(null==c)for(b=0;b<l;b++)f[b]=n(f[b]);else for(b=0;b<l;b++)c[b]&&(f[b]=n(f[b]));else if(2===r)if(null==c)for(b=0;b<l;b++)f[b]=n(f[b],k[b]);else for(b=0;b<l;b++)c[b]&&(f[b]=n(f[b],k[b]));m.mask=c;m.calculateStatistics();return m}},remapColor:function(k,n){k=this._clonePixelBlock(k);var r=k.width*k.height,m=n.length,l=Math.floor(m/2),b=n[Math.floor(l)],
a=n[0].value,c=n[n.length-1].value,f=k.pixels[0],e,g,d=!1,h=new Uint8Array(r),p=new Uint8Array(r),q=new Uint8Array(r),u=k.mask,v=4===n[0].mappedColor.length;u&&0!==u.length||(u=new Uint8Array(r),u.fill(v?255:1),k.mask=u);for(g=0;g<r;g++)if(u[g]){var t=f[g];if(t<a||t>c)h[g]=p[g]=q[g]=u[g]=0;else{d=!1;var x=l;var C=b;var B=0;for(e=m-1;1<e-B;){if(t===C.value){d=!0;break}t>C.value?B=x:e=x;x=Math.floor((B+e)/2);C=n[Math.floor(x)]}d||(C=t===n[e].value?n[e]:n[B]);h[g]=C.mappedColor[0];p[g]=C.mappedColor[1];
q[g]=C.mappedColor[2];u[g]=C.mappedColor[3]}}k.pixels=[h,p,q];k.mask=u;k.pixelType="u8";k.maskIsAlpha=v;return k},_clonePixelBlock:function(k){if(k.clone)return k.clone();var n=H.clone(k),r;if(k.pixels&&k.pixels[0]&&0<k.pixels[0].length&&!(n.pixels&&n.pixels[0]&&0<n.pixels[0].length)){n.pixels=[];var m=k.pixels.length;for(r=0;r<m;r++)n.pixels[r]=new k.pixels[r].constructor(k.pixels[r])}if(k.statistics)for(n.statistics=[],m=k.statistics.length,r=0;r<m;r++)n.statistics[r]=H.clone(k.statistics[r]);k.mask&&
(n.mask=new Uint8Array(k.mask));return n},_createContrastBrightnessLUT:function(k,n){if(this._contrastCache&&this._contrastCache.contrastOffset===k&&this._contrastCache.brightnessOffset===n)return this._contrastCache.lut;var r=Math.min(Math.max(k,-100),100),m=Math.min(Math.max(n,-100),100),l,b=new Uint8Array(256);for(l=0;256>l;l++){if(0<r&&100>r)var a=(200*l-25500+510*m)/(2*(100-r))+128;else 0>=r&&-100<r?a=(200*l-25500+510*m)*(100+r)/2E4+128:100===r?(a=200*l-25500+256*(100-r)+510*m,a=0<a?255:0):-100===
r&&(a=128);b[l]=255<a?255:0>a?0:a}this._contrastCache={contrastOffset:k,brightnessOffset:n,lut:b};return b}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(H,k,n,r,m,l){return H([n,l],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=
this.mixinIgnoreCase({rasters:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.rasters)return Error("The rasters input to composite band function is invalid.");var a=[],c=[],f=b.rasters.length,e;if(b.rasters[0].statistics)for(e=0;e<f;e++)a.push(b.rasters[e].statistics[0]);if(b.rasters[0].histograms)for(e=0;e<f;e++)c.push(b.rasters[e].histograms[0]);this.rasterInfo=k.mixin(b.rasters[0],{bandCount:f,pixelType:this._calculatePixelType(this.pixelType,b.rasters[0].pixelType),statistics:a,
histograms:c});return!0},read2D:function(b){b=b.rasters;if(null!=b&&0!==b.length){var a=this._clonePixelData(b[0]),c=a.pixelBlock,f=[],e=[];for(g=0;g<b.length;g++)f.push(b[g].pixelBlock.pixels[0]),e.push(b[g].pixelBlock.statistics[0]);c.pixels=f;c.stackedStatistics=e;c.planes=b.length;var g;e=c.width*c.height;for(g=0;g<b.length;g++)if(c=b[g].pixelBlock.mask,d&&c)for(f=0;f<e;f++)d[f]&=c[f];else var d=d||c;a.maks=d;return a}},readGL:function(b){this._performance.start();this._initializeProgram({fragment:m.compositeBand,
fragmentName:"CompositeBand"});var a=b.rasters;if(null!=a&&0!==a.length){a=a.length;var c,f=this.bindFrameBuffer();for(c=0;c<a;c++){var e=this._setupTextureData(b.rasters[c],{notOriginal:0<c});var g=0<c?c.toString():"";this._bindTexture(e.texture,"u_image"+g)}this._setUniforms({u_rasterCount:a});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:e.extent,texture:f.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,k,n,r,m,l,b){return H([n,l],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=k.mixin(a.raster,
{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=b.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==
this.pixelType&&(c.pixelType=this.pixelType,c.pixels=c.pixels.map(k.hitch(this,function(f){return this._clampBand(f,c.pixelType)})));return{extent:a.extent,pixelBlock:c}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:m.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(a.texture,"u_image");var c=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,k,n,r,m,l,b,a){return H([n,
b],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=k.mixin(c.raster,{bandCount:c.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,c.raster.pixelType),
statistics:c.raster.statistics,histograms:c.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;var f=this._analyzeKernel(),e=a.convolute(c.pixelBlock,{normalizedKernel:f.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&
(e.pixelType=this.pixelType);e.pixels=e.pixels.map(k.hitch(this,function(g){return this._clampBand(g,e.pixelType)}));return{extent:c.extent,pixelBlock:e}},readGL:function(c){this._performance.start();this._initializeProgram({fragment:l.convolution,fragmentName:"Convolution"});var f=this._setupTextureData(c.raster),e=this.bindFrameBuffer(),g=this.gl,d=g.drawingBufferWidth;g=g.drawingBufferHeight;var h=this.functionArguments.kernel;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/
c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/d,1/g],u_kernel:h,u_kernelSize:h.length});this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:e.texture}},_analyzeKernel:function(){var c=this.functionArguments.kernel,f=c.reduce(function(d,h){return d+h});0!==f&&1!==f&&(c=c.map(function(d){return d/f}));var e,g=[];for(e=0;e<c.length;e++)g.some(function(d){return d===c[e]})||g.push(c[e]);return{normalizedKernel:c,
distinctValues:g}},_analyzeKernelPattern:function(){var c=this.functionArguments.rows,f=this.functionArguments.columns,e=this.functionArguments.kernel,g=[],d,h;for(d=0;d<c;d++)g.push({weights:e.slice(d*f,(d+1)*f)});var p;for(d=1;d<c;d++){var q=g[d].weights;for(e=0;e<d;e++)if(p=g[e].weights){var u=q[0]/p[0];for(h=1;h<f;h++)q[h]/p[h]!==u&&(u=null);null!==u&&(g[d]={row:e,factor:u})}}return g}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(H,k,n,r,m,l){return H([n,l],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to extract band function is invalid.");var a=[],c=b.raster.statistics,f=[],e=b.raster.histograms,g=this.functionArguments.bandIDs.length||
b.raster.bandCount;this.functionArguments.bandIDs.forEach(k.hitch(this,function(d){if(d>=g-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+d);d=g-1}if(0>d)return Error("missing band "+d);void 0!==c&&null!==c&&0<c.length&&a.push(c[d]);void 0!==e&&null!==e&&0<e.length&&f.push(e[d])}));this.rasterInfo=k.mixin(b.raster,{bandCount:g,pixelType:this._calculatePixelType(this.pixelType,b.raster.pixelType),statistics:a,histograms:f});return!0},read2D:function(b){b=this._clonePixelData(b.raster);
if(null!==b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){this._performance.start();var a=b.pixelBlock,c=a.statistics,f=a.pixels,e=f.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return b;var g=[],d=[];this.functionArguments.bandIDs.forEach(function(h){if(h>=e-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+h;h=e-1}if(0>h)throw"missing band "+h;g.push(f[h]);void 0!==c&&null!==c&&0<c.length&&
d.push(c[h])});a.pixels=g;a.statistics=d;a.planes=this.functionArguments.bandIDs.length;return b}},readGL:function(b){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:m.extractBand,fragmentName:"ExtractBand"});var a=this.functionArguments.bandIDs;1===a.length&&(a=[a[0],a[0],a[0]]);this._bandIDs=a;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===a[0]&&1===a[1]&&2===a[2]);var c=!!(this._alterBand&&b.raster&&b.raster.texture);b=this._setupTextureData(b.raster,{bandIDs:a});var f=this.bindFrameBuffer();c?this._setUniforms({u_bandIDs:a,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:a,u_alterBand:!1});this._bindTexture(b.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,texture:f.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(H,k,n,r,m,l,b,a,c,f){return H([n,a],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(e){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},e);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var g=this._weights.reduce(function(d,
h){return d+h});this._weights=this._weights.map(function(d){return d/g})},bind:function(e){e=this.getSourceRasterInfo(e);if(!e.raster)return Error("The raster input to hillshade function is invalid.");e.raster.statistics&&(this.srcStatistics=e.raster.statistics);this.rasterInfo=k.mixin(e.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(e){this._performance.start();e=e.raster;e=c.hillshade(e,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:e.extent.spatialReference.wkid&&null==m[e.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return e},readGL:function(e){this._performance.start();this._initializeProgram({fragment:b.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var g=this._setupTextureData(e.raster),d=this.bindFrameBuffer(),h=this.gl,p=h.drawingBufferWidth;h=h.drawingBufferHeight;var q=g.extent,u=(q.xmax-q.xmin)/p,v=(q.ymax-q.ymin)/h,t=this.functionArguments.altitude,x=this.functionArguments.azimuth,
C=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(C*=2);var B=C/(8*u),F=C/(8*v);.001<C&&q.spatialReference.wkid&&null==m[q.spatialReference.wkid]&&(B/=111E3,F/=111E3);var y=this.functionArguments.psPower,w=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((B=q.spatialReference.wkid&&null==m[q.spatialReference.wkid])?(B=111E3*u,F=111E3*v,B=(C+Math.pow(B,y)*w)/(8*B),F=(C+Math.pow(F,y)*w)/(8*F)):(B=(C+Math.pow(u,y)*w)/(8*u),F=(C+Math.pow(v,y)*w)/(8*v)));
var A=(90-t)*Math.PI/180;t=Math.cos(A);var z=(360-x+90)*Math.PI/180;x=Math.sin(A)*Math.cos(z);A=Math.sin(A)*Math.sin(z);y=Array(6);w=Array(6);q=Array(6);var G=this._weights,I;if(1===this.functionArguments.hillshadeType){var K=this._azimuths.length;for(I=0;I<K;I++)t=this._altitudes[I],x=this._azimuths[I],A=(90-t)*Math.PI/180,t=Math.cos(A),z=(360-x+90)*Math.PI/180,x=Math.sin(A)*Math.cos(z),A=Math.sin(A)*Math.sin(z),y[I]=t,w[I]=x,q[I]=A}else y[0]=t,w[0]=x,q[0]=A;y=y.map(function(Q){return parseFloat(Q)});
w=w.map(function(Q){return parseFloat(Q)});q=q.map(function(Q){return parseFloat(Q)});this._setUniforms({u_cellSize:[u,v],u_zfactor:C,u_xFactor:B,u_yFactor:F,u_sinZcosA:x,u_sinZsinA:A,u_cosZ:t,u_sinZcosAs:w,u_sinZsinAs:q,u_cosZs:y,u_weights:G,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:e&&e.raster&&e.raster.pixelBlock?[1/e.raster.pixelBlock.width,1/e.raster.pixelBlock.height]:[1/p,1/h],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(g.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:g.extent,texture:d.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var e=this._indexedColormap,g=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(g=f.buildIndexedColormap(this.functionArguments.colormap))&&g.alphaSpecified,this._indexedColormap=g&&g.indexedColormap,this._indexedColormapOffset=g&&g.offset):g?(this._indexedColormap="multipart"===g.type?this.invert?r.createMultiPartColorRamp(this._invertColorRamp(g)):r.createMultiPartColorRamp(g):this.invert?r.createAlgorithmicColorRamp(this._invertColorRamp(g)):r.createAlgorithmicColorRamp(g),g.fromColor&&g.toColor&&"000"===g.fromColor.slice(0,
3).join("")&&"255255255"===g.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=r.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(e&&this._indexedColormap){g=!0;for(var d=0;d<e.length;d++)if(e[d]!==this._indexedColormap[d]){g=!1;break}g||(this._clrTexture=null)}},_setupColormapTexture:function(e){var g=this._createTexture(),d=this.gl,
h=e.length/4,p=new Float32Array(e.length),q;for(q=0;q<e.length;q++)p[q]=e[q]/255;d.getExtension("OES_texture_float");d.texImage2D(d.TEXTURE_2D,0,d.RGBA,h,1,0,d.RGBA,d.FLOAT,p);return g}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,k,n,r,m,l,b){return H([n,l],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var c=0;a.raster?c=a.raster.bandCount:a.rasters&&(c=Math.max.apply(null,a.rasters.map(function(f){return f.bandCount})));if(0===c)return Error("The raster input to local function is invalid. It only takes single band input.");a=a.raster||a.rasters.filter(function(f){return!!f.extent})[0];this.rasterInfo=k.mixin(a,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var c=[];c=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=c.map(function(h){return h.pixelBlock});var f=this.functionArguments.operation;if(null===f)return c[0];this._performance.start();var e=this._getOperations(),g=e.operators[f-1];e=e.functors[f-1];
if(!this.functionArguments.rasters){if(1!==g)throw"no sufficient rasters, require "+g;}else if(999!==g&&this.functionArguments.rasters.length!==g)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+g;var d=31===f?b.isNull(a[0]):50===f?b.setNull(a[0]):b.local(a,{rasterCountNeeded:g,functor:e});"Unknown"!==this.pixelType&&(d.pixelType=this.pixelType,d.pixels=d.pixels.map(k.hitch(this,function(h){return this._clampBand(h,d.pixelType)})));d.statistics||d.calculateStatistics();
return{extent:c[0].extent,pixelBlock:d}},readGL:function(a){this._performance.start();var c=this.functionArguments.operation,f=this._getWebGLOperations(),e=f.operators[c-1],g=m.local;f="result\x3d"+f.functors[c-1]+";";31!==c&&50!==c&&(f+="result \x3d vec4(result.rgb, a.a);");g=g.replace("vec4 replaceme"+e+";",f);f=this.gl.getParameter(this.gl.VERSION);var d="";if(-1<f.toLowerCase().indexOf("webgl 1.0")||-1<f.toLowerCase().indexOf("webgl 0."))d=this._getPolyfill(c);g=g.replace("vec4 polyfill;",d);
1<e&&(g=g.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",e.toString())));this._initializeProgram({fragment:g,fragmentName:"Local"});c=a.rasters;if(null!=c&&0!==c.length){c=c.length;f=this.bindFrameBuffer();for(e=0;e<c;e++){g=0<e?e.toString():"";var h=this._setupTextureData(a.rasters[e],{reCreate:!0});this._bindTexture(h.texture,"u_image"+g)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:h.extent,texture:f.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,c){return a+c},function(a,c){return a-c},function(a,c){return a*c},function(a){return Math.sqrt(a)},function(a,c){return Math.pow(a,c)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},
function(a){return Math.abs(a)},function(a,c){return a&c},function(a,c){return a<<c},function(a){return~a},function(a,c){return a|c},function(a,c){return a>>c},function(a,c){return a^c},function(a,c){return a&&c},function(a){return!a},function(a,c){return a||c},function(a,c){return a!=c},function(a){return Math.cos(a)},function(a,c){return Math.cosh(a)},function(a,c){return a/c},function(a,c){return a==c},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,
a)},function(a,c){return a>c?1:0},function(a,c){return a>=c?1:0},function(a,c){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,c){return a<c?1:0},function(a,c){return a<=c?1:0},function(a){return Math.log(a)},function(a,c){return Math.log10(a)},function(a,c){return Math.log2(a)},999,999,999,999,999,999,function(a,c){return a%c},function(a){return-a},function(a,c){return a!=c?1:0},999,function(a,c){return Math.floor(a)},function(a,c){return Math.ceil(a)},function(a,c){return c?
0:a},function(a,c){return Math.sin(a)},function(a,c){return Math.sinh(a)},function(a,c){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,c){return Math.atan2(a,c)},function(a,c){return a/c},function(a,c){return Math.floor(a/c)},999,999,999,999,999,999,999,999,999,999,function(a,c,f){return a?c:f}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var c=
"";switch(a){case 9:c=this._polyfill.atanh;break;case 22:c=this._polyfill.cosh;break;case 52:c=this._polyfill.sinh;break;case 57:c=this._polyfill.tanh;break;case 59:c=this._polyfill.acosh;break;case 60:c=this._polyfill.asinh}return c},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(H,k,n,r,m,l,b){return H([n,l],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=k.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
return!0},read2D:function(a){this._performance.start();a=a.raster;var c=b.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.mask,fragmentName:"Mask"});
a=this._setupTextureData(a.raster);var c=this.bindFrameBuffer(),f=this.functionArguments.includedRanges,e=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(g){return parseFloat(g,10)}):null;this._setUniforms({u_includedRanges:f,u_includedRanges_specified:f?!0:!1,u_noDataValues:e,u_noDataValues_specified:e?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(a.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(H,k,n,r,m,l,b){return H([n,l],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=k.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=b.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),f;if(this.functionArguments.scaled){var e=c.pixels[0];var g=c.mask;var d=e.length;var h=new Uint8Array(d);if(null==g)for(f=0;f<d;f++)h[f]=100*e[f]+100&255;else for(f=0;f<d;f++)g[f]&&(h[f]=100*e[f]+100&255);c.pixels[0]=h;c.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.ndvi,fragmentName:"NDVI"});var c=this.functionArguments.visibleBandID,f=this.functionArguments.infraredBandID,e=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(f,c)?!0:!1;a=this._setupTextureData(a.raster,{bandIDs:this._alterBand?{bandIDs:[f,c,f]}:null});var g=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:e}):this._setUniforms({u_bandId_nir:f,u_bandId_red:c,u_scaled:e});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:g.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(H,k,n,r,m,l,
b,a){return H([n,b],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=k.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;c=a.slope(c,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:c.extent.spatialReference.wkid&&null==r[c.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:l.slope,fragmentName:"Slope"});var f=this._setupTextureData(c.raster),e=this.bindFrameBuffer(),g=this.gl,d=g.drawingBufferWidth;g=g.drawingBufferHeight;var h=f.extent;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/d,1/g],u_cellSize:[(h.xmax-h.xmin)/d,(h.ymax-h.ymin)/g],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:e.texture}}})})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(H,k,n,r,m,l,b){return H([n,b],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,
support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,5,6].indexOf(this.functionArguments.stretchType)&&(console.error("The specific stretch type has not been implemented: "+this.functionArguments.stretchType),
this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");a.raster.statistics&&(this.srcStatistics=this._convertStats(a.raster.statistics));a.raster.histograms&&(this.srcHistograms=a.raster.histograms);this.rasterInfo=k.mixin({},a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),
statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?a.map(function(c){return c&&null!=c.min?[c.min,c.max,c.mean,c.stddev]:c}):null},_updateStatistisHistograms:function(a){var c=this.functionArguments,
f=c.histograms||this.srcHistograms;if(a&&a.pixelBlock&&a.pixelBlock.pixels){if(0===c.stretchType)this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=f;else{var e=a.pixelBlock,g=e.pixels.length,d=6===c.stretchType&&(c.dra||!f)||3===c.stretchType&&c.dra;d&&(e.statistics||e.calculateStatistics(),this._calculateStatisticsHistograms(a));if(c.dra)if(e.statistics||e.calculateStatistics(),d)this._statistics=e.statistics,this._histograms=e.histograms;else for(c=
e.statistics,this._statistics=[],a=0;a<g;a++)this._statistics[a]=[c[a].minValue,c[a].maxValue,0,0];else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=f}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=f,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},
_getGammaCorrection:function(){var a=this.functionArguments.gamma;if(a){var c=[],f;for(f=0;f<a.length;f++)c[f]=1<a[f]?2<a[f]?6.5+Math.pow(a[f]-2,2.5):6.5+100*Math.pow(2-a[f],4):1;return c}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var c=a.pixelBlock,f=c.pixels;c=c.width*c.height;var e=f.length,g,d;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);var h=this.LUT,p=this.LUTOffset;
for(g=0;g<e;g++){var q=h[g];for(d=0;d<c;d++){var u=f[g][d];f[g][d]=q[u-p]}}a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var c=a.pixelType,f=a.pixels,e=a.mask,g=f.length,d,h,p=function(w){this.min=-.5;this.max=255.5;this.size=256;k.mixin(this,w);this.counts=this.counts||new Uint32Array(this.size)},q=[],u,v;for(d=0;d<g;d++){var t=new p;var x=t.counts;var C=f[d];if("U8"===c)if(e)for(h=0;h<a.width*a.height;h++)e[h]&&x[C[h]]++;else for(h=0;h<a.width*a.height;h++)x[C[h]]++;
else{var B=a.statistics[d].minValue;var F=a.statistics[d].maxValue;t.min=B;t.max=F;F=(F-B)/256;var y=new Uint32Array(257);if(e)for(h=0;h<a.width*a.height;h++)e[h]&&y[Math.floor((C[h]-B)/F)]++;else for(h=0;h<a.width*a.height;h++)y[Math.floor((C[h]-B)/F)]++;for(h=0;255>h;h++)x[h]=y[h];x[255]=y[255]+y[256]}q.push(t);C=[];B=a.statistics[d].minValue;F=a.statistics[d].maxValue;for(h=v=u=y=0;h<t.size;h++)y+=x[h],u+=h*x[h];u/=y;for(h=0;h<t.size;h++)v+=x[h]*Math.pow(h-u,2);x=Math.sqrt(v/(y-1));h=(u+.5)*(t.max-
t.min)/t.size+t.min;t=x*(t.max-t.min)/t.size;C.push(B);C.push(F);C.push(h);C.push(t);a.statistics[d]={min:B,minValue:B,max:F,maxValue:F,mean:h,stddev:t}}a.histograms=q},_getCutOffPoints:function(a){var c=this.functionArguments,f=999;a&&a.pixelBlock?f=a.pixelBlock.pixels.length:a&&a.texture&&(f=3);a=Math.min(f,this._statistics.length);var e=[],g=[],d,h;switch(c.stretchType){case 5:for(d=0;d<a;d++)e[d]=this._statistics[d][0],g[d]=this._statistics[d][1];break;case 3:for(d=0;d<a;d++)e[d]=this._statistics[d][2]-
c.numberOfStandardDeviations*this._statistics[d][3],g[d]=this._statistics[d][2]+c.numberOfStandardDeviations*this._statistics[d][3],e[d]<this._statistics[d][0]&&(e[d]=this._statistics[d][0]),g[d]>this._statistics[d][1]&&(g[d]=this._statistics[d][1]);break;case 6:for(d=0;d<a;d++){f=this._histograms[d];var p=new Uint32Array(f.size);var q=f.counts;var u=0;var v=-.5===f.min&&1===(f.max-f.min)/q?.5:0;for(h=0;h<f.size;h++)u+=q[h],p[h]=u;q=c.minPercent*u/100;for(h=0;h<f.size;h++)if(p[h]>q){e[d]=f.min+(f.max-
f.min)/f.size*(h+v);break}q=(1-c.maxPercent/100)*u;for(h=f.size-2;0<=h;h--)if(p[h]<q){g[d]=f.min+(f.max-f.min)/f.size*(h+2-v);break}}break;default:for(d=0;d<f;d++)e[d]=0,g[d]=255}return{minCutOff:e,maxCutOff:g}},_createLUT:function(a){var c=this.functionArguments,f=a.pixelBlock,e=f.pixelType;if("U8"===e||"U16"===e||"S8"===e||"S16"===e){if(this._LUTSignature&&(e=this._computeLutSignature(),e.length===this._LUTSignature.length&&!e.some(function(A,z){return A!==this._LUTSignature[z]}.bind(this))))return;
e=f.pixels.length;var g=[],d=[],h=c.max,p=c.min,q=c.gamma,u=h-p,v=this._getCutOffPoints(a);a=v.minCutOff;v=v.maxCutOff;var t=0,x=256;"S8"===f.pixelType?t=-127:"S16"===f.pixelType&&(t=-32767);if("U16"===f.pixelType||"S16"===f.pixelType)x=65536;for(f=0;f<e;f++)g[f]=v[f]-a[f];var C=this._gammaCorrection;if(c.useGamma)for(f=0;f<e;f++){var B=[];for(c=0;c<x;c++){var F=c+t;var y=(F-a[f])/g[f];var w=1;1<q[f]&&(w-=Math.pow(1/u,y*C[f]));F<v[f]&&F>a[f]?B[c]=Math.floor(w*u*Math.pow(y,1/q[f]))+p:F>v[f]?B[c]=h:
F<a[f]&&(B[c]=p)}d[f]=B}else for(f=0;f<e;f++){B=[];for(c=0;c<x;c++)F=c+t,B[c]=F<a[f]?p:F>v[f]?h:Math.floor((F-a[f])/g[f]*u)+p;d[f]=B}this.LUT=d;this.LUTOffset=t;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,c=[],f,e;c.push(a.stretchType);c.push(a.min);c.push(a.max);c.push(a.numberOfStandardDeviations);if(this._statistics)for(f=0;f<this._statistics.length;f++)for(e=0;e<this._statistics[f].length;e++)c.push(this._statistics[f][e]);c.push(a.dra?
1:0);c.push(a.minPercent);c.push(a.maxPercent);if(a.gamma)for(f=0;f<this._statistics.length;f++)c.push(a.gamma[f]);c.push(a.useGamma?1:0);return c},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=this.functionArguments,f=a.pixelBlock,e=f.pixels,g=f.mask;f=f.width*f.height;var d=e.length,h=[],p=[],q=c.max,u=c.min,v=c.gamma,t=q-u;var x=this._getCutOffPoints(a);var C=x.minCutOff,B=x.maxCutOff;for(x=0;x<d;x++)h[x]=B[x]-C[x];if(c.useGamma&&null!==v&&v.length>=
d)for(x=0;x<d;x++)p[x]=1<v[x]?2<v[x]?6.5+Math.pow(v[x]-2,2.5):6.5+100*Math.pow(2-v[x],4):1;if(c.useGamma)if(void 0!==g&&null!==g)for(c=0;c<f;c++){if(g[c])for(x=0;x<d;x++){var F=e[x][c];var y=(F-C[x])/h[x];var w=1;1<v[x]&&(w-=Math.pow(1/t,y*p[x]));F<B[x]&&F>C[x]?e[x][c]=Math.floor(w*t*Math.pow(y,1/v[x]))+u:F>B[x]?e[x][c]=q:F<C[x]&&(e[x][c]=u)}}else for(c=0;c<f;c++)for(x=0;x<d;x++)F=e[x][c],y=(F-C[x])/h[x],w=1,1<v[x]&&(w-=Math.pow(1/t,y*p[x])),F<B[x]&&F>C[x]?e[x][c]=Math.floor(w*t*Math.pow(y,1/v[x]))+
u:F>B[x]?e[x][c]=q:F<C[x]&&(e[x][c]=u);else if(void 0!==g&&null!==g)for(c=0;c<f;c++){if(g[c])for(x=0;x<d;x++)F=e[x][c],F<B[x]&&F>C[x]?e[x][c]=Math.floor((F-C[x])/h[x]*t)+u:F>B[x]?e[x][c]=q:F<C[x]&&(e[x][c]=u)}else for(c=0;c<f;c++)for(x=0;x<d;x++)F=e[x][c],F<B[x]&&F>C[x]?e[x][c]=Math.floor((F-C[x])/h[x]*t)+u:F>B[x]?e[x][c]=q:F<C[x]&&(e[x][c]=u);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var c=this._statistics.length,f,e=[];for(f=0;f<c;f++){var g=this._statistics[f][2];"U8"!==
a&&(g=255*(g-this._statistics[f][0])/(this._statistics[f][1]-this._statistics[f][0]));e.push(this._computeGammaValue(g))}return e},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var c=0;0<a&&150!=a&&255>a&&(c=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));c=Math.log((a+c)/255);if(0!==c&&(a=Math.log(a/255)/c,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var c=this.renderTexture,f,e=
a.pixelBlock&&a.pixelBlock.pixels&&a.pixelBlock.pixels.length||this.sourceRasterInfo.raster.bandCount,g=a.pixelBlock,d=this.gl,h=d.drawingBufferWidth,p=d.drawingBufferHeight;if(!g&&this.functionArguments.dra){var q=new Float32Array(h*p*4),u=new Uint8Array(h*p);var v=new Float32Array(h*p);var t=new Float32Array(h*p);var x=new Float32Array(h*p);d.checkFramebufferStatus(d.FRAMEBUFFER)==d.FRAMEBUFFER_COMPLETE&&d.readPixels(0,0,h,p,d.RGBA,d.FLOAT,q);for(f=0;f<h*p;f++)v[f]=q[4*f],t[f]=q[4*f+1],x[f]=q[4*
f+2],u[f]=q[4*f+3];a.pixelBlock=new r({width:h,height:p,pixels:[v,t,x],mask:u});a.pixelBlock.calculateStatistics()}!g&&this.functionArguments.dra&&this._useGPUStats?(v=new Float32Array(e),t=new Float32Array(e)):(this._updateStatistisHistograms(a),q=this._getCutOffPoints(a),v=new Float32Array(e),t=new Float32Array(e),v.set(q.minCutOff.slice(0,e)),t.set(q.maxCutOff.slice(0,e)));this._initializeProgram({fragment:l.stretch,fragmentName:"Stretch"});q=this._setupTextureData(a);u=this.bindFrameBuffer();
this.renderTexture=!1;this._performance.start();if(!g&&this.functionArguments.dra&&this._useGPUStats){this._setUniforms({u_sourceDim:[h,p],u_bandCount:e});if(1===e)var C=this._readMinMax(q,2);else{C=this._readMinMax(q,0);var B=this._readMinMax(q,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)f=this._readHistogram(C,B,a),v=f.minCutOff||v,t=f.minCutOff||t}x=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(e);for(f=
0;f<e;f++)a[f]=x/(t[f]-v[f]);this._useGPUStats&&this._initializeProgram({fragment:l.stretch,fragmentName:"Stretch"});d.blendFunc(d.SRC_ALPHA,d.ZERO);x=new Float32Array(3);var F=new Float32Array(3);for(f=0;3>f;f++)x[f]=this.functionArguments.min,F[f]=this.functionArguments.max;f=this.functionArguments.useGamma;var y=this.functionArguments.gamma,w=this._gammaCorrection;Array.isArray(y)&&y.length>=e||(f=!1);this._setUniforms({u_sourceDim:[h,p],u_bandCount:e,u_minOutput:x,u_maxOutput:F,u_minCutOff:v,
u_maxCutOff:t,u_factor:a,u_state:100,u_useGamma:f,u_gamma:y,u_scaled:!c,u_gammaCorrection:w,u_minMaxTexture:!g&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=c;d.viewport(0,0,h,p);this._bindTexture(q.texture,"u_image");!g&&this.functionArguments.dra&&this._useGPUStats&&(c=d.getUniformLocation(this.rasterProgram,"u_image1"),d.uniform1i(c,1),d.activeTexture(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,C.texture),1<e&&(e=d.getUniformLocation(this.rasterProgram,"u_image2"),d.uniform1i(e,
2),d.activeTexture(d.TEXTURE2),d.bindTexture(d.TEXTURE_2D,B.texture)));this._drawGL();return{extent:q.extent,texture:u.texture}},_readMinMax:function(a,c){var f=this.gl,e=a.width||f.drawingBufferWidth,g=a.height||f.drawingBufferHeight;this._setUniforms({u_state:c});this.renderTexture=!1;var d=a.texture;for(f.activeTexture(f.TEXTURE0);1<e||1<g;){var h=this._createTexture();c=Math.max(Math.ceil(e/2),1);var p=Math.max(Math.ceil(g/2),1);f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,
f.RGBA,c,p,0,f.RGBA,f.FLOAT,null);a=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,a);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,h,0);f.viewport(0,0,c,p);f.bindTexture(f.TEXTURE_2D,d);this._setUniforms({u_sourceDim:[e,g]});e=c;g=p;this._drawGL(!0);d=h}a=new Float32Array(e*g*4);f.checkFramebufferStatus(f.FRAMEBUFFER)==f.FRAMEBUFFER_COMPLETE&&f.readPixels(0,0,e,g,f.RGBA,f.FLOAT,a);return{texture:h,minmax:a}},_readHistogram:function(a,c,f){if(a)try{var e=this.gl,g=e.drawingBufferWidth,
d=e.drawingBufferHeight,h,p,q;if(a.texture instanceof WebGLTexture){var u=!0;var v=[1,0,0,1];if(c){var t=a.minmax;var x=c.minmax}else t=[a.minmax[0]],x=[a.minmax[1]]}else for(x=c,t=a,v=new Float32Array(x.length),h=0;h<x.length;h++)v[h]=256/(x[h]-t[h]);var C=new Float32Array(g*d);for(q=0;q<C.length;q++)C[q]=q;if(!this.histogramProgram){var B=m.getShader(e,m.histogram),F=l.getShader(e,l.constant);this.histogramProgram=this._loadProgram(B,F)}e.blendFunc(e.ONE,e.ONE);e.enable(e.BLEND);e.useProgram(this.histogramProgram);
var y=e.getAttribLocation(this.histogramProgram,"a_pixelIndex"),w=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,w);e.bufferData(e.ARRAY_BUFFER,C,e.STATIC_DRAW);e.enableVertexAttribArray(y);e.vertexAttribPointer(y,1,e.FLOAT,!1,0,0);var A=this._setupHistTexture(f),z=this._createTexture();e.getExtension("OES_texture_float");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,257,1,0,e.RGBA,e.FLOAT,null);var G=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,G);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,
e.TEXTURE_2D,z,0);e.viewport(0,0,257,1);var I=e.getUniformLocation(this.histogramProgram,"u_image");e.uniform1i(I,0);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,A);var K=e.getUniformLocation(this.histogramProgram,"u_sourceDim");e.uniform2f(K,g,d);var Q=e.getUniformLocation(this.histogramProgram,"u_bandCount");e.uniform1i(Q,3);var N=e.getUniformLocation(this.histogramProgram,"u_halfPixel");e.uniform2f(N,.5/g,.5/d);var T=e.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(u){e.uniform1i(T,
1);var W=e.getUniformLocation(this.histogramProgram,"u_image1");e.uniform1i(W,1);e.activeTexture(e.TEXTURE1);e.bindTexture(e.TEXTURE_2D,a.texture);if(c){var X=e.getUniformLocation(this.histogramProgram,"u_image2");e.uniform1i(X,2);e.activeTexture(e.TEXTURE2);e.bindTexture(e.TEXTURE_2D,c.texture)}}else{var ea=e.getUniformLocation(this.histogramProgram,"u_mins");e.uniform4f(ea,t[0],t[0],t[0],t[0]);e.uniform1i(T,0)}var fa=e.getUniformLocation(this.histogramProgram,"u_color"),J=e.getUniformLocation(this.histogramProgram,
"u_factors"),V=e.getUniformLocation(this.histogramProgram,"u_size");e.uniform1f(V,256);a=[];c=[];e.uniform4fv(fa,[1,0,0,1]);e.uniform4fv(J,[v[0],0,0,1]);e.drawArrays(e.POINTS,0,C.length);var aa=this.sourceRasterInfo.raster.bandCount;1<aa&&(e.uniform4fv(fa,[0,1,0,1]),e.uniform4fv(J,[0,v[0],0,1]),e.drawArrays(e.POINTS,0,C.length),e.uniform4fv(fa,[0,0,1,1]),e.uniform4fv(J,[0,0,v[0],1]),e.drawArrays(e.POINTS,0,C.length));if(e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE){var Z=new Float32Array(1028);
e.readPixels(0,0,257,1,e.RGBA,e.FLOAT,Z);e=0;var L=-.5===t[0]&&1===(x[0]-t[0])/256?.5:0;for(h=0;h<aa;h++){var O=new Float32Array(257);var D=new Float32Array(257);for(q=e=0;256>q;q++)e+=Z[4*q+h],O[q]=e,D[q]=Z[4*q+h];D[256]=Z[1024+h];O[256]=e+Z[1024+h];var P=this.functionArguments.minPercent*e/100;if(x){for(p=0;256>p;p++)if(O[p]>P){a[h]=t[0]+(x[0]-t[0])/256*(p+L);break}P=(1-this.functionArguments.maxPercent/100)*e;for(p=254;0<=p;p--)if(O[p]<P){c[h]=t[0]+(x[0]-t[0])/256*(p+2-L);break}}}}return{histogram:Z,
minCutOff:a,maxCutOff:c}}catch(R){console.debug("webgl filter exception: "+R.message)}},_setupHistTexture:function(a){if(a instanceof WebGLTexture)return a;var c=this.originalHistTexture=this._createTexture(),f=this.gl;a=a.pixelBlock;var e=a.width,g=a.height;f.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();f.texImage2D(f.TEXTURE_2D,0,f.RGBA,e,g,0,f.RGBA,f.FLOAT,this.rgbaFloatData);return c}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(H,k,n,r,m,l,b){return H([r,l],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var c=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);
this.rasterInfo=k.mixin(a.raster,{bandCount:c?3:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=c?"Processed":"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var c=b.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());
return{extent:a.extent,pixelBlock:c}},_remapGL:function(a){this._performance.start();this._initializeProgram({fragment:m.remap,fragmentName:"Remap"});var c=new Uint8Array(64),f=this.functionArguments.colorBreaks;f.forEach(function(h,p){c[4*p]=h.mappedColor[0];c[4*p+1]=h.mappedColor[1];c[4*p+2]=h.mappedColor[2];c[4*p+3]=1>=h.mappedColor[3]?255*h.mappedColor[3]:h.mappedColor[3]});var e=f[f.length-1],g=e.mappedColor;c[60]=g[0];c[61]=g[1];c[62]=g[2];c[63]=1>=g[3]?255*g[3]:g[3];var d=new Float32Array(16);
f.forEach(function(h,p){d[p]=h.value});d[15]=e.value;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));f=this._clrTexture;e=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:c.length/4-1,u_breaks:d});this._bindTexture(f,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:e.texture}},_setupColormapTexture:function(a){var c=this._createTexture(),f=a.length/4,e=new Float32Array(a.length),
g=this.renderTexture?255:1,d,h=this.gl;for(d=0;d<a.length;d++)e[d]=a[d]/g;h.getExtension("OES_texture_float");h.texImage2D(h.TEXTURE_2D,0,h.RGBA,f,1,0,h.RGBA,h.FLOAT,e);return c}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(H,k,n,r,m){return H([r,m],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,
constructor:function(l){this.functionArguments={raster:null}},bind:function(l){l=this.getSourceRasterInfo(l);if(!l.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=k.mixin(l.raster,{});return!0},read2D:function(l){return l.raster},readGL:function(l){this._initializeProgram({fragment:n.identity,fragmentName:"identity"});l=this._setupTextureData(l.raster);var b=this.bindFrameBuffer();this._bindTexture(l.texture,"u_image");this._drawGL();return{extent:l.extent,
texture:b.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(H,k,n,r,m){return H([r,m],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(l){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},
l)},bind:function(l){l=this.getSourceRasterInfo(l);if(!l.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=k.mixin(l.raster,{bandCount:l.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,l.raster.pixelType),statistics:l.raster.statistics,histograms:l.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(l){this._performance.start();this._initializeProgram({fragment:n.resample,fragmentName:"Resample"});
var b=this._setupTextureData(l.raster),a=this.bindFrameBuffer(),c=this.gl,f=c.drawingBufferWidth;c=c.drawingBufferHeight;var e=l.raster;void 0!==e.pixelBlock?(b=b||this._setupTextureData(e),l=e.pixelBlock.width,e=e.pixelBlock.height):(b=b||e,l=f,e=c);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[l/f,e/c],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/f,1/c]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:b.extent,texture:a.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),function(H,k,n,r,m,l,b,a,c){var f=function(){function e(d){g[d.prototype.rendererName]=d}var g={};e(r);e(l);e(b);e(m);e(a);e(c);return g}();return{wellKnownRenderers:f,
isSupported:function(e){if(!e)return!1;var g=!0;f[e.rendererName]||(g=!1);return g},create:function(e){if(!e)return null;if(e.rendererName){var g=e.rendererName;e=e.rendererArguments}else g="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(e.type),g="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[g],"rasterStretch"===e.type&&e.bandIndex&&1<e.bandIndex.length&&(g="RGB");return(g=f[g])?new g(e):null},createDefaultRenderer:function(e){if(e&&
e.raster){var g=e.raster.rasterInfo,d=e.raster.dataType;if(g){var h=e.raster.rasterFunction,p=["Stretch","Colormap","ContrastAndBrightness"];if(h&&"U8"===g.pixelType&&-1<p.indexOf(h.functionName))h.renderTexture=!0;else if("Processed"!==d||!(e.useWebGL&&h&&h.renderTexture||!e.useWebGL&&"U8"===g.pixelType)){h&&(g=h.rasterInfo);h=g.bandCount;var q=g.colormap,u=g.vat;p=g.histograms;p&&0===p.length&&(p=null);var v=g.statistics&&g.statistics.map(function(C){return[C.min,C.max,C.mean,C.stddev]});if(1===
h&&q&&0<q.length)var t=this._getDefaultColormapRenderer(u,q);else if(1===h&&u&&u.features&&0<u.features.length)t=new m({});else{q=0;u=!1;d||!e.raster||!e.raster.tileInfo||void 0!==e.raster.tileInfo.tileType&&"Map"!==e.raster.tileInfo.tileType?"U8"===g.pixelType&&"Processed"===d?(q=5,v=v||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],u=!1):"U8"===g.pixelType||"Elevation"===d?(q=5,u=v?!1:!0):"Scientific"===d||"StdTime"===d?(q=5,u=v?!1:!0,t=this._getDefaultScientificColorRamp()):p&&0<p.length?(q=6,u=!1):v?(q=
5,u=!1):(q=6,u=!0):(v=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],q=5,u=!1);v||(q=5,u=!0);var x;3<=h&&!(e.bandIds||e.raster&&e.raster.imageServiceParams&&e.raster.imageServiceParams.bandIds)&&(x=this.getDefaultBandCombination(g));x&&(v=x.map(function(C){return v[C]}));e={stretchType:q,min:0,max:255,dra:u,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:v,histograms:p,numberOfStandardDeviations:2.5,bandIndex:x};1===h||x&&1===x.length?(t&&(e.colorRamp=t,e.invert=!1),t=new b(e)):t=new l(e)}return t}}}},
getDefaultBandCombination:function(e){var g=e.bandCount;if(1===g)return null;if(2===g)return[0];var d=(e=e.keyProperties)&&e.ChangeAnalysisParameters&&e.ChangeAnalysisParameters.AnalysisType;if(d&&("ccdc"===d.toLowerCase()||"landtrendr"===d.toLowerCase()))return[0];e=e&&e.BandProperties;var h;if(e&&e.length===g){var p=this.getWellKnownBandIndexes(e);e=p.red;d=p.green;var q=p.blue;p=p.nir;null!=e&&null!=d&&null!=q?h=[e,d,q]:null!=p&&null!=e&&null!=d&&(h=[p,e,d])}!h&&3<=g&&(h=[0,1,2]);return h},getWellKnownBandIndexes:function(e){for(var g=
{},d=0;d<e.length;d++){var h=e[d],p=h.BandName&&h.BandName.toLowerCase();"red"===p?g.red=d:"green"===p?g.green=d:"blue"===p?g.blue=d:"nearinfrared"===p||"nearinfrared_1"===p||"nir"===p?g.nir=d:h.WavelengthMax&&h.WavelengthMin&&(p=h.WavelengthMin,h=h.WavelengthMax,null==g.blue&&410<=p&&480>=p&&480<=h&&540>=h?g.blue=d:null==g.green&&490<=p&&560>=p&&560<=h&&610>=h?g.green=d:null==g.red&&595<=p&&670>=p&&660<=h&&730>=h?g.red=d:null==g.nir&&700<=p&&860>=p&&800<=h&&950>=h&&(g.nir=d))}return g},_getDefaultColormapRenderer:function(e,
g){if(g||g.length){var d=[],h=this._ratContainsColormap(e);if(h)var p=this._getRATValueClassNameMap(e);g.forEach(function(q){var u=p?p[q[0]]:q[0];d.push({color:[q[1],q[2],q[3]],value:q[0],label:h?null!=u?u:"":q[0]})});return new r({colormapInfos:d})}},_ratContainsColormap:function(e){if(!e||!e.fields)return!1;var g,d,h;return e.fields.some(function(p){p&&p.name&&(p=p.name.toLowerCase(),"red"===p&&(g=!0),"green"===p&&(d=!0),"blue"===p&&(h=!0));return g&&d&&h})},_getRATValueClassNameMap:function(e){if(!e||
!e.fields)return null;var g={},d,h;e.fields.forEach(function(p){if("classname"===p.name.toLowerCase()||"class_name"===p.name.toLowerCase())d=p.name;"value"===p.name.toLowerCase()&&(h=p.name)});e.features.forEach(function(p){p=p.attributes;g[p[h]]=d?p[d]:p[h]});return g},_getDefaultScientificColorRamp:function(){return{type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(e){return{fromColor:e.toColor,
toColor:e.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(H,k,n,r){return H([n],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",renderTexture:!0,constructor:function(m){m&&m.colormapInfos&&(m.colormap=m.colormapInfos.map(function(l){return[l.value].concat(l.color)}));this._function=new r(m);this._function.outputPixelType=
"U8";this._function.renderTexture=!0},draw2D:function(m){this._updateColormapParameters();m=this._clonePixelData(m);return m=this._function._colorize(m)},drawGL:function(m){this._updateColormapParameters();this._function._colorizeGL(m)},toJson:function(){var m=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:m}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(m){return{value:m[0],
color:m.slice(1),label:m[0]}})}},_updateColormapParameters:function(){var m=this._function.functionArguments;m.colormap=this.colormap;m.colormapName=this.colormapName;m.colorRamp=this.colorRamp;m.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(H,k,n,r){return H(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(m){m=
m||{};this.raster=m.raster||m.Raster||this.raster;this.draw=k.hitch(this,this.draw);this.bind=k.hitch(this,this.bind);m=k.clone(m);Object.keys(m).forEach(function(l){null==m[l]&&delete m[l]});k.mixin(this,m)},bind:function(m){if(!m)throw"failed to bind without options";var l=m;m.layer&&(m=m.layer,l={id:m.id,rawRasterInfo:m.raster.rasterInfo,glSetting:m._glSetting,xformSetting:m.tileManager&&m.tileManager.xformSetting,useWebGL:m.useWebGL,resampling:m.tileMode&&m.tileManager&&m.tileManager.xformSetting.requireProjection&&
!m._hasTilingEffects&&"Thematic"!==m.raster.dataType?1:0,tileMode:m.tileMode});this._rawRasterInfo=l.rawRasterInfo;this.useWebGL=l.useWebGL;this._function&&this._function.setProcessingContext(k.mixin({useProcessedData:!0},l));this._processingContext=l},hasTilingEffects:function(){},draw:function(m){return this.useWebGL?this.drawGL(m):this.draw2D(m)},toJson:function(){},_clonePixelData:function(m){if(null==m)return m;var l={};m.extent&&(l.extent=new n(m.extent.xmin,m.extent.ymin,m.extent.xmax,m.extent.ymax,
m.extent.spatialReference));m=m.processedPixelBlock||m.pixelBlock;if(null==m)return l;l.pixelBlock=m.clone?m.clone():r.prototype.clone(m);return l}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(H,k,n,r,m){return H([n],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",
alias:"",uniqueValueInfos:null,constructor:function(l){l&&l.colormap&&(this.colormap=l.colormap,this._function=new r(l),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(l){this.inherited(arguments);if(!this._function){var b=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!b)throw"uv renderer requires data source to have raster attribute table";var a=this.attributeField||this.field1||this.field,c=this.infos||this.uniqueValueInfos;this.defaultColor=
this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var f=b.fields.filter(function(t){return"value"===t.name.toLowerCase()})[0];if(f)var e=f.name;a||((a=b.fields.filter(function(t){return-1<["classname","category"].indexOf(t.name.toLowerCase())})[0])||(a=b.fields.filter(function(t){return"esriFieldTypeString"===t.type})[0]),this.alias=(this.field=a=a&&a.name||e)&&a.alias||e);var g=[],d;if(!c){c=[];var h=b.fields.filter(function(t){return"alpha"===t.name.toLowerCase()})[0];var p=b.fields.filter(function(t){return"red"===
t.name.toLowerCase()})[0];var q=b.fields.filter(function(t){return"green"===t.name.toLowerCase()})[0];var u=b.fields.filter(function(t){return"blue"===t.name.toLowerCase()})[0];for(f=0;f<b.features.length;f++){var v=b.features[f].attributes;(d=c.some(function(t){t.value===v[a]}))||(h&&p&&q&&u?c.push({value:v[a],alias:v[a],color:[v[p.name],v[q.name],v[u.name],v[h.name]]}):p&&q&&u?c.push({value:v[a],alias:v[a],color:[v[p.name],v[q.name],v[u.name]]}):c.push({value:v[a],alias:v[a]}))}if(!(p&&q&&u))for(d=
m.createRandomColorRamp({size:c.length}),f=0;f<c.length;f++)c[f].color=d[f];this.uniqueValueInfos=c}if(c)c.forEach(function(t){g=g.concat(b.features.filter(function(x){return t.value==x.attributes[a]}).map(function(x){return[x.attributes[e]].concat(t.color||t.symbol&&t.symbol.color)}))}),this.defaultColor&&b.features.filter(function(t){g.some(function(x){return x[0]===t.attributes[e]})||g.push([t.attributes[e]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=
new r({colormap:g});this.colormap=g;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(l){l=this._clonePixelData(l);return l=this._function._colorize(l)},drawGL:function(l){this._function._colorizeGL(l)},toJson:function(l){var b={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};l&&(b.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:b}},
toCommonRendererJson:function(){var l=this.attributeField||this.field1||this.field,b=(this.infos||this.uniqueValueInfos).map(function(a){return{value:a.value,label:a.alias+"",symbol:{color:3===a.color.length?a.color.concat([255]):a.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",field1:l,uniqueValueInfos:b}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),
function(H,k,n,r,m,l){return H([n],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(b){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
b=k.mixin({},b,{stretchType:this.stretchType});this._stretchFunction=new r(b);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this.bandIndex=b.bandIndex||b.BandIndex;this._function=new m(b);this._function.functionArguments.raster=this._stretchFunction;this._function.renderTexture=!0},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(b){this._updateStretchParameters();b=this._clonePixelData(b);if("U8"===b.pixelBlock.pixelType&&
!this.contrastOffset&&!this.brightnessOffset)return b;this._stretchFunction._stretch(b);var a=b.pixelBlock,c=this.bandIndex,f=Math.max.apply(null,c);a&&a.pixels.length>f&&c&&(a.pixels=c.map(function(e){return a.pixels[e]}),a.statistics&&(a.statistics=c.map(function(e){return a.statistics[e]})));if(this.contrastOffset||this.brightnessOffset)b.pixelBlock=l.contrastBrightnessStretch(b.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return b},drawGL:function(b){this._updateStretchParameters();
b.pixelBlock&&(b=this._clonePixelData(b));var a=b.pixelBlock,c=this.bandIndex,f=Math.max.apply(null,c),e=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,g=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,d,h;a&&a.pixels.length>f&&c&&(a.pixels=c.map(function(p){return a.pixels[p]}),a.statistics&&(a.statistics=c.map(function(p){return a.statistics[p]})),e&&0<e.length&&
e.length!==c.length&&(d=c.map(function(p){return e[p]})),g&&0<g.length&&g.length!==c.length&&(h=c.map(function(p){return g[p]})));this._stretchFunction.functionArguments.statistics=d||e;this._stretchFunction.functionArguments.histograms=h||g;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._function.renderTexture=!0,b=this._stretchFunction._stretchGL(b),this._function._cbGL(b)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(b))},toJson:function(){var b=
this._stretchFunction.toJson().rasterFunctionArguments;b.bandIndex=this.bandIndex;b.contrastOffset=this.contrastOffset;b.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:b}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:k.clone(this.statistics),
dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:k.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var b=this._stretchFunction.functionArguments;b.stretchType=this.stretchType;b.min=this.min;b.max=this.max;b.numberOfStandardDeviations=this.numberOfStandardDeviations;b.statistics=this.statistics;b.histograms=this.histograms;b.dra=this.dra;b.minPercent=this.minPercent;
b.maxPercent=this.maxPercent;b.useGamma=this.useGamma;b.gamma=this.gamma;b.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(H,k,n,r,m,l,b,a){return H([n],
{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(c){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
c=k.mixin({},c,{stretchType:this.stretchType});Object.keys(c).forEach(function(f){null==c[f]&&delete c[f]});this._function=new l(c);this._stretchFunction=new m(c);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new b(c);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},
draw2D:function(c){this._updateStretchParameters();c=this._clonePixelData(c);if("U8"===c.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return c;this._stretchFunction._stretch(c);var f=c.pixelBlock,e=this.bandIndex?this.bandIndex[0]:0;f&&1<f.pixels.length&&f.pixels.length>e&&(f.pixels=[f.pixels[e]],f.statistics&&(f.statistics=[f.statistics[e]]));this.colorRamp&&(c=this._clrFunction._colorize(c));if(this.contrastOffset||this.brightnessOffset)c.pixelBlock=a.contrastBrightnessStretch(c.pixelBlock,
{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return c},drawGL:function(c){this._updateStretchParameters();c.pixelBlock&&(c=this._clonePixelData(c));var f=c.pixelBlock,e=this.bandIndex?this.bandIndex[0]||0:0,g=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,d=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,h,p;f&&1<f.pixels.length&&
f.pixels.length>e&&(f.pixels=[f.pixels[e]],f.statistics&&(f.statistics=[f.statistics[e]]),g&&g.length>e&&(h=[g[e]]),d&&d.length>e&&(p=[d[e]]));this._stretchFunction.functionArguments.statistics=h||g;this._stretchFunction.functionArguments.histograms=p||d;f=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,c=this._stretchFunction._stretchGL(c),f&&(c=this._clrFunction._colorizeGL(c)),
this._function._cbGL(c)):f?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,c=this._stretchFunction._stretchGL(c),this._clrFunction._colorizeGL(c)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(c))},toJson:function(){var c=this._stretchFunction.toJson().rasterFunctionArguments;c.colorRamp=this.colorRamp||"";this.invert&&(c.invert=!0);c.contrastOffset=this.contrastOffset;c.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,
rendererArguments:c}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:k.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:k.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var c=this._stretchFunction.functionArguments;c.stretchType=this.stretchType;c.min=this.min;c.max=this.max;c.numberOfStandardDeviations=this.numberOfStandardDeviations;c.statistics=this.statistics;c.histograms=this.histograms;c.dra=this.dra;c.minPercent=this.minPercent;c.maxPercent=this.maxPercent;c.useGamma=this.useGamma;c.gamma=this.gamma;c.computeGamma=this.computeGamma;
this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(H,k,n,r,m){return H([n],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(l){l=l||{};this._function=new m(l);this._function.outputPixelType="U8";var b=
l.classBreakInfos;l=l.minValue;null!=l&&b&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(l,b))},bind:function(l){this.inherited(arguments);this.isColormapFunction=!1;var b=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,a=b&&b.vat;if(a&&"u8"===b.pixelType.toLowerCase()&&this.classBreakInfos){var c=this.field;if(b=a.fields.filter(function(p){return"value"===p.name.toLowerCase()})[0])var f=b.name;var e=a.features.sort(function(p,q){return parseFloat(p.attributes[c])-
parseFloat(q.attributes[c])})[0].attributes[c];this.isColormapFunction=!0;var g=[],d=this.field,h=this.classBreakInfos;h.forEach(function(p,q){a.features.forEach(function(u){var v=h[q-1]&&h[q-1].classMaxValue||e;u.attributes[d]<=p.classMaxValue&&(u.attributes[d]>v||u.attributes[d]===e)&&(v=p.symbol.color,g.some(function(t){return t[0]===u.attributes[f]})||g.push([u.attributes[f]].concat(v)))})});this._function=new r({colormap:g});this.colormap=g;this._function.outputPixelType="U8";this._function.renderTexture=
!0}this._function&&this._function.setProcessingContext(k.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(l){if(this.isColormapFunction)return this._updateColormapParameters(),l=this._clonePixelData(l),l=this._function._colorize(l);this._updateRemapParameters();return this._function._remap(l)},drawGL:function(l){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(l)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(l))},
toJson:function(){var l=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:l}},toCommonRendererJson:function(){var l,b=this.classBreakInfos,a=this.colorBreaks;if(null==b&&a)for(b=[],l=0;l<a.length-1;l++)b.push({classMaxValue:a[l+1].value,symbol:{color:a[l].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:a[l].value+" - "+a[l+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:a[0].value,classBreakInfos:b}},
_updateRemapParameters:function(){var l=this.classBreakInfos,b=this.minValue;null!=b&&l&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(b,l))},_getSortedColorBreaks:function(l,b){b=b.map(function(c){return{maxValue:c.classMaxValue,color:c.symbol.color}}).sort(function(c,f){return c.maxValue-f.maxValue});var a=[{value:l,mappedColor:b[0].color}];for(l=0;l<b.length;l++)a.push({value:b[l].maxValue,mappedColor:l===b.length-1?b[l].color:b[l+1].color});return a},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(H,k,n,r,m,l,b){return H([n],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,
altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(a){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);a&&a.scalingType&&(this.slopeType="adjusted"===a.scalingType?3:1);a&&a.pixelSizePower&&(this.psPower=a.pixelSizePower);a&&a.pixelSizeFactor&&(this.psFactor=a.pixelSizeFactor);a=k.mixin({},a,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,
slopeType:this.slopeType});Object.keys(a).forEach(function(c){null==a[c]&&delete a[c]});this._function=new m(a);this._hillshadeFunction=new r(a);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},draw2D:function(a){this._updateHillshadeParameters();a=this._clonePixelData(a);a=this._hillshadeFunction.read2D({raster:a});if(this.contrastOffset||
this.brightnessOffset)a.pixelBlock=b.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,a=this._hillshadeFunction.readGL({raster:a}),this._function._cbGL(a)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:a}))},toJson:function(){var a=
this._hillshadeFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":
"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var a=this._hillshadeFunction.functionArguments;a.hillshadeType=this.hillshadeType;a.azimuth=this.azimuth;a.altitude=this.altitude;a.zFactor=this.zFactor;a.slopeType=this.slopeType;a.psPower=this.psPower;a.psFactor=this.psFactor}})})},"esri/layers/rasterLib/raster/rasterProjectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/sniff ../../../kernel ../../../WKIDUnitConversion ../../../geometry/Extent ../../../geometry/projection ../../../geometry/webMercatorUtils ../../../SpatialReference ../../../geometry/Point".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e){H={requirePE:function(d,h){return!(d.equals(h)||d._canProject(h))},load:function(){var d=new n;if(!this._loadPromise)if(a.isSupported())this._loadPromise=a.load();else{var h=new n;h.reject("projection engine is not supported on this version of the browser, please try with a modern browser");this._loadPromise=h.promise}this._loadPromise.isFulfilled()?this._loadPromise.isResolved()?d.resolve():this._loadPromise.isRejected()&&d.resolve():(this._pendingdfds=this._pendingdfds||
[],this._pendingdfds.push(d),this._loadPromise.then(k.hitch(this,function(){this._pendingdfds.forEach(function(p){p.isFulfilled()||p.resolve()})}),k.hitch(this,function(){this._pendingdfds.forEach(function(p){p.isFulfilled()||p.reject()})})));return d.promise},computeError:function(d,h){return[Math.abs((d[0]+d[4]+d[4*h.rows]+d[4*h.rows+4])/4-d[2*h.rows+2]),Math.abs((d[1]+d[5]+d[4*h.rows+1]+d[4*h.rows+5])/4-d[2*h.rows+3])]},getDefaultDatumTransformationForDataset:function(d,h,p){if(!(h&&d.spatialReference&&
this.requirePE(d.spatialReference,h)&&a.isLoaded()))return null;d=new b(d.toJson());h=new f(h.toJson());return p?a.getTransformation(h,d.spatialReference,d):a.getTransformation(d.spatialReference,h,d)},project:function(d,h,p){if(!h||d.spatialReference.equals(h))return d;var q=a.isLoaded()?a:c;"esri.geometry.Extent"===d.declaredClass?d=new b(d.toJson()):"esri.geometry.Point"===d.declaredClass&&(d=new e(d.toJson()));h=new f(h.toJson());(d=q.project(d,h))&&"esri.geometry.Extent"===d.declaredClass?(d=
new b(d.toJson()),p&&(1E-5>Math.abs(d.xmin+180)&&1E-5>Math.abs(d.xmax-180)?(d.xmin=0,d.xmax=360):(0>d.xmin&&(d.xmin+=360,d.xmax+=360),0>d.xmax&&(d.xmax+=360)))):d&&"esri.geometry.Point"===d.declaredClass&&(d=new e(d.toJson()),p&&0>d.x&&(d.x+=360));return d},projectResolution:function(d,h,p){var q=p.xmin+(p.xmax-p.xmin)/2;p=p.ymin+(p.ymax-p.ymin)/2;d=new b(q,p,q+d.x,p+d.y,d.spatialReference);d=this.project(d,h);return new e(d.xmax-d.xmin,d.ymax-d.ymin,h)},getProjectionOffsetGrid:function(d,h,p,q,u,
v,t){null==t&&(t=[32,32]);var x=d.xmin,C=d.ymin,B=d.xmax,F=d.ymax,y=d.spatialReference,w=h.spatialReference,A=a.isLoaded()?a:c,z=u?-u:null,G=t[0]*p.x,I=t[1]*p.y;B={cols:Math.ceil((B-x)/G)+1,rows:Math.ceil((F-C)/I)+1};d=[];for(F=0;F<B.cols;F++){var K=Q;var Q=[];for(p=0;p<B.rows;p++){var N=new e({x:x+G*F,y:C+I*p,spatialReference:y});N=A.project(N,w,v);if(!N)return null;q&&0>N.x&&(N.x+=360);Q.push(N);0<F&&null!=z&&N.x<K[p].x&&(N.x+=u-z,N.x<K[p].x&&(N.x+=u-z));d.push((N.x-h.xmin)/(h.xmax-h.xmin));d.push((N.y-
h.ymin)/(h.ymax-h.ymin))}}h=this.computeError(d,B);q=new Float32Array((B.cols-1)*(B.rows-1)*12);u=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);v=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(F=0;F<B.cols-1;F++)for(p=0;p<B.rows-1;p++){G=F*B.rows*2+2*p;x=d[G];C=d[G+1];Q=d[G+2];y=d[G+3];G+=2*B.rows;w=d[G];A=d[G+1];z=d[G+2];I=d[G+3];K=0;N=12*(p*(B.cols-1)+F);for(G=0;3>G;G++)q[N++]=u[K++]*x+u[K++]*Q+u[K++]*z;for(G=K=0;3>G;G++)q[N++]=u[K++]*C+u[K++]*y+u[K++]*I;for(G=K=0;3>G;G++)q[N++]=v[K++]*x+v[K++]*w+v[K++]*
z;for(G=K=0;3>G;G++)q[N++]=v[K++]*C+v[K++]*A+v[K++]*I}return{offsets:d,error:h,coefficients:q,spacing:t,size:[B.cols-1,B.rows-1]}},getHalfWorldWidth:function(d){var h=d&&d.wkid;if(null!=h)return d.isWebMercator()&&(h=3857),null==l[h]?180:g[h]}};r("extend-esri")&&k.setObject("layers.rasterLib.raster.rasterProjectionHelper",H,m);var g={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,
32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,
54100:2.0037508342789244E7,54101:2.0037508342789244E7};return H})},"esri/geometry/projection":function(){define("require exports dojo/Deferred ./pe ../SpatialReference ./GeographicTransformation".split(" "),function(H,k,n,r,m,l){function b(g,d,h,p,q){void 0===p&&(p=null);void 0===q&&(q=!1);if(null===p){var u=l.cacheKey(d,h);void 0!==e[u]?p=e[u]:(p=a(d,h,null),null===p&&(p=new l),e[u]=p)}return c._project(g,d,h instanceof m||!1===q?h:new m(h),p,q)}function a(g,d,h){void 0===h&&(h=null);g=c._getTransformation(g,
d,h);return null!==g?l.fromGE(g):null}Object.defineProperty(k,"__esModule",{value:!0});var c=null;k.isLoaded=function(){return!!c&&r.isLoaded()};k.isSupported=function(){return r.isSupported()};var f=null;k.load=function(){if(f)return f.promise;f=new n;var g=r.load();H(["./geometryEngine"],function(d){c=d;g.then(function(){c._enableProjection(r);f.resolve()},function(h){f.reject(h)})});return f.promise};k.project=function(g,d,h){void 0===h&&(h=null);return g instanceof Array?0===g.length?[]:b(g,g[0].spatialReference,
d,h):b([g],g.spatialReference,d,h)[0]};var e={};k.projectMany=b;k.getTransformation=a;k.getTransformations=function(g,d,h){void 0===h&&(h=null);g=c._getTransformationBySuitability(g,d,h);if(null!==g){d=[];for(h=0;h<g.length;h++)d.push(l.fromGE(g[h]));return d}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(H,k,n,r,m){function l(u){function v(B,F,y){B[F]=y(B[F])}k._pe=u;g.init();d.init();h.init();p.init();
q.init();k.PeGCSExtent=function(B){function F(){return null!==B&&B.apply(this,arguments)||this}n(F,B);F.prototype.destroy=function(){k._pe.destroy(this)};return F}(k._pe.PeGCSExtent);for(var t=0,x=[k._pe.PeDatum,k._pe.PeGeogcs,k._pe.PeGeogtran,k._pe.PeObject,k._pe.PeParameter,k._pe.PePrimem,k._pe.PeProjcs,k._pe.PeSpheroid,k._pe.PeUnit];t<x.length;t++)u=x[t],v(u.prototype,"getName",function(B){return function(){return B.call(this,Array(g.PE_NAME_MAX))}});t=0;for(x=[k._pe.PeGeogtran,k._pe.PeProjcs];t<
x.length;t++)u=x[t],v(u.prototype,"getParameters",function(B){return function(){for(var F=Array(g.PE_PARM_MAX),y=B.call(this),w=0;w<F.length;w++){var A=k._pe.getValue(y,"*");F[w]=A?k._pe.wrapPointer(A,k._pe.PeParameter):null;y+=Int32Array.BYTES_PER_ELEMENT}return F}});v(k._pe.PeHorizon.prototype,"getCoord",function(B){return function(){var F=this.getSize();if(!F)return null;var y=[],w=B.call(this);f(y,F,w);return y}});v(k._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(B){var F=k._pe._pe_getPeGTlistExtendedGTsSize();
return function(){var y=null,w=B.call(this);if(!k._pe.compare(w,k._pe.NULL)){y=[w];var A=this.getSteps();if(1<A){w=k._pe.getPointer(w);for(var z=1;z<A;z++)y.push(k._pe.wrapPointer(w+F*z,k._pe.PeGTlistExtendedGTs))}}return y}});var C=k._pe._pe_getPeHorizonSize();u=function(B){return function(){var F=this._cache;F||(this._cache=F=new Map);if(F.has(B))return F.get(B);var y=null,w=B.call(this);if(!k._pe.compare(w,k._pe.NULL)){y=[w];var A=w.getNump();if(1<A){w=k._pe.getPointer(w);for(var z=1;z<A;z++)y.push(k._pe.wrapPointer(w+
C*z,k._pe.PeHorizon))}}F.set(B,y);return y}};v(k._pe.PeProjcs.prototype,"horizonGcsGenerate",u);v(k._pe.PeProjcs.prototype,"horizonPcsGenerate",u);k._pe.PeObject.prototype.toString=function(B){void 0===B&&(B=g.PE_STR_OPTS_NONE);k._pe.ensureCache.prepare();var F=k._pe.getPointer(this),y=k._pe.ensureInt8(Array(g.PE_BUFFER_MAX));return k._pe.UTF8ToString(k._pe._pe_object_to_string_ext(F,B,y))}}function b(u){if(u){var v=k._pe.getClass(u);v&&(v=k._pe.getCache(v))&&(u=k._pe.getPointer(u))&&delete v[u]}}
function a(u,v){var t=[];v=Array(v);for(var x=0;x<u;x++)t.push(k._pe.ensureInt8(v));return t}function c(u){if(Array.isArray(u[0])){var v=[];u.forEach(function(t){v.push(t[0],t[1])})}else v=u;return v}function f(u,v,t,x){void 0===x&&(x=!1);if(x)for(x=0;x<2*v;x++)u[x]=k._pe.getValue(t+x*Float64Array.BYTES_PER_ELEMENT,"double");else{var C=0===u.length;for(x=0;x<v;x++)C&&(u[x]=Array(2)),u[x][0]=k._pe.getValue(t,"double"),u[x][1]=k._pe.getValue(t+Float64Array.BYTES_PER_ELEMENT,"double"),t+=2*Float64Array.BYTES_PER_ELEMENT}}
Object.defineProperty(k,"__esModule",{value:!0});var e;k._pe=null;k.isLoaded=function(){return!!k._pe};k.isSupported=function(){return!!m("esri-wasm")};k.load=function(){if(e)return e.promise;e=new r;H(["./support/pe-wasm"],function(u){u({locateFile:function(v){return H.toUrl("./support/"+v)},onAbort:function(v){e.reject(Error(v))}}).then(function(v){l(v);e.resolve()})});return e.promise};(function(u){function v(C,B,F){k._pe.ensureCache.prepare();var y=c(F),w=F===y;y=k._pe.ensureFloat64(y);(C=k._pe._pe_geog_to_proj(k._pe.getPointer(C),
B,y))&&f(F,B,y,w);return C}function t(C,B,F){return x(C,B,F,0)}function x(C,B,F,y){k._pe.ensureCache.prepare();var w=c(F),A=F===w;w=k._pe.ensureFloat64(w);(C=k._pe._pe_proj_to_geog_center(k._pe.getPointer(C),B,w,y))&&f(F,B,w,A);return C}u.geogToProj=v;u.projGeog=function(C,B,F,y){switch(y){case g.PE_TRANSFORM_P_TO_G:return t(C,B,F);case g.PE_TRANSFORM_G_TO_P:return v(C,B,F)}return 0};u.projToGeog=t;u.projToGeogCenter=x})(k.PeCSTransformations||(k.PeCSTransformations={}));var g;(function(u){u.init=
function(){u.PE_BUFFER_MAX=k._pe.PeDefs.prototype.PE_BUFFER_MAX;u.PE_NAME_MAX=k._pe.PeDefs.prototype.PE_NAME_MAX;u.PE_MGRS_MAX=k._pe.PeDefs.prototype.PE_MGRS_MAX;u.PE_USNG_MAX=k._pe.PeDefs.prototype.PE_USNG_MAX;u.PE_DD_MAX=k._pe.PeDefs.prototype.PE_DD_MAX;u.PE_DDM_MAX=k._pe.PeDefs.prototype.PE_DDM_MAX;u.PE_DMS_MAX=k._pe.PeDefs.prototype.PE_DMS_MAX;u.PE_UTM_MAX=k._pe.PeDefs.prototype.PE_UTM_MAX;u.PE_PARM_MAX=k._pe.PeDefs.prototype.PE_PARM_MAX;u.PE_TYPE_NONE=k._pe.PeDefs.prototype.PE_TYPE_NONE;u.PE_TYPE_GEOGCS=
k._pe.PeDefs.prototype.PE_TYPE_GEOGCS;u.PE_TYPE_PROJCS=k._pe.PeDefs.prototype.PE_TYPE_PROJCS;u.PE_TYPE_GEOGTRAN=k._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;u.PE_TYPE_COORDSYS=k._pe.PeDefs.prototype.PE_TYPE_COORDSYS;u.PE_TYPE_UNIT=k._pe.PeDefs.prototype.PE_TYPE_UNIT;u.PE_STR_OPTS_NONE=k._pe.PeDefs.prototype.PE_STR_OPTS_NONE;u.PE_STR_AUTH_NONE=k._pe.PeDefs.prototype.PE_STR_AUTH_NONE;u.PE_STR_AUTH_TOP=k._pe.PeDefs.prototype.PE_STR_AUTH_TOP;u.PE_STR_NAME_CANON=k._pe.PeDefs.prototype.PE_STR_NAME_CANON;u.PE_PARM_X0=
k._pe.PeDefs.prototype.PE_PARM_X0;u.PE_PARM_ND=k._pe.PeDefs.prototype.PE_PARM_ND;u.PE_TRANSFORM_1_TO_2=k._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;u.PE_TRANSFORM_2_TO_1=k._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;u.PE_TRANSFORM_P_TO_G=k._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;u.PE_TRANSFORM_G_TO_P=k._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;u.PE_HORIZON_RECT=k._pe.PeDefs.prototype.PE_HORIZON_RECT;u.PE_HORIZON_POLY=k._pe.PeDefs.prototype.PE_HORIZON_POLY;u.PE_HORIZON_LINE=k._pe.PeDefs.prototype.PE_HORIZON_LINE;
u.PE_HORIZON_DELTA=k._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(g=k.PeDefs||(k.PeDefs={}));(function(u){function v(B,F){var y=null,w=x[B];w||(w={},x[B]=w);w.hasOwnProperty(String(F))?y=w[F]:(B=k._pe.PeFactory.prototype.factoryByType(B,F),k._pe.compare(B,k._pe.NULL)||(y=B,w[F]=y));return y=t(y)}function t(B){if(B){var F=B.getType();switch(F){case g.PE_TYPE_GEOGCS:B=k._pe.castObject(B,k._pe.PeGeogcs);break;case g.PE_TYPE_PROJCS:B=k._pe.castObject(B,k._pe.PeProjcs);break;case g.PE_TYPE_GEOGTRAN:B=k._pe.castObject(B,
k._pe.PeGeogtran);break;default:F&g.PE_TYPE_UNIT&&(B=k._pe.castObject(B,k._pe.PeUnit))}}return B}var x={},C={};u.initialize=function(){k._pe.PeFactory.prototype.initialize(null)};u.coordsys=function(B){return v(g.PE_TYPE_COORDSYS,B)};u.factoryByType=v;u.fromString=function(B,F){var y=null,w=C[B];w||(w={},C[B]=w);w.hasOwnProperty(F)?y=w[F]:(B=k._pe.PeFactory.prototype.fromString(B,F),k._pe.compare(B,k._pe.NULL)||(y=B,w[F]=y));return y=t(y)};u.geogcs=function(B){return v(g.PE_TYPE_GEOGCS,B)};u.geogtran=
function(B){return v(g.PE_TYPE_GEOGTRAN,B)};u.getCode=function(B){return k._pe.PeFactory.prototype.getCode(B)};u.projcs=function(B){return v(g.PE_TYPE_PROJCS,B)};u.unit=function(B){return v(g.PE_TYPE_UNIT,B)}})(k.PeFactory||(k.PeFactory={}));k.PeGCSExtent=null;var d;(function(u){var v;u.init=function(){u.PE_GTLIST_OPTS_COMMON=k._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;v=k._pe._pe_getPeGTlistExtendedEntrySize()};u.getGTlist=function(t,x,C,B,F,y){var w=null,A=new k._pe.PeInteger(y);try{var z=
k._pe.PeGTlistExtended.prototype.getGTlist(t,x,C,B,F,A);if(y=A.val)if(w=[z],1<y){var G=k._pe.getPointer(z);for(t=1;t<y;t++)w.push(k._pe.wrapPointer(G+v*t,k._pe.PeGTlistExtendedEntry))}}finally{k._pe.destroy(A)}return w}})(d=k.PeGTlistExtended||(k.PeGTlistExtended={}));(function(u){u.destroy=function(v){if(v&&v.length){for(var t=0;t<v.length;t++){var x=v[t];b(x);x.getEntries().forEach(function(C){b(C);C=C.getGeogtran();b(C);C.getParameters().forEach(b);[C.getGeogcs1(),C.getGeogcs2()].forEach(function(B){b(B);
var F=B.getDatum();b(F);b(F.getSpheroid());b(B.getPrimem());b(B.getUnit())})})}k._pe.PeGTlistExtendedEntry.prototype.Delete(v[0])}}})(k.PeGTlistExtendedEntry||(k.PeGTlistExtendedEntry={}));(function(u){u.geogToGeog=function(v,t,x,C,B){k._pe.ensureCache.prepare();var F=c(x),y=x===F;F=k._pe.ensureFloat64(F);var w=0;C&&(w=k._pe.ensureFloat64(C));(v=k._pe._pe_geog_to_geog(k._pe.getPointer(v),t,F,w,B))&&f(x,t,F,y);return v}})(k.PeGTTransformations||(k.PeGTTransformations={}));(function(u){function v(x,
C,B,F,y,w){k._pe.ensureCache.prepare();switch(x){case "dd":var A=k._pe._pe_geog_to_dd;var z=g.PE_DD_MAX;break;case "ddm":A=k._pe._pe_geog_to_ddm;z=g.PE_DDM_MAX;break;case "dms":A=k._pe._pe_geog_to_dms,z=g.PE_DMS_MAX}x=0;C&&(x=k._pe.getPointer(C));C=c(F);C=k._pe.ensureFloat64(C);z=a(B,z);F=k._pe.ensureInt32(z);if(y=A(x,B,C,y,F))for(A=0;A<B;A++)w[A]=k._pe.UTF8ToString(z[A]);return y}function t(x,C,B,F,y){k._pe.ensureCache.prepare();switch(x){case "dd":var w=k._pe._pe_dd_to_geog;break;case "ddm":w=k._pe._pe_ddm_to_geog;
break;case "dms":w=k._pe._pe_dms_to_geog}x=0;C&&(x=k._pe.getPointer(C));C=F.map(function(A){return k._pe.ensureString(A)});F=k._pe.ensureInt32(C);C=k._pe.ensureFloat64(Array(2*B));(w=w(x,B,F,C))&&f(y,B,C);return w}u.geog_to_dms=function(x,C,B,F,y){return v("dms",x,C,B,F,y)};u.dms_to_geog=function(x,C,B,F){return t("dms",x,C,B,F)};u.geog_to_ddm=function(x,C,B,F,y){return v("ddm",x,C,B,F,y)};u.ddm_to_geog=function(x,C,B,F){return t("ddm",x,C,B,F)};u.geog_to_dd=function(x,C,B,F,y){return v("dd",x,C,
B,F,y)};u.dd_to_geog=function(x,C,B,F){return t("dd",x,C,B,F)}})(k.PeNotationDms||(k.PeNotationDms={}));var h;(function(u){u.init=function(){u.PE_MGRS_STYLE_NEW=k._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;u.PE_MGRS_STYLE_OLD=k._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;u.PE_MGRS_STYLE_AUTO=k._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;u.PE_MGRS_180_ZONE_1_PLUS=k._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;u.PE_MGRS_ADD_SPACES=k._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};
u.geog_to_mgrs_extended=function(v,t,x,C,B,F,y){k._pe.ensureCache.prepare();var w=0;v&&(w=k._pe.getPointer(v));v=c(x);x=k._pe.ensureFloat64(v);v=a(t,g.PE_MGRS_MAX);var A=k._pe.ensureInt32(v);if(C=k._pe._pe_geog_to_mgrs_extended(w,t,x,C,B,F,A))for(B=0;B<t;B++)y[B]=k._pe.UTF8ToString(v[B]);return C};u.mgrs_to_geog_extended=function(v,t,x,C,B){k._pe.ensureCache.prepare();var F=0;v&&(F=k._pe.getPointer(v));v=x.map(function(y){return k._pe.ensureString(y)});x=k._pe.ensureInt32(v);v=k._pe.ensureFloat64(Array(2*
t));(C=k._pe._pe_mgrs_to_geog_extended(F,t,x,C,v))&&f(B,t,v);return C}})(h=k.PeNotationMgrs||(k.PeNotationMgrs={}));(function(u){u.geog_to_usng=function(v,t,x,C,B,F,y){k._pe.ensureCache.prepare();var w=0;v&&(w=k._pe.getPointer(v));v=c(x);x=k._pe.ensureFloat64(v);v=a(t,g.PE_MGRS_MAX);var A=k._pe.ensureInt32(v);if(C=k._pe._pe_geog_to_usng(w,t,x,C,B,F,A))for(B=0;B<t;B++)y[B]=k._pe.UTF8ToString(v[B]);return C};u.usng_to_geog=function(v,t,x,C){k._pe.ensureCache.prepare();var B=0;v&&(B=k._pe.getPointer(v));
v=x.map(function(F){return k._pe.ensureString(F)});x=k._pe.ensureInt32(v);v=k._pe.ensureFloat64(Array(2*t));(B=k._pe._pe_usng_to_geog(B,t,x,v))&&f(C,t,v);return B}})(k.PeNotationUsng||(k.PeNotationUsng={}));var p;(function(u){u.init=function(){u.PE_UTM_OPTS_NONE=k._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;u.PE_UTM_OPTS_ADD_SPACES=k._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;u.PE_UTM_OPTS_NS=k._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};u.geog_to_utm=function(v,t,x,C,B){k._pe.ensureCache.prepare();
var F=0;v&&(F=k._pe.getPointer(v));v=c(x);x=k._pe.ensureFloat64(v);v=a(t,g.PE_UTM_MAX);var y=k._pe.ensureInt32(v);if(C=k._pe._pe_geog_to_utm(F,t,x,C,y))for(F=0;F<t;F++)B[F]=k._pe.UTF8ToString(v[F]);return C};u.utm_to_geog=function(v,t,x,C,B){k._pe.ensureCache.prepare();var F=0;v&&(F=k._pe.getPointer(v));v=x.map(function(y){return k._pe.ensureString(y)});x=k._pe.ensureInt32(v);v=k._pe.ensureFloat64(Array(2*t));(C=k._pe._pe_utm_to_geog(F,t,x,C,v))&&f(B,t,v);return C}})(p=k.PeNotationUtm||(k.PeNotationUtm=
{}));var q;(function(u){var v=new Map;u.init=function(){u.PE_PCSINFO_OPTION_NONE=k._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;u.PE_PCSINFO_OPTION_DOMAIN=k._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;u.PE_POLE_OUTSIDE_BOUNDARY=k._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;u.PE_POLE_POINT=k._pe.PePCSInfo.prototype.PE_POLE_POINT};u.generate=function(t,x){void 0===x&&(x=u.PE_PCSINFO_OPTION_DOMAIN);var C;if(v.has(t)){var B=v.get(t);B[x]&&(C=B[x])}C||(C=k._pe.PePCSInfo.prototype.generate(t,
x),B||(B=[],v.set(t,B)),B[x]=C);return C}})(q=k.PePCSInfo||(k.PePCSInfo={}));(function(u){u.version_string=function(){return k._pe.PeVersion.prototype.version_string()}})(k.PeVersion||(k.PeVersion={}));k._init=l})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,n){k.__proto__=n}||function(k,n){for(var r in n)n.hasOwnProperty(r)&&(k[r]=n[r])};return function(k,n){function r(){this.constructor=
k}H(k,n);k.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()})},"esri/geometry/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(H,k,n){return function(){function r(m){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(m&&m.steps){var l=0;for(m=m.steps;l<m.length;l++){var b=m[l];b instanceof n?this.steps.push(b):this.steps.push(new n({wkid:b.wkid,wkt:b.wkt,isInverse:b.isInverse}))}}}r.cacheKey=
function(m,l){return[void 0!==m.wkid&&null!==m.wkid?m.wkid.toString():"-1",void 0!==m.wkt&&null!==m.wkt?m.wkt.toString():"",void 0!==l.wkid&&null!==l.wkid?l.wkid.toString():"-1",void 0!==l.wkt&&null!==l.wkt?l.wkt.toString():""].join()};r.fromGE=function(m){var l=new r,b="",a=0;for(m=m.steps;a<m.length;a++){var c=n.fromGE(m[a]);l.steps.push(c);b+=c.uid.toString()+","}l._cached_projection={};l._gtlistentry=null;l._chain=b;return l};r.prototype.getInverse=function(){var m=new r;m.steps=[];for(var l=
this.steps.length-1;0<=l;l--)m.steps.push(this.steps[l].getInverse());return m};r.prototype.getGTListEntry=function(){for(var m="",l=0,b=this.steps;l<b.length;l++)m+=b[l].uid.toString()+",";m!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=m);return this._gtlistentry};r.prototype.assignCachedGe=function(m,l,b){this._cached_projection[r.cacheKey(m,l)]=b};r.prototype.getCachedGeTransformation=function(m,l){for(var b="",a=0,c=this.steps;a<c.length;a++)b+=c[a].uid.toString()+
",";b!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=b);m=this._cached_projection[r.cacheKey(m,l)];return void 0===m?null:m};return r}()})},"esri/geometry/GeographicTransformationStep":function(){define(["require","exports"],function(H,k){var n=0;return function(){function r(m){void 0===m&&(m=null);this.uid=n++;m?(this._wkt=void 0!==m.wkt?m.wkt:null,this._wkid=void 0!==m.wkid?m.wkid:-1,this._isInverse=void 0!==m.isInverse?!0===m.isInverse:!1):(this._wkt=null,this._wkid=
-1,this._isInverse=!1)}r.fromGE=function(m){var l=new r;l._wkt=m.wkt;l._wkid=m.wkid;l._isInverse=m.isInverse;return l};Object.defineProperty(r.prototype,"wkt",{get:function(){return this._wkt},set:function(m){this._wkt=m;this.uid=n++},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"wkid",{get:function(){return this._wkid},set:function(m){this._wkid=m;this.uid=n++},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"isInverse",{get:function(){return this._isInverse},
set:function(m){this._isInverse=m;this.uid=n++},enumerable:!0,configurable:!0});r.prototype.getInverse=function(){var m=new r;m._wkt=this.wkt;m._wkid=this._wkid;m._isInverse=!this.isInverse;return m};return r}()})},"esri/layers/rasterLib/raster/TileServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F){H=k([F],{declaredClass:"esri.layers.rasterLib.raster.TileServiceRaster",constructor:function(y){},open:function(){var y=new r,w=this.serviceInfo||this._getServiceInfo(null),A=n.hitch(this,function(G){this.serviceInfo=G;this.version=G.currentVersion;this.rasterInfo=this._parseRasterInfo(G);this.loaded=!0;this._getRasterIdentifier();y.resolve(this)}),z=n.hitch(this,function(G){this.loaded=!0;this._getRasterIdentifier();y.reject(G)});f(w,A,z);return y.promise},
read:function(y){var w=this.url+"/tile/"+y.level+"/"+y.row+"/"+y.col,A={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};return this._requestPixels({url:w+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},decodeParams:A,tileOptions:y})},identify:function(y,w){null==w&&(w=this.tileInfo.lods[this.tileInfo.lods.length-1].level);var A=(y.x-this.tileInfo.origin.x)/
this.tileInfo.lods[w].resolution/this.tileInfo.cols;y=(this.tileInfo.origin.y-y.y)/this.tileInfo.lods[w].resolution/this.tileInfo.rows;var z=Math.floor(A),G=Math.floor(y),I=Math.floor((A-z)*this.tileInfo.cols);I=Math.min(I,this.tileInfo.cols-1);var K=Math.floor((y-G)*this.tileInfo.rows);K=Math.min(K,this.tileInfo.rows-1);var Q=new r;this.read({level:w,row:G,col:z}).then(function(N){var T=K*N.width+I;N&&N.pixels&&0<N.pixels.length?(N=N.mask?N.mask[T]?N.pixels.map(function(W){return W[T]}):null:N.pixels.map(function(W){return W[T]}),
Q.resolve(N)):Q.reject("no valid data")},function(N){Q.reject(N)});return Q.promise},setFetchParameters:function(y,w){},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_getServiceInfo:function(){var y=this.url,w=new r(u._dfdCanceller);w._pendingDfd=d({url:y,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});w._pendingDfd.then(function(A){w.callback(A)},function(A){w.errback(A)});return w},_parseRasterInfo:function(y){var w=
new B;w.extent=new h(y.fullExtent);w.spatialReference=new q(y.spatialReference);this.tileType=y.cacheType||"Map";switch(this.tileType){case "Map":w.bandCount=3;w.pixelType="U8";this.dataType="Processed";break;case "Elevation":w.bandCount=1;w.pixelType=y.pixelType||"F32";this.dataType="Elevation";break;case "Raster":w.bandCount=null,w.pixelType=null,this.dataType=y.serviceDataType&&y.serviceDataType.replace("esriImageServiceDataType","")||"Generic"}var A=y.tileInfo;w.width=Math.floor((y.fullExtent.xmax-
y.fullExtent.xmin)/A.lods[A.lods.length-1].resolution+.5);w.height=Math.floor((y.fullExtent.ymax-y.fullExtent.ymin)/A.lods[A.lods.length-1].resolution+.5);w.cellSize=new p({x:A.lods[A.lods.length-1].resolution,y:A.lods[A.lods.length-1].resolution,spatialReference:y.spatialReference});this.tileInfo=new C(A);this.tileInfo.tileType=this.tileType;return w}});a("extend-esri")&&n.setObject("layers.rasterLib.raster.TileServiceRaster",H,e);return H})},"esri/layers/rasterLib/raster/TileRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F){H=k([F],{declaredClass:"esri.layers.rasterLib.raster.TileRaster",sourceType:"TileCache",_RECORD_SIZE:8,constructor:function(y){this._cloudBlobStorage=y&&y._cloudBlobStorage},open:function(){var y=new r,w=this.datasetInfo||this._getDatasetInfo(null),A=n.hitch(this,function(G){this.datasetInfo=G;this.rasterInfo=G=this._parseRasterInfo(G);this.tileType="Cache/LERC"===G.format?"Elevation":"Cache/MIXED"===G.format||"Cache/JPEG"===G.format||"Cache/PNG"===
G.format?"Map":"Raster";this.tileInfo=G.tileInfo;this.dataType=["Generic","Elevation","Processed"][["Raster","Elevation","Map"].indexOf(this.tileType)];this._HEADER_SIZE=G.packetSize*G.packetSize*this._RECORD_SIZE+64;this.loaded=!0;this._cloudBlobStorage=this._cloudBlobStorage||-1<this.url.toLowerCase().indexOf("s3.amazonaws.com")||-1<this.url.toLowerCase().indexOf("windows.net")||-1<this.url.toLowerCase().indexOf("googleapis.com");this._getRasterIdentifier();y.resolve(this)}),z=n.hitch(this,function(G){this.loaded=
!0;this._getRasterIdentifier();y.reject(G)});f(w,A,z);return y.promise},read:function(y){var w=new r,A=y.level,z=y.row,G=y.col,I=this._buildCacheFilePath(this.url,A,z,G),K=this._getIndexRecordFromBundle(A,z,G);d({url:I,content:{},headers:{Range:"bytes\x3d0-"+(this._HEADER_SIZE-1).toString()},handleAs:"arraybuffer"}).then(n.hitch(this,function(Q,N){if(!w.isCanceled()){console.log("time in ms request "+(new Date-T));var T=new Date;Q=new Uint8Array(Q);Q=this._getTileEndAndContentType(Q,K);N={width:this.tileInfo.cols,
height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};this._requestPixels({url:I+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},headers:{Range:"bytes\x3d"+Q.position.toString()+"-"+(Q.position+Q.recordSize).toString()},decodeParams:N,tileOptions:y}).then(function(W){w.isCanceled()||w.resolve(W)},function(W){w.isCanceled()||w.reject(W)})}}));return w.promise},identify:function(){return null},
setFetchParameters:function(y,w){},toJson:function(){return{url:this.url,tileInfo:this.tileInfo.toJson(),rasterInfo:this.rasterInfo.toJson(),datasetInfo:this.datasetInfo,sourceType:this.sourceType,tileType:this.tileType,_rasterId:this._rasterId}},_getDatasetInfo:function(){return d({url:this.url+"/conf.json",handleAs:"json",content:{}})},_parseRasterInfo:function(y){var w=new B;switch(y.pixelType){case 1:var A="U1";break;case 1:A="U2";break;case 2:A="U4";break;case 3:A="U8";break;case 4:A="S8";break;
case 5:A="U16";break;case 6:A="S16";break;case 7:A="U32";break;case 8:A="S32";break;case 9:A="F32";break;default:A="F32"}var z,G=[],I=y.LODInfos;for(z=0;z<I.levels.length;z++)G.push({level:I.levels[z],resolution:I.resolutions[z],scale:96/.0254*I.resolutions[z]});z=new q(y.extent.spatialReference||y.geodataXform.spatialReference);G=new C({rows:y.blockHeight,cols:y.blockWidth,dpi:96,format:y.format,compressionQuality:0,origin:y.origin,spatialReference:z,lods:G});w.pixelType=A;w.bandCount=y.bandCount;
w.spatialReference=z;w.extent=new h({xmin:y.extent.xmin,ymin:y.extent.ymin,xmax:y.extent.xmax,ymax:y.extent.ymax,spatialReference:z});w.cellSize=new p({x:y.pixelSizeX,y:y.pixelSizeY,spatialReference:z});w.width=Math.floor((w.extent.xmax-w.extent.xmin)/w.cellSize.x+.5);w.height=Math.floor((w.extent.ymax-w.extent.ymin)/w.cellSize.y+.5);w.statistics=y.statistics.map(function(K){Object.keys(K).forEach(function(Q){isNaN(K[Q])&&(K[Q]=null)});return K});w.histograms=y.histograms;w.geodataXform=y.geodataXform;
w.packetSize=y.packetSize;w.format=y.format;w.compressionQuality=y.compressionQuality;w.tileInfo=G;return w},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_buildCacheFilePath:function(y,w,A,z){var G=this.rasterInfo.packetSize;z=Math.floor(z/G)*G;A="R"+this._toHexString4(Math.floor(A/G)*G)+"C"+this._toHexString4(z);G="L";G=10<=w?G+w.toString():G+("0"+w.toString());return this._cloudBlobStorage?y+"/_alllayers/"+
G+"/"+A+".bundle":y+"/"+G+"_"+A+"/bundle"},_getIndexRecordFromBundle:function(y,w,A){y=this.rasterInfo.packetSize;w=w%y*y+A%y;if(0>w)throw"Invalid level / row / col";return w*this._RECORD_SIZE+64},_getTileEndAndContentType:function(y,w){y=y.subarray(w,w+8);w=0;var A;for(A=0;5>A;A++)w|=(y[A]&255)<<8*A;var z=w&0xffffffffff;w=0;for(A=5;8>A;A++)w|=(y[A]&255)<<8*(A-5);return{position:z,recordSize:w&0xffffffffff}},_toHexString4:function(y){y=y.toString(16);if(4!=y.length)for(var w=4-y.length;0<w--;)y="0"+
y;return y}});a("extend-esri")&&n.setObject("layers.rasterLib.raster.TileRaster",H,e);return H})},"esri/layers/rasterLib/raster/FunctionRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff ../DeferredList2 dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../rasterFormats/rasterCodec ./RasterInfo ./BasicRaster ../../rasterLib/function/rasterFunctionHelper".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F){H=k([B],{declaredClass:"esri.layers.rasterLib.raster.FunctionRaster",rasterFunction:null,sourceType:"Function",constructor:function(y){y&&y.rasterFx&&this._init(y.rasterFx,y.rasterFxArgs)},open:function(){var y=this.getMemberRasters().map(function(A){return A.open()});this.identifiers=this.getMemberRasters().map(function(A){return A._rasterId});var w=new r;(new c(y,null,null,!0)).then(function(A){A.some(function(z){return!z[0]})?w.reject(A):
(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.tileInfo=A[0][1].tileInfo,w.resolve(this))}.bind(this));return w.promise},getProjectedFullExtent:function(y){var w=new r;this.getMemberRasters()[0].getProjectedFullExtent(y).then(n.hitch(this,function(A){this.projectedFullExtent=A;w.resolve(A)}));return w.promise},setProcessingContext:function(y){var w=y;y.layer&&(y=y.layer,
w={id:y.id,rawRasterInfo:y.raster.rasterInfo,glSetting:y._glSetting,xformSetting:y.tileManager&&y.tileManager.xformSetting,useWebGL:y.useWebGL,resampling:y.tileMode&&y.tileManager&&y.tileManager.xformSetting.requireProjection&&!y._hasTilingEffects&&"Thematic"!==y.raster.dataType?1:0,tileMode:y.tileMode});this.rasterFunction.setProcessingContext(w);this._layerOptions=w},alterDefinition:function(y){if(y=y||this.rasterFunction)1===this.memberRasters.length&&!y._bindComplete&&(this.rasterFunction=F.create(y,
{raster:this.memberRasters[0]}))&&(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.rasterFunction.setProcessingContext(this._layerOptions)),this._rasterHandler&&this._rasterHandler._connected&&this.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this._layerOptions.id,data:this.rasterFunction.toJson(!0)})},setFetchParameters:function(y,w){var A=this.getMemberRasters();
A&&1===A.length&&A[0].setFetchParameters(y,w)},getMemberRasters:function(){this.memberRasters||(this.memberRasters=[],this._getMemberRasters(this.rasterFunction.functionArguments,this.memberRasters));return this.memberRasters},read:function(y){var w=new r(h._dfdCanceller);if(y.src){var A=this.rasterFunction.read(y);w.resolve(A);return w.promise}var z=this.getMemberRasters().map(function(Q){return Q.read(y)});z=new c(z);var G,I,K=this.identifiers;w._pendingDfd=z;z.then(n.hitch(this,function(Q){if(G=
Q.some(function(N){return N[0]}))I={},Q.forEach(function(N,T){I[K[T]]=N[0]?N[1]:null});A=I?this.rasterFunction.read({extent:y.extent,src:I}):null;A.srcData=I;w.resolve(A)}));return w},_init:function(y,w){if(this.rasterFunction=F.create(y,w))this.rasterFunction._bindComplete=!0;else throw"Cannot initialize a function raster without a raster function";},_getMemberRasters:function(y,w){var A=Object.keys(y),z,G,I;for(z=0;z<A.length;z++)if(I=y[A[z]]){var K=I instanceof Array?I:[I];for(G=0;G<K.length;G++)(I=
K[G])&&("function"===typeof I||"object"===typeof I)&&I.read&&(I.functionArguments?this._getMemberRasters(I.functionArguments,w):I.sourceType&&"Function"!==I.sourceType&&(I._identifier=I._getRasterIdentifier(),w.some(function(Q){return Q._identifier===I._identifier})||w.push(I)))}return w}});a("extend-esri")&&n.setObject("layers.rasterLib.raster.FunctionRaster",H,e);return H})},"esri/layers/rasterLib/DeferredList2":function(){define(["dojo/DeferredList"],function(H){return function(k,n,r,m,l){this.list=
k;n=new H(k,n,r,m,l);var b=n.resolve.bind(n),a=n.cancel.bind(n);n.cancel=function(){k&&k.forEach(function(c){c.cancel&&c.cancel()});a.apply(this,arguments)}.bind(n);n.resolve=function(){this.isFulfilled()||b.apply(this,arguments)}.bind(n);return n}})},"esri/layers/rasterLib/tile/RasterTileManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ../DeferredList2 ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../PixelBlock ./RasterTileInfo ../raster/rasterProjectionHelper".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e){var g=function(d,h){var p;for(p=0;p<d.length;p++)if(h(d[p]))return p;return-1};return H(null,{declaredClass:"esri.layers.rasterLib.tile.RasterTileManager",count:null,fullBoundary:null,tileBoundary:null,tiles:null,resolution:null,virtual:!0,prefetchBufferSize:0,_progressiveGlobal:!1,_MAX_TILES:128,_defaultMatrixResolution:20,constructor:function(d){this.tiles=[];this.xformSetting={};this.mapSpatialReference=d&&d.mapSR;this.layer=d&&d.layer;this.identifiers=this.layer.raster.rasterFunction?
this.layer.raster.getMemberRasters().map(function(h){return h._rasterId}):[this.layer.raster._rasterId];(d=d&&d.tileInfo)&&this.setTileInfo(d)},setTileInfo:function(d){this.tileInfo=d;this.virtual=d.virtual;this.mapResolution=null;this.tiles.length=0;this.xformSetting.requireProjection=!this.virtual&&!this.mapSpatialReference.equals(this.tileInfo.spatialReference);this.xformSetting.requirePE=e.requirePE(this.mapSpatialReference,this.tileInfo.spatialReference);this.xformSetting.meshSize=this.xformSetting.requireProjection?
[this._defaultMatrixResolution,this._defaultMatrixResolution]:[1,1];this.halfWorldWidth=e.getHalfWorldWidth(d.spatialReference)},updateResolution:function(d,h){if(!(this.mapResolution&&d&&this._resolutionEqual(this.mapResolution.x,d.x)&&this._resolutionEqual(this.mapResolution.y,d.y))){this.resetTiles();var p=this.xformSetting.requireProjection;this.mapResolution=this.resolution=d;p&&(this.resolution=e.projectResolution(d,this.tileInfo.spatialReference,this.layer.projectedFullExtent||h));this._resolution=
this.resolution;d=this.resolution;if(!this.tileInfo.virtual){p=.75*Math.min(d.x,d.y)+.25*Math.max(d.x,d.y);if(p>=this.tileInfo.lods[0].resolution){var q=this.tileInfo.lods[0];this.ooe=!0}else{if(p<=this.tileInfo.lods[this.tileInfo.lods.length-1].resolution)q=this.tileInfo.lods[this.tileInfo.lods.length-1];else for(d=0;d<this.tileInfo.lods.length-1;d++)if(q=this.tileInfo.lods[d],h=this.tileInfo.lods[d+1],q.resolution>=p&&h.resolution<=p){q.resolution-p>p-h.resolution&&(q=h);break}this.ooe=!1}this.level=
q&&q.level;d=this.resolution=new a({x:q.resolution,y:q.resolution,spatialReference:this.tileInfo.spatialReference})}p=this.layer.raster.rasterInfo.extent;q=this.tileInfo.origin;h=this.tileInfo.cols;var u=this.tileInfo.rows;this.fullBoundary={rowStart:Math.floor((q.y-p.ymax)/d.y/u),rowEnd:Math.floor((q.y-p.ymin-d.y)/d.y/u),colStart:Math.floor((p.xmin-q.x)/d.x/h),colEnd:Math.floor((p.xmax-q.x-d.x)/d.x/h)};if(p=this.halfWorldWidth){u=Math.ceil(p/d.x/(h/2));var v=this.tileInfo.applyGCS360Transform?360:
p,t=Math.round(h-(v-q.x)/d.x%h);t===h&&(t=0);this.fullBoundary.colRange=u;this.fullBoundary.paddingRight=t;this.fullBoundary.paddingLeft=Math.round((u*h*d.x+q.x-v-(this.tileInfo.applyGCS360Transform?0:q.x+p))/d.x)}this.hasNewData=!0}},getXformGrid:function(){var d=this.mapExtent,h=this.layer._hasTilingEffects?this.extent:this.fullExtent,p=this.layer.getCurrentResolution(),q=JSON.stringify(d.toJson())+JSON.stringify(h.toJson());this._datumTransformationInitialized||(this._datumTransformationInitialized=
!0,this._datumTransformation=e.getDefaultDatumTransformationForDataset(this.layer.raster.rasterInfo.extent,d.spatialReference,!0));this._cachedExtentString&&this._cachedExtentString===q||(this._cachedExtentString=q,this._xformGrid=d=e.getProjectionOffsetGrid(d,h,p,this.tileInfo.applyGCS360Transform,this.halfWorldWidth,this._datumTransformation));d=this._xformGrid;this.xformSetting.meshSize=d&&d.size;return d},getWrapTimes:function(d){var h=e.getHalfWorldWidth(d.spatialReference);if(!h)return 0;var p=
2*h;h=this.tileInfo.applyGCS360Transform?0:-h;return Math.floor((d.xmax-h)/p)-Math.floor((d.xmin-h)/p)},normalizeCoordinate:function(d,h){if(!h)return 0;var p=2*h;if(0<d){for(;d>h;)d-=p;return d}for(;d<-h;)d+=p;return d},resetTiles:function(){this.tiles.forEach(k.hitch(this,function(d){d.fetch&&!d.fetch.isCanceled()&&d.fetch.cancel();d.update&&!d.update.isCanceled()&&d.update.cancel()}));this.tiles.length=0},updateExtent:function(d,h){this.mapExtent=this.extent=d;var p=this.xformSetting.requireProjection;
if(p){this.extent=e.project(d,this.tileInfo.spatialReference,this.tileInfo.applyGCS360Transform);if(!this.extent)return;this.extent.spatialReference=new b(this.extent.spatialReference.toJson())}else if(d.spatialReference.isWebMercator()||4326===d.spatialReference.wkid){var q=4326===d.spatialReference.wkid?180:this.halfWorldWidth,u=d.xmin;if(u<-q||u>q){for(var v=d.xmax,t=2*q;u<-q;)u+=t,v+=t;for(;u>q;)u-=t,v-=t;this.mapExtent=this.extent=d=new l(u,d.ymin,v,d.ymax,d.spatialReference)}}this.updateResolution(h,
d);q=this.extent;u=this.tileInfo;v=u.cols;t=u.rows;h=this.resolution;var x=q;p=p?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent;this.ooe&&(x=this._getIntersect(q,p));var C=Math.floor((x.xmin-u.origin.x)/h.x/v)-this.prefetchBufferSize,B=Math.floor((x.xmax-u.origin.x)/h.x/v)+this.prefetchBufferSize,F=null,y=this.getWrapTimes(d),w=this.fullBoundary&&this.fullBoundary.colRange;y&&this.halfWorldWidth&&(B===C&&(F=C),B+=y*w);if(d=this.halfWorldWidth&&this.tiles.length&&(y!==this.wrapTimes||
F!==this._circlularColId))this._wrapSwitchCount=this._wrapSwitchCount?this._wrapSwitchCount+1:1;this.wrapTimes=y;this._circlularColId=F;var A=Math.floor((u.origin.y-x.ymax)/h.y/t)-this.prefetchBufferSize;F=Math.floor((u.origin.y-x.ymin)/h.y/t)+this.prefetchBufferSize;this.tileBoundary={rowStart:A,rowEnd:F,colStart:C,colEnd:B};var z,G;((x=(F-A+1)*(B-C+1)>this._MAX_TILES||!this.virtual&&this._resolution.x>8*this.tileInfo.lods[0].resolution)||2<y||d)&&this.resetTiles();if(!(x||2<y)){x=this.tiles;d=!1;
for(z=x.length-1;0<=z;z--){var I=x[z].row;var K=x[z].wrapCol;if(I<A||I>F||K<C||K>B)x[z].fetch&&!x[z].fetch.isCanceled()&&x[z].fetch.cancel(),x[z].update&&!x[z].update.isCanceled()&&x[z].update.cancel(),x.splice(z,1),d=!0}for(z=A;z<=F;z++)for(G=C;G<=B;G++){A=new l(u.origin.x+h.x*v*G,u.origin.y-h.y*t*(z+1),u.origin.x+h.x*v*(G+1),u.origin.y-h.y*t*z,q.spatialReference);var Q=y&&w?0<=G?G%w:w- -G%w:G;I=g(x,function(N){return N.row===z&&N.col===Q&&N.wrapCol===G});K=p.xmax>=A.xmax?v:Math.round((p.xmax-A.xmin)/
h.x);-1===I&&(x.push({row:z,col:Q,wrapCol:G,cellsizeX:h.x,cellsizeY:h.y,width:v,height:t,actualWidth:K,extent:A,normalizedExtent:this._wrapExtent(A,Q),pixelBlock:null,virtual:this.virtual,level:this.level,tileType:this.tileInfo.tileType||"Raster"}),d=!0)}d&&this._sortTiles();h=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);this.width=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);this.height=h;this.count=x.length;h=Math.min.apply(null,x.map(function(N){return N.extent.xmin}));
u=Math.max.apply(null,x.map(function(N){return N.extent.xmax}));v=Math.min.apply(null,x.map(function(N){return N.extent.ymin}));t=Math.max.apply(null,x.map(function(N){return N.extent.ymax}));h=this.fullExtent=new l(h,v,u,t,q.spatialReference);if(this.layer.roaming||this.layer.useWebGL)this.layer._hasTilingEffects?(this.xformSetting.offset=[0,0],this.xformSetting.scale=[1,1]):(d&&(this._tilesChanged=!0),this.xformSetting.offset=[(q.xmin-h.xmin)/(h.xmax-h.xmin),-(h.ymin-q.ymin)/(h.ymax-h.ymin)],this.xformSetting.scale=
[(q.xmax-q.xmin)/(h.xmax-h.xmin),(q.ymax-q.ymin)/(h.ymax-h.ymin)])}},fetchTiles:function(d){(this._tilesChanged||d)&&this._fetchTiles(d)},_fetchTiles:function(d){this._fetchCounter=0;var h=this.extent;this.fetchAllCompleted=d?new n:null;(this._tilesChanged||d&&this.layer._hasTilingEffects)&&this.tiles.forEach(k.hitch(this,function(q){q.updateCompleted=!1}));var p={};!this.layer.roaming&&this.layer._hasTilingEffects&&d?(this.identifiers.forEach(function(q,u){p[q]={extent:this.extent,pixelBlock:new c({width:this.layer._map.width,
height:this.layer._map.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.extent,src:p,isEmpty:!0}):this._tilesChanged&&(this.identifiers.forEach(function(q,u){p[q]={extent:this.fullExtent,pixelBlock:new c({width:128,height:128,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.fullExtent,src:p,isEmpty:!0});this.tiles.forEach(k.hitch(this,function(q){if(q.fetch)q.update||(q.update=this.updateTile(q));
else{if(this._isTileOutSide(q,h)){q.updateCompleted=!0;return}this._requestTile(q)}this.layer.roaming&&this.layer.useWebGL?this._fillPixelData(q):q.src&&d&&(this.layer._hasTilingEffects||this.layer.useWebGL)&&(this._fillPixelData(q),this.layer._hasTilingEffects&&(q.updateCompleted=!0),q.processedPixelBlock=null,q.renderedPixelBlock=null)}));0===this._fetchCounter&&(this._fetched=!0);this._tilesChanged=!1;d&&this._updateFetchStatus()},updateTile:function(d,h){var p=new n;if(!d.src&&!d.fetch)return p.resolve(d),
p.promise;r(d.src||d._fetched||d.fetch,k.hitch(this,function(){var q=this.layer.tileMode&&this.layer._rasterHandler&&!(this.layer._hasTilingEffects||this.layer.useWebGL),u=this.layer._drawTile,v=this._validateRawPixelBlocks(d);this.layer._hasTilingEffects&&!this.layer.useWebGL&&(u=u&&(this._progressiveGlobal||h));if((h||!h&&v)&&(q||u||this.layer.roaming)){if(this.xformSetting.requireProjection&&this.layer.useWebGL&&(this.xformSetting.gridConfig=this.getXformGrid(),null==this.xformSetting.gridConfig))return p.cancel(),
p.promise;this._processTile(d,h).then(k.hitch(this,function(t){p.isCanceled()||this._renderTile(t,h).then(k.hitch(this,function(x){this.hasNewData=!1;p.isCanceled()||p.resolve(x)}))}))}else h||v||(d.updateCompleted=!0),this.layer.useWebGL||this.layer._hasTilingEffects?p.resolve(this.originalPixelData):p.resolve()}));return p.promise},setLayer:function(d){this.layer=d},fillupTiles:function(){this.tiles.forEach(k.hitch(this,function(d){d.update&&d.updateCompleted&&!d.filled&&(d.updateCompleted=!1,this._fillPixelData(d),
d.updateCompleted=!0)}))},_validateRawPixelBlocks:function(d){return d&&d.src&&!this.identifiers.some(function(h){return!(d.src[h].pixelBlock&&0!==d.src[h].pixelBlock.validPixelCount&&d.src[h].pixelBlock.pixels&&0<d.src[h].pixelBlock.pixels.length)})},_wrapExtent:function(d,h){if(d){if(this.tileInfo.applyGCS360Transform){var p=this.normalizeCoordinate(d.xmin,180);0>p&&(p+=360);return new l({xmin:p,ymin:d.ymin,xmax:d.xmax-d.xmin+p,ymax:d.ymax,spatialReference:d.spatialReference})}if(this.halfWorldWidth){p=
null!=h?new l({xmin:this.tileInfo.origin.x+this.tileInfo.cols*h*this.resolution.x,ymin:d.ymin,xmax:this.tileInfo.origin.x+this.tileInfo.cols*(h+1)*this.resolution.x,ymax:d.ymax,spatialReference:d.spatialReference}):new l({xmin:d.xmin,ymin:d.ymin,xmax:d.xmax,ymax:d.ymax,spatialReference:d.spatialReference});h=this.normalizeCoordinate(p.xmin,this.halfWorldWidth);var q=h-p.xmin;.01<Math.abs(q)&&(p.xmin=h,p.xmax+=q)}return p||d}},_getIntersect:function(d,h){return new l(Math.max(d.xmin,h.xmin),Math.max(d.ymin,
h.ymin),Math.min(d.xmax,h.xmax),Math.min(d.ymax,h.ymax),d.spatialReference)},_isTileOutSide:function(d,h){var p=!1;if(d.virtual){var q=d.normalizedExtent;if(h=h||(this.xformSetting.requireProjection?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent)){d=q.xmin-this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;p=q.ymin-this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;var u=q.xmax+this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;q=q.ymax+this.prefetchBufferSize*
this.tileInfo.rows*this.resolution.y;p=u<=h.xmin||d>=h.xmax||q<=h.ymin||p>=h.ymax}else p=!1}else p=0>d.level||d.row<this.fullBoundary.rowStart||d.row>this.fullBoundary.rowEnd||d.col<this.fullBoundary.colStart||d.col>this.fullBoundary.colEnd;return p},_resolutionEqual:function(d,h){return d===h||d&&h&&Math.abs(d-h)<Math.abs(h/1E4)?!0:!1},_requestTile:function(d){var h=this.identifiers,p;if(this._isTileOutSide(d)){var q=new n;d.updateCompleted=!0;q.resolve(null);q=q.promise}else q=this.layer.raster.rasterFunction?
new m(this.layer.raster.getMemberRasters().map(function(u){return u.read(d)})):new m([this.layer.raster.read(d)]);d.fetch=q;this._fetchCounter++;r(d.src||d._fetched||q,k.hitch(this,function(u){if(p=u&&u.some(function(t){return t[0]})){var v={};u.forEach(function(t,x){v[h[x]]=t[0]&&t[1]?{extent:t[1].extent,pixelBlock:t[1].pixelBlock,width:t[1].width,height:t[1].height}:null});d.src=v}else d.src=null;this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);d._fetched=!0;this._updateFetchStatus()}),
k.hitch(this,function(){this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);d._fetched=!0;this._updateFetchStatus()}));d.update=this.updateTile(d)},_updateFetchStatus:function(){this.layer._drawTile&&this.fetchAllCompleted&&!this.fetchAllCompleted.isResolved()&&!this.tiles.some(function(d){return!d._fetched})&&(this.tiles.forEach(k.hitch(this,function(d){this._fillPixelData(d)})),this.fetchAllCompleted.resolve())},_fillPixelData:function(d,h){if(d&&!d.updateCompleted)if(Math.abs(d.cellsizeX-
this.resolution.x)>d.cellsizeX/10)d.updateCompleted=!0;else if(!1===this._validateRawPixelBlocks(d))d.updateCompleted=!0;else{var p=d.extent;if(this.layer.roaming||this.layer.useWebGL&&!this.layer._hasTilingEffects){var q=this.fullExtent;var u=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);var v=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);h?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:u,
height:v,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(k.hitch(this,function(x){this.originalPixelData.src[x].pixelBlock.width=u;this.originalPixelData.src[x].pixelBlock.height=v}))}else q=this.extent,u=this.layer._map.width,v=this.layer._map.height,h?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:u,height:v,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(k.hitch(this,function(x){this.originalPixelData.src[x].pixelBlock.width=
u;this.originalPixelData.src[x].pixelBlock.height=v}));if(q.xmax<=p.xmin||q.xmin>=p.xmax||q.ymax<=p.ymin||q.ymin>=p.ymax)return null;var t=this.originalPixelData.isEmpty=!1;this.identifiers.forEach(k.hitch(this,function(x){d.src&&(this._fillPixelBlock(d.src[x],this.originalPixelData.src[x],{extent:q,width:u,height:v,normalizedExtent:d.normalizedExtent},!1),t=!0)}));d.filled=t;this.hasNewData=!0}},_fillPixelBlock:function(d,h,p,q){var u=d.extent,v=p.extent;q=p.width;var t=p.height;if(d.pixelBlock&&
d.pixelBlock.pixels&&d.pixelBlock.pixels[0]){var x=(u.xmax-u.xmin)/d.width,C=Math.max(u.xmin,v.xmin),B=Math.min(u.ymax,v.ymax),F=Math.round((C-u.xmin)/x),y=d.width-Math.round(Math.abs(u.xmax-Math.min(u.xmax,v.xmax))/x),w=Math.round(Math.abs(u.ymax-B)/x),A=d.height-Math.round((Math.max(u.ymin,v.ymin)-u.ymin)/x),z=this.halfWorldWidth;C=Math.round((C-v.xmin)/x);p=p.normalizedExtent;if(!(this.wrapTimes&&z&&u.xmin<-z)){if(this.wrapTimes&&z){if(this.tileInfo.applyGCS360Transform)360<u.xmin&&(C-=this.fullBoundary.paddingLeft);
else if(u.xmin>z){C-=this.fullBoundary.paddingLeft;var G=this.normalizeCoordinate(u.xmin,z);var I=this.normalizeCoordinate(u.xmax,z)}else G=u.xmin,I=u.xmax;this.tileInfo.applyGCS360Transform?p&&360>p.xmin&&360<p.xmax&&(y-=this.fullBoundary.paddingRight):p&&p.xmin<z&&p.xmax>z?y-=this.fullBoundary.paddingRight:G<z&&I>z&&(y-=this.fullBoundary.paddingRight)}G=Math.round(Math.abs(v.ymax-B)/x);I=d.pixelBlock.pixels.length;h=h.pixelBlock;p=d.width;u=h.mask||new Uint8Array(q*t);var K=d.pixelBlock,Q=K.mask,
N=0;for(x=0;x<I;x++){B=K.pixels[x];z=h.pixels[x]||new B.constructor(q*t);for(d=w;d<A;d++)for(N=(G+d-w)*q+C,v=F;v<y;v++)z[N+v-F]=B[d*p+v];h.pixels[x]=z}if(Q)for(d=w;d<A;d++)for(N=(G+d-w)*q+C,v=F;v<y;v++)u[N+v-F]=Q[d*p+v];else for(d=w;d<A;d++)for(N=(G+d-w)*q+C,v=F;v<y;v++)u[N+v-F]=1;h.pixelType=h.pixelType||K.pixelType;h.mask=u;if(!(h.statistics&&0<h.statistics.length))for(h.statistics=[],d=0;d<K.statistics.length;d++)h.statistics[d]={minValue:K.statistics[d].minValue,maxValue:K.statistics[d].maxValue};
else if(K.statistics&&h.statistics)for(d=0;d<h.statistics.length;d++)h.statistics[d].minValue=Math.min(K.statistics[d].minValue,h.statistics[d].minValue),h.statistics[d].maxValue=Math.max(K.statistics[d].maxValue,h.statistics[d].maxValue)}}},_processTile:function(d,h){var p=new n,q=this.layer._hasTilingEffects,u=this.layer.useWebGL,v=q||u,t=this.layer.raster.rasterFunction&&d&&(q||u||!d.processedPixelBlock);if(h)var x=d;else this._fillPixelData(d),x=v?this.originalPixelData:d;this.xformSetting.hasNewTexture=
this.hasNewData;var C;t?(this.identifiers.forEach(function(B){if(0===x.src[B].pixelBlock.pixels.length||0===x.src[B].pixelBlock.pixels[0].length)C=!0}),C?p.resolve({extent:x.extent,processedPixelBlock:x.src[this.identifiers[0]],pixelBlock:x.src[this.identifiers[0]]}):u?(this.processedPixelData=this.layer.raster.rasterFunction.read(x),p.resolve(this.processedPixelData)):this.layer._rasterHandler?this.layer._rasterHandler.process({extent:x.extent,src:x.src}).then(function(B){q?(this.processedPixelData=
B,p.resolve(this.processedPixelData)):(d.processedPixelBlock=B.pixelBlock,p.resolve(d))}):(h=this.layer.raster.rasterFunction.read(d),d.processedPixelBlock=h.pixelBlock,p.resolve(d))):v?p.resolve(x.src[this.identifiers[0]]):(d.pixelBlock=x.src[this.identifiers[0]]&&x.src[this.identifiers[0]].pixelBlock,p.resolve(d));return p.promise},_renderTile:function(d){var h=new n,p=this.layer._hasTilingEffects,q=this.layer.useWebGL,u=Math.abs((d.extent.xmax-d.extent.xmin)/d.width-this.layer.getCurrentResolution().x)>
this.resolution.x/10;u=this.layer.useWebGL&&(u||this._isTileOutSide(d,this.layer._map.extent));this.xformSetting.hasNewTexture=this.hasNewData;this.layer._rasterRenderer&&d&&(d.texture||d.src||d.pixelBlock||d.processedPixelBlock)?(this.layer._rasterRenderer.interpolation=this.layer.interpolation,q&&!u?(this.layer.raster.rasterFunction&&this.layer.raster.rasterFunction.renderTexture||this.layer._rasterRenderer.draw(d),h.resolve(d)):this.layer._rasterHandler?this.layer._rasterHandler.render({extent:d.extent,
pixelBlock:d.processedPixelBlock||d.pixelBlock}).then(function(v){p?(v.renderedPixelBlock=v.pixelBlock,h.resolve(v)):(d.renderedPixelBlock=v.pixelBlock,h.resolve(d))}.bind(this)):(d.renderedPixelBlock=this.layer._rasterRenderer.draw(d).pixelBlock,h.resolve(d))):(d.renderedPixelBlock=d.processedPixelBlock||d.pixelBlock,h.resolve(d));return h.promise},_sortTiles:function(){this.tiles.sort(function(d,h){return d.row<h.row||d.row==h.row&&d.col<h.col?-1:1})}})})},"esri/dijit/RasterFunctionEditor/utils":function(){define("dojo/_base/lang dojo/_base/url dojo/has dojo/on dojo/Deferred dojo/_base/array dojo/i18n!../../nls/jsapi ../../kernel ../../request ../../lang ../../config ../../layers/ArcGISImageServiceLayer ../../layers/ImageServiceParameters ../../layers/MosaicRule ../../layers/RasterFunction ../../tasks/Geoprocessor ../../tasks/JobInfo ../../renderers/colorUtils ../../renderers/colorRampUtils".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t){function x(N){if(N){var T=l.map([N.FromColor,N.ToColor],function(W){W=v.toRGB({h:W.Hue,s:W.Saturation,v:W.Value});return[W.r,W.g,W.b]});return{fromColor:T[0],toColor:T[1],type:"algorithmic",algorithm:N.Algorithm}}}function C(N){if(N)return N=v.toHSV(v.getDojoColor(N)),{type:"HsvColor",Hue:N.h,Saturation:N.s,Value:N.v,AlphaValue:255}}function B(N){if(N){var T=N.toJson?N.toJson():void 0;return{Algorithm:T&&T.Algorithm||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",
FromColor:C(N.fromColor),ToColor:C(N.toColor)}}}function F(N,T,W){function X(J,V){return N+" ("+fa[J]+" - "+fa[V]+")"}var ea=b.rasterFunctions.enumLabels,fa={1:ea.esriMonthJanuary,2:ea.esriMonthFebruary,3:ea.esriMonthMarch,4:ea.esriMonthApril,5:ea.esriMonthMay,6:ea.esriMonthJune,7:ea.esriMonthJuly,8:ea.esriMonthAugust,9:ea.esriMonthSeptember,10:ea.esriMonthOctober,11:ea.esriMonthNovember,12:ea.esriMonthDecember};if(W&&""===W)return N.toString();ea="Months"===W;W="Quarters"===W;if(!ea&&!W)return N.toString();
if(1==T&&ea)return N+" ("+fa[+N]+")";switch(+N){case 1:return X(1,3);case 2:return X(4,6);case 3:case 7:return X(7,9);case 4:return W?X(10,12):X(4,6);case 10:return X(10,12)}return N.toString()}function y(N){return(new Date(Number(N))).toISOString().replace("Z","")}function w(N){return(new Date(N+"Z")).getTime()}function A(N,T){return N.some(function(W){return W.label===T.label}.bind(this))}var z={},G,I,K,Q=this&&this.__spreadArrays||function(){for(var N=0,T=0,W=arguments.length;T<W;T++)N+=arguments[T].length;
N=Array(N);var X=0;for(T=0;T<W;T++)for(var ea=arguments[T],fa=0,J=ea.length;fa<J;fa++,X++)N[X]=ea[fa];return N};H.mixin(z,{fetchRFT:function(N,T,W,X,ea){var fa=new m;var J=(J=(J=N.name)&&J.slice(-8))&&".rft.xml"===J.toLowerCase();return N&&N.itemDataUrl?J?ea?this.convertRFT({url:ea+"/ConvertRasterFunctionTemplate",rft:{itemId:N.id},format:"json"},T,X,W):(W("errorUtilitiesServiceNotAvailable"),fa.reject(Error("errorUtilitiesServiceNotAvailable")),fa.promise):c({url:N.itemDataUrl,callbackParamName:"callback",
content:{f:"json"},handleAs:"json",load:T,error:W}).then(X):(W("errorRetrievingRFTItem"),fa.reject(Error("errorRetrievingRFTItem")),fa.promise)},convertRFT:function(N,T,W,X){var ea=N.url,fa=function(){K&&(K.remove(),K=null);I&&(I.remove(),I=null)};G||(G=new q(ea),r(G,"error",fa));I=r(G,"job-complete",function(J){I&&(I.remove(),I=null);J.jobInfo.jobStatus!==u.STATUS_SUCCEEDED?(fa(),X(J)):G.getResultData(J.jobInfo.jobId,"outputRasterFunction")});K=r(G,"get-result-data-complete",function(J){K&&(K.remove(),
K=null);var V=J&&J.result&&J.result.value;V&&V.url&&(J={url:V.url,handleAs:"json",load:W,error:X},V=(new k(V.url)).authority,-1===e.defaults.io.corsEnabledServers.indexOf(V)&&e.defaults.io.corsEnabledServers.push(V),c(J))});N={inputRasterFunction:JSON.stringify(N.rft),format:N.format};return G.submitJob(N,T,null,X)},getRasterJsonFromLayer:function(N){if(!N)return null;var T=N.url;T&&0<T.indexOf("?token\x3d")&&(T=T.slice(0,T.indexOf("?token\x3d")));var W=N.credential||T&&a.id.findCredential(T);f.isDefined(W)&&
(T=T+"?token\x3d"+W.token,W.referer&&(T+=W.referer));T={url:T,name:N.name};N.renderingRule&&(T.renderingRule=N.renderingRule.toJson?N.renderingRule.toJson():N.renderingRule);N.mosaicRule&&(T.mosaicRule=N.mosaicRule.toJson?N.mosaicRule.toJson():N.mosaicRule);return T},getLayerIdfromRasterValue:function(N,T){if(N&&T){var W;l.some(T,function(X){if(X&&X.url===N.url&&X.name===N.name&&N.name)return W=X.id,!0});return W}},getColorRampFromArg:function(N){if(N){var T;if(N.type&&-1<N.type.toLowerCase().indexOf("colorramp"))var W=
N;else N.value&&-1<N.value.type.toLowerCase().indexOf("colorramp")&&(W=N.value);if(W)return N=W.type.toLowerCase(),"multipartcolorramp"===N?T=t.fromJson({type:"multipart",colorRamps:l.map(W.ArrayOfColorRamp,function(X){return x(X)})}):"algorithmiccolorramp"===N&&(T=t.fromJson(x(W))),T.id=T.name=W.Name,T}},getRFxArgColorRampValue:function(N){if(N){if(N.fromColor&&N.toColor)return H.mixin(B(N),{Name:N.name});if(N.colorRamps){var T=l.map(N.colorRamps,B);return{type:"MultiPartColorRamp",NumColorRamps:T.length,
ArrayOfColorRamp:T,Name:N.name}}}},RFX_VARIABLE_TYPE:"RasterFunctionVariable",RFX_TEMPLATE_TYPE:"RasterFunctionTemplate",ARGUMENT_ARRAY_TYPE:"ArgumentArray",getArgRFT:function(N){if(N){if("RasterFunctionTemplate"===N.type)return N;if(N.value&&"RasterFunctionTemplate"===N.value.type)return N.value}},getEnumData:function(N,T,W){if(Array.isArray(N))return N.forEach(function(X){X.key=X.key.toString()}),N},getImageServiceTitle:function(N){N=N.split("/");return N[N.length-2]},isReferencedObject:function(N){if(N&&
f.isDefined(N._object_ref_id))return!0},functionTypes:{local:"LocalFunction",gpAdapter:"GPAdapterFunction",pythonAdapter:"PythonAdapterFunction"},defaultRasterNodeProps:{name:"Raster",isDataset:!0,isPublic:!1,type:"RasterFunctionVariable"},getArcGISImageServiceLayerItem:function(N){if(N){N=H.clone(N);N.name||(N.name=this.getImageServiceTitle(N.url));var T=new d;N.mosaicRule&&(T.mosaicRule=new h(N.mosaicRule));N.renderingRule&&(T.renderingRule=new p(N.renderingRule));T=new g(N.url,{id:N.name+(new Date).toString(),
imageServiceParameters:T});T.name=N.name;return T}},filterMDInfoIfMosiacRuleIsSet:function(N){var T=H.clone(N.multidimensionalInfo),W=[],X=N.mosaicRule&&N.mosaicRule.multidimensionalDefinition;if(X&&0<X.length){var ea=T.variables.filter(function(fa){return X[0].variableName===fa.name}.bind(this));if(!ea||0===ea.length)return T;ea=ea[0];W=H.clone(ea);W.dimensions=[];X.forEach(function(fa){var J=ea.dimensions.filter(function(O){return fa.dimensionName===O.name}.bind(this));if(J&&0!==J.length){var V=
(J=J[0])&&J.values,aa=0,Z=1,L=fa.values&&fa.values.length;switch(fa.values&&fa.values[0].length||L){case 1:aa=V.indexOf(fa.values[0]);Z=aa+1;break;case 2:aa=V.indexOf(fa.values[0][0]),Z=V.indexOf(fa.values[0][1])+1}V=V.slice(aa,Z);J.values=V;W.dimensions.push(J)}else W.dimensions=H.clone(ea.dimensions)}.bind(this));T.variables=[W]}return T},getRecurrentIntervalName:F,getFormattedDateString:y,parseFormattedDateString:w,getVariables:function(N){var T=N.selectedVariables,W=void 0===T?[]:T;return N.multiDimensionalData.variables.filter(function(X){var ea=
W.some(function(fa){return"string"===typeof fa?fa===X.name:fa.value===X.name}.bind(this));return W.length?ea:!0}.bind(this))},getDimensions:function(N){var T=N.variables;N=N.selectedDimension;var W=void 0===N?"":N;return(void 0===T?[]:T).reduce(function(X,ea){ea=ea.dimensions.filter(function(fa){return W?fa.name===W:!0}.bind(this));return ea.length?Q(X,ea):X}.bind(this),[])},getFormattedDimensionValues:function(N){var T=[];N.forEach(function(W){var X=W.hasRanges,ea=W.recurring,fa;W.values.forEach(function(J){var V=
H.clone(J);X||(V=[V]);"StdTime"===W.name&&(V=V.map(function(aa){return ea?F(aa,W.interval,W.intervalUnit):y(Number(aa))}.bind(this)));V=X?V.join(" \u2014 "):V.join("");fa={label:V,value:ea?X?J.join(" \u2014 "):J.toString():V,selected:!1,disabled:!1};A(T,fa)||T.push(fa)}.bind(this))}.bind(this));return T},dimensionHasRanges:function(N){return N[0].hasRanges},getFormattedDimensionRanges:function(N){var T=[],W=[];N.forEach(function(X){X=X.label.split(" \u2014 ");T.push({label:X[0],value:X[0],selected:!1,
disabled:!1});W.push({label:X[1],value:X[1],selected:!1,disabled:!1})});return{min:T,max:W}},applyMultidimensionalDefinitionFilter:function(N,T){var W=T&&T.dimensions&&0<T.dimensions.length;T&&"BY_RANGES"===T.definitionType?W=W&&T.minValues&&0<T.minValues.length&&T.maxValues&&0<T.maxValues.length:T&&"BY_VALUES"===T.definitionType&&(W=W&&T.values&&0<T.values.length);if(!W)return N;N=H.clone(N);N.forEach(function(X){var ea=X.hasRanges,fa=[],J=0<=T.dimensions.indexOf(X.name);J||(fa=X.values);J&&T.dimensions.forEach(function(V,
aa){if(V===X.name)switch(T.definitionType){case "BY_RANGES":V=T.minValues[aa];aa=T.maxValues[aa];"StdTime"===X.name&&(V=w(V),aa=w(aa));"boolean"===typeof V||isNaN(V)||(V=Number(V));"boolean"===typeof aa||isNaN(aa)||(aa=Number(aa));var Z=-1,L=-1;if(ea)for(var O=0;O<X.values.length&&!(X.values[O][0]===V&&(Z=O),X.values[O][1]===aa&&(L=O+1),0<=Z&&1<=L);O++);else Z=X.values.indexOf(V),L=X.values.indexOf(aa)+1;fa=Q(fa,X.values.slice(Z,L));break;case "BY_VALUES":var D=ea?T.values[aa].split(" \u2014 "):[T.values[aa]];
"StdTime"===X.name&&(D=D.map(function(P){return w(P)}.bind(this)));V=X.values.filter(function(P){"boolean"===typeof P||isNaN(P)||(P=Number(P));return ea?P.includes(D[0])&&P.includes(D[1]):D[0]==P}.bind(this));fa=Q(fa,V)}}.bind(this));X.values=H.clone(fa)}.bind(this));return N},mapObjectByProperty:function(N,T){return N.map(function(W){return W[T]}.bind(this))},removeDuplicatesFromArray:function(N){return N.filter(function(T,W,X){return X.indexOf(T)===W}.bind(this))},UIModifier:{show:function(N){N.classList.remove("hidden")},
hide:function(N){N.classList.add("hidden")}},isArraySame:function(N,T){return N&&T?N.length===T.length&&N.every(function(W,X){return W===T[X]}.bind(this)):!1}});n("extend-esri")&&H.setObject("dijit.RasterFunctionEditor.utils",z,a);return z})},"esri/dijit/analysis/storageUtils":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/promise/all dojo/has dojo/json ../../request ../../kernel".split(" "),function(H,k,n,r,m,l,b,a,c){k={MAX_RESOURCES:10,checkResourceLimit:!0,
_getItemUrl:function(f){var e=f.folderId||f.ownerFolder;return this._portalUrl+"/sharing/rest/content/users/"+f.owner+"/"+(e?e+"/":"")+"/items/"+f.id},addToItemResource:function(f,e){this._portalUrl=e.portalUrl;delete e.portalUrl;f=this._getItemUrl(f);f+="/addResources";e={filename:e.jobInfo.jobId+".json",text:b.stringify(e),resourcesPrefix:"jobs",f:"json"};return a({url:f,content:e},{usePost:!0})},getItemResource:function(f,e){e&&e.portalUrl&&(this._portalUrl=e.portalUrl);f=this._getItemUrl(f);f+=
"/resources/"+e.resource;return a({url:f,content:{f:"json"}})},removeItemResource:function(f,e){e&&e.portalUrl&&(this._portalUrl=e.portalUrl);f=this._getItemUrl(f);return a({url:f+"/removeResources",content:{resource:e.resource,deleteAll:e.deleteAll,f:"json"}},{usePost:!0})},addToStorage:function(f){if(window.sessionStorage){var e=window.sessionStorage.getItem("esri_analysis_jobhistory");e=e?b.parse(e):[];e.push(f);window.sessionStorage.setItem("esri_analysis_jobhistory",b.stringify(e))}},addAllToStorage:function(f){window.sessionStorage&&
window.sessionStorage.setItem("esri_analysis_jobhistory",b.stringify(f))},removeFromStorage:function(f){if(window.sessionStorage){var e=window.sessionStorage.getItem("esri_analysis_jobhistory");e&&(e=b.parse(e));e=H.filter(e,function(g){return g.jobInfo&&g.jobInfo.jobId!==f.jobInfo.jobId});window.sessionStorage.setItem("esri_analysis_jobhistory",b.stringify(e))}},removeAllFromStorage:function(){window.sessionStorage&&window.sessionStorage.removeItem("esri_analysis_jobhistory")},getJobsInfoList:function(){var f;
window.sessionStorage&&(f=window.sessionStorage.getItem("esri_analysis_jobhistory"))&&(f=b.parse(f));return f},addItemResources:function(f,e){var g=this.getJobsInfoList(),d=[];H.forEach(g,function(h){h.portalUrl=e.portalUrl;var p=new r;d.push(p);this.addToItemResource(f,h).then(n.hitch(this,function(q){q&&!0===q.success&&(this.removeFromStorage(h),p.resolve(q))}))},this);return m(d)},saveJobsQueue:function(f,e){var g=this.getJobsInfoList(),d=new r;g&&0<g.length&&this.removeResourceQueue(f,e).then(n.hitch(this,
function(){if(g.length>this.MAX_RESOURCES){for(this.sortJobsInfoList(g,{asc:!1});g.length>this.MAX_RESOURCES;)g.pop();this.addAllToStorage(g)}this.addItemResources(f,e).then(n.hitch(this,function(h){d.resolve(h)}),n.hitch(this,function(h){d.reject(h)}))}),n.hitch(this,function(h){d.reject(h)}));return d.promise},saveJobsInfoList:function(f,e){return this.checkResourceLimit?this.saveJobsQueue(f,e):this.addItemResources(f,e)},getResources:function(f,e){e&&e.portalUrl&&(this._portalUrl=e.portalUrl);
f=this._getItemUrl(f);return a({url:f+"/resources",content:{f:"json"}})},getResourcesInfo:function(f,e){var g=[],d=new r;this.sortResources(f,e).then(n.hitch(this,function(h){H.forEach(h.resources,function(p){e.resource=p.resource;g.push(this.getItemResource(f,e))},this);m(g).then(n.hitch(this,function(p){d.resolve(p)}),n.hitch(this,function(p){d.reject(p)}))}),n.hitch(this,function(h){d.reject(h)}));return d.promise},sortJobsInfoList:function(f,e){f.sort(n.hitch(this,function(g,d){return e.asc?g.timestamp-
d.timestamp:d.timestamp-g.timestamp}))},sortResources:function(f,e){var g=new r;this.getResources(f,e).then(n.hitch(this,function(d){d.resources&&0<d.resources.length&&d.resources.sort(n.hitch(this,function(h,p){return e.asc?h.created-p.created:p.created-h.created}));g.resolve(d)}),n.hitch(this,function(d){g.reject(d)}));return g.promise},removeResourceQueue:function(f,e){var g=new r,d=[];var h=this.getJobsInfoList().length;var p=this.MAX_RESOURCES-h;p=0<p?p:0;e.asc=!0;this.sortResources(f,e).then(n.hitch(this,
function(q){if(q&&q.resources&&0<q.resources.length)if(0===p){var u=q.resources.shift();e.resource=u.resource;e.deleteAll=!0;d.push(this.removeItemResource(f,e));q.resources=[]}else for(;q.resources.length>p;)u=q.resources.shift(),e.resource=u.resource,d.push(this.removeItemResource(f,e));m(d).always(n.hitch(this,function(){g.resolve(q)}))}),n.hitch(this,function(q){g.reject(q)}));return g.promise}};l("extend-esri")&&n.setObject("dijit.analysis.storageUtils",k,c);return k})},"esri/dijit/analysis/_AnalysisOptions":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-attr dojo/_base/json dojo/dom-class dojo/dom-construct dojo/dom-style dojo/aspect dojo/has dojo/_base/array dojo/_base/window dojo/on dojo/query dojo/number ./Settings ./SettingsViewModel ./utils ./mixins/browselayers/BrowseLayerMixin ./mixins/FilterAndSelection dijit/Dialog dijit/form/NumberTextBox dojo/i18n!../../nls/jsapi ../../lang ../../kernel".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y){H=H([v,t],{declaredClass:"esri.dijit.analysis._AnalysisOptions",showSelectFolder:!1,showChooseExtent:!0,showHelp:!0,showCredits:!0,returnFeatureCollection:!1,showCloseIcon:!0,showSelectAnalysisLayer:!0,map:null,showReadyToUseLayers:!0,showAnalysisBusyIndicator:!0,showGeoAnalyticsParams:!1,showBrowseLayers:!1,showAnalysisModeLabel:!1,distanceDefaultUnits:"Miles",showSettings:!1,showOutputType:!1,context:{},includeRouteLayers:!1,doSaveJobInfo:!1,
doSaveInStorage:!1,showCreditCalcBusyIndicator:!0,useArcGISComponents:!1,isServerAdvanceLicensed:!0,constructor:function(w){w.rerun&&this._initRerunProps(w)},isAdmin:function(w){return F.isDefined(w.role)&&("org_admin"===w.role||"account_admin"===w.role)},isOwner:function(w,A){return w.owner?w.owner===A.id:w.userId?w.userId===A.username:w.credential?w.credential.userId===A.username:!0},_initRerunProps:function(w){w.OutputName&&w.OutputName.serviceProperties?w.outputLayerName=w.OutputName.serviceProperties.name:
w.resultName&&(w.outputLayerName=w.resultName);w.timeStepReference&&(w.timeReference=w.timeStepReference);this.set("extentCheck",w.extentCheck);this._numberFormatHandle=a.before(C,"_setValueAttr",function(A,z,G){A=h.format(A);return[A,z,G]});this.on("close",k.hitch(this,function(){this._numberFormatHandle&&(this._numberFormatHandle.remove(),this._numberFormatHandle=null)}))},_setShowSelectFolderAttr:function(w){!0===w&&w===this.get("returnFeatureCollection")&&(w=!w);this.showSelectFolder=w;this._webMapFolderSelect&&
this._webMapFolderSelect.set("required",w);this._chooseFolderRow&&b.set(this._chooseFolderRow,"display",!0===this.showSelectFolder?"block":"none");w&&this._webMapFolderSelect&&this.getFolderStore().then(k.hitch(this,function(A){this.folderStore=A;u.setupFoldersUI({folderStore:this.folderStore,folderId:this.folderId,folderName:this.folderName,folderSelect:this._webMapFolderSelect,username:this.portalUser?this.portalUser.username:""})}))},_getShowSelectFolderAttr:function(){return this.showSelectFolder},
_setShowChooseExtentAttr:function(w){this.showChooseExtent=w},_getShowChooseExtentAttr:function(){return this.showChooseExtent},_setExtentCheckAttr:function(w){this.extentCheck=w;F.isDefined(this._useExtentCheck)&&F.isDefined(w)&&this._useExtentCheck.set("checked",w)},_setMapAttr:function(w){this.map=w},_getMapAttr:function(){return this.map},_setShowHelpAttr:function(w){this.showHelp=w},_getShowHelpAttr:function(){return this.showHelp},_setReturnFeatureCollectionAttr:function(w){this.returnFeatureCollection=
w;this.set("showSelectFolder",!w)},_getReturnFeatureCollectionAttr:function(){return this.returnFeatureCollection},_setShowCreditsAttr:function(w){(this.showCredits=w)&&this._showCreditsLink&&this._usageForm&&(this._onCreditsClickHandle=g.pausable(this._showCreditsLink,"click",k.hitch(this,this._handleShowCreditsClick)))},_getShowCreditsAttr:function(){return this.showCredits},_setShowCloseIconAttr:function(w){this.showCloseIcon=w},_getShowCloseIconAttr:function(){return this.showCloseIcon},_setShowSelectAnalysisLayerAttr:function(w){this.showSelectAnalysisLayer=
w;this._analysisSelect&&this._analysisSelect.set("required",w)},_getShowSelectAnalysisLayerAttr:function(){return this.showSelectAnalysisLayer},_setIsSingleTenantAttr:function(w){this.isSingleTenant=w},_getIsSingleTenantAttr:function(){return this.isSingleTenant},_setAllowChooseLabelAttr:function(w){this.allowChooseLabel=w},_getAllowChooseLabelAttr:function(){return this.allowChooseLabel},_setTitleAttr:function(w){this.title=w;this._toolTitle&&n.set(this._toolTitle,"innerHTML",w)},_getTitleAttr:function(){return this.title=
n.get(this._toolTitle,"innerHTML")},_setShowReadyToUseLayersAttr:function(w){this.showReadyToUseLayers=w},_getShowReadyToUseLayersAttr:function(w){return this.showReadyToUseLayers},_setFolderIdAttr:function(w){this.folderId=w},_getFolderIdAttr:function(){this._webMapFolderSelect&&this.folderStore&&(this.folderId=this._webMapFolderSelect.item?this.folderStore.getValue(this._webMapFolderSelect.item,"id"):"");return this.folderId},_setFolderNameAttr:function(w){this.folderName=w},_getFolderNameAttr:function(){this._webMapFolderSelect&&
this.folderStore&&this._webMapFolderSelect.item&&(this.folderName=this.folderStore.getValue(this._webMapFolderSelect.item,"name"));return this.folderName},_setHelperServicesAttr:function(w){this.helperServices=w},_getHelperServicesAttr:function(w){return this.helperServices},_getPortalSelfAttr:function(){return this.portalSelf},_setPortalSelfAttr:function(w){this.portalSelf=w},_setShowAnalysisBusyIndicatorAttr:function(w){w&&this.own(this.on("start",k.hitch(this,function(){this.showLoadingIndicator()})),
this.on("job-fail, job-result, job-cancel",k.hitch(this,function(){this.hideLoadingIndicator()})),this.on("job-status",k.hitch(this,function(A){"esriJobFailed"===A.jobStatus&&this.hideLoadingIndicator()})))},_setShowGeoAnalyticsParamsAttr:function(w){this.showGeoAnalyticsParams=w},_getShowGeoAnalyticsParamsAttr:function(){return this.showGeoAnalyticsParams},_setShowBrowseLayersAttr:function(w){this.showBrowseLayers=w},_getShowBrowseLayersAttr:function(){return this.showBrowseLayers},showLoadingIndicator:function(){this.get("showAnalysisBusyIndicator")&&
(this._saveBtn.set("iconClass","esriLoading"),this.set("disableRunAnalysis",!0))},hideLoadingIndicator:function(){this.get("showAnalysisBusyIndicator")&&(this._saveBtn.set("iconClass",""),this.set("disableRunAnalysis",!1))},_setDistanceDefaultUnitsAttr:function(w){this.distanceDefaultUnits=w},_getDistanceDefaultUnitsAttr:function(){return this.distanceDefaultUnits},_setAnalysisModeAttr:function(w){this.analysisMode=w},_setShowAnalysisModeLabelAttr:function(w){this.showAnalysisModeLabel=w;this._titleLbl&&
this._analysisModeLblNode&&(b.set(this._titleLbl,"display",this.showAnalysisModeLabel?"none":"block"),b.set(this._analysisModeLblNode,"display",this.showAnalysisModeLabel?"flex":"none"),this.showAnalysisModeLabel&&("standard"===this.analysisMode?this.analysisModeLabel=this.i18n.standard:"bigdata"===this.analysisMode||this.showGeoAnalyticsParams?this.analysisModeLabel=this.i18n.bigData:"raster"===this.analysisMode&&(this.analysisModeLabel=this.i18n.raster),n.set(this._analysisModeCrumb,"innerHTML",
this.analysisModeLabel)))},_getTimeReferenceAttr:function(){if(this._timeRefDay){var w="",A="",z="";var G=this._timeRefDay.get("value");var I=this._timeRefTime.get("value");G&&(w=G.toDateString(),z="Date");I&&(A=I.toTimeString(),z="DateTime");this.set("timeReferenceType",z);G=A&&-1!==A.indexOf("GMT")?w+" "+A.substring(0,A.indexOf("GMT")+3):A?w+" "+A.split(" ")[0]+" GMT":w+" GMT";this.timeReference=(new Date(G)).getTime()}return this.timeReference},_setTimeReferenceAttr:function(w){w=new Date(w+6E4*
(new Date(w)).getTimezoneOffset());this._timeRefDay&&this._timeRefDay.set("value",w);this._timeRefTime&&"DateTime"===this.timeReferenceType&&this._timeRefTime.set("value",w)},_setTimeReferenceTypeAttr:function(w){this.timeReferenceType=w},_setSLayersAttr:function(w){this.sLayers=w},_setContextAttr:function(w){this.context=w},_setIncludeRouteLayersAttr:function(w){this.includeRouteLayers=w},_getIncludeRouteLayersAttr:function(){return this.includeRouteLayers},_setShowSettingsAttr:function(w){this.showSettings=
w;var A=this.analysisMode&&("raster"===this.analysisMode||"bigdata"===this.analysisMode),z="ClassifyPixelsUsingDeepLearning DetectObjectsUsingDeepLearning ClassifyObjectsUsingDeepLearning CalculateSlope DeriveAspect MonitorVegetation ApplyRFxTemplate RemapValues ExtractRaster AggregateMultidimensionalRaster GenerateMultidimensionalAnomaly GenerateTrendRaster PredictUsingTrendRaster FindArgumentStatistics Sample ConvertFeatureToRaster".split(" "),G=["ClassifyPixelsUsingDeepLearning","DetectObjectsUsingDeepLearning",
"ClassifyObjectsUsingDeepLearning"],I=this.analysisMode&&"raster"===this.analysisMode;z=I&&-1!==z.indexOf(this.toolName)&&this.isSingleTenant;var K=I&&-1!==G.indexOf(this.toolName);G=K&&this.isSingleTenant;var Q=I&&"Sample"===this.toolName,N=-1!==["DetectObjectsUsingDeepLearning","ClassifyObjectsUsingDeepLearning"].indexOf(this.toolName),T=-1!=="SummarizeRasterWithin ZonalStatisticsAsTable CalculateDensityRaster InterpolatePointsEBK CreateViewshedRaster Watershed ConvertRasterToFeature Sample".split(" ").indexOf(this.toolName),
W=-1!=="CalculateDistance DetermineOptimumTravelCostNetwork DetermineTravelCostPathAsPolyline OptimalPathAsLine OptimalPathAsRaster DistanceAllocation DistanceAccumulation OptimalRegionConnections".split(" ").indexOf(this.toolName),X=I&&!N&&!Q;Q=I&&!Q;K=I&&!T&&!K&&!W;T=I&&!this.isSingleTenant;w&&(u.settingsDlg||(w=e.doc.createDocumentFragment(),w=l.create("div",{style:"width:200px;height:200px;"},w),W=f.filter(this.sLayers,function(ea){return ea.type?"Table"!==ea.type:!0}),u.settingsVM=new q({showHelp:!0,
showCloseIcon:!1,showOverwriteResultOption:!1,showCloseAnalysisOption:!0,showStoreAnalysisOption:!0,showCoordinateSystems:this.analysisMode&&("raster"===this.analysisMode&&!N||"bigdata"===this.analysisMode),showProcessSR:this.analysisMode&&"bigdata"===this.analysisMode,showOutSR:X,showExtent:!0,showRasterSettings:I,showGeoAnalyticsSettings:this.analysisMode&&"bigdata"===this.analysisMode,showRasterPPFSettings:z,showRasterPTSettings:G,showRasterSnapSettings:X,showCellsizeSettings:Q,showResamplingSettings:K,
showCreditWarningSettings:T,showHeader:!1,layers:W,showJobsHistory:!1,jobsHistoryItem:null}),this.signInPromise.then(k.hitch(this,function(){u.settingsVM.set("portalUrl",this.portalUrl)})),u.settings=new p({viewModel:u.settingsVM},w),this.i18n||(this.i18n={},k.mixin(this.i18n,B.common),k.mixin(this.i18n,B.analysisTools),k.mixin(this.i18n,B.analysisMsgCodes),k.mixin(this.i18n,B.analysisSettings)),u.settingsDlg=new x({title:this.i18n.analysisEnv,content:u.settings,style:"width:400px;"}),u.settingsDlg.own(u.settings.on("ok-settings",
k.hitch(this,function(){u.settingsDlg.hide()})),u.settings.on("cancel-settings",k.hitch(this,function(){u.settingsDlg.hide()})))),u.settingsDlg&&(u.settingsVM.set("showRasterSettings",I),u.settingsVM.set("showGeoAnalyticsSettings",this.analysisMode&&"bigdata"===this.analysisMode),u.settingsVM.set("showCoordinateSystems",this.analysisMode&&("raster"===this.analysisMode&&!N||"bigdata"===this.analysisMode)),u.settingsVM.set("showProcessSR",this.analysisMode&&"bigdata"===this.analysisMode),u.settingsVM.set("showOutSR",
X),u.settingsVM.set("showRasterPPFSettings",z),u.settingsVM.set("showRasterPTSettings",G),u.settingsVM.set("showRasterSnapSettings",X),u.settingsVM.set("showCellsizeSettings",Q),u.settingsVM.set("showResamplingSettings",K),u.settingsVM.set("showCreditWarningSettings",T),this.domNode&&d("[esriHelpTopic\x3d'toolDescription']",this.domNode).forEach(k.hitch(this,function(ea){ea&&(this._settingsLink=l.create("a",{href:"#","class":"esriAnalysisSettingsIcon"},ea,"before"),g(this._settingsLink,"click",k.hitch(this,
this._handleSettingsLinkClick)))})),this._settingWatchers||(this._settingWatchers=!0,I=this.get("context"),u.settingsVM.extent&&(I.extent=u.settingsVM.extent,this._useExtentCheck&&this._useExtentCheck.set("checked",!1)),u.settingsVM.outSR&&(I.outSR=u.settingsVM.outSR),u.settingsVM.processSR&&(I.processSR=u.settingsVM.processSR),u.settingsVM.extent&&(I.extent=u.settingsVM.extent,this._useExtentCheck&&this._useExtentCheck.set("checked",!1)),u.settingsVM.cellSize&&(I.cellSize=u.settingsVM.cellSize),
u.settingsVM.mask&&(I.mask=u.settingsVM.mask),u.settingsVM.snapRaster&&(I.snapRaster=u.settingsVM.snapRaster),u.settingsVM.processorType&&(I.processorType=u.settingsVM.processorType),u.settingsVM.parallelProcessingFactor&&(I.parallelProcessingFactor=u.settingsVM.parallelProcessingFactor),u.settingsVM.recycleProcessingWorkers&&(I.recycleProcessingWorkers=u.settingsVM.recycleProcessingWorkers),u.settingsVM.retryOnFailures&&(I.retryOnFailures=u.settingsVM.retryOnFailures),u.settingsVM.resamplingMethod&&
(I.resamplingMethod=u.settingsVM.resamplingMethod),this.set("returnFeatureCollection",!A&&u.settingsVM.returnFeatureCollection),this._updateContextDatastore(I,u.settingsVM.datastore),this.set("context",I),u.settingsVM.watch("outSR",k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))ea.outSR=J,this.set("context",ea)})),u.settingsVM.watch("processSR",k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))ea.processSR=J,this.set("context",ea)})),u.settingsVM.watch("extent",k.hitch(this,function(ea,
fa,J){if(ea=this.get("context"))ea.extent=J,this.set("context",ea);this._useExtentCheck&&this._useExtentCheck.set("checked",!F.isDefined(J))})),u.settingsVM.watch("cellSize",k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))ea.cellSize=J,this.set("context",ea)})),u.settingsVM.watch("mask",k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))ea.mask=J,this.set("context",ea)})),u.settingsVM.watch("snapRaster",k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))ea.snapRaster=J,this.set("context",
ea)})),u.settingsVM.watch("returnFeatureCollection",k.hitch(this,function(ea,fa,J){this.set("returnFeatureCollection",!(this.analysisMode&&("raster"===this.analysisMode||"bigdata"===this.analysisMode))&&J)})),u.settingsVM.watch("datastore",k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))this._updateContextDatastore(ea,J),this.set("context",ea)})),u.settingsVM.watch("processorType",k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))ea.processorType=J,this.set("context",ea)})),u.settingsVM.watch("parallelProcessingFactor",
k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))ea.parallelProcessingFactor=J,this.set("context",ea)})),u.settingsVM.watch("recycleProcessingWorkers",k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))ea.recycleProcessingWorkers=J,this.set("context",ea)})),u.settingsVM.watch("retryOnFailures",k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))ea.retryOnFailures=J,this.set("context",ea)})),u.settingsVM.watch("resamplingMethod",k.hitch(this,function(ea,fa,J){if(ea=this.get("context"))ea.resamplingMethod=
J,this.set("context",ea)})))))},_updateContextDatastore:function(w,A){w&&A&&(A&&-1===["BDS","GDB"].indexOf(A)?w.dataStore=A:w.dataStore=null,setTimeout(k.hitch(this,function(){this.set("showSelectFolder",this.showGeoAnalyticsParams?!w.dataStore:this.showSelectFolder)}),0))},_setShowOutputTypeAttr:function(w){this.showOutputType=w},_setDoSaveJobInfoAttr:function(w){this.doSaveJobInfo=w},_setDoSaveInStorageAttr:function(w){this.doSaveInStorage=w},_getResultNameAttr:function(w){this.resultName="";this.outputLayerInput?
this.resultName=this.outputLayerInput.get("value"):this._outputLayerInput&&(this.resultName=this._outputLayerInput.get("value"));return this.resultName},_setArcadeEditorAttr:function(w){this.arcadeEditor=w},_setShowCreditCalcBusyIndicatorAttr:function(w){var A=[];this.showCredits&&this._showCreditsLink&&this._usageForm&&(w?(A.push(a.before(this,"_handleShowCreditsClick",k.hitch(this,function(){var z=this._form&&this._form.validate();"DeriveNewLocations"===this.toolName||"FindExistingLocations"===
this.toolName?z=z&&this.expressionGrid.validate():"EnrichLayer"==this.toolName&&(z=z&&this.validateSelectedGrid());z?this._pauseCreditLinkClick(this._onCreditsClickHandle,!0):this._pauseCreditLinkClick(this._onCreditsClickHandle,!1)}))),A.push(a.after(this._usageForm,"_setContentAttr",k.hitch(this,function(){this._pauseCreditLinkClick(this._onCreditsClickHandle,!1)}))),A.push(a.after(this._usageForm,"_setErrorContentAttr",k.hitch(this,function(){this._pauseCreditLinkClick(this._onCreditsClickHandle,
!1)})))):A.forEach(function(z){z.remove();z=null}))},_setuseArcGISComponentsAttr:function(w){this.useArcGISComponents=w},_getuseArcGISComponentsAttr:function(w){return this.useArcGISComponents},_setIsServerAdvanceLicensedAttr:function(w){this.isServerAdvanceLicensed=w},_getIsServerAdvanceLicensedAttr:function(){return this.isServerAdvanceLicensed},_handleSettingsLinkClick:function(){this.showSettingsDlg()},showSettingsDlg:function(w){w&&w.preventDefault();this._hasPCSWarnShown&&this.showGeoAnalyticsParams&&
this._errorMessagePane&&u.hideMessages(this._errorMessagePane);u.settingsDlg.show()},_handleModeCrumbClick:function(w){w.preventDefault();this._onClose(!1)},_onFocus:function(){this.map&&"function"===typeof this.map.disableKeyboardNavigation&&this.map.disableKeyboardNavigation();this.emit("focus");this.inherited(arguments)},_onBlur:function(){this.map&&"function"===typeof this.map.enableKeyboardNavigation&&this.map.enableKeyboardNavigation();this.emit("blur");this.inherited(arguments)},_handleAtrrValueUpdate:function(w,
A,z){"0"!==z&&(w=this.get("statisticSelect"),(z=this.getOptions(z))&&z.type&&u.addStatisticsOptions({selectWidget:w,type:z.type,showGeoAnalyticsParams:this.showGeoAnalyticsParams}))},_pauseCreditLinkClick:function(w,A){A?(w.pause(),b.set(this._showCreditsLink,{color:"grey",cursor:"none"}),m.add(this._showCreditsLink,"esriAnalysisTextDisabled esriLoadingBar2")):(w.resume(),b.set(this._showCreditsLink,{color:"#21759B",cursor:"pointer"}),m.remove(this._showCreditsLink,"esriAnalysisTextDisabled esriLoadingBar2"))},
constructAnalysisInputLyrObj:function(w,A){A=F.isDefined(A)?A:this.isSingleTenant;return u.constructAnalysisInputLyrObj(w,A,!this.showGeoAnalyticsParams)},_addBarrierstoJobParams:function(w,A){w instanceof Object&&(A.pointBarrierLayer&&(w.pointBarrierLayer=r.toJson(this.constructAnalysisInputLyrObj(A.pointBarrierLayer))),A.lineBarrierLayer&&(w.lineBarrierLayer=r.toJson(this.constructAnalysisInputLyrObj(A.lineBarrierLayer))),A.polygonBarrierLayer&&(w.polygonBarrierLayer=r.toJson(this.constructAnalysisInputLyrObj(A.polygonBarrierLayer))));
return w}});c("extend-esri")&&k.setObject("dijit.analysis._AnalysisOptions",H,y);return H})},"esri/dijit/analysis/Settings":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/json dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/NodeList dojo/NodeList-dom dojo/_base/fx dojo/fx/easing dojo/promise/all dojo/Evented dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/TextBox dijit/form/NumberTextBox dijit/form/ToggleButton dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/form/FilteringSelect dijit/Dialog dijit/ConfirmDialog dojox/mvc/at dgrid1/OnDemandGrid dgrid1/Tree dgrid1/Editor dgrid1/Keyboard dgrid1/Selection dgrid1/Selector dgrid1/extensions/ColumnResizer dgrid1/extensions/DijitRegistry ../../kernel ../../lang ../../geometry/Extent ../../SpatialReference ../../layers/ArcGISImageServiceLayer ./_Widget ./utils ./SettingsViewModel ./JobsList ./components/DataStoreSelect dojo/i18n!../../nls/jsapi dojo/text!./templates/Settings.html".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I,K,Q,N,T,W,X,ea,fa,J,V,aa,Z,L,O,D,P,R,ca,ha,oa,ma,U,da,na,ia,pa,E,M,ba,Y){var ka=k([aa,O,D,P,L,Z,R,ca]);H=na.createSubclass([B,F,y,w],{declaredClass:"esri.dijit.analysis.Settings",templateString:Y,widgetsInTemplate:!0,i18n:null,toolName:"Settings",helpFileName:"AnalysisEnvironments",viewModelType:pa,cssClass:{primaryButton:"btn calcite blue",button:"btn calcite"},constructor:function(S,ja){this._pbConnects=[];S.containerNode&&(this.container=
S.containerNode);this.cssClass=n.mixin({},this.cssClass)},destroy:function(){this.inherited(arguments);r.forEach(this._pbConnects,m.disconnect);delete this._pbConnects},postMixInProperties:function(){this.inherited(arguments);this.i18n={};n.mixin(this.i18n,ba.common);n.mixin(this.i18n,ba.analysisSettings);this._initModelWatchers()},postCreate:function(){this.inherited(arguments);this.viewModel.showOkCancel&&(this._state={});this.initUI()},startup:function(){this._spatialRefGrid.startup()},initUI:function(){this._rasterUX=
[this._snapLblRow,this._snapSelRow,this._rasterLblRow,this._cellLblRow,this._cellSelectRow,this._cellSelectNumRow,this._maskLblRow,this._maskSelRow];this._extentUX=[this._processExtLblRow,this._extentLblRow,this._extentRow];this._coordSysUX=[this._processSRRow,this._processSRLblRow,this._outSRLblRow,this._outSRRow,this._coordinateLblRow];this._geoanalyticsUX=[this._geoanalyticsLblRow,this._datastoreLabelRow,this._selectDataStore];this._rasterPPFUX=[this._parallelProcessingLblRow,this._parallelProcessingFactorLblRow,
this._parallelProcessingFactorNumRow,this._recycleProcessingWorkersLblRow,this._recycleProcessingWorkersNumRow,this._retryOnFailuresLblRow,this._retryOnFailuresNumRow];this._rasterPTUX=[this._processorLblRow,this._processorTypeLblRow,this._processorTypeSelRow];this._rasterStorageUX=[this._storageLblRow,this._resamplingMethodLblRow,this._resamplingMethodSelRow];ia.initHelpLinks(this.domNode,this.viewModel.showHelp);ia.updateDisplay(this._rasterUX,this.viewModel.showRasterSettings,"table-row");ia.updateDisplay([this._overwriteRow],
this.viewModel.showOverwriteResultOption,"table-row");ia.updateDisplay([this._closeAnalysisRow],this.viewModel.showCloseAnalysisOption,"table-row");ia.updateDisplay([this._storeAnalysisRow],this.viewModel.showStoreAnalysisOption,"table-row");ia.updateDisplay(this._coordSysUX,this.viewModel.showCoordinateSystems,"table-row");ia.updateDisplay([this._processSRRow,this._processSRLblRow],this.viewModel.showProcessSR,"table-row");ia.updateDisplay([this._outSRLblRow,this._outSRRow],this.viewModel.showOutSR,
"table-row");ia.updateDisplay([this._coordinateLblRow],this.viewModel.showProcessSR||this.viewModel.showProcessSR,"table-row");ia.updateDisplay(this._extentUX,this.viewModel.showExtent,"table-row");ia.updateDisplay([this._closeDiv],this.viewModel.showCloseIcon,"block");ia.updateDisplay([this._settingsHeader],this.viewModel.showHeader,"block");ia.updateDisplay([this._actionbuttonCtr],this.viewModel.showOkCancel,"block");ia.updateDisplay(this._geoanalyticsUX,this.viewModel.showGeoAnalyticsSettings,
"table-row");ia.updateDisplay(this._rasterPPFUX,this.viewModel.showRasterPPFSettings,"table-row");ia.updateDisplay(this._rasterPTUX,this.viewModel.showRasterPTSettings,"table-row");ia.updateDisplay([this._maskLblRow,this._maskSelRow],this.viewModel.showRasterSettings&&!this.viewModel.showRasterPTSettings,"table-row");ia.updateDisplay([this._snapLblRow,this._snapSelRow],this.viewModel.showRasterSnapSettings,"table-row");ia.updateDisplay([this._cellLblRow,this._cellSelectRow,this._cellSelectNumRow],
this.viewModel.showCellsizeSettings,"table-row");ia.updateDisplay(this._rasterStorageUX,this.viewModel.showResamplingSettings,"table-row");ia.updateDisplay([this._creditWarningRow],this.viewModel.showCreditWarningSettings,"table-row");this._spatialRefGrid||(this._spatialRefGrid=new ka({collection:this.viewModel.spatialRefStore,id:this.id+"_settingsgrid",showHeader:!1,columns:[{renderExpando:!0,label:"Name",field:"name",sortable:!1,resizable:!0}],"class":"esriAnalysisSpatialRefTree"},this._spatialRefGridNode),
h(".dijitButton",this._coordDialog.domNode).forEach(function(S,ja){0===ja?p.add(S,this.cssClass.primaryButton):p.add(S,this.cssClass.button)},this));this.viewModel.outSR&&this._outSRInput.set("value",this.viewModel.outSR.wkid);this.viewModel.processSR&&this._processSRInput.set("value",this.viewModel.processSR.wkid);this.viewModel.layers&&this._updateLayerOptions(this.viewModel.layers);this._updateProcessSRSelectValue();this._handleProcessSRSelectChange(this._processSRSelect.get("value"));this._updateOutSRSelectValue();
this._handleSRSelectChange(this._outSRSelect.get("value"));this._updateExtentSelectValue();this._handleExtentOptionChange(this._extentSelect.get("value"));this._updateCellSizeSelectValue();this._handleCellSizeSelectChange(this._cellSizeSelect.get("value"));this._updateSnapRasterSelectValue();this._handleSnapRasterSelectChange(this._snapRasterSelect.get("value"));this._updateMaskSelectValue();this._handleMaskSelectChange(this._maskSelect.get("value"));this._updateProcessorTypeSelectValue();this._handleProcessorTypeSelectChange(this._processorTypeSelect.get("value"));
this._updateparallelProcessingFactorInputValue();this._handleparallelProcessingFactorInputChange(this._parallelProcessingFactorInput.get("value"));this._updaterecycleProcessingWorkersInputValue();this._handlerecycleProcessingWorkersInputChange(this._recycleProcessingWorkersInput.get("value"));this._updateretryOnFailuresInputValue();this._handleretryOnFailuresInputChange(this._retryOnFailuresInput.get("value"));this._updateResamplingMethodSelectValue();this._handleResamplingMethodSelectChange(this._resamplingMethodSelect.get("value"));
this._closeAnalysisCheck.set("checked",this.viewModel.closeAnalysisWidget);this._storeAnalysisCheck.set("checked",!this.viewModel.returnFeatureCollection);this._creditWarningCheck.set("checked",this.viewModel.creditWarning);this.viewModel.showJobsHistory&&this.buildJobsUI();this.viewModel.showGeoAnalyticsSettings&&this.buildDataStoreUI();this._handleCloseMsg()},_initModelWatchers:function(){this.own(this.viewModel.watch("showCloseIcon",n.hitch(this,function(S,ja,la){ia.updateDisplay([this._closeDiv],
la,"block")})),this.viewModel.watch("showHelp",n.hitch(this,function(S,ja,la){ia.initHelpLinks(this.domNode,la)})),this.viewModel.watch("showOverwriteResultOption",n.hitch(this,function(S,ja,la){ia.updateDisplay([this._overwriteRow],la,"table-row")})),this.viewModel.watch("showCloseAnalysisOption",n.hitch(this,function(S,ja,la){ia.updateDisplay([this._closeAnalysisRow],la,"table-row")})),this.viewModel.watch("showStoreAnalysisOption",n.hitch(this,function(S,ja,la){ia.updateDisplay([this._storeAnalysisRow],
la,"table-row")})),this.viewModel.watch("showCoordinateSystems",n.hitch(this,function(S,ja,la){ia.updateDisplay(this._coordSysUX,la,"table-row")})),this.viewModel.watch("showProcessSR",n.hitch(this,function(S,ja,la){ia.updateDisplay([this._processSRRow,this._processSRLblRow],la,"table-row");ia.updateDisplay([this._coordinateLblRow],la||this.viewModel.showOutSR,"table-row");this._updateProcessSRSelectValue();this._handleProcessSRSelectChange(this._processSRSelect.get("value"))})),this.viewModel.watch("showOutSR",
n.hitch(this,function(S,ja,la){ia.updateDisplay([this._outSRLblRow,this._outSRRow],la,"table-row");ia.updateDisplay([this._coordinateLblRow],la||this.viewModel.showProcessSR,"table-row");this._updateOutSRSelectValue();this._handleSRSelectChange(this._outSRSelect.get("value"))})),this.viewModel.watch("showExtent",n.hitch(this,function(S,ja,la){ia.updateDisplay(this._extentUX,la,"table-row");this._updateExtentSelectValue();la&&this._handleExtentOptionChange(this._extentSelect.get("value"))})),this.viewModel.watch("showRasterSettings",
n.hitch(this,function(S,ja,la){ia.updateDisplay(this._rasterUX,la,"table-row");this._updateCellSizeSelectValue();this._handleCellSizeSelectChange(this._cellSizeSelect.get("value"));this._updateSnapRasterSelectValue();this._handleSnapRasterSelectChange(this._snapRasterSelect.get("value"));this._updateMaskSelectValue();this._handleMaskSelectChange(this._maskSelect.get("value"));this._updateResamplingMethodSelectValue();this._handleResamplingMethodSelectChange(this._resamplingMethodSelect.get("value"))})),
this.viewModel.watch("showRasterPPFSettings",n.hitch(this,function(S,ja,la){ia.updateDisplay(this._rasterPPFUX,la,"table-row");this._updateparallelProcessingFactorInputValue();this._handleparallelProcessingFactorInputChange(this._parallelProcessingFactorInput.get("value"));this._updaterecycleProcessingWorkersInputValue();this._handlerecycleProcessingWorkersInputChange(this._recycleProcessingWorkersInput.get("value"));this._updateretryOnFailuresInputValue();this._handleretryOnFailuresInputChange(this._retryOnFailuresInput.get("value"))})),
this.viewModel.watch("showRasterPTSettings",n.hitch(this,function(S,ja,la){ia.updateDisplay(this._rasterPTUX,la,"table-row");ia.updateDisplay([this._maskLblRow,this._maskSelRow],!la&&this.viewModel.showRasterSettings,"table-row");this._updateProcessorTypeSelectValue();this._handleProcessorTypeSelectChange(this._processorTypeSelect.get("value"))})),this.viewModel.watch("showRasterSnapSettings",n.hitch(this,function(S,ja,la){ia.updateDisplay([this._snapLblRow,this._snapSelRow],la,"table-row");this._updateparallelProcessingFactorInputValue();
this._handleSnapRasterSelectChange(this._snapRasterSelect.get("value"))})),this.viewModel.watch("showCellsizeSettings",n.hitch(this,function(S,ja,la){ia.updateDisplay([this._cellLblRow,this._cellSelectRow,this._cellSelectNumRow],la,"table-row");this._updateCellSizeSelectValue();this._handleCellSizeSelectChange(this._cellSizeSelect.get("value"))})),this.viewModel.watch("layers",n.hitch(this,function(S,ja,la){this._updateLayerOptions(this.viewModel.layers)})),this.viewModel.watch("showHeader",n.hitch(this,
function(S,ja,la){ia.updateDisplay([this._settingsHeader],la,"block")})),this.viewModel.watch("showOkCancel",n.hitch(this,function(S,ja,la){ia.updateDisplay([this._actionbuttonCtr],la,"block")})),this.viewModel.watch("showGeoAnalyticsSettings",n.hitch(this,function(S,ja,la){ia.updateDisplay(this._geoanalyticsUX,la,"table-row");la&&this.buildDataStoreUI()})),this.viewModel.watch("isCustomProcessSR",n.hitch(this,function(){this._updateProcessSRSelectValue();this._handleProcessSRSelectChange(this._processSRSelect.get("value"))})),
this.viewModel.watch("isCustomExtent",n.hitch(this,function(){this._updateExtentSelectValue();this._handleExtentOptionChange(this._extentSelect.get("value"))})),this.viewModel.watch("isCustomOutSR",n.hitch(this,function(){this._updateOutSRSelectValue();this._handleSRSelectChange(this._outSRSelect.get("value"))})),this.viewModel.watch("closeAnalysisWidget",n.hitch(this,function(S,ja,la){this._handleCloseAnalysisCheck(la)})),this.viewModel.watch("returnFeatureCollection",n.hitch(this,function(S,ja,
la){this._handleReturnFeatureCollectionCheck(la)})),this.viewModel.watch("showJobsHistory",n.hitch(this,this.buildJobsUI)),this.viewModel.watch("jobsViewModel",n.hitch(this,this.buildJobsUI)),this.viewModel.watch("showResamplingSettings",n.hitch(this,function(S,ja,la){ia.updateDisplay(this._rasterStorageUX,la,"table-row")})),this.viewModel.watch("showCreditWarningSettings",n.hitch(this,function(S,ja,la){ia.updateDisplay([this._creditWarningRow],la,"table-row")})))},buildJobsUI:function(){ia.updateDisplay([this._settingsNavCtrl],
this.viewModel.showJobsHistory,"block");p.toggle(this._form.domNode,"tab-contents tab-section is-active",this.viewModel.showJobsHistory);p.toggle(this._jobHistoryCtr,"tab-contents tab-section",this.viewModel.showJobsHistory);p.toggle(this.domNode,"esri-analysis-category",this.viewModel.showJobsHistory);this.viewModel.showJobsHistory&&(this._addTabHandlers||(h(".tab-nav a",this.domNode).on("click",n.hitch(this,function(S){S.stopPropagation();h(".tab-title",this.domNode).removeClass("is-active");p.add(S.target,
"is-active");S=p.contains(S.target,"general-tab");ia.updateDisplay([this._form.domNode],S,"block");ia.updateDisplay([this._jobHistoryCtr],!S,"block")})),this._addTabHandlers=!0),this.buildJobsList())},buildJobsList:function(){this.viewModel.jobsViewModel&&!this._jobsListWidget&&(this._jobsListWidget=new E({viewModel:this.viewModel.jobsViewModel},this._jobsListDiv))},buildDataStoreUI:function(){this._dataStoreSelect||(this._dataStoreSelect=new M({geoAnalyticsServer:this.viewModel.geoAnalyticsServer,
value:this.viewModel.get("datastore")},d.create("div",null,this._dataStoreTd)),this._dataStoreSelect.startup(),this._dataStoreSelect.on("change",n.hitch(this,this._handleDSSelectChange)))},_updateExtentSelectValue:function(){if(this.viewModel.get("isCustomExtent"))this._extentSelect.set("value","SPECIFIED");else if(this.viewModel.viewProps&&this.viewModel.viewProps.extentLayer&&this._layerNames){var S=r.indexOf(this._layerNames,this.viewModel.viewProps.extentLayer.name);this._extentSelect.set("value",
"LAYER_"+S)}else this._extentSelect.set("value","DEFAULT");this.viewModel.get("isCustomExtent")&&this.viewModel.extent&&(this._xMinInput.set("value",this.viewModel.extent.xmin),this._xMaxInput.set("value",this.viewModel.extent.xmax),this._yMinInput.set("value",this.viewModel.extent.ymin),this._yMaxInput.set("value",this.viewModel.extent.ymax))},_updateProcessSRSelectValue:function(){this.viewModel.processSR&&this.viewModel.get("isCustomProcessSR")&&this._processSRInput.set("value",this.viewModel.processSR.wkid);
if(this.viewModel.get("isCustomProcessSR"))this._processSRSelect.set("value","SPECIFIED");else if(this.viewModel.viewProps&&this.viewModel.viewProps.pSRLayer&&this._layerNames){var S=r.indexOf(this._layerNames,this.viewModel.viewProps.pSRLayer.name);this._processSRSelect.set("value","LAYER_"+S)}else this._processSRSelect.set("value","DEFAULT")},_updateOutSRSelectValue:function(){this.viewModel.outSR&&this.viewModel.get("isCustomOutSR")&&this._outSRInput.set("value",this.viewModel.outSR.wkid);if(this.viewModel.get("isCustomOutSR"))this._outSRSelect.set("value",
"SPECIFIED");else if(this.viewModel.viewProps&&this.viewModel.viewProps.outSRLayer&&this._layerNames){var S=r.indexOf(this._layerNames,this.viewModel.viewProps.outSRLayer.name);this._outSRSelect.set("value","LAYER_"+S)}else this._outSRSelect.set("value","DEFAULT")},_updateCellSizeSelectValue:function(){if(this.viewModel.get("isCustomCellSize"))this._cellSizeSelect.set("value","SPECIFIED");else if(this.viewModel.viewProps&&this.viewModel.viewProps.cellSizeLayer&&this._layerNames){var S=r.indexOf(this._layerNames,
this.viewModel.viewProps.cellSizeLayer.name);this._cellSizeSelect.set("value","LAYER_"+S)}else this.viewModel.cellSize?this._cellSizeSelect.set("value",this.viewModel.cellSize):this._cellSizeSelect.set("value",this._cellSizeSelect.get("value"));this.viewModel.get("isCustomCellSize")&&this.viewModel.cellSize&&this._cellSizeInput.set("value",this.viewModel.cellSize)},_updateSnapRasterSelectValue:function(){if(this.viewModel.viewProps&&this.viewModel.viewProps.snapRasterLayer&&this._layerNames){var S=
r.indexOf(this._layerNames,this.viewModel.viewProps.snapRasterLayer.name);this._snapRasterSelect.set("value","LAYER_"+this._layerNames[S])}else this._snapRasterSelect.set("value",this._snapRasterSelect.get("value"))},_updateMaskSelectValue:function(){if(this.viewModel.viewProps&&this.viewModel.viewProps.maskLayer&&this._layerNames){var S=r.indexOf(this._layerNames,this.viewModel.viewProps.maskLayer.name);this._maskSelect.set("value","LAYER_"+S)}else this._maskSelect.set("value",this._maskSelect.get("value"))},
_updateProcessorTypeSelectValue:function(){this.viewModel.processorType?this._processorTypeSelect.set("value",this.viewModel.processorType):this._processorTypeSelect.set("value",this._processorTypeSelect.get("value"))},_updateparallelProcessingFactorInputValue:function(){this.viewModel.parallelProcessingFactor?this._parallelProcessingFactorInput.set("value",this.viewModel.parallelProcessingFactor):this._parallelProcessingFactorInput.set("value",this._parallelProcessingFactorInput.get("value"))},_updaterecycleProcessingWorkersInputValue:function(){this.viewModel.recycleProcessingWorkers?
this._recycleProcessingWorkersInput.set("value",this.viewModel.recycleProcessingWorkers):this._recycleProcessingWorkersInput.set("value",this._recycleProcessingWorkersInput.get("value"))},_updateretryOnFailuresInputValue:function(){this.viewModel.retryOnFailures?this._retryOnFailuresInput.set("value",this.viewModel.retryOnFailures):this._retryOnFailuresInput.set("value",this._retryOnFailuresInput.get("value"))},_updateResamplingMethodSelectValue:function(){this.viewModel.resamplingMethod?this._resamplingMethodSelect.set("value",
this.viewModel.resamplingMethod):this._resamplingMethodSelect.set("value",this._resamplingMethodSelect.get("value"))},_handleSRSelectChange:function(S){this._coordDialog.hide();this._outSRBtn.set("disabled","SPECIFIED"!==S);ia.updateDisplay(this._outSRCustomRow,"SPECIFIED"===S&&this.viewModel.showOutSR,"table-row");ia.updateDisplay(this._outSRCustomInputRow,"SPECIFIED"===S&&this.viewModel.showOutSR,"table-row");this._outSRInput.set("required","SPECIFIED"===S);-1!==S.indexOf("LAYER_")&&(S=S.split("_")[1],
S=this.viewModel.layers[S],this.viewModel.showOkCancel?(this._outSR={wkid:parseInt(S.fullExtent.spatialReference.wkid,10)},this._state.outSRLayer={name:S.name,url:S.url,fullExtent:S.fullExtent}):this.viewModel.set("outSR",{wkid:parseInt(S.fullExtent.spatialReference.wkid,10)}))},_handleProcessSRSelectChange:function(S){this._coordDialog.hide();this._processSRBtn.set("disabled","SPECIFIED"!==S);ia.updateDisplay(this._processSRCustomRow,"SPECIFIED"===S&&this.viewModel.showProcessSR,"table-row");ia.updateDisplay(this._processSRCustomInputRow,
"SPECIFIED"===S&&this.viewModel.showProcessSR,"table-row");this._processSRInput.set("required","SPECIFIED"===S);-1!==S.indexOf("LAYER_")&&(S=S.split("_")[1],S=this.viewModel.layers[S],this.viewModel.showOkCancel?(this._processSR={wkid:parseInt(S.fullExtent.spatialReference.wkid,10)},this._state.pSRLayer={name:S.name,url:S.url,fullExtent:S.fullExtent}):this.viewModel.set("processSR",{wkid:parseInt(S.fullExtent.spatialReference.wkid,10)}))},_handleOutSRBtnClick:function(){this._outSRClick=!0;this._coordDialog.show()},
_handleProcessSRBtnClick:function(){this._outSRClick=!1;this._coordDialog.show()},_handleExtentOptionChange:function(S){var ja="SPECIFIED"===S;ia.updateDisplay([this._extentLbl,this._customExtentRow],this.viewModel.showExtent&&ja,"table-row");this._xMinInput.set("required",ja);this._xMaxInput.set("required",ja);this._yMinInput.set("required",ja);this._yMaxInput.set("required",ja);-1!==S.indexOf("LAYER_")?(S=S.split("_")[1],S=this.viewModel.layers[S],ja=new ma(S.fullExtent),this.viewModel.showOkCancel?
(this._extent=ja.shiftCentralMeridian(),this._state.extentLayer={name:S.name,url:S.url,fullExtent:S.fullExtent}):this.viewModel.set("extent",ja.shiftCentralMeridian())):"SPECIFIED"===S?(ja=new ma(this._xMinInput.get("value"),this._yMinInput.get("value"),this._xMaxInput.get("value"),this._yMaxInput.get("value"),new U({wkid:102100})),this.viewModel.showOkCancel?(this._extent=ja,this._state.extentLayer=null):this.viewModel.set("extent",ja)):"DEFAULT"===S&&(this._extent=null,this._state.extentLayer=null)},
_validateExtent:function(){var S=!0,ja="";this._handleCloseMsg();this._xMinInput.get("value")>this._xMaxInput.get("value")&&(S=!1,ja+=this.i18n.xMinMaxExtent);this._yMinInput.get("value")>this._yMaxInput.get("value")&&(S=!1,ja+="\x3cbr/\x3e"+this.i18n.yMinMaxExtent);S||this._showMessages(ja);return S},_handleSRDlgOk:function(){var S;for(ja in this._spatialRefGrid.get("selection"))this._spatialRefGrid.get("selection").hasOwnProperty(ja)&&(S=ja);S=this._spatialRefGrid.collection.getSync(S);var ja=S.sRef.wkid;
this.viewModel.showOkCancel?this._outSRClick?this._outSR={wkid:parseInt(ja,10)}:this._processSR={wkid:parseInt(ja,10)}:this.viewModel.set(this._outSRClick?"outSR":"processSR",{wkid:parseInt(ja,10)});this._outSRClick?this._outSRInput.textbox.value=ja:this._processSRInput.textbox.value=ja;this._outSRClick?g.set(this._outSRLabel,"innerHTML",S.name):g.set(this._processSRLabel,"innerHTML",S.name)},_handleSRDlgCancel:function(){},_handleOutSRInputChange:function(S){S&&(g.set(this._outSRLabel,"innerHTML",
""),ia.updateDisplay([this._outSRLabel],!1,"inline"),this.viewModel.showOkCancel?(this._outSR={wkid:parseInt(S,10)},this._state.outSRLayer=null):this.viewModel.set("outSR",{wkid:parseInt(S,10)}))},_handleProcessSRInputChange:function(S){S&&(g.set(this._processSRLabel,"innerHTML",""),ia.updateDisplay([this._processSRLabel],!1,"inline"),this.viewModel.showOkCancel?(this._processSR={wkid:parseInt(S,10)},this._state.pSRLayer=null):this.viewModel.set("processSR",{wkid:parseInt(S,10)}))},_handleCellSizeSelectChange:function(S){ia.updateDisplay([this._cellSelectNumRow],
"SPECIFIED"===S&&this.viewModel.showRasterSettings,"table-row");-1!==S.indexOf("LAYER_")?(S=this._cellSizeSelect.getOptions(S),this.viewModel.showOkCancel?(this._cellSize={url:S.url},this._state.cellSizeLayer={name:S.label.substring(6),url:S.url,fullExtent:S.fullExtent}):this.viewModel.set("cellSize",{url:S.url})):"SPECIFIED"===S?this.viewModel.showOkCancel?(this._cellSize=this._cellSizeInput.get("value"),this._state.cellSizeLayer=null):this.viewModel.set("cellSize",this._cellSizeInput.get("value")):
this.viewModel.showOkCancel?(this._cellSize=S,this._state.cellSizeLayer=null):this.viewModel.set("cellSize",S)},_handleSnapRasterSelectChange:function(S){-1!==S.indexOf("LAYER_")?(S=this._snapRasterSelect.getOptions(S),this.viewModel.showOkCancel?(this._snapRaster={url:S.url},this._state.snapRasterLayer={name:S.label.substring(6),url:S.url,fullExtent:S.fullExtent}):this.viewModel.set("snapRaster",{url:S.url})):this.viewModel.showOkCancel?(this._snapRaster="NONE"===S?void 0:S,this._state.snapRasterLayer=
null):this.viewModel.set("snapRaster","NONE"===S?void 0:S)},_handleMaskSelectChange:function(S){-1!==S.indexOf("LAYER_")?(S=this._maskSelect.getOptions(S),this.viewModel.showOkCancel?(this._mask={url:S.url},this._state.maskLayer={name:S.label.substring(6),url:S.url,fullExtent:S.fullExtent}):this.viewModel.set("mask",{url:S.url})):this.viewModel.showOkCancel?(this._mask="NONE"===S?void 0:S,this._state.maskLayer=null):this.viewModel.set("mask","NONE"===S?void 0:S)},_handleCellSizeInputChange:function(S){S&&
"SPECIFIED"===this._cellSizeSelect.get("value")&&(this.viewModel.showOkCancel?this._cellSize=S:this.viewModel.set("cellSize",S))},_handleDSSelectChange:function(S){this.viewModel.showOkCancel||this.viewModel.set("datastore",S.value)},_handleProcessorTypeSelectChange:function(S){this.viewModel.showOkCancel?this._processorType="NONE"===S?void 0:S:this.viewModel.set("processorType",S);this.viewModel.set("showRasterPPFSettings",this.viewModel.showRasterPTSettings&&"GPU"!=S)},_handleparallelProcessingFactorInputChange:function(S){this.viewModel.showOkCancel?
this._parallelProcessingFactor=S:this.viewModel.set("parallelProcessingFactor",S)},_handlerecycleProcessingWorkersInputChange:function(S){this.viewModel.showOkCancel?this._recycleProcessingWorkers=S:this.viewModel.set("recycleProcessingWorkers",S)},_handleretryOnFailuresInputChange:function(S){this.viewModel.showOkCancel?this._retryOnFailures=S:this.viewModel.set("retryOnFailures",S)},_handleResamplingMethodSelectChange:function(S){this.viewModel.showOkCancel?this._resamplingMethod=S:this.viewModel.set("resamplingMethod",
S)},_updateLayerOptions:function(S){var ja=r.map(S,function(ra,sa){return{value:"LAYER_"+sa,label:"Layer "+ra.name,url:ra.url,fullExtent:ra.fullExtent}}),la=[{value:"minof",label:this.i18n.minInputs},{value:"maxof",label:this.i18n.maxInputs,selected:!0},{value:"SPECIFIED",label:this.i18n.extentSpecfiedBelow}],qa=[{value:"DEFAULT",label:this.i18n.defaultLabel},{value:"SPECIFIED",label:this.i18n.extentSpecfiedBelow}],ta=[{value:"GPU",label:this.i18n.gpu},{value:"CPU",label:this.i18n.cpu}],Ba=[{value:"NEAREST",
label:this.i18n.nearest},{value:"BILINEAR",label:this.i18n.bilinear},{value:"CUBIC",label:this.i18n.cubic}];var wa=[].concat([{value:"DEFAULT",label:this.i18n.defaultExtentLabel},{value:"SPECIFIED",label:this.i18n.extentSpecfiedBelow}]).concat(ja);qa=[].concat(qa).concat(ja);var ua=r.filter(S,function(ra){return ra instanceof da||"esri.layers.RasterXLayer"===ra.declaredClass||ra.url&&"imageserver"===ra.url.split("/").pop().toLowerCase()});ua=[].concat(r.map(ua,function(ra,sa){return{value:"LAYER_"+
ra.name,label:"Layer "+ra.name,url:ra.url,fullExtent:ra.fullExtent}},this));this._layerNames=r.map(S,function(ra,sa){return ra.name});this._outSRSelect.removeOption(this._outSRSelect.getOptions());this._processSRSelect.removeOption(this._processSRSelect.getOptions());this._extentSelect.removeOption(this._extentSelect.getOptions());this._maskSelect.removeOption(this._maskSelect.getOptions());this._cellSizeSelect.removeOption(this._cellSizeSelect.getOptions());this._snapRasterSelect.removeOption(this._snapRasterSelect.getOptions());
this._processorTypeSelect.removeOption(this._processorTypeSelect.getOptions());this._resamplingMethodSelect.removeOption(this._resamplingMethodSelect.getOptions());this._outSRSelect.addOption(wa);this._processSRSelect.addOption(wa);this._extentSelect.addOption(qa);this._maskSelect.addOption([{value:"NONE",label:""}].concat(ja));this._cellSizeSelect.addOption([].concat(la).concat(ua));this._snapRasterSelect.addOption([{value:"NONE",label:""}].concat(ua));this._processorTypeSelect.addOption([{value:"NONE",
label:""}].concat(ta));this._resamplingMethodSelect.addOption(Ba);this._updateExtentSelectValue();this._updateOutSRSelectValue();this._updateProcessSRSelectValue();this._updateCellSizeSelectValue();this._updateSnapRasterSelectValue();this._updateMaskSelectValue();this._updateProcessorTypeSelectValue();this._updateparallelProcessingFactorInputValue();this._updaterecycleProcessingWorkersInputValue();this._updateretryOnFailuresInputValue();this._updateResamplingMethodSelectValue()},_handleCloseAnalysisCheck:function(S){this.viewModel.showOkCancel||
this.viewModel.set("closeAnalysisWidget",S)},_handleReturnFeatureCollectionCheck:function(S){this.viewModel.showOkCancel||this.viewModel.set("returnFeatureCollection",!S)},_handleOkButtonClick:function(S){S&&S.preventDefault();this._form.validate()&&("SPECIFIED"!==this._extentSelect.get("value")||this._validateExtent())&&(this.viewModel.set("viewProps",this._state),"DEFAULT"!==this._outSRSelect.get("value")?this.viewModel.set("outSR",this._outSR):"DEFAULT"===this._outSRSelect.get("value")&&this.viewModel.set("outSR",
null),"DEFAULT"!==this._processSRSelect.get("value")?this.viewModel.set("processSR",this._processSR):"DEFAULT"===this._processSRSelect.get("value")&&this.viewModel.set("processSR",null),"SPECIFIED"===this._extentSelect.get("value")&&this._validateExtent()&&(this._extent=new ma(this._xMinInput.get("value"),this._yMinInput.get("value"),this._xMaxInput.get("value"),this._yMaxInput.get("value"),new U({wkid:102100}))),this.viewModel.set("extent",this._extent),this.viewModel.set("mask",this._mask),this.viewModel.set("snapRaster",
this._snapRaster),this.viewModel.set("cellSize",this._cellSize),this.viewModel.set("resamplingMethod",this._resamplingMethod),this.viewModel.set("creditWarningChecked",this._creditWarning),this._dataStoreSelect&&this.viewModel.set("datastore",this._dataStoreSelect.get("value")),this.viewModel.set("closeAnalysisWidget",this._closeAnalysisCheck.get("checked")),this.viewModel.set("returnFeatureCollection",!this._storeAnalysisCheck.get("checked")),this.viewModel.set("isCustomExtent","SPECIFIED"===this._extentSelect.get("value")),
this.viewModel.set("isCustomOutSR","SPECIFIED"===this._outSRSelect.get("value")),this.viewModel.set("isCustomProcessSR","SPECIFIED"===this._processSRSelect.get("value")),this.viewModel.set("isCustomCellSize","SPECIFIED"===this._cellSizeSelect.get("value")),this.viewModel.set("processorType",this._processorType),this.viewModel.set("parallelProcessingFactor",this._parallelProcessingFactor),this.viewModel.set("recycleProcessingWorkers",this._recycleProcessingWorkers),this.viewModel.set("retryOnFailures",
this._retryOnFailures),this.viewModel.save(),this.emit("ok-settings",{viewMode:this.viewModel}))},_handleCancelButtonClick:function(){this.viewModel.reset();this.reset();this.emit("cancel-settings",{viewMode:this.viewModel})},_handleCreditWarningCheck:function(S){this.viewModel.set("creditWarning",S)},reset:function(){"SPECIFIED"!==this._extentSelect.get("value")||this._validateExtent()||this.viewModel.get("isCustomExtent")||(this._xMinInput.reset(),this._xMaxInput.reset(),this._yMinInput.reset(),
this._yMaxInput.reset());this.initUI()},_showMessages:function(S){g.set(this._bodyNode,"innerHTML",S);v.fadeIn({node:this._errorMessagePane,easing:t.quadIn,onEnd:n.hitch(this,function(){e.set(this._errorMessagePane,{display:""})})}).play()},_handleCloseMsg:function(S){S&&S.preventDefault();v.fadeOut({node:this._errorMessagePane,easing:t.quadOut,onEnd:n.hitch(this,function(){e.set(this._errorMessagePane,{display:"none"})})}).play()}});a("extend-esri")&&n.setObject("dijit.analysis.Settings",H,ha);return H})},
"dojo/NodeList":function(){define(["./query"],function(H){return H.NodeList})},"dijit/ConfirmDialog":function(){define(["dojo/_base/declare","./Dialog","./_ConfirmDialogMixin"],function(H,k,n){return H("dijit.ConfirmDialog",[k,n],{})})},"dijit/_ConfirmDialogMixin":function(){define(["dojo/_base/declare","./_WidgetsInTemplateMixin","dojo/i18n!./nls/common","dojo/text!./templates/actionBar.html","./form/Button"],function(H,k,n,r){return H("dijit._ConfirmDialogMixin",k,{actionBarTemplate:r,buttonOk:n.buttonOk,
_setButtonOkAttr:{node:"okButton",attribute:"label"},buttonCancel:n.buttonCancel,_setButtonCancelAttr:{node:"cancelButton",attribute:"label"}})})},"dojox/mvc/at":function(){define(["dojo/_base/kernel","dojo/_base/lang","./sync","./_atBindingExtension"],function(H,k,n){H.experimental("dojox.mvc");H=function(r,m){return{atsignature:"dojox.mvc.at",target:r,targetProp:m,bindDirection:n.both,direction:function(l){this.bindDirection=l;return this},transform:function(l){this.converter=l;return this},equals:function(l){this.equalsCallback=
l;return this}}};H.from=n.from;H.to=n.to;H.both=n.both;return k.setObject("dojox.mvc.at",H)})},"dojox/mvc/sync":function(){define(["dojo/_base/lang","dojo/_base/config","dojo/_base/array","dojo/has"],function(H,k,n,r){function m(c,f,e,g,d,h,p,q,u,v){if(!(e(u,q)||"*"==d&&0>n.indexOf(g.get("properties")||[p],p)||"*"==d&&p in(v||{}))){e="*"==d?p:d;if(r("mvc-bindings-log-api"))var t=b(g,e,h,p);try{u=c?c(u,f):u}catch(x){r("mvc-bindings-log-api")&&console.log("Copy from"+t.join(" to ")+" was not done as an error is thrown in the converter.");
return}r("mvc-bindings-log-api")&&console.log(t.reverse().join(" is being copied from: ")+" (Value: "+u+" from "+q+")");H.isFunction(g.set)?g.set(e,u):g[e]=u}}var l=H.getObject("dojox.mvc",!0);r.add("mvc-bindings-log-api",(k.mvc||{}).debugBindings);var b=r("mvc-bindings-log-api")?function(c,f,e,g){return[[e.canConvertToLoggable||!e.declaredClass?e:e.declaredClass,g].join(":"),[c.canConvertToLoggable||!c.declaredClass?c:c.declaredClass,f].join(":")]}:"";k={from:1,to:2,both:3};var a=function(c,f,e,
g,d){var h=(d||{}).converter;if(h){var p={source:c,target:e};var q=h.format&&H.hitch(p,h.format);var u=h.parse&&H.hitch(p,h.parse)}var v=[],t=[],x=H.mixin({},c.constraints,e.constraints);h=(d||{}).bindDirection||l.both;var C=(d||{}).equals||a.equals;if(r("mvc-bindings-log-api"))var B=b(c,f,e,g);if("*"==g){if("*"!=f)throw Error("Unmatched wildcard is specified between source and target.");d=e.get("properties");if(!d){d=[];for(var F in e)e.hasOwnProperty(F)&&"_watchCallbacks"!=F&&d.push(F)}t=e.get("excludes")}else d=
[f];h&l.from&&(H.isFunction(c.set)&&H.isFunction(c.watch)?v.push(c.watch.apply(c,("*"!=f?[f]:[]).concat([function(y,w,A){m(q,x,C,e,g,c,y,w,A,t)}]))):r("mvc-bindings-log-api")&&console.log(B.reverse().join(" is not a stateful property. Its change is not reflected to ")+"."),n.forEach(d,function(y){if("*"!=g||!(y in(t||{}))){var w=H.isFunction(c.get)?c.get(y):c[y];m(q,x,C,e,"*"==g?y:g,c,y,void 0,w)}}));h&l.to&&(h&l.from||n.forEach(d,function(y){if("*"!=g||!(y in(t||{}))){var w=H.isFunction(e.get)?e.get(g):
e[g];m(u,x,C,c,y,e,"*"==g?y:g,void 0,w)}}),H.isFunction(e.set)&&H.isFunction(e.watch)?v.push(e.watch.apply(e,("*"!=g?[g]:[]).concat([function(y,w,A){m(u,x,C,c,f,e,y,w,A,t)}]))):r("mvc-bindings-log-api")&&console.log(B.join(" is not a stateful property. Its change is not reflected to ")+"."));r("mvc-bindings-log-api")&&console.log(B.join(" is bound to: "));F={};F.unwatch=F.remove=function(){for(var y=null;y=v.pop();)y.unwatch();r("mvc-bindings-log-api")&&console.log(B.join(" is unbound from: "))};
return F};H.mixin(l,k);return H.setObject("dojox.mvc.sync",H.mixin(a,{equals:function(c,f){return c===f||"number"==typeof c&&isNaN(c)&&"number"==typeof f&&isNaN(f)||H.isFunction((c||{}).getTime)&&H.isFunction((f||{}).getTime)&&c.getTime()==f.getTime()||(H.isFunction((c||{}).equals)?c.equals(f):H.isFunction((f||{}).equals)?f.equals(c):!1)}},k))})},"dojox/mvc/_atBindingExtension":function(){define(["dojo/_base/config","dojo/has","dijit/_WidgetBase","./atBindingExtension"],function(H,k,n,r){k.add("mvc-extension-per-widget",
(H.mvc||{}).extensionPerWidget);k("mvc-extension-per-widget")||r(n.prototype)})},"dojox/mvc/atBindingExtension":function(){define("dojo/aspect dojo/_base/array dojo/_base/lang dijit/_WidgetBase ./_atBindingMixin dijit/registry".split(" "),function(H,k,n,r,m){return function(l){k.forEach(arguments,function(b){b.dataBindAttr?console.warn("Detected a widget or a widget class that has already been applied data binding extension. Skipping..."):(n._mixin(b,m.mixin),H.before(b,"postscript",function(a,c){this._dbpostscript(a,
c)}),H.before(b,"startup",function(){this._started||this._startAtWatchHandles()}),H.before(b,"destroy",function(){this._stopAtWatchHandles()}),H.around(b,"set",function(a){return function(c,f){return c==m.prototype.dataBindAttr?this._setBind(f):"dojox.mvc.at"==(f||{}).atsignature?this._setAtWatchHandle(c,f):a.apply(this,n._toArray(arguments))}}))});return arguments}})},"dojox/mvc/_atBindingMixin":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/has dojo/Stateful ./resolve ./sync".split(" "),
function(H,k,n,r,m,l,b){function a(d){try{var h=require("dijit/registry")}catch(q){return}for(d=d.domNode&&d.domNode.parentNode;d;){if(d=h.getEnclosingWidget(d)){var p=d._relTargetProp||"target";if((k.isFunction(d.get)?d.get(p):d[p])||p in d.constructor.prototype)return d}d=d&&d.domNode.parentNode}}function c(d,h,p,q,u){function v(){t.Two&&t.Two.unwatch();delete t.Two;var F=x&&(k.isFunction(x.get)?x.get(C):x[C]),y=l(d,F);F=l(p,F);r("mvc-bindings-log-api")&&(!y||/^rel:/.test(d)&&!x)&&e(d,h);r("mvc-bindings-log-api")&&
(!F||/^rel:/.test(p)&&!x)&&e(p,q);y&&F&&(!/^rel:/.test(d)&&!/^rel:/.test(p)||x)&&(y.set&&y.watch||"*"!=h?null==h?(k.isFunction(F.set)?F.set(q,y):F[q]=y,r("mvc-bindings-log-api")&&console.log("dojox/mvc/_atBindingMixin set "+y+" to: "+f(F,q))):t.Two=b(y,h,F,q,u):r("mvc-bindings-log-api")&&e(d,h))}var t={},x=a(p),C=x&&x._relTargetProp||"target";v();if(x&&/^rel:/.test(d)||/^rel:/.test(p)&&k.isFunction(x.set)&&k.isFunction(x.watch))t.rel=x.watch(C,function(F,y,w){y!==w&&(r("mvc-bindings-log-api")&&console.log("Change in relative data binding target: "+
x),v())});var B={};B.unwatch=B.remove=function(){for(var F in t)t[F]&&t[F].unwatch(),delete t[F]};return B}var f=r("mvc-bindings-log-api")?function(d,h){return[d._setIdAttr||!d.declaredClass?d:d.declaredClass,h].join(":")}:"",e=r("mvc-bindings-log-api")?function(d,h){console.warn(h+" could not be resolved"+("string"==typeof d?" with "+d:"")+".")}:"",g={dataBindAttr:"data-mvc-bindings",_dbpostscript:function(d,h){h=this._refs=(d||{}).refs||{};for(var p in d)if("dojox.mvc.at"==(d[p]||{}).atsignature){var q=
d[p];delete d[p];h[p]=q}q=new m;var u=this;q.toString=function(){return"[Mixin value of widget "+u.declaredClass+", "+(u.id||"NO ID")+"]"};q.canConvertToLoggable=!0;this._startAtWatchHandles(q);for(p in h)void 0!==q[p]&&((d=d||{})[p]=q[p]);this._stopAtWatchHandles()},_startAtWatchHandles:function(d){this.canConvertToLoggable=!0;var h=this._refs;if(h){var p=this._atWatchHandles=this._atWatchHandles||{};this._excludes=null;for(var q in h)h[q]&&"*"!=q&&(p[q]=c(h[q].target,h[q].targetProp,d||this,q,{bindDirection:h[q].bindDirection,
converter:h[q].converter,equals:h[q].equalsCallback}));"dojox.mvc.at"==(h["*"]||{}).atsignature&&(p["*"]=c(h["*"].target,h["*"].targetProp,d||this,"*",{bindDirection:h["*"].bindDirection,converter:h["*"].converter,equals:h["*"].equalsCallback}))}},_stopAtWatchHandles:function(){for(var d in this._atWatchHandles)this._atWatchHandles[d].unwatch(),delete this._atWatchHandles[d]},_setAtWatchHandle:function(d,h){if("ref"==d)throw Error(this+": 1.7 ref syntax used in conjunction with 1.8 dojox/mvc/at syntax, which is not supported.");
var p=this._atWatchHandles=this._atWatchHandles||{};p[d]&&(p[d].unwatch(),delete p[d]);this._excludes=this[d]=null;this._started?p[d]=c(h.target,h.targetProp,this,d,{bindDirection:h.bindDirection,converter:h.converter,equals:h.equalsCallback}):this._refs[d]=h},_setBind:function(d){d=eval("({"+d+"})");for(var h in d){var p=d[h];"dojox.mvc.at"!=(p||{}).atsignature?console.warn(h+" in "+dataBindAttr+" is not a data binding handle."):this._setAtWatchHandle(h,p)}},_getExcludesAttr:function(){if(this._excludes)return this._excludes;
var d=[],h;for(h in this._atWatchHandles)"*"!=h&&d.push(h);return d},_getPropertiesAttr:function(){if(this.constructor._attribs)return this.constructor._attribs;var d=["onClick"].concat(this.constructor._setterAttrs);H.forEach(["id","excludes","properties","ref","binding"],function(h){h=H.indexOf(d,h);0<=h&&d.splice(h,1)});return this.constructor._attribs=d}};g[g.dataBindAttr]="";n=n("dojox/mvc/_atBindingMixin",null,g);n.mixin=g;return n})},"dojox/mvc/resolve":function(){define(["dojo/_base/lang",
"dijit/registry","dojo/Stateful"],function(H,k){return H.setObject("dojox.mvc.resolve",function(n,r){if("string"==typeof n){var m=n.match(/^(expr|rel|widget):(.*)$/)||[];try{n="rel"==m[1]?H.getObject(m[2]||"",!1,r):"widget"==m[1]?k.byId(m[2]):H.getObject(m[2]||n,!1,r)}catch(l){}}return n})})},"dgrid1/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(H,k,n){return H([k,n],{})})},"dgrid1/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./List ./util/misc dojo/_base/sniff".split(" "),
function(H,k,n,r,m,l,b,a){function c(f,e){e&&e.nodeType&&f.appendChild(e)}H=H(b,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(f){return"object"!==typeof f?this.columns[f]:this.cell(f).column},listType:"grid",cell:function(f,e){if(f.column&&f.element)return f;f.target&&f.target.nodeType&&(f=f.target);if(f.nodeType){do{if(this._rowIdToObject[f.id])break;var g=f.columnId;if(g){e=g;var d=f;break}f=f.parentNode}while(f&&f!==this.domNode)}if(!d&&"undefined"!==
typeof e){var h=this.row(f);if(g=h&&h.element){g=g.getElementsByTagName("td");for(var p=0;p<g.length;p++)if(g[p].columnId===e){d=g[p];break}}}if(null!=f)return{row:h||this.row(f),column:e&&this.column(e),element:d}},createRowCells:function(f,e,g,d,h){var p=n.create("table",{className:"dgrid-row-table",role:"presentation"}),q=9>l("ie")?n.create("tbody",null,p):p,u,v,t;g=g||this.subRows;var x=0;for(u=g.length;x<u;x++){var C=g[x];var B=n.create("tr",null,q);C.className&&(B.className=C.className);var F=
0;for(v=C.length;F<v;F++){var y=C[F];var w=y.id;var A=y.field?" field-"+a.escapeCssIdentifier(y.field,"-"):"";(t="function"===typeof y.className?y.className(d):y.className)&&(A+=" "+t);A=n.create(f,{className:"dgrid-cell"+(w?" dgrid-column-"+a.escapeCssIdentifier(w,"-"):"")+A,role:"th"===f?"columnheader":"gridcell"});A.columnId=w;if(w=y.colSpan)A.colSpan=w;if(w=y.rowSpan)A.rowSpan=w;e(A,y,d,h);B.appendChild(A)}}return p},_createBodyRowCell:function(f,e,g,d){var h=g;e.get?h=e.get(g):"field"in e&&"_item"!==
e.field&&(h=g[e.field]);e.renderCell?c(f,e.renderCell(g,h,f,d)):this._defaultRenderCell.call(e,g,h,f,d)},_createHeaderRowCell:function(f,e){var g=e.headerNode=f,d=e.field;d&&(f.field=d);e.renderHeaderCell?c(g,e.renderHeaderCell(g)):("label"in e||e.field)&&g.appendChild(document.createTextNode("label"in e?e.label:e.field));!1!==e.sortable&&d&&"_item"!==d&&(f.sortable=!0,f.className+=" dgrid-sortable")},left:function(f,e){f.element||(f=this.cell(f));return this.cell(this._move(f,-(e||1),"dgrid-cell"))},
right:function(f,e){f.element||(f=this.cell(f));return this.cell(this._move(f,e||1,"dgrid-cell"))},_defaultRenderCell:function(f,e,g){if(this.formatter){var d=this.formatter,h=this.grid.formatterScope;f="string"===typeof d&&h?h[d](e,f):this.formatter(e,f);null!=f&&f.hasOwnProperty("html")?g.innerHTML=f.html:null!=f&&g.appendChild(document.createTextNode(f))}else null!=e&&g.appendChild(document.createTextNode(e))},renderRow:function(f,e){f=this.createRowCells("td",k.hitch(this,"_createBodyRowCell"),
e&&e.subRows,f,e);e=n.create("div",{role:"row"});e.appendChild(f);return e},renderHeader:function(){var f=this,e=this.headerNode;e.setAttribute("role","row");n.empty(e);var g=this.createRowCells("th",k.hitch(this,"_createHeaderRowCell"),this.subRows&&this.subRows.headerRows);this._rowIdToObject[g.id=this.id+"-header"]=this.columns;e.appendChild(g);this._sortListener&&this._sortListener.remove();this._sortListener=m(g,"click,keydown",function(d){if("click"===d.type||32===d.keyCode||!l("opera")&&13===
d.keyCode){var h=d.target;do if(h.sortable){var p=h.field||h.columnId;var q=f.sort[0];p=f.hasNeutralSort&&q&&q.property===p&&q.descending?[]:[{property:p,descending:q&&q.property===p&&!q.descending}];q={bubbles:!0,cancelable:!0,grid:f,parentType:d.type,sort:p};m.emit(d.target,"dgrid-sort",q)&&(f._sortNode=h,f.set("sort",p));break}while((h=h.parentNode)&&h!==e)}})},resize:function(){var f=this.headerNode.firstChild,e=this.contentNode,g;this.inherited(arguments);e.style.width="";e&&f&&(g=f.offsetWidth)>
e.offsetWidth&&(e.style.width=g+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(){this.inherited(arguments);this.updateSortArrow(this.sort)},_findSortArrowParent:function(f){var e=this.columns,g;for(g in e){var d=e[g];if(d.field===f)return d.headerNode}},updateSortArrow:function(f,e){this._lastSortedArrow&&(this._lastSortedArrow.parentNode&&r.remove(this._lastSortedArrow.parentNode,"dgrid-sort-up dgrid-sort-down"),
n.destroy(this._lastSortedArrow),delete this._lastSortedArrow);e&&(this.sort=f);f[0]&&(e=f[0].property,f=f[0].descending,e=this._sortNode||this._findSortArrowParent(e),delete this._sortNode,e&&(e=e.contents||e,this._lastSortedArrow=n.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"\x26nbsp;",role:"presentation"},e,"first"),r.add(e,"dgrid-sort-"+(f?"down":"up")),this.resize()))},styleColumn:function(f,e){return this.addCssRule("#"+a.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+
a.escapeCssIdentifier(f,"-"),e)},_configColumns:function(f,e){var g=[],d=e instanceof Array;a.each(e,function(h,p){"string"===typeof h&&(e[p]=h={label:h});d||h.field||(h.field=p);p=h.id=h.id||(isNaN(p)?p:f+p);this._configColumn&&(this._configColumn(h,e,f),p=h.id);d&&(this.columns[p]=h);h.grid?h.grid!==this&&console.warn("Sharing column definition objects with multiple grids is not supported.",h.grid,this):h.grid=this;g.push(h)},this);return d?e:g},_destroyColumns:function(){this.cleanup()},configStructure:function(){var f=
this.subRows,e=this._columns=this.columns;this.columns=!e||e instanceof Array?{}:e;if(f)for(e=0;e<f.length;e++)f[e]=this._configColumns(e+"-",f[e]);else this.subRows=[this._configColumns("",e)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(f){this._destroyColumns();this.subRows=null;this.columns=f;this._updateColumns()},_setSubRows:function(f){this._destroyColumns();this.subRows=f;this._updateColumns()},_updateColumns:function(){this.configStructure();this.renderHeader();
this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});H.appendIfNode=c;return H})},"dgrid1/List":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/query dojo/sniff ./util/misc".split(" "),function(H,k,n,r,m,l,b,a){function c(t,x){return l("#"+a.escapeCssIdentifier(t),x)[0]}function f(t,x){t.className="dgrid-scrollbar-measure";
document.body.appendChild(t);x=t["offset"+x]-t["client"+x];t.className="";t.parentNode&&document.body.removeChild(t);return x}function e(t){n.replace(this.domNode,t,this._class||"");this._class=t}function g(){return this._class}var d=[];b("mozilla")&&d.push("has-mozilla");b("touch")&&d.push("has-touch");n.add(document.documentElement,d);b.add("pointer",function(t){return"PointerEvent"in t?"pointer":"MSPointerEvent"in t?"MSPointer":!1});var h,p;b.add("dom-scrollbar-width",function(t,x,C){return f(C,
"Width")});b.add("dom-scrollbar-height",function(t,x,C){return f(C,"Height")});b.add("dom-rtl-scrollbar-left",function(t,x,C){t=document.createElement("div");C.className="dgrid-scrollbar-measure";C.setAttribute("dir","rtl");C.appendChild(t);document.body.appendChild(C);x=!!b("ie")||!!b("trident")||/\bEdge\//.test(navigator.userAgent)||t.offsetLeft>=b("dom-scrollbar-width");C.className="";C.parentNode&&document.body.removeChild(C);r.destroy(t);C.removeAttribute("dir");return x});var q=0,u=function(){this._started&&
this.resize()},v=H(null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,addUiClasses:!0,highlightDuration:250,resizeThrottleDelay:a.defaultDelay,resizeThrottleMethod:"throttleDelayed",postscript:function(t,x){var C=this;(this._Row=function(B,F,y){this.id=B;this.data=F;this.element=y}).prototype.remove=function(){C.removeRow(this.element)};x&&(this.srcNodeRef=x=x.nodeType?x:c(x));this.create(t,x)},listType:"list",create:function(t,x){x=this.domNode=x||document.createElement("div");
if(t){this.params=t;H.safeMixin(this,t);var C=t["class"]||t.className||x.className}this.sort=this.sort||[];this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=x.id=x.id||this.id||v.autoIdPrefix+q++;this.buildRendering();C&&e.call(this,C);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var t=this.domNode,x=this.addUiClasses,C=this;var B=this.isRTL="rtl"===(document.body.dir||document.documentElement.dir||
document.body.style.direction).toLowerCase();t.className="";t.setAttribute("role","grid");n.add(t,"dgrid dgrid-"+this.listType+(x?" ui-widget":""));var F=this.headerNode=r.create("div",{className:"dgrid-header dgrid-header-row"+(x?" ui-widget-header":"")+(this.showHeader?"":" dgrid-header-hidden")},t);var y=this.bodyNode=r.create("div",{className:"dgrid-scroller"},t);b("ff")&&(y.tabIndex=-1);this.headerScrollNode=r.create("div",{className:"dgrid-header dgrid-header-scroll dgrid-scrollbar-width"+(x?
" ui-widget-header":"")},t);this.footerNode=r.create("div",{className:"dgrid-footer"+(this.showFooter?"":" dgrid-footer-hidden")},t);B&&(t.className+=" dgrid-rtl"+(b("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));m(y,"scroll",function(w){C.showHeader&&(F.scrollLeft=w.scrollLeft||y.scrollLeft);w.stopPropagation();m.emit(t,"scroll",{scrollTarget:y})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=r.create("div",{className:"dgrid-content"+(x?" ui-widget-content":"")},this.bodyNode);
"string"===typeof this.resizeThrottleMethod&&a[this.resizeThrottleMethod]?x=a[this.resizeThrottleMethod](u,this,this.resizeThrottleDelay):"function"===typeof this.resizeThrottleMethod?x=this.resizeThrottleMethod(k.hitch(this,u),this.resizeThrottleDelay):(console.warn("Invalid value specified for resizeThrottleMethod:  "+this.resizeThrottleMethod),x=a.throttleDelayed(u,this,this.resizeThrottleDelay));this._resizeHandle=m(window,"resize",x);this._listeners.push(this._resizeHandle)},postCreate:function(){},
startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this.sort))},configStructure:function(){},resize:function(){var t=this.bodyNode,x=this.footerNode;x=this.showFooter?x.offsetHeight:0;this.headerScrollNode.style.height=t.style.marginTop=this.headerNode.offsetHeight+"px";t.style.marginBottom=x+"px";h||(h=b("dom-scrollbar-width"),p=b("dom-scrollbar-height"),b("ie")&&(h++,p++),a.addCssRule(".dgrid-scrollbar-width","width: "+h+"px"),a.addCssRule(".dgrid-scrollbar-height",
"height: "+p+"px"),17!==h&&(a.addCssRule(".dgrid-header-row","right: "+h+"px"),a.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+h+"px")))},addCssRule:function(t,x){t=a.addCssRule(t,x);this.cleanAddedRules&&this._listeners.push(t);return t},on:function(t,x){t=m(this.domNode,t,x);b("dom-addeventlistener")||this._listeners.push(t);return t},cleanup:function(){for(var t in this._rowIdToObject)if(this._rowIdToObject[t]!==this.columns){var x=c(t,this.domNode);x&&this.removeRow(x,!0)}},destroy:function(){if(this._listeners){for(var t=
this._listeners.length;t--;)this._listeners[t].remove();this._listeners=null}this._started=!1;this.cleanup();r.destroy(this.domNode)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoRowId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},highlightRow:function(t,x){var C="dgrid-highlight"+(this.addUiClasses?" ui-state-highlight":"");t=t.element||t;n.add(t,C);setTimeout(function(){n.remove(t,C)},x||this.highlightDuration)},adjustRowIndices:function(t){var x=t.rowIndex;if(-1<
x){do-1<t.rowIndex&&this.setRowIndex(t,x++,t.rowIndex);while((t=t.nextSibling)&&t.rowIndex!==x)}},renderArray:function(t,x,C){C=C||{};var B=C.start||0,F=document.createDocumentFragment(),y=[],w=0,A=t.length;x||(this._lastCollection=t);for(;w<A;)y[w]=this.insertRow(t[w],F,null,B++,C),w++;(t=x?x.parentNode:this.contentNode)&&t.parentNode&&(t!==this.contentNode||A)&&(t.insertBefore(F,x||null),A&&this.adjustRowIndices(y[A-1]));return y},renderHeader:function(){},setRowIndex:function(t,x,C){t.rowIndex=
x;this.maintainOddEven&&(x=1===x%2?"dgrid-row-odd":"dgrid-row-even",void 0!==C?(C=1===C%2?"dgrid-row-odd":"dgrid-row-even",C!==x&&n.replace(t,C,x)):n.add(t,x))},_autoRowId:0,insertRow:function(t,x,C,B,F){var y=this.id+"-row-"+(this.collection&&this.collection.getIdentity?this.collection.getIdentity(t):this._autoRowId++),w=c(y,this.domNode),A=w&&w.previousSibling;w&&(w===C&&(C=(C.connected||C).nextSibling),this.removeRow(w,!1,F));w=this.renderRow(t,F);w.className=(w.className||"")+" dgrid-row "+(this.addUiClasses?
" ui-state-default":"");this._rowIdToObject[w.id=y]=t;x.insertBefore(w,C||null);this.setRowIndex(w,B);A&&A.rowIndex!==w.rowIndex-1&&this.adjustRowIndices(A);return w},renderRow:function(t){var x=document.createElement("div");x.appendChild(document.createTextNode(t));return x},removeRow:function(t,x){t=t.element||t;delete this._rowIdToObject[t.id];x||r.destroy(t)},row:function(t){var x;if(t instanceof this._Row)return t;t.target&&t.target.nodeType&&(t=t.target);if(t.nodeType){do{var C=t.id;if(x=this._rowIdToObject[C])return new this._Row(C.substring(this.id.length+
5),x,t);t=t.parentNode}while(t&&t!==this.domNode)}else return"object"===typeof t?x=this.collection.getIdentity(t):(x=t,t=this._rowIdToObject[this.id+"-row-"+x]),new this._Row(x,t,c(this.id+"-row-"+x,this.domNode))},cell:function(t){return{row:this.row(t)}},_move:function(t,x,C,B){var F;var y=F=t.element;x=x||1;do if(t=F[0>x?"previousSibling":"nextSibling"]){do if((F=t)&&-1<(F.className+" ").indexOf(C+" ")){y=F;x+=0>x?1:-1;break}while(t=(!B||!F.hidden)&&F[0>x?"lastChild":"firstChild"])}else if(F=F.parentNode,
!F||F===this.bodyNode||F===this.headerNode)break;while(x);return y},up:function(t,x,C){t.element||(t=this.row(t));return this.row(this._move(t,-(x||1),"dgrid-row",C))},down:function(t,x,C){t.element||(t=this.row(t));return this.row(this._move(t,x||1,"dgrid-row",C))},scrollTo:function(t){"undefined"!==typeof t.x&&(this.bodyNode.scrollLeft=t.x);"undefined"!==typeof t.y&&(this.bodyNode.scrollTop=t.y)},getScrollPosition:function(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}},get:function(t){var x=
"_get"+t.charAt(0).toUpperCase()+t.slice(1);return"function"===typeof this[x]?this[x].apply(this,[].slice.call(arguments,1)):this[t]},set:function(t,x){if("object"===typeof t)for(var C in t)this.set(C,t[C]);else C="_set"+t.charAt(0).toUpperCase()+t.slice(1),"function"===typeof this[C]?this[C].apply(this,[].slice.call(arguments,1)):this[t]=x;return this},_getClass:g,_setClass:e,_getClassName:g,_setClassName:e,_setSort:function(t,x){this.sort="string"!==typeof t?t:[{property:t,descending:x}];this._applySort()},
_applySort:function(){this.refresh();if(this._lastCollection){var t=this.sort;if(t&&0<t.length){var x=t[0].property,C=!!t[0].descending;this._lastCollection.sort(function(B,F){B=B[x];F=F[x];void 0===B&&(B="");void 0===F&&(F="");return B===F?0:B>F!==C?1:-1})}this.renderArray(this._lastCollection)}},_setShowHeader:function(t){var x=this.headerNode;this.showHeader=t;n.toggle(x,"dgrid-header-hidden",!t);this.renderHeader();this.resize();t&&(x.scrollLeft=this.getScrollPosition().x)},_setShowFooter:function(t){this.showFooter=
t;n.toggle(this.footerNode,"dgrid-footer-hidden",!t);this.resize()}});v.autoIdPrefix="dgrid_";return v})},"dgrid1/util/misc":function(){define(["dojo/has"],function(H){var k=[],n,r,m,l=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,b=setTimeout,a=clearTimeout;H.add("requestidlecallback",function(f){return"function"===typeof f.requestIdleCallback});var c={defaultDelay:15,throttle:function(f,e,g){var d=!1;g=g||c.defaultDelay;return function(){d||(d=!0,f.apply(e,arguments),b(function(){d=!1},g))}},throttleDelayed:function(f,
e,g){var d=!1;g=g||c.defaultDelay;return function(){if(!d){d=!0;var h=arguments;b(function(){d=!1;f.apply(e,h)},g)}}},debounce:function(f,e,g){var d;g=g||c.defaultDelay;return function(){d&&(a(d),d=null);var h=arguments;d=b(function(){d=null;f.apply(e,h)},g)}},each:function(f,e,g){var d;if(f)if("number"===typeof f.length){var h=0;for(d=f.length;h<d;h++)e.call(g,f[h],h,f)}else for(h in f)e.call(g,f[h],h,f)},addCssRule:function(f,e){n||(n=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(n),
n=n.sheet||n.styleSheet,r=n.deleteRule?"deleteRule":"removeRule",m=n.cssRules?"cssRules":"rules");var g=k.length;k[g]=(n.cssRules||n.rules).length;n.addRule?n.addRule(f,e):n.insertRule(f+"{"+e+"}",k[g]);return{get:function(d){return n[m][k[g]].style[d]},set:function(d,h){"undefined"!==typeof k[g]&&(n[m][k[g]].style[d]=h)},remove:function(){var d=k[g],h;if(void 0!==d){n[r](d);k[g]=void 0;var p=g+1;for(h=k.length;p<h;p++)k[p]>d&&k[p]--}}}},escapeCssIdentifier:function(f,e){return"string"===typeof f?
f.replace(l,e||"\\$1"):f}};return c})},"dgrid1/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/on dojo/when dojo/query ./util/misc".split(" "),function(H,k,n,r,m,l,b,a,c){function f(d){return d&&(0<=d.className.indexOf("dgrid-row")||0<=d.className.indexOf("dgrid-loading"))}function e(d){return d&&0<=d.className.indexOf("dgrid-preload")}var g=0;return n([H,k],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,
farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:c.defaultDelay,keepScrollPosition:!1,rowHeight:0,_deleteQueue:[],postCreate:function(){this.inherited(arguments);var d=this;l(this.bodyNode,"scroll",c[this.pagingMethod](function(h){d._processScroll(h)},null,this.pagingDelay))},renderQuery:function(d,h){var p=this,q=h&&h.container||this.contentNode,u,v=0,t=h&&h.start||0;"level"in d&&(v=u=d.level);var x={query:d,count:0,level:v,top:!1};var C={node:m.create("div",{className:"dgrid-preload",
style:{height:"0"}},q),count:0,query:d,next:x,level:v,top:!0};var B=C.node;B.rowIndex=0;x.previous=C;var F=x.node=m.create("div",{className:"dgrid-preload",style:{height:"0"}},q);C.id=g++;B.setAttribute("data-preloadid",C.id);x.id=g++;F.setAttribute("data-preloadid",x.id);F.rowIndex=this.minRowsPerPage;p._insertPreload(C);var y=m.create("div",{className:"dgrid-loading"},F,"before");m.create("div",{className:"dgrid-below"},y).innerHTML=this.loadingMessage;h=r.mixin({start:0,count:this.minRowsPerPage},
h);null!=u&&(h.queryLevel=u);return this._trackError(function(){var w=d(h);return p.renderQueryResults(w,F,h).then(function(A){return w.totalLength.then(function(z){var G=A.length,I=F.parentNode;!p._rows||"queryLevel"in h||(p._rows.min=0,p._rows.max=G===z?Infinity:G-1);m.destroy(y);"queryLevel"in h||(p._total=z);0===z&&I&&(p.noDataNode&&m.destroy(p.noDataNode),p._insertNoDataNode(I));C.count=t;x.count=z-G-t;F.rowIndex=t+G;z?p._updatePreloadRowHeights(C):(F.style.display="none",B.style.display="none");
p._previousScrollPosition&&I&&I.offsetHeight&&(p.scrollTo(p._previousScrollPosition),delete p._previousScrollPosition);return b(p._processScroll()).then(function(){return A})})}).otherwise(function(A){m.destroy(y);throw A;})})},_insertPreload:function(d){var h=this.preload;if(h){for(;h.node.compareDocumentPosition(d.node)&Node.DOCUMENT_POSITION_PRECEDING;)if(h=h.previous,null==h)return;for(;h.node.compareDocumentPosition(d.node)&Node.DOCUMENT_POSITION_FOLLOWING&&h.next;)h=h.next;h.previous.next=d;
d.previous=h.previous;d=d.next;d.next=h;h.previous=d}else this.preload=d},refresh:function(d){var h=this,p=d&&d.keepScrollPosition,q;"undefined"===typeof p&&(p=this.keepScrollPosition);p&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this._renderedCollection)return this.renderQuery(function(u){u=h._renderedCollection.fetchRange({start:u.start,end:u.start+u.count});u.then(function(v){q=v});return u}).then(function(){h._emitRefreshComplete();return q})},resize:function(){this.inherited(arguments);
this._processScroll()},cleanup:function(){this.inherited(arguments);this.preload=null},renderQueryResults:function(d){var h=this.inherited(arguments),p=this._getRenderedCollection(this.preload);p&&p.releaseRange&&h.then(function(q){q[0]&&!q[0].parentNode.tagName&&d.totalLength.then(function(){p.releaseRange(q[0].rowIndex,q[q.length-1].rowIndex+1)})});return h},_getFirstRowSibling:function(d){return d.lastChild},_calcRowHeight:function(d){var h=d.nextSibling;return h&&!/\bdgrid-preload\b/.test(h.className)?
h.offsetTop-d.offsetTop:d.offsetHeight},_calcAverageRowHeight:function(d){for(var h=d.length,p=0,q=0;q<h;q++)p+=this._calcRowHeight(d[q]);return h&&p?p/h:0},_updatePreloadRowHeights:function(){var d=this.preload,h=0;if(d){for(;d.previous;)d=d.previous;for(;d;)d.rowHeight||(d.rowHeight=this._calcAverageRowHeight(d.node.parentNode.querySelectorAll(".dgrid-row")),this._adjustPreloadHeight(d)),h=d?d.rowHeight:h,d=d.next;this.rowHeight=h}},lastScrollTop:0,_processScroll:function(d){function h(X,ea){ea=
ea?"next":"previous";for(var fa;fa=X[ea];)X=fa;return X}function p(X,ea){function fa(){a:{var U=!ea;for(var da=X;da=da[ea?"previous":"next"];)if(U===da.top){U=da;break a}U=void 0}if(U&&aa!==U&&!e(U.top?U.node.nextSibling:U.node.previousSibling))return V(),X=U,O=X.node,Z=ea?X.node.offsetTop-B:C-(X.node.offsetTop+X.node.offsetHeight),oa=(U=J(O))&&U.rowIndex,ca=void 0,U}function J(U){var da=e(U);(U=U[D])&&!f(U)&&(U=da&&e(U)?null:(da=fa())?da:J(U));return U}function V(){X.count+=P;ea&&(O.rowIndex-=P);
t._adjustPreloadHeight(X);P=0;t._releaseRange(X,ea,oa,ca)}var aa=X;X=h(X,ea);var Z=ea?X.node.offsetTop-B:C-(X.node.offsetTop+X.node.offsetHeight),L=t.farOffRemoval,O=X.node,D=ea?"previousSibling":"nextSibling",P=0,R=0,ca;if(Z>2*L){var ha;var oa=(ha=J(O))&&ha.rowIndex;for(ca=void 0;ha&&aa!==X;){var ma=t._calcRowHeight(ha);R+ma+L>Z||!f(ha)?ha=fa():(R+=ma,P+=ha.count||1,t._pruneRow(ha,ea),"rowIndex"in ha&&(ca=ha.rowIndex),ha=J(ha))}V();t._deleteNodeQueue()}}function q(X,ea){do X=ea?X.next:X.previous;
while(X&&!X.node.offsetWidth);return X}var u=this.preload,v;this._updatePreloadRowHeights();if(v=u&&u.rowHeight){var t=this,x=t.bodyNode,C=d&&d.scrollTop||this.getScrollPosition().y,B=x.offsetHeight+C;d=t.lastScrollTop;x=t.bufferRows*v;var F=x-v,y,w=!0;for(t.lastScrollTop=C;u&&!u.node.offsetWidth;)u=u.previous;for(;u&&u!==A;){var A=t.preload;t.preload=u;v=u.node;var z=v.offsetTop;if(B+1+F<z)u=q(u,w=!1);else if(C-1-F>z+v.offsetHeight)u=q(u,w=!0);else{z=((v.top?C-x:B)-z)/u.rowHeight;var G=(B-C+2*x)/
u.rowHeight;G+=Math.min(Math.abs(Math.max(Math.min((C-d)*u.rowHeight,t.maxRowsPerPage/2),t.maxRowsPerPage/-2)),10);v.top&&(z-=G);z=Math.max(z,0);10>z&&0<z&&G+z<t.maxRowsPerPage&&(G+=Math.max(0,z),z=0);G=Math.min(Math.max(G,t.minRowsPerPage),t.maxRowsPerPage,u.count);if(0===G)u=q(u,w);else{G=Math.ceil(G);z=Math.min(Math.floor(z),u.count-G);var I={};u.count-=G;var K=v,Q=t.queryRowsOverlap,N=!u.top&&u;if(N)u.previous&&(p(u),0<z&&e(v.previousSibling)?(z=Math.min(u.count,z),u.previous.count+=z,t._adjustPreloadHeight(u.previous,
!0),v.rowIndex+=z,Q=0):G+=z,u.count-=z),I.start=v.rowIndex-Q,I.count=Math.min(G+Q,t.maxRowsPerPage),v.rowIndex=I.start+I.count;else{if(u.next)if(K=v.nextSibling,p(u,!0),e(v.nextSibling))u.next.count+=u.count-z,u.next.node.rowIndex=z+G,t._adjustPreloadHeight(u.next),u.count=z,Q=0,K=u.next.node;else var T=!0;I.start=u.count;I.count=Math.min(G+Q,t.maxRowsPerPage);I.scrollingUp=!0}T&&K&&K.offsetWidth&&(T=K.offsetTop);t._adjustPreloadHeight(u);"level"in u.query&&(I.queryLevel=u.query.level);if("queryLevel"in
I||!(I.start>t._total||0>I.count)){var W=m.create("div",{className:"dgrid-loading",style:{height:G*u.rowHeight+"px"}},K,"before");m.create("div",{className:"dgrid-"+(N?"below":"above"),innerHTML:t.loadingMessage},W);W.count=G;t._trackError(function(){(function(X,ea,fa){var J=u.query(I);y=t.renderQueryResults(J,X,I).then(function(V){var aa=t._rows;!aa||"queryLevel"in I||!V.length||(ea?(aa.max<=aa.min&&(aa.min=V[0].rowIndex),aa.max=V[V.length-1].rowIndex):(aa.max<=aa.min&&(aa.max=V[V.length-1].rowIndex),
aa.min=V[0].rowIndex));K=X.nextSibling;m.destroy(X);fa&&K&&K.offsetWidth&&t.scrollTo({y:t.bodyNode.scrollTop+K.offsetTop-fa});J.totalLength.then(function(Z){"queryLevel"in I||(t._total=Z,t._rows&&t._rows.max>=t._total-1&&(t._rows.max=Infinity));ea&&(ea.count=Z-ea.node.rowIndex,t._adjustPreloadHeight(ea))});t._processScroll();return V},function(V){m.destroy(X);throw V;})})(W,N,T)});u=u.previous}}}}return y}},_adjustPreloadHeight:function(d,h){d.node.style.height=this._calculatePreloadHeight(d,h)+"px"},
_calculatePreloadHeight:function(d,h){return Math.min(d.count*d.rowHeight,h?Infinity:this.maxEmptySpace)},_pruneRow:function(d,h,p){this.removeRow(d,!0,p);this._queueNodeForDeletion(d)},_queueNodeForDeletion:function(d){this._deleteQueue.push(d)},_deleteNodeQueue:function(){for(var d=document.createElement("div"),h=this._deleteQueue,p=h.length;p--;)d.appendChild(h[p]);this._deleteQueue=[];setTimeout(function(){m.destroy(d)},1)},_removePreloads:function(d){if(d&&d.length){var h=this,p=this._getHeadPreload();
d.forEach(function(q){if(q=h._findPreload(q,p))q.previous&&(q.previous.next=q.next),q.next&&(q.next.previous=q.previous)})}},_getHeadPreload:function(){var d=this.preload;if(d)for(;d.previous;)d=d.previous;return d},_findPreload:function(d,h){for(h||(h=this._getHeadPreload());h;){if(h.node===d)return h;h=h.next}},_getRenderedCollection:function(){return this._renderedCollection},_releaseRange:function(d,h,p,q){if(d){var u=d.level;d=this._getRenderedCollection(d);null!=q&&d.releaseRange&&"number"===
typeof p&&"number"===typeof q&&(h?d.releaseRange(q,p+1):d.releaseRange(p,q+1),this._rows&&!u&&(this._rows[h?"max":"min"]=q,this._rows.max>=this._total-1&&(this._rows.max=Infinity)))}}})})},"dgrid1/_StoreMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/dom-construct dojo/has dojo/on dojo/when".split(" "),function(H,k,n,r,m,l,b,a){function c(f){if("object"!==typeof f)f=Error(f);else if("cancel"===f.dojoType)return;b.emit(this.domNode,"dgrid-error",{grid:this,
error:f,cancelable:!0,bubbles:!0})&&console.error(f)}return H(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,_structureHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",loadingMessage:"",_total:0,constructor:function(){this.dirty={};this._updating={};this._columnsWithSet={};this._structureHandle=r.before(this,"configStructure",k.hitch(this,function(){this._columnsWithSet={}}))},destroy:function(){this.inherited(arguments);this._structureHandle&&
this._structureHandle.remove();this._renderedCollection&&this._cleanupCollection();this._refreshTimeout&&clearTimeout(this._refreshTimeout)},_configColumn:function(f){f.set&&(this._columnsWithSet[f.field]=f);this.inherited(arguments)},_setCollection:function(f){this._renderedCollection&&(this.cleanup(),this._cleanupCollection({shouldRevert:!f||f.storage!==this._renderedCollection.storage}));this.collection=f;if(this._started){if(f){var e=f;this.sort&&0<this.sort.length&&(e=f.sort(this.sort));e.track&&
this.shouldTrackCollection&&(e=e.track(),this._rows=[],this._observerHandle=this._observeCollection(e,this.contentNode,{rows:this._rows}));this._renderedCollection=e}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection')")},_getTotal:function(){return this._total},_cleanupCollection:function(f){f=f||{};this._observerHandle&&(this._observerHandle.remove(),this._observerHandle=this._rows=null);!1!==f.shouldRevert&&(this.dirty=
{});this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},_emitRefreshComplete:function(){var f=this;this._refreshTimeout=setTimeout(function(){b.emit(f.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:f});f._refreshTimeout=null},0)},_insertNoDataNode:function(f){this._removeNoDataNode();
f=f||this.contentNode;var e=this.noDataNode=m.create("div",{className:"dgrid-no-data",innerHTML:this.noDataMessage});f.insertBefore(e,this._getFirstRowSibling?this._getFirstRowSibling(f):null);return e},_removeNoDataNode:function(){return this.noDataNode?(m.destroy(this.noDataNode),delete this.noDataNode,!0):!1},row:function(){var f=this.inherited(arguments);f&&f.data&&"undefined"!==typeof f.id&&(f.id=this.collection.getIdentity(f.data));return f},refresh:function(){var f=this.inherited(arguments);
this.collection||this._insertNoDataNode();return f},refreshCell:function(f){if(!this.collection||!this._createBodyRowCell)throw Error("refreshCell requires a Grid with a collection.");this.inherited(arguments);return this.collection.get(f.row.id).then(k.hitch(this,"_refreshCellFromItem",f))},_refreshCellFromItem:function(f,e,g){var d=f.element;m.empty(d);var h=this.dirty&&this.dirty[f.row.id];h&&(e=k.delegate(e,h));this._createBodyRowCell(d,f.column,e,g)},renderArray:function(){var f=this.inherited(arguments);
this.collection||f.length&&this.noDataNode&&m.destroy(this.noDataNode);return f},insertRow:function(f,e,g,d,h){var p=this.collection,q=this.dirty;p=p&&p.getIdentity(f);var u;p in q&&!(p in this._updating)&&(u=q[p]);u&&(f=k.delegate(f,u));q=this.inherited(arguments);h&&h.rows&&(h.rows[d]=q);this.noDataNode&&(m.destroy(this.noDataNode),this.noDataNode=null);return q},updateDirty:function(f,e,g){var d=this.dirty,h=d[f];h||(h=d[f]={});h[e]=g},save:function(){function f(x,C){return function(B){var F=e._columnsWithSet,
y=e._updating,w;if("function"===typeof B.set)B.set(C);else for(w in C)B[w]=C[w];for(w in F){var A=F[w].set(B);void 0!==A&&(B[w]=A)}y[x]=!0;return g.put(B).then(function(z){delete d[x];delete y[x];p[x]=z;return p})}}var e=this,g=this.collection,d=this.dirty,h=new n,p={},q=function(x){var C;return e.getBeforePut||!(C=e.row(x).data)?function(){return g.get(x)}:function(){return C}},u=h.then(function(){return p}),v;for(v in d){var t=f(v,d[v]);u=u.then(q(v)).then(t)}h.resolve();return u},revert:function(){this.dirty=
{};this.refresh()},_trackError:function(f){"string"===typeof f&&(f=k.hitch(this,f));var e=this;try{var g=a(f())}catch(d){f=new n,f.reject(d),g=f.promise}g.otherwise(function(d){c.call(e,d)});return g},removeRow:function(f,e,g){var d={element:f};e||this.up(d).element!==f||this.down(d).element!==f||this._insertNoDataNode();(d=g&&g.rows||this._rows)&&delete d[f.rowIndex];return this.inherited(arguments)},renderQueryResults:function(f,e,g){g=k.mixin({rows:this._rows},g);var d=this;return f.then(function(h){h=
d.renderArray(h,e,g);delete d._lastCollection;return h})},_observeCollection:function(f,e,g){var d=this,h=g.rows,p,q=[f.on("delete, update",function(u){var v=u.previousIndex,t=u.index;void 0!==v&&h[v]&&("max"in h&&(void 0===t||t<h.min||t>h.max)&&h.max--,0>h.max&&(h.max=0),p=h[v],p.parentNode===e&&d.removeRow(p,!1,g),h.splice(v,1),("delete"===u.type||"update"===u.type&&(v<t||void 0===t))&&h[v]&&h[v].rowIndex--);"delete"===u.type&&(p=null)}),f.on("add, update",function(u){var v=u.previousIndex,t=u.index;
if(void 0!==t&&(!("max"in h)||t>=h.min&&t<=h.max)){"max"in h&&(void 0===v||v<h.min||v>h.max)&&h.max++;if(h.length){if(v=h[t],!v&&(v=h[t-1]))v=(v.connected||v).nextSibling}else v=d._getFirstRowSibling&&d._getFirstRowSibling(e);p&&v&&p.id===v.id&&(v=(v.connected||v).nextSibling);v&&!v.parentNode&&(v=document.getElementById(v.id));h.splice(t,0,void 0);p=d.insertRow(u.target,e,v,t,g);d.highlightRow(p)}p=null}),f.on("add, delete, update",function(u){var v="undefined"!==typeof u.previousIndex?u.previousIndex:
Infinity,t="undefined"!==typeof u.index?u.index:Infinity,x=Math.min(v,t);v!==t&&h[x]&&d.adjustRowIndices(h[x]);Infinity!==v&&d._processScroll&&(h[v]||h[v-1])&&d._processScroll();d._onNotification(h,u,f);f===d._renderedCollection&&"totalLength"in u&&(d._total=u.totalLength)})];return{remove:function(){for(;0<q.length;)q.pop().remove()}}},_onNotification:function(){}})})},"dgrid1/Tree":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/dom-construct dojo/dom-class dojo/on dojo/promise/all dojo/query dojo/when ./util/has-css3 ./Grid dojo/has!touch?./util/touch".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h){return H(null,{collapseOnRefresh:!1,enableTreeTransitions:!0,treeIndentWidth:9,constructor:function(){this._treeColumnListeners=[]},shouldExpand:function(p,q,u){return u},expand:function(p,q,u,v){function t(){y||x._processScroll&&x._processScroll()}if(!this._treeColumn)return e();var x=this,C=p.element?p:this.row(p),B=!!this._expanded[C.id],F=g("transitionend");p=C.element;p=-1<p.className.indexOf("dgrid-expando-icon")?p:f(".dgrid-expando-icon",p)[0];u=u||!this.enableTreeTransitions;
if(p&&p.mayHaveChildren&&(u||q!==B)){var y=void 0===q?!this._expanded[C.id]:q,w=this.getScrollPosition();this._resetExpanded(C.id,y);b.replace(p,"ui-icon-triangle-1-"+(y?"se":"e"),"ui-icon-triangle-1-"+(y?"e":"se"));b.toggle(C.element,"dgrid-row-expanded",y);q=C.element;var A=q.connected,z={};if(!A){A=z.container=q.connected=l.create("div",{className:"dgrid-tree-container"},q,"after");var G=function(T){var W=x._renderedCollection.getChildren(C.data);x.sort&&0<x.sort.length&&(W=W.sort(x.sort));W.track&&
x.shouldTrackCollection&&(A._rows=T.rows=[],W=W.track(),A._handles=[W.tracking,x._observeCollection(W,A,T)]);G.collection=W;return"start"in T?W.fetchRange({start:T.start,end:T.start+T.count}):W.fetch()};"level"in p&&(A.level=G.level=p.level+1);if(this.renderQuery)var I=v?x._renderedCollection.getChildren(C.data).fetchRange({start:0,end:1}).totalLength.then(function(T){z.start=T-x.minRowsPerPage;z.end=T-1;z.count=x.minRowsPerPage;x._previousScrollPosition=w;return x.renderQuery(G,z)}):this.renderQuery(G,
z);else{var K=l.create("div",null,A);I=this._trackError(function(){return x.renderQueryResults(G(z),K,k.mixin({rows:z.rows},"level"in G?{queryLevel:G.level}:null)).then(function(T){l.destroy(K);return T})})}F&&a(A,F,this._onTreeTransitionEnd)}A.hidden=!y;var Q=A.style;if(!F||u)Q.display=y?"block":"none",Q.height="",t();else{a.once(A,F,t);if(y){Q.display="block";var N=A.scrollHeight;Q.height="0px"}else b.add(A,"dgrid-tree-resetting"),Q.height=A.scrollHeight+"px";setTimeout(function(){b.remove(A,"dgrid-tree-resetting");
Q.height=y?N?N+"px":"auto":"0px"},0)}}return e(I)},_configColumns:function(){var p=this.inherited(arguments);this._resetExpanded();for(var q=0,u=p.length;q<u;q++)if(p[q].renderExpando){this._configureTreeColumn(p[q]);break}return p},insertRow:function(p,q,u,v,t){t=t||{};var x=t.queryLevel="queryLevel"in t?t.queryLevel:"level"in q?q.level:0,C=this.inherited(arguments),B=this.row(C);(x=this.shouldExpand(B,x,this._expanded[B.id]))&&this._expandWhenInDom(C,t);(x||!this.collection.mayHaveChildren||this.collection.mayHaveChildren(p))&&
b.add(C,"dgrid-row-expandable");return C},_expandWhenInDom:function(p,q,u){p.offsetHeight?(p=this.expand(p,!0,!0,q.scrollingUp),u&&p.then(function(){u.resolve()})):p.parentNode&&this.domNode.offsetHeight&&(this._expandPromises&&!u&&(u=new m,this._expandPromises.push(u.promise)),setTimeout(this._expandWhenInDom.bind(this,p,q,u),0))},_queueNodeForDeletion:function(p){this.inherited(arguments);var q=p.connected;q&&this._deleteQueue.push(q)},_pruneRow:function(p,q){var u=p.connected,v;if(u){var t=this.row(p).id;
this._expanded[t]&&(v=f("\x3e.dgrid-preload",u)[q?1:0])&&(v=this._findPreload(v),v=q?v.next:v.previous,v.expandedContent||(v.expandedContent={}),v.expandedContent[t]=u.offsetHeight)}this.inherited(arguments,[p,q,{treePrune:!0,removeBelow:q}])},refresh:function(p){this._expandPromises=[];var q=(this.keepScrollPosition||p&&p.keepScrollPosition)&&Object.keys(this._expanded).length?this.inherited(arguments,k.mixin(p||{},{keepScrollPosition:!1})):this.inherited(arguments);return e(q).then(function(){var u=
this._expandPromises;delete this._expandPromises;return c(u)}.bind(this))},removeRow:function(p,q,u){var v=p.connected,t={};if(v){v._handles&&(n.forEach(v._handles,function(y){y.remove()}),delete v._handles);v._rows&&(t.rows=v._rows);var x=f("\x3e.dgrid-row",v);var C=f("\x3e.dgrid-preload",v);if(x&&x.length){if(this._releaseRange){var B=x[0].rowIndex;var F=x[x.length-1].rowIndex;this._releaseRange(this._findPreload(C[0]),!1,B,F)}x.forEach(function(y){u&&u.treePrune?this._pruneRow(y,u.removeBelow):
this.removeRow(y,!0,t)},this)}this._removePreloads&&this._removePreloads(C);v._rows&&(v._rows.length=0,delete v._rows);q?this._queueNodeForDeletion(v):l.destroy(v)}this.inherited(arguments)},_refreshCellFromItem:function(p,q){if(!p.column.renderExpando)return this.inherited(arguments);this.inherited(arguments,[p,q,{queryLevel:f(".dgrid-expando-icon",p.element)[0].level}])},cleanup:function(){this.inherited(arguments);this.collapseOnRefresh&&this._resetExpanded()},_destroyColumns:function(){this.inherited(arguments);
for(var p=this._treeColumnListeners,q=p.length;q--;)p[q].remove();this._treeColumnListeners=[];this._treeColumn=null},_calcRowHeight:function(p){var q=p.connected;return this.inherited(arguments)+(q?q.offsetHeight:0)},_configureTreeColumn:function(p){var q=this,u=".dgrid-content .dgrid-column-"+p.id,v;this._treeColumn=p;if(!p._isConfiguredTreeColumn){var t=p.renderCell||this._defaultRenderCell;p._isConfiguredTreeColumn=!0;p.renderCell=function(C,B,F,y){var w=y&&"queryLevel"in y?y.queryLevel:0,A=!q.collection.mayHaveChildren||
q.collection.mayHaveChildren(C);var z=p.renderExpando(w,A,q._expanded[q.collection.getIdentity(C)],C);z.level=w;z.mayHaveChildren=A;(C=t.call(p,C,B,F,y))&&C.nodeType?(F.appendChild(z),F.appendChild(C)):F.insertBefore(z,F.firstChild)};"function"!==typeof p.renderExpando&&(p.renderExpando=this._defaultRenderExpando)}var x=this._treeColumnListeners;0===x.length&&(x.push(this.on(p.expandOn||".dgrid-expando-icon:click,"+u+":dblclick,"+u+":keydown",function(C){var B=q.row(C);q.collection.mayHaveChildren&&
!q.collection.mayHaveChildren(B.data)||"keydown"===C.type&&32!==C.keyCode||"dblclick"===C.type&&v&&1<v.count&&B.id===v.id&&-1<C.target.className.indexOf("dgrid-expando-icon")||q.expand(B);-1<C.target.className.indexOf("dgrid-expando-icon")&&(v&&v.id===q.row(C).id?v.count++:v={id:q.row(C).id,count:1})})),g("touch")&&x.push(this.on(h.selector(u,h.dbltap),function(){q.expand(this)})))},_defaultRenderExpando:function(p,q,u){var v=this.grid.isRTL?"right":"left",t="dgrid-expando-icon";q&&(t+=" ui-icon ui-icon-triangle-1-"+
(u?"se":"e"));return l.create("div",{className:t,innerHTML:"\x26nbsp;",style:"margin-"+v+": "+p*this.grid.treeIndentWidth+"px; float: "+v+";"})},_onNotification:function(p,q){"delete"===q.type&&this._resetExpanded(q.id);this.inherited(arguments)},_onTreeTransitionEnd:function(p){var q=this,u=this.style.height;u&&(this.style.display="0px"===u?"none":"block");p&&(b.add(this,"dgrid-tree-resetting"),setTimeout(function(){b.remove(q,"dgrid-tree-resetting")},0));this.style.height=""},_resetPlaceHolder:function(p){var q=
this._getHeadPreload&&this._getHeadPreload();if(q)if(null!=p)a:for(;q;){var u=q.expandedContent;if(u&&u[p]){delete u[p];this._adjustPreloadHeight(q);break a}q=q.next}else for(p=q;p;)p.expandedContent&&(delete p.expandedContent,this._adjustPreloadHeight(p)),p=p.next},_resetExpanded:function(p,q){this._resetPlaceHolder(p);null==p?this._expanded={}:q?this._expanded[p]=!0:delete this._expanded[p]},_calculatePreloadHeight:function(p){var q=this.inherited(arguments),u=p.expandedContent;u&&Object.keys(u).forEach(function(v){q+=
u[v]});return q},_getRenderedCollection:function(p){return p.level?p.query.collection:this.inherited(arguments)}})})},"dgrid1/util/has-css3":function(){define(["dojo/has"],function(H){function k(r,m){r=r.style;var l;if(m in r)return!0;m=m.slice(0,1).toUpperCase()+m.slice(1);for(l=n.length;l--;)if(n[l]+m in r)return n[l];return!1}var n=["ms","O","Moz","Webkit"];H.add("css-transitions",function(r,m,l){return k(l,"transitionProperty")});H.add("css-transforms",function(r,m,l){return k(l,"transform")});
H.add("css-transforms3d",function(r,m,l){return k(l,"perspective")});H.add("transitionend",function(){var r=H("css-transitions");return r?!0===r?"transitionend":{ms:"MSTransitionEnd",O:"oTransitionEnd",Moz:"transitionend",Webkit:"webkitTransitionEnd"}[r]:!1});return H})},"dgrid1/Editor":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/dom-construct dojo/dom-class dojo/on dojo/query dojo/sniff ./Grid".split(" "),function(H,k,n,r,m,l,b,a,c,f){return k(null,{editorFocusWrapperClassName:"dgrid-editor-focus-wrapper",
constructor:function(){this._editorInstances={};this._editorColumnListeners=[];this._editorCellListeners={};this._editorsPendingStartup=[]},postCreate:function(){var e=this;this.inherited(arguments);this.on(".dgrid-input:focusin",function(){e._focusedEditorCell=e.cell(this)});this._editorFocusoutHandle=b.pausable(this.domNode,".dgrid-input:focusout",function(g){e._focusedEditorCell&&e._focusedEditorCell.element.contains(g.target)||(e._focusedEditorCell=null)});this._listeners.push(this._editorFocusoutHandle)},
insertRow:function(){this._editorRowListeners={};var e=this.inherited(arguments),g=this.row(e),d=this._editorCellListeners[e.id]=this._editorCellListeners[e.id]||{},h;for(h in this._editorRowListeners)d[h]=this._editorRowListeners[h];this._editorRowListeners=null;(d=this._previouslyFocusedEditorCell)&&d.row.id===g.id&&(this.edit(this.cell(g,d.column.id)),this._previouslyFocusedEditorCell=null);return e},refresh:function(){for(var e in this._editorInstances){var g=this._getEditorRootNode(this._editorInstances[e].domNode);
g&&g.parentNode&&(this._removeEditorBlurHandles(),g.parentNode.removeChild(g))}return this.inherited(arguments)},removeRow:function(e){var g=this,d=this._focusedEditorCell,h=this.row(e);d&&h&&d.row.id===h.id&&(this._previouslyFocusedEditorCell=d,this._editorFocusoutHandle.pause(),setTimeout(function(){g._editorFocusoutHandle.resume();g._previouslyFocusedEditorCell=null},0));if(this._editorCellListeners[e.id]){for(var p in this._editorCellListeners[e.id])this._editorCellListeners[e.id][p].remove();
delete this._editorCellListeners[e.id]}for(d=this._alwaysOnWidgetColumns.length;d--;)if(h=(h=this.cell(e,this._alwaysOnWidgetColumns[d].id).element)&&(h.contents||h).widget)this._editorFocusoutHandle.pause(),h.destroyRecursive(),this._editorFocusoutHandle.resume();return this.inherited(arguments)},renderArray:function(){var e=this.inherited(arguments);e.length?this._startupPendingEditors():this._editorsPendingStartup=[];return e},_onNotification:function(){this.inherited(arguments);this._startupPendingEditors()},
_destroyColumns:function(){this._editorStructureCleanup();this.inherited(arguments)},_editorStructureCleanup:function(){var e=this._editorInstances,g=this._editorColumnListeners;this._editTimer&&clearTimeout(this._editTimer);for(var d in e){var h=e[d];h.domNode&&h.destroyRecursive()}this._editorInstances={};for(e=g.length;e--;)g[e].remove();for(var p in this._editorCellListeners)for(d in this._editorCellListeners[p])this._editorCellListeners[p][d].remove();for(e=0;e<this._editorColumnListeners.length;e++)this._editorColumnListeners[e].remove();
this._editorCellListeners={};this._editorColumnListeners=[];this._editorsPendingStartup=[]},configStructure:function(){this._alwaysOnWidgetColumns=[];this.inherited(arguments)},_configColumns:function(){for(var e=this.inherited(arguments),g=0,d=e.length;g<d;g++)e[g].editor&&this._configureEditorColumn(e[g]);return e},_configureEditorColumn:function(e){var g=this,d=e.renderCell||this._defaultRenderCell,h=e.editOn,p="string"!==typeof e.editor;h?this._editorInstances[e.id]=this._createSharedEditor(e,
d):p&&this._alwaysOnWidgetColumns.push(e);e.renderCell=h?function(q,u,v,t){if(!t||!t.alreadyHooked){var x=b(v,h,function(){g._activeOptions=t;g.edit(this)});if(g._editorRowListeners)g._editorRowListeners[e.id]=x;else{var C=g.row(q);g._editorCellListeners[C.element.id][e.id]=x}}return d.call(e,q,u,v,t)}:function(q,u,v,t){if(!e.canEdit||e.canEdit(q,u))q=g._createEditor(e,q),g._showEditor(q,e,v,u),v[p?"widget":"input"]=q;else return d.call(e,q,u,v,t)}},edit:function(e){function g(B){d._activeCell=v;
d._showEditor(p,q,v,x);d._editTimer=setTimeout(function(){var F=d._getEditorFocusNode(p);F.focus&&F.focus();q._editorBlurHandle&&q._editorBlurHandle.resume();d._editTimer=null;B.resolve(p)},0)}var d=this,h,p;e.column||(e=this.cell(e));if(!e||!e.element)return null;this._previouslyFocusedEditorCell=e;var q=e.column;var u=q.field;var v=e.element.contents||e.element;if(p=this._editorInstances[q.id]){if(this._activeCell!==v){var t=e.row;var x=(h=this.dirty&&this.dirty[t.id])&&u in h?h[u]:q.get?q.get(t.data):
t.data[u];if(!q.canEdit||q.canEdit(e.row.data,x)){var C=new r;e=this._getEditorFocusNode(p);e.offsetWidth?(e.blur(),setTimeout(function(){g(C)},0)):g(C);return C.promise}}}else if(q.editor&&(p=v.widget||v.input))return C=new r,p.focus&&p.focus(),C.resolve(p),C.promise;return null},refreshCell:function(e){var g=e.column,d=g.get?g.get(e.row.data):e.row.data[g.field],h;g.editor&&(e.column.editOn&&this._activeCell===e.element?h=this._editorInstances[e.column.id]:e.column.editOn||(h=e.element.widget||
e.element.input));if(h)return h.domNode?h.set("value",d):this._updateInputValue(h,d),(new r).resolve();g._editorBlurHandle&&g._editorBlurHandle.remove();return this.inherited(arguments)},_showEditor:function(e,g,d,h){var p=e.domNode;p||this._updateInputValue(e,h);d.innerHTML="";l.add(d,"dgrid-cell-editing");p&&g.editOn&&e.validate&&e.reset&&e.reset();d.appendChild(this._getEditorRootNode(e));p&&!g.editOn?this._editorsPendingStartup.push([e,g,d,h]):this._startupEditor(e,g,d,h)},_startupEditor:function(e,
g,d,h){e.domNode&&(e._started||e.startup(),e._dgridIgnoreChange=!0,e.set("value",h),setTimeout(function(){e._dgridIgnoreChange=!1},0));e._dgridLastValue=h;this._activeCell&&(this._activeValue=h,b.emit(d,"dgrid-editor-show",{grid:this,cell:this.cell(d),column:g,editor:e,bubbles:!0,cancelable:!1}))},_startupPendingEditors:function(){for(var e=this._editorsPendingStartup,g=e.length;g--;)this._startupEditor.apply(this,e[g]);this._editorsPendingStartup=[]},_handleEditorChange:function(e,g){var d=e.target;
"_dgridLastValue"in d&&-1<d.className.indexOf("dgrid-input")&&this._updatePropertyFromEditor(g||this.cell(d).column,d,e)},_getEditorFocusNode:function(e){var g=e.parentNode||e.domNode&&e.domNode.parentNode;g&&l.contains(g,this.editorFocusWrapperClassName)||(g=e.focusNode||e.domNode||e);return g},_getEditorRootNode:function(e){if(e){var g=e.parentNode||e.domNode&&e.domNode.parentNode;g&&l.contains(g,this.editorFocusWrapperClassName)||(g=e.domNode||e);return g}},_createEditorFocusWrapper:function(e,
g){isNaN(g)&&(g=isNaN(e.tabIndex)?-1:e.tabIndex);g=m.create("div",{className:this.editorFocusWrapperClassName,tabIndex:g});g.appendChild(e);return g},_createEditor:function(e,g){var d=e.editor,h=e.editOn,p=this,q="string"!==typeof d&&d,u={};var v=e.editorArgs||{};"function"===typeof v&&(v=v.call(this,e,g));if(q){var t=new q(v);v=t.focusNode||t.domNode;v.className+=" dgrid-input";if(c("mac")&&e.editOn&&/checkbox|radio/i.test(v.type))v=this._createEditorFocusWrapper(t.domNode,e.tabIndex),this._listeners.push(b(v,
"blur",function(){t._dgridIgnoreChange||p._updatePropertyFromEditor(e,t,{type:"widget"})}));else if(!h)t.on("change",function(){t._dgridIgnoreChange||p._updatePropertyFromEditor(e,t,{type:"widget"})})}else this._hasInputListener||(this._hasInputListener=!0,this.on("change",function(C){p._handleEditorChange(C)})),"textarea"===d?q="textarea":(q="input",u.type=d),t=v=m.create(q,n.mixin(u,{className:"dgrid-input",name:e.field,tabIndex:isNaN(e.tabIndex)?-1:e.tabIndex},v)),c("mac")&&e.editOn&&/checkbox|radio/i.test(d)&&
(v=this._createEditorFocusWrapper(t),t.tabIndex=0,t.removeAttribute("tabindex")),9>c("ie")&&(d="radio"===d||"checkbox"===d?b(t,"click",function(C){p._handleEditorChange(C,e)}):b(t,"change",function(C){p._handleEditorChange(C,e)}),h?this._editorColumnListeners.push(d):this._editorRowListeners?this._editorRowListeners[e.id]=d:this._editorCellListeners[this.row(g).element.id][e.id]=d);if(e.autoSelect){var x=t.focusNode||t;x.select&&b(x,"focus",function(){setTimeout(function(){x.select()},0)})}return t},
_createSharedEditor:function(e){function g(){var t=h._activeCell;u.blur();"function"===typeof h.focus&&setTimeout(function(){h.focus(t)},p&&9>c("ie")?15:0)}var d=this._createEditor(e),h=this,p=d.domNode,q=this._getEditorRootNode(d),u=this._getEditorFocusNode(d),v=p?function(){d.set("value",d._dgridLastValue)}:function(){h._updateInputValue(d,d._dgridLastValue);h._updatePropertyFromEditor(e,d)};this._editorColumnListeners.push(b(u,"keydown",function(t){t=t.keyCode||t.which;27===t?(v(),h._activeValue=
d._dgridLastValue,g()):13===t&&!1!==e.dismissOnEnter&&g()}));(e._editorBlurHandle=b.pausable(this._getEditorFocusNode(d),"blur",function(t){if(!d.dropDown||!d.dropDown.domNode.contains(t.relatedTarget||document.activeElement)){if(t&&t.target){var x=t.target;if((x=l.contains(x,h.editorFocusWrapperClassName)&&x)&&t.relatedTarget===(d.focusNode||d)){x.focus();return}}h._updatePropertyFromEditor(e,d,{type:"widget"});t=q.parentNode;x={alreadyHooked:!0};var C=h.cell(q);b.emit(C.element,"dgrid-editor-hide",
{grid:h,cell:C,column:e,editor:d,bubbles:!0,cancelable:!1});e._editorBlurHandle.pause();t.removeChild(q);C.row&&(l.remove(C.element,"dgrid-cell-editing"),m.empty(t),f.appendIfNode(t,e.renderCell(C.row.data,h._activeValue,t,h._activeOptions?n.delegate(x,h._activeOptions):x)));h._focusedEditorCell=h._activeCell=h._activeValue=h._activeOptions=null}})).pause();this._editorColumnListeners.push(e._editorBlurHandle);return d},_updatePropertyFromEditor:function(e,g,d){var h;if(!g.isValid||g.isValid())if(d=
this._updateProperty((g.domNode||g).parentNode,this._activeCell?this._activeValue:g._dgridLastValue,this._retrieveEditorValue(e,g),d),this._activeCell?this._activeValue=d:g._dgridLastValue=d,"radio"===g.type&&g.name&&!e.editOn&&e.field)for(h in d=this.row(g),a("input[type\x3dradio][name\x3d"+g.name+"]",this.contentNode).forEach(function(p){var q=this.row(p);p!==g&&p._dgridLastValue&&(p._dgridLastValue=!1,this.updateDirty?this.updateDirty(q.id,e.field,!1):q.data[e.field]=!1)},this),this.dirty)d.id.toString()!==
h&&this.dirty[h][e.field]&&this.updateDirty(h,e.field,!1)},_updateProperty:function(e,g,d,h){var p=this;if((g&&g.valueOf())!==(d&&d.valueOf())){var q=this.cell(e),u=q.row,v=q.column;e=q.element;if(v.field&&u)if(q={grid:this,cell:q,oldValue:g,value:d,bubbles:!0,cancelable:!0},h&&h.type&&(q.parentType=h.type),b.emit(e,"dgrid-datachange",q))this.updateDirty?(this.updateDirty(u.id,v.field,d),v.autoSave&&setTimeout(function(){p._trackError("save")},0)):u.data[v.field]=d;else{var t;(t=e.widget)?(t._dgridIgnoreChange=
!0,t.set("value",g),setTimeout(function(){t._dgridIgnoreChange=!1},0)):(t=e.input)&&this._updateInputValue(t,g);return g}}return d},_updateInputValue:function(e,g){e.value=g;if("radio"===e.type||"checkbox"===e.type)e.checked=e.defaultChecked=!!g},_retrieveEditorValue:function(e,g){return"function"===typeof g.get?this._convertEditorValue(g.get("value")):this._convertEditorValue(g["checkbox"===g.type||"radio"===g.type?"checked":"value"])},_convertEditorValue:function(e,g){"number"===typeof g?e=isNaN(e)?
e:parseFloat(e):"boolean"===typeof g?e="true"===e?!0:"false"===e?!1:e:g instanceof Date&&(g=new Date(e),e=isNaN(g.getTime())?e:g);return e},_removeEditorBlurHandles:function(){H.forEach(this.subRows,function(e){e instanceof Array?H.forEach(e,function(g){g._editorBlurHandle&&g._editorBlurHandle.remove()}):e._editorBlurHandle&&e._editorBlurHandle.remove()})}})})},"dgrid1/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/dom-class dojo/on dojo/_base/lang dojo/has ./util/misc dojo/_base/sniff".split(" "),
function(H,k,n,r,m,l,b){function a(y){y.preventDefault()}var c={checkbox:1,radio:1,button:1},f=/\bdgrid-cell\b/,e=/\bdgrid-row\b/,g=H(null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,mouseDownEventType:"mousedown",postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=m.mixin({},g.defaultKeyMap));this.headerKeyMap||(this.headerKeyMap=m.mixin({},g.defaultHeaderKeyMap))},postCreate:function(){function y(z){var G=z.target;return G.type&&(!c[G.type]||32===z.keyCode)}
function w(z){function G(){A._focusedHeaderNode&&(A._focusedHeaderNode.tabIndex=-1);if(A.showHeader){if(K)for(var W=A.headerNode.getElementsByTagName("th"),X=0,ea;ea=W[X];++X){if(Q.test(ea.className)){A._focusedHeaderNode=T=ea;break}}else A._focusedHeaderNode=T=A.headerNode;T&&(T.tabIndex=A.tabIndex)}}function I(){var W=A._focusedNode||T;if(!Q.test(W.className)||!z.contains(W)){for(var X=z.getElementsByTagName("*"),ea=0,fa;fa=X[ea];++ea)if(Q.test(fa.className)){W=A._focusedNode=fa;break}T.tabIndex=
-1;W.tabIndex=A.tabIndex}}var K=A.cellNavigation,Q=K?f:e,N=z===A.headerNode,T=z;N?(G(),A._listeners.push(k.after(A,"renderHeader",G,!0))):A._listeners.push(k.after(A,"renderArray",I,!0),k.after(A,"_onNotification",function(W,X){0===X.totalLength?z.tabIndex=0:1===X.totalLength&&"add"===X.type&&I()},!0));A._listeners.push(r(z,A.mouseDownEventType,function(W){y(W)||A._focusOnNode(W.target,N,W)}));A._listeners.push(r(z,"keydown",function(W){if(!W.metaKey&&!W.altKey){var X=A[N?"headerKeyMap":"keyMap"][W.keyCode];
X&&!y(W)&&X.call(A,W)}}))}this.inherited(arguments);var A=this;this.tabableHeader&&(w(this.headerNode),r(this.headerNode,"dgrid-cellfocusin",function(){A.scrollTo({x:this.scrollLeft})}));w(this.contentNode);this._debouncedEnsureScroll=b.debounce(this._ensureScroll,this)},_pruneRow:function(){var y=this._focusedNode;this._focusedNode=null;this.inherited(arguments);this._focusedNode=y},removeRow:function(y){if(!this._focusedNode)return this.inherited(arguments);var w=this,A=document.activeElement===
this._focusedNode,z=this[this.cellNavigation?"cell":"row"](this._focusedNode),G=z.row||z,I;y=y.element||y;y===G.element&&((I=this.down(G,1,!0))&&I.element!==y||(I=this.up(G,1,!0)),this._removedFocus={active:A,rowId:G.id,columnId:z.column&&z.column.id,siblingId:I&&I.element!==y?I.id:void 0},setTimeout(function(){w._removedFocus&&w._restoreFocus(G.id)},0),this._focusedNode=null);this.inherited(arguments)},insertRow:function(){var y=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&
this._restoreFocus(y);return y},_restoreFocus:function(y){var w=this._removedFocus,A;if((y=(y=y&&this.row(y))&&y.element&&y.id===w.rowId?y:"undefined"!==typeof w.siblingId&&this.row(w.siblingId))&&y.element){if(!y.element.parentNode.parentNode){w.wait=!0;return}"undefined"!==typeof w.columnId&&(A=this.cell(y,w.columnId))&&A.element&&(y=A);w.active&&0!==y.element.offsetHeight?this._focusOnNode(y,!1,null):(n.add(y.element,"dgrid-focus"),y.element.tabIndex=this.tabIndex,this._focusedNode=y.element)}delete this._removedFocus},
addKeyHandler:function(y,w,A){y=k.after(this[A?"headerKeyMap":"keyMap"],y,w,!0);this._listeners.push(y);return y},_ensureRowScroll:function(y){var w=this.getScrollPosition().y;w>y.offsetTop?this.scrollTo({y:y.offsetTop}):w+this.contentNode.offsetHeight<y.offsetTop+y.offsetHeight&&this.scrollTo({y:y.offsetTop-this.contentNode.offsetHeight+y.offsetHeight})},_ensureColumnScroll:function(y){var w=this.getScrollPosition().x,A=y.offsetLeft;if(w>A)this.scrollTo({x:A});else{var z=this.bodyNode.clientWidth;
y=y.offsetWidth;var G=A+y;w+z<G&&this.scrollTo({x:z>y?G-z:A})}},_ensureScroll:function(y,w){!y.column&&!y.row&&y.data&&y.element?this._ensureRowScroll(y.element):(this.cellNavigation&&(this.columnSets||1<this.subRows.length)&&!w&&this._ensureRowScroll(y.row.element),this.bodyNode.clientWidth<this.contentNode.offsetWidth&&this._ensureColumnScroll(y.element))},_focusOnNode:function(y,w,A){var z="_focused"+(w?"Header":"")+"Node",G=this[z],I=this.cellNavigation?"cell":"row",K=this[I](y),Q;if(y=K&&K.element){if(this.cellNavigation){var N=
y.getElementsByTagName("input");var T=0;for(Q=N.length;T<Q;T++){var W=N[T];if((-1!==W.tabIndex||"_dgridLastValue"in W)&&!W.disabled){W.focus();var X=!0;break}}}null!==A&&(A=m.mixin({grid:this},A),A.type&&(A.parentType=A.type),A.bubbles||(A.bubbles=!0));G&&(n.remove(G,"dgrid-focus"),G.removeAttribute("tabindex"),A&&(A[I]=this[I](G),r.emit(G,"dgrid-cellfocusout",A)));G=this[z]=y;A&&(A[I]=K);z=this.cellNavigation?f:e;!X&&z.test(y.className)&&(y.tabIndex=this.tabIndex,y.focus());n.add(y,"dgrid-focus");
A&&r.emit(G,"dgrid-cellfocusin",A);this._debouncedEnsureScroll(K,w)}},focusHeader:function(y){this._focusOnNode(y||this._focusedHeaderNode,!0)},focus:function(y){(y=y||this._focusedNode)?this._focusOnNode(y,!1):(this._removedFocus&&(this._removedFocus.active=!0),this.contentNode.focus())}}),d=g.moveFocusVertical=function(y,w){if(this._focusedNode&&y.target!==this.contentNode){var A=this.cellNavigation,z=this[A?"cell":"row"](y);z=A&&z.column.id;w=this.down(this._focusedNode,w,!0);A&&(w=this.cell(w,
z));this._focusOnNode(w,!1,y);y.preventDefault()}};H=g.moveFocusUp=function(y){d.call(this,y,-1)};var h=g.moveFocusDown=function(y){d.call(this,y,1)},p=g.moveFocusPageUp=function(y){d.call(this,y,-this.pageSkip)},q=g.moveFocusPageDown=function(y){d.call(this,y,this.pageSkip)},u=g.moveFocusHorizontal=function(y,w){if(this.cellNavigation&&y.target!==this.contentNode){var A=!this.row(y);this._focusOnNode(this.right(this["_focused"+(A?"Header":"")+"Node"],w),A,y);y.preventDefault()}},v=g.moveFocusLeft=
function(y){u.call(this,y,-1)},t=g.moveFocusRight=function(y){u.call(this,y,1)},x=g.moveHeaderFocusEnd=function(y,w){if(this.cellNavigation){var A=this.headerNode.getElementsByTagName("th");this._focusOnNode(A[w?0:A.length-1],!0,y)}y.preventDefault()},C=g.moveHeaderFocusHome=function(y){x.call(this,y,!0)},B=g.moveFocusEnd=function(y,w){var A=this.cellNavigation,z=this.contentNode,G=z.scrollTop+(w?0:z.scrollHeight);z=z[w?"firstChild":"lastChild"];var I=-1<z.className.indexOf("dgrid-preload"),K=I?z[(w?
"next":"previous")+"Sibling"]:z;y.preventDefault();this.scrollTo({y:G});if(I){for(;K&&0>K.className.indexOf("dgrid-row");)K=K[(w?"next":"previous")+"Sibling"];if(!K)return}if(!I||1>z.offsetHeight)A&&(K=this.cell(K,this.cell(y).column.id)),this._focusOnNode(K,!1,y);else{l("dom-addeventlistener")||(y=m.mixin({},y));var Q=k.after(this,"renderArray",function(N){var T=N[w?0:N.length-1];A&&(T=this.cell(T,this.cell(y).column.id));this._focusOnNode(T,!1,y);Q.remove();return N});this._listeners.push(Q)}},
F=g.moveFocusHome=function(y){B.call(this,y,!0)};g.defaultKeyMap={32:a,33:p,34:q,35:B,36:F,37:v,38:H,39:t,40:h};g.defaultHeaderKeyMap={32:a,35:x,36:C,37:v,39:t};return g})},"dgrid1/Selection":function(){define("dojo/_base/declare dojo/aspect dojo/dom-class dojo/mouse dojo/on dojo/sniff dojo/has!touch?./util/touch dojo/query dojo/dom".split(" "),function(H,k,n,r,m,l,b){function a(q,u){u=q.unselectable=u?"on":"";q=q.getElementsByTagName("*");for(var v=q.length;--v;)"INPUT"!==q[v].tagName&&"TEXTAREA"!==
q[v].tagName&&(q[v].unselectable=u)}function c(q,u){var v=q.bodyNode,t=u?"text":21>l("ff")?"-moz-none":"none";e&&"msUserSelect"!==e?v.style[e]=t:l("dom-selectstart")?u||q._selectstartHandle?u&&q._selectstartHandle&&(q._selectstartHandle.remove(),delete q._selectstartHandle):q._selectstartHandle=m(v,"selectstart",function(x){var C=x.target&&x.target.tagName;"INPUT"!==C&&"TEXTAREA"!==C&&x.preventDefault()}):(a(v,!u),u||q._unselectableHandle)?u&&q._unselectableHandle&&(q._unselectableHandle.remove(),
delete q._unselectableHandle):q._unselectableHandle=k.after(q,"renderRow",function(x){a(x,!0);return x})}l.add("dom-comparedocumentposition",function(q,u,v){return!!v.compareDocumentPosition});l.add("dom-selectstart","undefined"!==typeof document.onselectstart);var f=l("mac")?"metaKey":"ctrlKey",e=l("css-user-select"),g=l("pointer"),d=g&&"MS"===g.slice(0,2),h=g?g+(d?"Down":"down"):"mousedown",p=g?g+(d?"Up":"up"):"mouseup";"WebkitUserSelect"===e&&"undefined"!==typeof document.documentElement.style.msUserSelect&&
(e=!1);return H(null,{selectionDelegate:".dgrid-row",selectionEvents:h+","+p+",dgrid-cellfocusin",selectionTouchEvents:l("touch")?b.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var q=this.selectionMode;this.selectionMode="";this._setSelectionMode(q)},destroy:function(){this.inherited(arguments);
this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(q){q!==this.selectionMode&&(this.clearSelection(),this.selectionMode=q,this._selectionHandlerName="_"+q+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},_setAllowTextSelection:function(q){"undefined"!==typeof q?c(this,q):c(this,"none"===this.selectionMode);this.allowTextSelection=
q},_handleSelect:function(q,u){if(!r.isRight(q)&&this[this._selectionHandlerName]&&this.allowSelect(this.row(u))&&("dgrid-cellfocusin"!==q.type||"mousedown"!==q.parentType)&&(q.type!==p||u===this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=q;if(!q.keyCode||!q.ctrlKey||32===q.keyCode)if(!q.shiftKey&&q.type===h&&this.isSelected(u))this._waitForMouseUp=u;else this[this._selectionHandlerName](q,u);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(q,u){q=q.keyCode?
q.ctrlKey:q[f];this._lastSelected===u?this.select(u,null,!q||!this.isSelected(u)):(this.clearSelection(),this.select(u),this._lastSelected=u)},_multipleSelectionHandler:function(q,u){var v=this._lastSelected,t=q.keyCode?q.ctrlKey:q[f];if(!q.shiftKey){var x=t?null:!0;v=null}this.select(u,v,x);v||(this._lastSelected=u)},_extendedSelectionHandler:function(q,u){if(q[f]||!this.isSelected(u)||1!==this.getSelectedCount())(2===q.button?this.isSelected(u):q.keyCode?q.ctrlKey:q[f])||this.clearSelection(null,
!0),this._multipleSelectionHandler(q,u)},_toggleSelectionHandler:function(q,u){this.select(u,null,null)},_initSelectionEvents:function(){var q=this,u=this.contentNode,v=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};l("touch")&&!l("pointer")&&this.selectionTouchEvents?(m(u,b.selector(v,this.selectionTouchEvents),function(t){q._handleSelect(t,this);q._ignoreMouseSelect=this}),m(u,m.selector(v,this.selectionEvents),function(t){q._ignoreMouseSelect!==this?q._handleSelect(t,
this):t.type===p&&(q._ignoreMouseSelect=null)})):m(u,m.selector(v,this.selectionEvents),function(t){q._handleSelect(t,this)});this.addKeyHandler&&this.addKeyHandler(32,function(t){q._handleSelect(t,t.target)});if(this.allowSelectAll)this.on("keydown",function(t){t[f]&&65===t.keyCode&&!/\bdgrid-input\b/.test(t.target.className)&&(t.preventDefault(),q[q.allSelected?"clearSelection":"selectAll"]())});this._setCollection&&this._listeners.push(k.before(this,"_setCollection",function(t){q._updateDeselectionAspect(t)}));
this._updateDeselectionAspect()},_updateDeselectionAspect:function(q){function u(x,C){if((x=v.row(x))&&v.selection[x.id])v[C](x)}var v=this;this._removeDeselectSignals&&this._removeDeselectSignals();var t=q&&q.track&&this._observeCollection?[k.before(this,"_observeCollection",function(x){t.push(x.on("delete",function(C){"undefined"===typeof C.index&&u(C.id,"deselect")}))}),k.after(this,"_observeCollection",function(x){t.push(x.on("update",function(C){"undefined"!==typeof C.index&&u(x.getIdentity(C.target),
"select")}))},!0)]:[k.before(this,"removeRow",function(x,C){C||(x=this.row(x))&&x.id in this.selection&&this.deselect(x)})];this._removeDeselectSignals=function(){for(var x=t.length;x--;)t[x].remove();t=[]}},allowSelect:function(){return!0},_fireSelectionEvent:function(q){var u=this._selectionEventQueues[q],v=this._selectionTriggerEvent;var t={bubbles:!0,grid:this};v&&(t.parentType=v.type);t[this._selectionTargetType]=u;this._selectionEventQueues[q]=[];m.emit(this.contentNode,"dgrid-"+q,t)},_fireSelectionEvents:function(){var q=
this._selectionEventQueues,u;for(u in q)q[u].length&&this._fireSelectionEvent(u)},_select:function(q,u,v){"undefined"===typeof v&&(v=!0);q.element||(q=this.row(q));if(!1===v||this.allowSelect(q)){var t=this.selection;var x=!!t[q.id];null===v&&(v=!x);var C=q.element;v||this.allSelected?t[q.id]=v:delete this.selection[q.id];C&&(v?n.add(C,"dgrid-selected"+(this.addUiClasses?" ui-state-active":"")):n.remove(C,"dgrid-selected ui-state-active"));v!==x&&C&&this._selectionEventQueues[(v?"":"de")+"select"].push(q);
if(u)if(u.element||(u=this.row(u)),u){if(u=u.element)for(t=this._determineSelectionDirection(C,u),t||(u=document.getElementById(u.id),t=this._determineSelectionDirection(C,u));q.element!==u&&(q=this[t](q));)this._select(q,null,v)}else this._lastSelected=C,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")}},
_determineSelectionDirection:l("dom-comparedocumentposition")?function(q,u){q=u.compareDocumentPosition(q);return q&1?!1:2===q?"down":"up"}:function(q,u){return 1>u.sourceIndex?!1:u.sourceIndex>q.sourceIndex?"down":"up"},select:function(q,u,v){this._select(q,u,v);this._fireSelectionEvents()},deselect:function(q,u){this.select(q,u,!1)},clearSelection:function(q,u){this.allSelected=!1;for(var v in this.selection)q!==v&&this._select(v,null,!1);u||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var q in this._rowIdToObject){var u=this.row(this._rowIdToObject[q]);this._select(u.id,null,!0)}this._fireSelectionEvents()},getSelectedCount:function(){var q=0,u;for(u in this.selection)u&&(q+=1);return q},isSelected:function(q){if("undefined"===typeof q||null===q)return!1;q.element||(q=this.row(q));return q.id in this.selection?!!this.selection[q.id]:this.allSelected&&(!q.data||this.allowSelect(q))},refresh:function(){this.deselectOnRefresh&&
this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var q=this.inherited(arguments),u=this.selection,v,t;for(v=0;v<q.length;v++){var x=this.row(q[v]);(t=x.id in u?u[x.id]:this.allSelected)&&this.select(x,null,t)}this._fireSelectionEvents();return q}})})},"dgrid1/Selector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/sniff dojo/dom-construct dojo/dom-class ./Selection".split(" "),function(H,k,n,r,m,l){return H(l,{postCreate:function(){this.inherited(arguments);
this.on(".dgrid-selector:click,.dgrid-selector:keydown",k.hitch(this,"_handleSelectorClick"));this.on("dgrid-select",k.hitch(this,"_changeSelectorInput",!0));this.on("dgrid-deselect",k.hitch(this,"_changeSelectorInput",!1))},_defaultRenderSelectorInput:function(b,a,c,f){var e=b.grid;m.add(c,"dgrid-selector");return c.input=r.create("input",{"aria-checked":a,checked:a,disabled:!e.allowSelect(e.row(f)),tabIndex:isNaN(b.tabIndex)?-1:b.tabIndex,type:b.selector},c)},_configureSelectorColumn:function(b){var a=
this,c=b.selector;this._selectorColumns.push(b);this._selectorSingleRow=this._selectorSingleRow||"radio"===b.selector;var f="function"===typeof c?c:this._defaultRenderSelectorInput;b.sortable=!1;b.renderCell=function(e,g,d){g=(g=e&&a.row(e))&&a.selection[g.id];f(b,!!g,d,e)};b.renderHeaderCell=function(e){var g="label"in b?b.label:b.field||"";"radio"!==b.selector&&a.allowSelectAll?(b._selectorHeaderCheckbox=f(b,!1,e,{}),a._hasSelectorHeaderCheckbox=!0):e.appendChild(document.createTextNode(g))}},_handleSelectorClick:function(b){if("INPUT"!==
b.target.nodeName||"keydown"!==b.type||32!==b.keyCode){var a=this.cell(b).row;if("click"===b.type||32===b.keyCode||!n("opera")&&13===b.keyCode||0===b.keyCode){this._selectionTriggerEvent=b;if(a){if(this.allowSelect(a)){var c=this._lastSelected&&this.row(this._lastSelected);this._selectorSingleRow?c&&c.id===a.id||(this.clearSelection(),this.select(a,null,!0),this._lastSelected=a.element):a&&(b.shiftKey?this._changeSelectorInput(!0,{rows:[a]}):c=null,c=b.shiftKey?c:null,this.select(c||a,a,c?void 0:
null),this._lastSelected=a.element)}}else this[this.allSelected?"clearSelection":"selectAll"]();this._selectionTriggerEvent=null}}},_changeSelectorInput:function(b,a){this._selectorColumns.length&&this._updateRowSelectors(b,a);this._hasSelectorHeaderCheckbox&&this._updateHeaderCheckboxes()},_updateRowSelectors:function(b,a){a=a.rows;for(var c=a.length,f=this._selectorColumns.length,e=0;e<c;e++)for(var g=0;g<f;g++){var d=this.cell(a[e],this._selectorColumns[g].id).element;d&&(d=(d.contents||d).input)&&
!d.disabled&&(d.checked=b,d.setAttribute("aria-checked",b))}},_updateHeaderCheckboxes:function(){for(var b=this._selectorColumns.length,a=0;a<b;a++){var c="false",f=this._selectorColumns[a]._selectorHeaderCheckbox;if(f){var e=this.selection;var g=!1;for(var d in e)if(e[d]!=this.allSelected){g=!0;break}f.indeterminate=g;f.checked=this.allSelected;g?c="mixed":this.allSelected&&(c="true");f.setAttribute("aria-checked",c)}}},configStructure:function(){this.inherited(arguments);var b=this.columns;this._selectorColumns=
[];this._hasSelectorHeaderCheckbox=this._selectorSingleRow=!1;for(var a in b)b[a].selector&&this._configureSelectorColumn(b[a])},_handleSelect:function(b){var a=this.cell(b).column;a&&a.selector||this.inherited(arguments)}})})},"dgrid1/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-construct dojo/dom-geometry dojo/has ../util/misc dojo/_base/html".split(" "),function(H,k,n,r,m,l,b,a,c,f){function e(v,t,x,C,B){for(var F=
1;F<t;F++)v[x+F][C]=B}function g(v){for(var t=v.length,x=t,C=k.filter(v[0],function(K){return!K.hidden}).length,B=Array(t);t--;)B[t]=Array(C);var F={};for(t=0;t<x;t++)for(var y=B[t],w=v[t],A=0,z=0;A<C;A++){var G=w[z],I;if("undefined"===typeof y[A]){y[A]=G.id;G.rowSpan&&1<G.rowSpan&&e(B,G.rowSpan,t,A,G.id);if(0<t&&G.colSpan&&1<G.colSpan)for(I=1;I<G.colSpan;I++)y[++A]=G.id,G.rowSpan&&1<G.rowSpan&&e(B,G.rowSpan,t,A,G.id);F[G.id]=v[0][A].id;z++}}return F}function d(v,t,x,C,B){if(!(0>=x)){var F=v.columns[t];
if(F){var y={grid:v,columnId:t,width:x,bubbles:!0,cancelable:!0};C&&(y.parentType=C);if(!v._resizedColumns||n.emit(v.headerNode,"dgrid-columnresize",y))return"auto"===x?delete F.width:(F.width=x,x+="px"),(C=v._columnSizes[t])?C.set("width",x):C=f.addCssRule("#"+f.escapeCssIdentifier(v.domNode.id)+" .dgrid-column-"+f.escapeCssIdentifier(t,"-"),"width: "+x+";"),v._columnSizes[t]=C,!1!==B&&v.resize(),!0}}}var h,p,q=0,u={create:function(){h=b.create("div",{className:"dgrid-column-resizer"});p=b.create("div",
{className:"dgrid-resize-guard"})},destroy:function(){b.destroy(h);b.destroy(p);h=p=null},show:function(v){var t=a.position(v.domNode,!0);h.style.top=t.y+"px";h.style.height=t.h+"px";document.body.appendChild(h);v.domNode.appendChild(p)},move:function(v){h.style.left=v+"px"},hide:function(){h.parentNode.removeChild(h);p.parentNode.removeChild(p)}};return H(null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);q||u.create();q++},
destroy:function(){this.inherited(arguments);for(var v in this._columnSizes)this._columnSizes[v].remove();--q||u.destroy()},resizeColumnWidth:function(v,t){return d(this,v,t)},configStructure:function(){var v=this._oldColumnSizes=m.mixin({},this._columnSizes),t;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);for(t in v)t in this._columnSizes||v[t].remove();delete this._oldColumnSizes},_configColumn:function(v){this.inherited(arguments);var t=v.id,x;"width"in v&&((x=this._oldColumnSizes[t])?
x.set("width",v.width+"px"):x=f.addCssRule("#"+f.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+f.escapeCssIdentifier(t,"-"),"width: "+v.width+"px;"),this._columnSizes[t]=x)},renderHeader:function(){this.inherited(arguments);var v=this;if(this.columnSets&&this.columnSets.length)for(var t=this.columnSets.length;t--;)var x=m.mixin(x||{},g(this.columnSets[t]));else this.subRows&&1<this.subRows.length&&(x=g(this.subRows));t=r(".dgrid-cell",v.headerNode);for(var C=t.length;C--;){var B=t[C],F=B.columnId,
y=v.columns[F],w=B.childNodes;if(y&&!1!==y.resizable){y=b.create("div",{className:"dgrid-resize-header-container"});for(B.contents=y;0<w.length;)y.appendChild(w[0]);w=b.create("div",{className:"dgrid-resize-handle resizeNode-"+f.escapeCssIdentifier(F,"-")},y);B.appendChild(y);w.columnId=x&&x[F]||F}}v.mouseMoveListen||(n(v.headerNode,".dgrid-resize-handle:mousedown"+(c("touch")?",.dgrid-resize-handle:touchstart":""),function(A){v._resizeMouseDown(A,this);v.mouseMoveListen.resume();v.mouseUpListen.resume()}),
v._listeners.push(v.mouseMoveListen=n.pausable(document,"mousemove"+(c("touch")?",touchmove":""),f.throttleDelayed(function(A){v._updateResizerPosition(A)}))),v._listeners.push(v.mouseUpListen=n.pausable(document,"mouseup"+(c("touch")?",touchend":""),function(A){v._resizeMouseUp(A);v.mouseMoveListen.pause();v.mouseUpListen.pause()})),v.mouseMoveListen.pause(),v.mouseUpListen.pause())},_resizeMouseDown:function(v,t){v.preventDefault();l.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(v);
this._targetCell=r(".dgrid-column-"+f.escapeCssIdentifier(t.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(v);u.show(this)},_resizeMouseUp:function(v){var t=this._columnSizes,x;this.adjustLastColumn&&(x=this.headerNode.clientWidth-1);if(!this._resizedColumns){var C=r(".dgrid-cell",this.headerNode);this.columnSets&&this.columnSets.length?C=C.filter(function(G){return"0"===G.columnId.split("-")[0]&&!(G.columnId in t)}):this.subRows&&1<this.subRows.length&&(C=C.filter(function(G){return"0"===
G.columnId.charAt(0)&&!(G.columnId in t)}));var B=C.map(function(G){return G.offsetWidth});C.forEach(function(G,I){d(this,G.columnId,B[I],null,!1)},this);this._resizedColumns=!0}l.setSelectable(this.domNode,!0);C=this._targetCell;var F=this._getResizeMouseLocation(v)-this._startX,y=C.offsetWidth+F,w=this._getResizedColumnWidths(),A=w.totalWidth;w=w.lastColId;var z=r(".dgrid-column-"+f.escapeCssIdentifier(w,"-"),this.headerNode)[0].offsetWidth;y<this.minWidth&&(y=this.minWidth);d(this,C.columnId,y,
v.type)&&C.columnId!==w&&this.adjustLastColumn&&(A+F<x?d(this,w,"auto",v.type):z-F<=this.minWidth&&d(this,w,this.minWidth,v.type));u.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(v){if(this._targetCell){v=this._getResizeMouseLocation(v);var t=this._targetCell.offsetWidth,x=v;t+(v-this._startX)<this.minWidth&&(x=this._startX-(t-this.minWidth));u.move(x)}},_getResizeMouseLocation:function(v){var t=0;v.pageX?t=v.pageX:v.clientX&&(t=v.clientX+document.body.scrollLeft+
document.documentElement.scrollLeft);return t},_getResizedColumnWidths:function(){var v=0,t=r((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),x=t.length;if(!x)return{};for(var C=t[x-1].columnId;x--;)v+=t[x].offsetWidth;return{totalWidth:v,lastColId:C}}})})},"dgrid1/extensions/DijitRegistry":function(){define(["dojo/_base/declare","dojo/dom-geometry","dijit/_WidgetBase","dijit/registry"],function(H,k,n,r){var m=n.prototype;return H(null,{minSize:0,maxSize:Infinity,
layoutPriority:0,showTitle:!0,buildRendering:function(){r.add(this);this.inherited(arguments);this.domNode.setAttribute("widgetId",this.id)},startup:function(){if(!this._started){this.inherited(arguments);var l=this.getParent();l&&l.isLayoutContainer&&this._resizeHandle.remove()}},destroyRecursive:function(){this.destroy()},destroy:function(){this.inherited(arguments);r.remove(this.id)},getChildren:function(){return[]},getParent:function(){return r.getEnclosingWidget(this.domNode.parentNode)},isLeftToRight:function(){return!this.isRTL},
placeAt:function(l,b){return m.placeAt.call(this,l,b)},resize:function(l){l&&k.setMarginBox(this.domNode,l);this.inherited(arguments)},_set:function(l,b){this[l]=b},watch:function(){}})})},"esri/dijit/analysis/_Widget":function(){define(["dijit/_WidgetBase","dojo/_base/lang","dojo/dom-class"],function(H,k,n){return H.createSubclass({declaredClass:"esri.dijit.analysis.Widget",create:function(r,m){r=k.mixin({viewModel:{}},r);r.viewModel=this._ensureViewModelInstance(r.viewModel);this.inherited(arguments,
[r,m])},destroy:function(){this.inherited(arguments);this.viewModel.destroy&&this.viewModel.destroy();this.viewModel=null},viewModel:null,_setViewModelAttr:function(r){this._set("viewModel",this._ensureViewModelInstance(r))},viewModelType:null,visible:!0,_setVisibleAttr:function(r){this._set("visible",r);n.toggle(this.domNode,"esri-hidden",!r)},_ensureViewModelInstance:function(r){return r&&!r.declaredClass&&this.viewModelType?new this.viewModelType(r):r}})})},"esri/dijit/analysis/SettingsViewModel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/has dojo/json dojo/Stateful ./storeUtils ./SpatialReferences ./JobsViewModel ../../kernel ../../lang".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g){H=H([b],{declaredClass:"esri.dijit.analysis.SettingsViewModel",showHelp:!0,showOverwriteResultOption:!0,showCloseAnalysisOption:!0,showStoreAnalysisOption:!0,showCoordinateSystems:!0,showOutSR:!0,showProcessSR:!0,showExtent:!0,showRasterSettings:!0,showGeoAnalyticsSettings:!0,showRasterPPFSettings:!1,showRasterPTSettings:!1,showRasterSnapSettings:!0,showCreditWarningSettings:!0,showResamplingSettings:!1,showCloseIcon:!0,showHeader:!0,showOkCancel:!0,showJobsHistory:!1,
isCustomExtent:!1,layers:null,viewProps:null,closeAnalysisWidget:!0,returnFeaturCollection:!1,jobsViewModel:null,geoAnalyticsServer:null,creditWarning:!0,spatialRefStore:a.createHierarchicalStore({data:c}),spatialRefData:c,constructor:function(d){var h=this.get("saveModel");h&&h.layers&&d.layers&&(this._arrayUnique(d.layers.concat(h.layers),"name"),delete h.layers);k.mixin(d,h);this.watch("showJobsHistory",k.hitch(this,this.updateJobsVM));this.watch("portalUrl",k.hitch(this,this.updateJobsVM));this.watch("jobsHistoryItem",
k.hitch(this,this.updateJobsVM))},_showCloseIconSetter:function(d){this.showCloseIcon=d},_showHelpSetter:function(d){this.showHelp=d},_showOverwriteResultOptionSetter:function(d){this.showOverwriteResultOption=d},_showCloseAnalysisOptionSetter:function(d){this.showCloseAnalysisOption=d},_showStoreAnalysisOptionSetter:function(d){this.showStoreAnalysisOption=d},_showCoordinateSystemsSetter:function(d){this.showCoordinateSystems=d},_showExtentSetter:function(d){this.showExtent=d},_showRasterSettingsSetter:function(d){this.showRasterSettings=
d},_showRasterPPFSettingsSetter:function(d){this.showRasterPPFSettings=d},_showRasterPTSettingsSetter:function(d){this.showRasterPTSettings=d},_showRasterSnapSettingsSetter:function(d){this.showRasterSnapSettings=d},_returnFeatureCollectionSetter:function(d){this.returnFeatureCollection=d},_closeAnalysisWidgetSetter:function(d){this.closeAnalysisWidget=d},_overwriteResultSetter:function(d){this.overwriteResult=d},_outSRSetter:function(d){this.outSR=d},_processSRSetter:function(d){this.processSR=d},
_extentSetter:function(d){this.extent=d},_snapRasterSetter:function(d){this.snapRaster=d},_cellSizeSetter:function(d){this.cellSize=d},_maskSetter:function(d){this.mask=d},_layersSetter:function(d){this.layers=d},_showHeaderSetter:function(d){this.showHeader=d},_showOutSRSetter:function(d){this.showOutSR=d;this.set("outSR",d?this.outSR:void 0)},_showProcessSRSetter:function(d){this.showProcessSR=d;this.set("processSR",d?this.processSR:void 0)},_showOkCancelSetter:function(d){this.showOkCancel=!0},
_isCustomExtentSetter:function(d){this.isCustomExtent=d},_isCustomOutSRSetter:function(d){this.isCustomOutSR=d},_isCustomProcessSRSetter:function(d){this.isCustomProcessSR=d},_isCustomCellSizeSetter:function(d){this.isCustomCellSize=d},_showGeoAnalyticsSettingsSetter:function(d){this.showGeoAnalyticsSettings=d},_datastoreSetter:function(d){this.datastore=d},_portalUrlSetter:function(d){this.portalUrl=d},_jobsHistoryItemSetter:function(d){this.jobsHistoryItem=d},_viewPropsSetter:function(d){this.viewProps=
d},_saveModelGetter:function(){var d;window.localStorage&&(d=window.localStorage.getItem("esri_analysis_settings"))&&(d=l.parse(d));return d},_saveModelSetter:function(d){d||(d={isCustomExtent:this.isCustomExtent,isCustomOutSR:this.isCustomOutSR,isCustomProcessSR:this.isCustomProcessSR,isCustomCellSize:this.isCustomCellSize,outSR:this.outSR,processSR:this.processSR,extent:this.extent,cellSize:this.cellSize,snapRaster:this.snapRaster,mask:this.mask,datastore:this.datastore,viewProps:this.viewProps,
closeAnalysisWidget:this.closeAnalysisWidget,returnFeatureCollection:this.returnFeatureCollection,processorType:this.processorType,parallelProcessingFactor:this.parallelProcessingFactor,recycleProcessingWorkers:this.recycleProcessingWorkers,retryOnFailures:this.retryOnFailures,resamplingMethod:this.resamplingMethod,creditWarning:this.creditWarning},this.layers&&0<this.layers.length&&(d.layers=n.map(this.layers,function(h){return{name:h.name,url:h.url,fullExtent:h.fullExtent,type:h.type,format:h.format}})));
window.localStorage&&d&&window.localStorage.setItem("esri_analysis_settings",l.stringify(d))},_geoAnalyticsServerSetter:function(d){this.geoAnalyticsServer=d},_processorTypeSetter:function(d){this.processorType=d},_parallelProcessingFactorSetter:function(d){this.parallelProcessingFactor=d},_recycleIntervalOfProecssingWorkersSetter:function(d){this.recycleIntervalOfProecssingWorkers=d},_numberOfRetriesOnRandomFailureSetter:function(d){this.numberOfRetriesOnRandomFailure=d},_resamplingMethodSetter:function(d){this.resamplingMethod=
d},_creditWarningSetter:function(d){this.creditWarning=d},save:function(){this.set("saveModel")},reset:function(){k.mixin(this,this.get("saveModel"))},updateJobsVM:function(){this.showJobsHistory&&this.portalUrl&&this.jobsHistoryItem&&!this.jobsViewModel&&(this.jobsViewModel=new f({portalUrl:this.portalUrl,item:this.jobsHistoryItem}),this.watch("jobsHistoryItem",k.hitch(this,function(){this.jobsViewModel.set("item",this.jobsHistoryItem)})),this.watch("portalUrl",k.hitch(this,function(){this.jobsViewModel.set("portalUrl",
this.portalUrl)})))},_arrayUnique:function(d,h){d=d.concat();for(var p=0;p<d.length;++p)for(var q=p+1;q<d.length;++q)(!h&&d[p]===d[q]||h&&d[p][h]===d[q][h])&&d.splice(q--,1);return d}});m("extend-esri")&&k.setObject("dijit.analysis.SettingsViewModel",H,e);return H})},"esri/dijit/analysis/storeUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dstore/Memory dstore/Trackable dstore/Tree ../../kernel".split(" "),function(H,k,n,r,m,l,b){var a=H([r,m]);r={createHierarchicalStore:function(c){c=
this.createSyncStore(c,l);c.getRootCollection=function(){return this.root.filter({parent:void 0})};return c.getRootCollection()},createSyncStore:function(c,f){c=c||{};c.data&&(c=k.mixin({},c,{data:k.clone(c.data)}));return new (f?H([a,f]):a)(c)},createStore:function(c){for(var f={identifier:"id",label:"id",items:[]},e=0,g=c.length;e<g;e++)f.items.push(k.mixin({id:e},c[e%g]));return this.createSyncStore({data:f})}};n("extend-esri")&&k.setObject("dijit.analysis.storeUtils",r,b);return r})},"dstore/Memory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array ./Store ./Promised ./SimpleQuery ./QueryResults".split(" "),
function(H,k,n,r,m,l,b){return H([r,m,l],{constructor:function(){this.storage.version=0},postscript:function(){this.inherited(arguments);this.setData(this.data||[])},data:null,autoEmitEvents:!1,getSync:function(a){return this.storage.fullData[this.storage.index[a]]},putSync:function(a,c){c=c||{};var f=this.storage,e=f.index,g=f.fullData,d=this.Model;!d||a instanceof d||(a=this._restore(a));var h=this.getIdentity(a);null==h&&(this._setIdentity(a,"id"in c?c.id:Math.random()),h=this.getIdentity(a));
f.version++;f=h in e?"update":"add";d={target:a};var p;if("update"===f){if(!1===c.overwrite)throw Error("Object already exists");h=p=e[h]}else h=this.defaultNewToStart?0:g.length;if("beforeId"in c){var q=c.beforeId;null===q?(c=g.length,"update"===f&&--c):(c=e[q],p<c&&--c);void 0!==c?d.beforeId=q:(console.error("options.beforeId was specified but no corresponding index was found"),c=h)}else c=h;if(c===p)g[c]=a;else for(void 0!==p&&g.splice(p,1),g.splice(c,0,a),p=void 0===p?c:Math.min(p,c),c=g.length;p<
c;++p)e[this.getIdentity(g[p])]=p;this.emit(f,d);return a},addSync:function(a,c){(c=c||{}).overwrite=!1;return this.putSync(a,c)},removeSync:function(a){var c=this.storage,f=c.index;c=c.fullData;if(a in f)return f=c.splice(f[a],1)[0],this._reindex(),this.emit("delete",{id:a,target:f}),!0},setData:function(a){this.parse&&(a=this.parse(a));a.items&&(this.idProperty=a.identifier||this.idProperty,a=a.items);this.storage.fullData=this.data=a;this._reindex()},_reindex:function(){for(var a=this.storage,
c=a.index={},f=a.fullData,e=this.Model,g=Object.prototype,d=0,h=f.length;d<h;d++){var p=f[d];if(e&&!(p instanceof e)){var q=this._restore(p,p.__proto__===g);p!==q&&(f[d]=p=q)}c[this.getIdentity(p)]=d}a.version++},fetchSync:function(){var a=this.data;if(!a||a._version!==this.storage.version){a=this.storage.fullData;for(var c=this.queryLog,f=0,e=c.length;f<e;f++)a=c[f].querier(a);a._version=this.storage.version;this.data=a}return new b(a)},fetchRangeSync:function(a){var c=this.fetchSync();return new b(c.slice(a.start,
a.end),{totalLength:c.length})},_includePropertyInSubCollection:function(a){return"data"!==a&&this.inherited(arguments)}})})},"dstore/Store":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/has dojo/when dojo/_base/declare ./QueryMethod ./Filter dojo/Evented".split(" "),function(H,k,n,r,m,l,b,a,c){function f(g){return function(d,h){var p=this;m(d,function(q){q={target:q};var u=h[1]||{};"beforeId"in u&&(q.beforeId=u.beforeId);p.emit(g,q)});return d}}r.add("object-proto",!!{}.__proto__&&
!{}.watch);var e=r("object-proto");return l(c,{constructor:function(g){g&&l.safeMixin(this,g);this.Model&&this.Model.createSubclass&&(this.Model=this.Model.createSubclass([]).extend({_store:this}));this.storage=new c;var d=this;this.autoEmitEvents&&(n.after(this,"add",f("add")),n.after(this,"put",f("update")),n.after(this,"remove",function(h,p){m(h,function(){d.emit("delete",{id:p[0]})});return h}))},autoEmitEvents:!0,idProperty:"id",queryAccessors:!0,getIdentity:function(g){return g.get?g.get(this.idProperty):
g[this.idProperty]},_setIdentity:function(g,d){g.set?g.set(this.idProperty,d):g[this.idProperty]=d},forEach:function(g,d){var h=this;return m(this.fetch(),function(p){for(var q=0,u;void 0!==(u=p[q]);q++)g.call(d,u,q,h);return p})},matchesFilter:function(g){var d=this.queryLog;if(d&&g){g=[g];for(var h=0,p=d.length;h<p;h++)g=d[h].querier(g);return 0<g.length}return!0},on:function(g,d,h){var p=this;return this.storage.on(g,function(q){d&&(!h||p.matchesFilter(q&&q.target))&&d&&d(q)})},emit:function(g,
d){d=d||{};d.type=g;try{return this.storage.emit(g,d)}catch(h){console.error(h)}finally{return d.cancelable}},parse:null,stringify:null,Model:null,_restore:function(g,d){var h=this.Model;if(h&&g){var p=h.prototype,q=p._restore;q?g=q.call(g,h,d):e&&d?g.__proto__=p:g=H.delegate(p,g)}return g},create:function(g){return new this.Model(g)},_createSubCollection:function(g){var d=H.delegate(this.constructor.prototype),h;for(h in this)this._includePropertyInSubCollection(h,d)&&(d[h]=this[h]);return l.safeMixin(d,
g)},_includePropertyInSubCollection:function(g,d){return!(g in d)||d[g]!==this[g]},queryLog:[],filter:new b({type:"filter",normalizeArguments:function(g){var d=this.Filter;return g instanceof d?[g]:[new d(g)]}}),Filter:a,sort:new b({type:"sort",normalizeArguments:function(g,d){if("function"===typeof g)var h=[g];else h=g instanceof Array?g.slice():"object"===typeof g?[].slice.call(arguments):[{property:g,descending:d}],h=k.map(h,function(p){p=H.mixin({},p);p.descending=!!p.descending;return p}),h=
[h];return h}}),select:new b({type:"select"}),_getQuerierFactory:function(g){return this["_create"+(g[0].toUpperCase()+g.substr(1))+"Querier"]}})})},"dstore/QueryMethod":function(){define([],function(){return function(H){var k=H.type,n=H.normalizeArguments,r=H.applyQuery,m=H.querierFactory;return function(){var l=Array.prototype.slice.call(arguments),b=n?n.apply(this,l):l;l={type:k,arguments:l,normalizedArguments:b};var a=this._getQuerierFactory(k)||m;a&&(l.querier=a.apply(this,b));b=this._createSubCollection({queryLog:this.queryLog.concat(l)});
return r?r.call(this,b,l):b}}})},"dstore/Filter":function(){define(["dojo/_base/declare"],function(H){function k(r){return function(){var m=this.constructor,l=new m;l.type=r;l.args=Array.prototype.slice.call(arguments);return this.type?k("and").call(m.prototype,this,l):l}}function n(r){return function(){for(var m=this.constructor,l=[],b=0;b<arguments.length;b++){var a=arguments[b];l.push(a instanceof m?a:new m(a))}m=new m;m.type=r;m.args=l;this.type===r?m.args=this.args.concat(l):this.type?l.unshift(this):
1===l.length&&l[0].type&&(m.type=l[0].type,m.args=l[0].args.slice());return m}}H=H(null,{constructor:function(r){var m=typeof r;switch(m){case "object":m=this;for(var l in r){var b=r[l];m=b instanceof this.constructor?m[b.type](l,b.args[0]):b&&b.test?m.match(l,b):m.eq(l,b)}this.type=m.type;this.args=m.args;break;case "function":case "string":this.type=m,this.args=[r]}},and:n("and"),or:n("or"),eq:k("eq"),ne:k("ne"),lt:k("lt"),lte:k("lte"),gt:k("gt"),gte:k("gte"),contains:k("contains"),"in":k("in"),
match:k("match")});H.filterCreator=k;H.logicalOperatorCreator=n;return H})},"dstore/Promised":function(){define(["dojo/_base/declare","dojo/Deferred","./QueryResults","dojo/when"],function(H,k,n,r){function m(l,b){return function(){var a=new k;try{a.resolve(this[l].apply(this,arguments))}catch(c){a.reject(c)}return b?(a=new n(a.promise),a.totalLength=r(a.totalLength),a):a.promise}}return H(null,{get:m("getSync"),put:m("putSync"),add:m("addSync"),remove:m("removeSync"),fetch:m("fetchSync",!0),fetchRange:m("fetchRangeSync",
!0)})})},"dstore/QueryResults":function(){define(["dojo/_base/lang","dojo/when"],function(H,k){function n(r,m){return k(this,function(l){for(var b=0,a=l.length;b<a;b++)r.call(m,l[b],b,l)})}return function(r,m){var l=m&&"totalLength"in m;if(r.then){r=H.delegate(r);var b=r.then(function(a){var c=l?m.totalLength:a.totalLength||a.length;a.totalLength=c;return!l&&c});r.totalLength=l?m.totalLength:b;r.response=m&&m.response}else r.totalLength=l?m.totalLength:r.length;r.forEach=n;return r}})},"dstore/SimpleQuery":function(){define(["dojo/_base/declare",
"dojo/_base/array"],function(H,k){function n(m,l){if(-1<m.indexOf(".")){var b=m.split("."),a=b.length;return function(c){for(var f=0;f<a;f++)c=c&&(l&&c.get?c.get(b[f]):c[b[f]]);return c}}return function(c){return c.get?c.get(m):c[m]}}var r={eq:function(m,l){return m===l},"in":function(m,l){return-1<k.indexOf(l.data||l,m)},ne:function(m,l){return m!==l},lt:function(m,l){return m<l},lte:function(m,l){return m<=l},gt:function(m,l){return m>l},gte:function(m,l){return m>=l},match:function(m,l,b){return l.test(m,
b)},contains:function(m,l,b,a){var c=this;l=l.data?l.data:Array.isArray(l)?l:[l];return k.every(l,function(f){if("object"===typeof f&&f.type){var e=c._getFilterComparator(f.type);return k.some(m,function(g){return e.call(c,g,f.args[1],b,a)})}return-1<k.indexOf(m,f)})}};return H(null,{_createFilterQuerier:function(m){function l(f){var e=f.type;f=f.args;var g=a._getFilterComparator(e);if(g){var d=f[0],h=n(d,b),p=f[1];p&&p.fetchSync&&(p=p.fetchSync());return function(x){return g.call(a,h(x),p,x,d)}}switch(e){case "and":case "or":for(var q=
0,u=f.length;q<u;q++){var v=l(f[q]);var t=t?function(x,C){return"and"===e?function(B){return x(B)&&C(B)}:function(B){return x(B)||C(B)}}(t,v):v}return t;case "function":return f[0];case "string":t=a[f[0]];if(!t)throw Error("No filter function "+f[0]+" was found in the collection");return t;case void 0:return function(){return!0};default:throw Error('Unknown filter operation "'+e+'"');}}var b=this.queryAccessors,a=this,c=l(m);return function(f){return k.filter(f,c)}},_getFilterComparator:function(m){return r[m]||
this.inherited(arguments)},_createSelectQuerier:function(m){return function(l){var b=m.length;return k.map(l,m instanceof Array?function(a){for(var c={},f=0;f<b;f++){var e=m[f];c[e]=a[e]}return c}:function(a){return a[m]})}},_createSortQuerier:function(m){var l=this.queryAccessors;return function(b){b=b.slice();"function"===typeof m?b.sort(m):m&&m.length&&b.sort(function(a,c){for(var f=0;f<m.length;f++){var e=m[f];if("function"==typeof e)var g=e(a,c);else{g=e.get||(e.get=n(e.property,l));e=e.descending;
var d=g(a);g=g(c);null!=d&&(d=d.valueOf());null!=g&&(g=g.valueOf());g=d===g?0:!!e===("undefined"===typeof g||null===g&&"undefined"!==typeof d||null!=d&&d<g)?1:-1}if(0!==g)return g}return 0});return b}}})})},"dstore/Trackable":function(){define("dojo/_base/lang dojo/_base/declare dojo/aspect dojo/when dojo/promise/all dojo/_base/array dojo/on".split(" "),function(H,k,n,r,m,l,b){function a(e,g,d){for(var h=e.length-1;0<=h;--h){var p=e[h],q=p.start;p=q+p.count;if(g>p){e.splice(h+1,0,{start:g,count:d-
g});return}d>=q&&(g=Math.min(g,q),d=Math.max(d,p),e.splice(h,1))}e.unshift({start:g,count:d-g})}var c=0,f={track:function(){function e(){return function(){var B=this,F=this.inherited(arguments);r(F,function(y){y=B._results=y.slice();B._partialResults&&(B._partialResults=null);B._ranges=[];a(B._ranges,0,y.length)});return F}}function g(){return function(B){var F=this,y=B.start,w=B.end,A=this.inherited(arguments);this._results||r(A,function(z){return r(z.totalLength,function(G){var I=F._partialResults||
(F._partialResults=[]);w=Math.min(w,y+z.length);I.length=G;G=[y,w-y].concat(z);I.splice.apply(I,G);a(F._ranges,y,w);return z})});return A}}function d(B,F){c++;var y=F.target;F=H.delegate(F,x[B]);var w=F.beforeId;r(v._results||v._partialResults,function(A){if(A){var z,G,I=v._ranges,K="id"in F?F.id:h.getIdentity(y),Q=-1,N=-1,T=-1,W=-1;if("delete"===B||"update"===B)for(z=0;-1===Q&&z<I.length;++z){var X=I[z];var ea=X.start;for(G=ea+X.count;ea<G;++ea)if(h.getIdentity(A[ea])==K){Q=F.previousIndex=ea;N=
z;var fa=w==K;A.splice(Q,1);X.count--;for(ea=z+1;ea<I.length;++ea)I[ea].start--;break}}if("add"===B||"update"===B){if(t){if(t([y]).length){var J=0;G=I.length-1;for(fa=-1;J<=G&&-1===T;)z=J+Math.round((G-J)/2),X=I[z],N=A.slice(X.start,X.start+X.count),void 0!==w&&(fa=null===w?N.length:C(N,w)),-1===fa&&(fa=Q>=Math.max(0,X.start-1)&&Q<=X.start+X.count?Q:h.defaultNewToStart?0:N.length),N.splice(fa,0,y),ea=l.indexOf(t(N),y),K=X.start+ea,0===ea&&0!==X.start?G=z-1:ea>=N.length-1&&K<A.length?J=z+1:(T=K,W=
z);if(-1===T&&0<J&&J<I.length)var V=!0}}else{ea=-1;if(void 0===w||fa)"update"===B?(T=Q,W=N):h.defaultNewToStart?ea=T=0:(T=A.length,ea=I.length-1);else if(null===w)T=A.length,ea=I.length-1;else for(z=0,G=I.length;-1===W&&z<G;++z)X=I[z],T=C(A,w,X.start,X.start+X.count),-1!==T&&(W=z);-1!==ea&&-1===W&&(X=I[ea])&&X.start<=T&&T<=X.start+X.count&&(W=ea)}if(-1<T&&-1<W)for(F.index=T,A.splice(T,0,y),I[W].count++,z=W+1;z<I.length;++z)I[z].start++;else if(V)for(F.beforeIndex=I[J].start,z=J;z<I.length;++z)I[z].start++}F.totalLength=
A.length}(A=v["on_tracked"+B])&&A.call(v,F)})}var h=this.store||this,p=[],q={add:1,update:1,"delete":1},u;for(u in q)p.push(this.on(u,function(B){return function(F){d(B,F)}}(u)));var v=k.safeMixin(H.delegate(this),{_ranges:[],fetch:e(),fetchRange:g(),releaseRange:function(B,F){if(this._partialResults){a:for(var y=this._ranges,w=0,A;A=y[w];++w){var z=A.start,G=z+A.count;if(B<=z)if(F>=G)y.splice(w,1);else{A.start=F;A.count=G-A.start;break a}else if(B<G)if(F>z){y.splice(w,1,{start:z,count:B-z},{start:F,
count:G-F});break a}else A.count=B-A.start}for(;B<F;++B)delete this._partialResults[B]}},on:function(B,F){var y=this,w=this.getInherited(arguments);return b.parse(v,B,F,function(A,z){return z in q?n.after(v,"on_tracked"+z,F,!0):w.call(y,z,F)})},tracking:{remove:function(){for(;0<p.length;)p.pop().remove();this.remove=function(){}}},track:null});this.fetchSync&&(k.safeMixin(v,{fetchSync:e(),fetchRangeSync:g()}),v.fetchSync());var t;l.forEach(this.queryLog,function(B){var F=t,y=B.querier;y&&(t=F?function(w){return y(F(w))}:
y)});var x={add:{index:void 0},update:{previousIndex:void 0,index:void 0},"delete":{previousIndex:void 0}},C=function(B,F,y,w){w=void 0!==w?w:B.length;for(y=void 0!==y?y:0;y<w;++y)if(h.getIdentity(B[y])===F)return y;return-1};return v}};m=k(null,f);m.create=function(e,g){e=k.safeMixin(H.delegate(e),f);k.safeMixin(e,g);return e};return m})},"dstore/Tree":function(){define(["dojo/_base/declare"],function(H){return H(null,{constructor:function(){this.root=this},mayHaveChildren:function(k){return"hasChildren"in
k?k.hasChildren:!0},getRootCollection:function(){return this.root.filter({parent:null})},getChildren:function(k){return this.root.filter({parent:this.getIdentity(k)})}})})},"esri/dijit/analysis/SpatialReferences":function(){define(["dojo/_base/lang","dojo/has","../../kernel"],function(H,k,n){for(var r=[{name:"Spatial References"},{name:"PCS",parent:"Spatial References"},{name:"UTM",parent:"PCS"},{name:"World",parent:"PCS"},{name:"Continental",parent:"World"},{name:"Sinusoidal",type:"PCS",sRef:{wkid:54008},
parent:"World"},{name:"Winkel Tripel (NGS version)",type:"PCS",sRef:{wkid:54042},parent:"World"},{name:"NAD 1983 Contiguous USA Albers",type:"PCS",sRef:{wkid:5070},parent:"Continental"},{name:"GDA 1994 Australia Albers",type:"PCS",sRef:{wkid:3577},parent:"Continental"},{name:"ETRS 1989 Lambert Azimuthal Equal Area Coord Ref Sys",type:"PCS",sRef:{wkid:3035},parent:"Continental"},{name:"ETRS 1989 Lambert Conformal Conic Coord Ref Sys",type:"PCS",sRef:{wkid:3034},parent:"Continental"},{name:"NAD 1983 Albers Canada",
type:"PCS",sRef:{wkid:102001},parent:"Continental"},{name:"NAD 1983 Lambert Canada",type:"PCS",sRef:{wkid:102002},parent:"Continental"},{name:"NAD 1983 Lambert contiguous USA",type:"PCS",sRef:{wkid:102004},parent:"Continental"},{name:"NAD 1983 Albers Alaska",type:"PCS",sRef:{wkid:3338},parent:"Continental"},{name:"NAD 1983 Albers Hawaii",type:"PCS",sRef:{wkid:102007},parent:"Continental"},{name:"NAD 1983 Albers North America",type:"PCS",sRef:{wkid:102008},parent:"Continental"},{name:"NAD 1983 Lambert North America",
type:"PCS",sRef:{wkid:102009},parent:"Continental"},{name:"WGS 1984 Sinusoidal Africa",type:"PCS",sRef:{wkid:102011},parent:"Continental"},{name:"WGS 1984 Lambert Asia",type:"PCS",sRef:{wkid:102012},parent:"Continental"},{name:"SAD 1969 Lambert South America",type:"PCS",sRef:{wkid:102015},parent:"Continental"},{name:"WGS 1984 Lambert Azimuthal EqArea North Pole",type:"PCS",sRef:{wkid:102017},parent:"Continental"},{name:"WGS 1984 Stereographic North Pole",type:"PCS",sRef:{wkid:102018},parent:"Continental"},
{name:"WGS 1984 Lambert Azimuthal EqArea South Pole",type:"PCS",sRef:{wkid:102020},parent:"Continental"},{name:"WGS 1984 Stereographic South Pole",type:"PCS",sRef:{wkid:102021},parent:"Continental"},{name:"WGS 1984 Lambert for Africa",type:"PCS",sRef:{wkid:102024},parent:"Continental"},{name:"WGS 1984 Albers for Northern Asia",type:"PCS",sRef:{wkid:102025},parent:"Continental"},{name:"WGS 1984 Lambert for Northern Asia",type:"PCS",sRef:{wkid:102027},parent:"Continental"},{name:"WGS 1984 Albers for Southern Asia",
type:"PCS",sRef:{wkid:102028},parent:"Continental"},{name:"WGS 1984 Lambert for Southern Asia",type:"PCS",sRef:{wkid:102030},parent:"Continental"},{name:"SAD 1969 Albers South America",type:"PCS",sRef:{wkid:102033},parent:"Continental"},{name:"NAD 1983 USGS Contiguous USA Albers",type:"PCS",sRef:{wkid:102039},parent:"Continental"},{name:"WGS 1984 UTM Zone 1N",type:"PCS",sRef:{wkid:32601},parent:"UTM"},{name:"WGS 1984 UTM Zone 2N",type:"PCS",sRef:{wkid:32602},parent:"UTM"},{name:"WGS 1984 UTM Zone 3N",
type:"PCS",sRef:{wkid:32603},parent:"UTM"},{name:"WGS 1984 UTM Zone 4N",type:"PCS",sRef:{wkid:32604},parent:"UTM"},{name:"WGS 1984 UTM Zone 5N",type:"PCS",sRef:{wkid:32605},parent:"UTM"},{name:"WGS 1984 UTM Zone 6N",type:"PCS",sRef:{wkid:32606},parent:"UTM"},{name:"WGS 1984 UTM Zone 7N",type:"PCS",sRef:{wkid:32607},parent:"UTM"},{name:"WGS 1984 UTM Zone 8N",type:"PCS",sRef:{wkid:32608},parent:"UTM"},{name:"WGS 1984 UTM Zone 9N",type:"PCS",sRef:{wkid:32609},parent:"UTM"},{name:"WGS 1984 UTM Zone 10N",
type:"PCS",sRef:{wkid:32610},parent:"UTM"},{name:"WGS 1984 UTM Zone 11N",type:"PCS",sRef:{wkid:32611},parent:"UTM"},{name:"WGS 1984 UTM Zone 12N",type:"PCS",sRef:{wkid:32612},parent:"UTM"},{name:"WGS 1984 UTM Zone 13N",type:"PCS",sRef:{wkid:32613},parent:"UTM"},{name:"WGS 1984 UTM Zone 14N",type:"PCS",sRef:{wkid:32614},parent:"UTM"},{name:"WGS 1984 UTM Zone 15N",type:"PCS",sRef:{wkid:32615},parent:"UTM"},{name:"WGS 1984 UTM Zone 16N",type:"PCS",sRef:{wkid:32616},parent:"UTM"},{name:"WGS 1984 UTM Zone 17N",
type:"PCS",sRef:{wkid:32617},parent:"UTM"},{name:"WGS 1984 UTM Zone 18N",type:"PCS",sRef:{wkid:32618},parent:"UTM"},{name:"WGS 1984 UTM Zone 19N",type:"PCS",sRef:{wkid:32619},parent:"UTM"},{name:"WGS 1984 UTM Zone 20N",type:"PCS",sRef:{wkid:32620},parent:"UTM"},{name:"WGS 1984 UTM Zone 21N",type:"PCS",sRef:{wkid:32621},parent:"UTM"},{name:"WGS 1984 UTM Zone 22N",type:"PCS",sRef:{wkid:32622},parent:"UTM"},{name:"WGS 1984 UTM Zone 23N",type:"PCS",sRef:{wkid:32623},parent:"UTM"},{name:"WGS 1984 UTM Zone 24N",
type:"PCS",sRef:{wkid:32624},parent:"UTM"},{name:"WGS 1984 UTM Zone 25N",type:"PCS",sRef:{wkid:32625},parent:"UTM"},{name:"WGS 1984 UTM Zone 26N",type:"PCS",sRef:{wkid:32626},parent:"UTM"},{name:"WGS 1984 UTM Zone 27N",type:"PCS",sRef:{wkid:32627},parent:"UTM"},{name:"WGS 1984 UTM Zone 28N",type:"PCS",sRef:{wkid:32628},parent:"UTM"},{name:"WGS 1984 UTM Zone 29N",type:"PCS",sRef:{wkid:32629},parent:"UTM"},{name:"WGS 1984 UTM Zone 30N",type:"PCS",sRef:{wkid:32630},parent:"UTM"},{name:"WGS 1984 UTM Zone 31N",
type:"PCS",sRef:{wkid:32631},parent:"UTM"},{name:"WGS 1984 UTM Zone 32N",type:"PCS",sRef:{wkid:32632},parent:"UTM"},{name:"WGS 1984 UTM Zone 33N",type:"PCS",sRef:{wkid:32633},parent:"UTM"},{name:"WGS 1984 UTM Zone 34N",type:"PCS",sRef:{wkid:32634},parent:"UTM"},{name:"WGS 1984 UTM Zone 35N",type:"PCS",sRef:{wkid:32635},parent:"UTM"},{name:"WGS 1984 UTM Zone 36N",type:"PCS",sRef:{wkid:32636},parent:"UTM"},{name:"WGS 1984 UTM Zone 37N",type:"PCS",sRef:{wkid:32637},parent:"UTM"},{name:"WGS 1984 UTM Zone 38N",
type:"PCS",sRef:{wkid:32638},parent:"UTM"},{name:"WGS 1984 UTM Zone 39N",type:"PCS",sRef:{wkid:32639},parent:"UTM"},{name:"WGS 1984 UTM Zone 40N",type:"PCS",sRef:{wkid:32640},parent:"UTM"},{name:"WGS 1984 UTM Zone 41N",type:"PCS",sRef:{wkid:32641},parent:"UTM"},{name:"WGS 1984 UTM Zone 42N",type:"PCS",sRef:{wkid:32642},parent:"UTM"},{name:"WGS 1984 UTM Zone 43N",type:"PCS",sRef:{wkid:32643},parent:"UTM"},{name:"WGS 1984 UTM Zone 44N",type:"PCS",sRef:{wkid:32644},parent:"UTM"},{name:"WGS 1984 UTM Zone 45N",
type:"PCS",sRef:{wkid:32645},parent:"UTM"},{name:"WGS 1984 UTM Zone 46N",type:"PCS",sRef:{wkid:32646},parent:"UTM"},{name:"WGS 1984 UTM Zone 47N",type:"PCS",sRef:{wkid:32647},parent:"UTM"},{name:"WGS 1984 UTM Zone 48N",type:"PCS",sRef:{wkid:32648},parent:"UTM"},{name:"WGS 1984 UTM Zone 49N",type:"PCS",sRef:{wkid:32649},parent:"UTM"},{name:"WGS 1984 UTM Zone 50N",type:"PCS",sRef:{wkid:32650},parent:"UTM"},{name:"WGS 1984 UTM Zone 51N",type:"PCS",sRef:{wkid:32651},parent:"UTM"},{name:"WGS 1984 UTM Zone 52N",
type:"PCS",sRef:{wkid:32652},parent:"UTM"},{name:"WGS 1984 UTM Zone 53N",type:"PCS",sRef:{wkid:32653},parent:"UTM"},{name:"WGS 1984 UTM Zone 54N",type:"PCS",sRef:{wkid:32654},parent:"UTM"},{name:"WGS 1984 UTM Zone 55N",type:"PCS",sRef:{wkid:32655},parent:"UTM"},{name:"WGS 1984 UTM Zone 56N",type:"PCS",sRef:{wkid:32656},parent:"UTM"},{name:"WGS 1984 UTM Zone 57N",type:"PCS",sRef:{wkid:32657},parent:"UTM"},{name:"WGS 1984 UTM Zone 58N",type:"PCS",sRef:{wkid:32658},parent:"UTM"},{name:"WGS 1984 UTM Zone 59N",
type:"PCS",sRef:{wkid:32659},parent:"UTM"},{name:"WGS 1984 UTM Zone 60N",type:"PCS",sRef:{wkid:32660},parent:"UTM"}],m=0;m<r.length;++m)r[m].hasChildren=void 0===r[m].type;r={identifier:"name",items:r};k("extend-esri")&&H.setObject("dijit.analysis.SpatialReferences",r,n);return r})},"esri/dijit/analysis/JobsViewModel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json dojo/Stateful dojo/topic ./utils ./storageUtils ../../kernel ../../lang".split(" "),function(H,
k,n,r,m,l,b,a,c,f,e){H=H([l],{declaredClass:"esri.dijit.analysis.JobsViewModel",constructor:function(g){this.watch("item",k.hitch(this,this.fetchJobs))},_portalUrlSetter:function(g){this.portalUrl=g},_itemSetter:function(g){this.item=g},_jobsSetter:function(g){this.jobs=g},_currentJobSetter:function(g){g&&g.jobParams&&a.jobParamsToWidgetProps(g).then(k.hitch(this,function(d){this.currentJob=d;b.publish("analysis/jobs/selectedjob",this.currentJob,this.item)}))},fetchJobs:function(){this.portalUrl&&
this.item&&c.getResourcesInfo(this.item,{portalUrl:this.portalUrl}).then(k.hitch(this,function(g){g=n.filter(g,function(d){return e.isDefined(d.toolName)&&e.isDefined(d.jobInfo)&&e.isDefined(d.jobParams)});this.set("jobs",g)}),k.hitch(this,function(g){console.log("Error fetching jobs",g)}))}});r("extend-esri")&&k.setObject("dijit.analysis.JobsViewModel",H,f);return H})},"esri/dijit/analysis/JobsList":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/json dojo/date/locale dojo/has dojo/json dojo/on dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/NodeList dojo/NodeList-dom dojo/_base/fx dojo/fx/easing dojo/Evented dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/TextBox dijit/form/ToggleButton dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/form/FilteringSelect dijit/Dialog dijit/ConfirmDialog dojox/mvc/at dgrid1/OnDemandGrid dgrid1/Tree dgrid1/Editor dgrid1/Keyboard dgrid1/Selection dgrid1/Selector dgrid1/extensions/ColumnResizer dgrid1/extensions/DijitRegistry ../../kernel ../../lang ./_Widget ./utils ./JobsViewModel dojo/i18n!../../nls/jsapi dojo/text!./templates/JobsList.html".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I,K,Q,N,T,W,X,ea,fa,J,V,aa,Z,L,O,D,P,R,ca,ha,oa,ma,U,da,na,ia){H=ma.createSubclass([F,y,w,A],{declaredClass:"esri.dijit.analysis.JobsList",templateString:ia,widgetsInTemplate:!0,i18n:null,toolName:"JobsList",helpFileName:"AnalysisEnvironments",viewModelType:da,cssClass:{primaryButton:"btn calcite blue",button:"btn calcite",tableRow:"esriHelpPopup"},constructor:function(pa,E){this._pbConnects=[];pa.containerNode&&(this.container=pa.containerNode);
this.cssClass=n.mixin({},this.cssClass)},destroy:function(){this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.i18n={};n.mixin(this.i18n,na.common);this._initModelWatchers()},postCreate:function(){this.inherited(arguments);this.buildJobsList()},startup:function(){},buildJobsList:function(){r.forEach(this.viewModel.jobs,function(pa){var E=p.create("tr",{"class":this.cssClass.tableRow},this._analysisJobTBody),M=p.create("td",{innerHTML:"\x3ca href\x3d'#'\x3e"+pa.toolName+
"\x3c/a\x3e"},E);p.create("td",{innerHTML:this._formatTimeStamp(pa.timestamp)},E);e(M,"click",n.hitch(this,this._openTool,pa))},this)},_initModelWatchers:function(){this.own(this.viewModel.watch("jobs",n.hitch(this,this.buildJobsList)))},_openTool:function(pa){this.viewModel.set("currentJob",pa)},_formatTimeStamp:function(pa){return a.format(new Date(pa),{formatLength:"medium"})}});c("extend-esri")&&n.setObject("dijit.analysis.JobsList",H,ha);return H})},"esri/dijit/analysis/components/DataStoreSelect":function(){define("../../../kernel ../../../lang ../../../request dijit/_WidgetBase dojox/lang/functional/object dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/has dojo/promise/all dojo/Evented dojo/i18n!../nls/DataStoreSelect".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g){k=l([r,e],{declaredClass:"esri.dijit.analysis.components.DataStoreSelect",geoAnalyticsServer:null,i18n:null,postMixInProperties:function(){this.inherited(arguments);this.i18n={};b.mixin(this.i18n,g)},buildRendering:function(){this.createElements()},postCreate:function(){this.inherited(arguments);this.buildDataStoreUI()},createElements:function(){this.domNode=a.create("div",{style:"width:100%;height:100%"});this._dsSelect=a.create("select",{"class":"dijit dijitReset dijitInline dijitLeft dijitDownArrowButton esriLeadingMargin1 longInput esriLongLabel dijitSelect dijitValidationTextBox",
onchange:b.hitch(this,this._handleDSSelectChange)},this.domNode)},_handleDSSelectChange:function(d){this.emit("change",{value:this._dsSelect.value})},buildDataStoreUI:function(){if(this.geoAnalyticsServer&&!this.bdfsTemplateOptions){var d=this.geoAnalyticsServer.replace("/System/GeoAnalyticsTools/GPServer","");n({url:d+"/DataStoreCatalogs",content:{f:"json"}}).then(b.hitch(this,function(h){var p=h.services.map(function(q){return q.name});h=p.map(function(q){return n({url:d+"/"+q+"/BigDataCatalogServer",
content:{f:"json"}})});f(h).then(b.hitch(this,function(q){var u=[];q.filter(function(t,x){t.name=p[x];return void 0!==t.outputTemplates}).forEach(function(t){t.outputTemplates.forEach(function(x){u.push({label:t.name.replace("DataStoreCatalogs/bigDataFileShares_","")+"-"+x.title,innerHTML:t.name.replace("DataStoreCatalogs/bigDataFileShares_","")+"-"+x.title,value:t.name.replace("DataStoreCatalogs/bigDataFileShares_","/bigDataFileShares/")+":"+x.name})})});this.bdfsTemplateOptions=u;q=a.create("optGroup",
{label:this.i18n.agsDataStore});var v=a.create("optGroup",{label:this.i18n.bdfsTemplates});q.appendChild(a.create("option",{label:this.i18n.relationalDS,value:"GDB",innerHTML:this.i18n.relationalDS}));q.appendChild(a.create("option",{label:this.i18n.spatialDS,value:"BDS",innerHTML:this.i18n.spatialDS}));u.forEach(b.hitch(this,function(t){v.appendChild(a.create("option",t))}));this._dsSelect.appendChild(q);this._dsSelect.appendChild(v);m.keys(this._dsSelect.options).some(function(t){return t.label===
this.value},this);this._setCurValue()}))}),b.hitch(this,function(){this._dsSelect.add(a.create("option",{label:this.i18n.relationalDS,value:"GDB",innerHTML:this.i18n.relationalDS}));this._dsSelect.add(a.create("option",{label:this.i18n.spatialDS,value:"BDS",innerHTML:this.i18n.spatialDS}));this._setCurValue()}))}},_setCurValue:function(){m.keys(this._dsSelect.options).some(function(d){return d.label===this.value},this)?this._dsSelect.value=this.value:this._dsSelect.value="BDS"},reset:function(){this._dsSelect.reset()},
_setGeoAnalyticsServerAttr:function(d){this.geoAnalyticsServer=d},_setValueAttr:function(d){this.value=d||"BDS"},_getValueAttr:function(){return this._dsSelect?this._dsSelect.value:null}});c("extend-esri")&&b.setObject("dijit.analysis.components.DataStoreSelect",k,H);return k})},"dojox/lang/functional/object":function(){define(["dojo/_base/kernel","dojo/_base/lang","./lambda"],function(H,k,n){var r={};k.mixin(n,{keys:function(m){var l=[],b;for(b in m)b in r||l.push(b);return l},values:function(m){var l=
[],b;for(b in m)b in r||l.push(m[b]);return l},filterIn:function(m,l,b){b=b||H.global;l=n.lambda(l);var a={},c;for(c in m)if(!(c in r)){var f=m[c];l.call(b,f,c,m)&&(a[c]=f)}return a},forIn:function(m,l,b){b=b||H.global;l=n.lambda(l);for(var a in m)a in r||l.call(b,m[a],a,m);return b},mapIn:function(m,l,b){b=b||H.global;l=n.lambda(l);var a={},c;for(c in m)c in r||(a[c]=l.call(b,m[c],c,m));return a}});return n})},"dojox/lang/functional/lambda":function(){define(["../..","dojo/_base/lang","dojo/_base/array"],
function(H,k,n){var r=k.getObject("lang.functional",!0,H),m={},l=1<"ab".split(/a*/).length?String.prototype.split:function(c){var f=this.split.call(this,c);(c=c.exec(this))&&0==c.index&&f.unshift("");return f},b=function(c){var f=[],e=l.call(c,/\s*->\s*/m);if(1<e.length)for(;e.length;)c=e.pop(),f=e.pop().split(/\s*,\s*|\s+/m),e.length&&e.push("(function("+f.join(", ")+"){ return ("+c+"); })");else if(c.match(/\b_\b/))f=["_"];else{e=c.match(/^\s*(?:[+*\/%&|\^\.=<>]|!=)/m);var g=c.match(/[+\-*\/%&|\^\.=<>!]\s*$/m);
if(e||g)e&&(f.push("$1"),c="$1"+c),g&&(f.push("$2"),c+="$2");else{e=c.replace(/(?:\b[A-Z]|\.[a-zA-Z_$])[a-zA-Z_$\d]*|[a-zA-Z_$][a-zA-Z_$\d]*:|this|true|false|null|undefined|typeof|instanceof|in|delete|new|void|arguments|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|escape|eval|isFinite|isNaN|parseFloat|parseInt|unescape|dojo|dijit|dojox|window|document|'(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"/g,"").match(/([a-z_$][a-z_$\d]*)/gi)||[];var d={};n.forEach(e,function(h){d.hasOwnProperty(h)||(f.push(h),
d[h]=1)})}}return{args:f,body:c}},a=function(c){return c.length?function(){var f=c.length-1,e=r.lambda(c[f]).apply(this,arguments);for(--f;0<=f;--f)e=r.lambda(c[f]).call(this,e);return e}:function(f){return f}};k.mixin(r,{rawLambda:function(c){return b(c)},buildLambda:function(c){c=b(c);return"function("+c.args.join(",")+"){return ("+c.body+");}"},lambda:function(c){if("function"==typeof c)return c;if(c instanceof Array)return a(c);if(m.hasOwnProperty(c))return m[c];var f=b(c);return m[c]=new Function(f.args,
"return ("+f.body+");")},clearLambdaCache:function(){m={}}});return r})},"esri/dijit/analysis/mixins/browselayers/BrowseLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/query ../../../../kernel ../../../../request ../../../../lang ../../../../layers/CSVLayer ../../../../arcgis/Portal ../../../../SpatialReference ../../ProjectExtent dojo/Deferred ../../ItemTypes ../../utils ./configs/AGOLBrowseItem ./configs/EnterpriseBrowseItem dojo/i18n!../../nls/BrowseLayerMixin".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v){H=H([],{tableSupportedTools:"JoinFeatures SummarizeAttributes ExtractData GeocodeLocationsfromTable CopyToDataStore AppendData CalculateField MergeLayers DescribeDataset DetectIncidents".split(" "),allowedItemTypes:[],defaultItemTypes:[h.MS,h.FS],availableItemTypeFilters:["layers","featureLayers"],_createBrowseItems:function(t,x,C){t=t||{};var B=t.browseValue||{};x=x||{};var F=this.defaultItemTypes.concat(this.get("allowedItemTypes"));if(this.useArcGISComponents)this.setUpItemBrowser(t,
x,C).then(function(){this.map&&this._chopExtentAtDateLine(this.map.extent).then(this._projectExtentAndDispatch.bind(this))}.bind(this));else{var y=[];F.forEach(function(w){y.push('type:"'+w+'"')});"browse"===B?(C=this._browsedlg.browseItems.get("query"),C.custom=this._queryTagsForLivingAtlasBrowseItems(x),this._browsedlg.browseItems.set("extent",this.get("map").extent),this._browsedlg.browseItems.set("query",C),this._browsedlg.show()):(this.showGeoAnalyticsParams&&y.push('type:"'+h.BIGDATA+'"'),C=
this._browseLyrsdlg.browseItems.get("query"),C.types=y,this._browseLyrsdlg.browseItems.set("query",C),x.geometryTypes?(this._browseLyrsdlg.browseItems.plugIn.checkGeometryType=!0,0<x.geometryTypes.length&&(this._browseLyrsdlg.browseItems.plugIn.geometryTypes=x.geometryTypes)):this._browseLyrsdlg.browseItems.plugIn.checkGeometryType=!1,x.layerTypes?(this._browseLyrsdlg.browseItems.plugIn.checkLayerType=!0,0<x.layerTypes.length&&(this._browseLyrsdlg.browseItems.plugIn.layerTypes=x.layerTypes)):this._browseLyrsdlg.browseItems.plugIn.checkLayerType=
!1,x.customCheck?(this._browseLyrsdlg.browseItems.plugIn.customCheckHandler=x.customCheck.customCheckHandler,this._browseLyrsdlg.browseItems.plugIn.customCheckFailureMessage=x.customCheck.customCheckFailureMessage):this._browseLyrsdlg.browseItems.plugIn.customCheckHandler=void 0,this._browseLyrsdlg.show())}},setUpItemBrowser:function(t,x,C){var B=new d;window.require(["arcgis-components/wrappers/ItemBrowser","esri/arcgis/Portal"],function(F,y){if(!this.ib){var w=document.createElement("div");!t.isDialog&&
document.body.appendChild(w);var A=new y.Portal(this.portalSelf&&this.portalSelf.urlKey&&this.portalSelf.customBaseUrl?location.protocol+"//"+this.portalSelf.urlKey+"."+this.portalSelf.customBaseUrl+"/sharing/rest":(this.portalSelf&&this.portalSelf.portalHostname?location.protocol+"//"+this.portalSelf.portalHostname:this.portalUrl)+"/sharing/rest");"ArcGISEnterpriseOnKubernetes"===(this.portalSelf||{}).portalDeploymentType&&(t.disableBoundary=!0,t.disableLAAL=!0);var z=this.defaultItemTypes.concat(this.get("allowedItemTypes")),
G=function(){this._closeFullScreenBrowser();t.isDialog&&this._closeDialog();this._resetSelectBox(C);!t.isDialog&&this._removeDOMfromBody(w)},I=function(W){this._closeFullScreenBrowser();t.isDialog&&this._closeDialog();W[0]&&W[0].type===h.RFT?this.onSelectRFTTool.bind(this)(W[0],A):W[0]&&W[0].type===h.DLPK?this.onSelectDLPKTool.bind(this)(W[0],A):this.onBrowseItemSelect.bind(this)(W[0],A,C);!t.isDialog&&this._removeDOMfromBody(w)},K=function(W){this._closeFullScreenBrowser();t.isDialog&&this._closeDialog();
this.onSelectGPTool.bind(this)(W);!t.isDialog&&this._removeDOMfromBody(w)},Q=function(W){this._closeFullScreenBrowser();t.isDialog&&this._closeDialog();this.onEditRFTTool.bind(this)(W,A);!t.isDialog&&this._removeDOMfromBody(w)},N=function(W){this._closeFullScreenBrowser();t.isDialog&&this._closeDialog();this.onBrowseItemSelect.bind(this)(W,A,C);!t.isDialog&&this._removeDOMfromBody(w)},T=function(W){t.isDialog&&this._closeDialog();W&&W.type===h.RFT?this.onEditRFTTool.bind(this)(W,A):this.onBrowseItemSelect.bind(this)(W,
A,C,!0);!t.isDialog&&this._removeDOMfromBody(w)};-1<this.tableSupportedTools.indexOf(this.helpFileName)&&(z=z.concat([this.showGeoAnalyticsParams?h.TABLE:h.BTABLE]));A.signIn().then(function(){this._fetchGroupForRFT(A).then(function(W){-1<z.indexOf(h.IS)?this.availableItemTypeFilters=["layers","featureLayers","mapImageLayers","imageryLayers"]:-1===z.indexOf(h.GPSERVICE)&&-1===z.indexOf(h.RFT)&&-1===z.indexOf(h.FILE)&&(this.availableItemTypeFilters=this.availableItemTypeFilters.concat(["layers","featureLayers"]));
-1<this.tableSupportedTools.indexOf(this.helpFileName)&&(this.availableItemTypeFilters=this.availableItemTypeFilters.concat(["tables"]));W={allowedItemTypes:this.showGeoAnalyticsParams?[h.BIGDATA].concat(z):z,availableItemTypeFilters:this.showGeoAnalyticsParams?this.availableItemTypeFilters.concat(["bigDataFileShares"]):this.availableItemTypeFilters,customQueryTags:x,addQueryParameters:t.addQueryParameters,portal:A,isPortal:this.isSingleTenant,onSelectSubLayer:N.bind(this),onActionSubLayer:T.bind(this),
onSelectGPTool:K.bind(this),onEditRFT:Q.bind(this),rftGroupId:W,disableLAAL:t.disableLAAL,disableBoundary:t.disableBoundary,title:t.title,disabledSubResources:this._getDisableResources(t.disabledSubResources),showRFTSystemSection:null!=t.showRFTSystemSection?t.showRFTSystemSection:"raster"===t.analysisMode?!0:!1,showRFTEditCustomAction:null!=t.showRFTEditCustomAction?t.showRFTEditCustomAction:!0,enableMapAreaFilter:null!=t.enableMapAreaFilter?t.enableMapAreaFilter:!0};var X=k.mixin(F.initialState.settings.config,
this.isSingleTenant?u.getConfig(W):q.getConfig(W)),ea=k.mixin(F.initialState.parameters,{section:"myContent",filter:k.mixin(F.initialState.parameters.filter,{searchMapArea:!1})});-1<W.allowedItemTypes.indexOf(h.RFT)&&!this.isSingleTenant&&(X.addQueryParameters=function(V){return"all"===V.parameters.section?"-owner: (esri_*)":""});if(-1<W.allowedItemTypes.indexOf(h.RFT)&&W.showRFTSystemSection){var fa=this.isSingleTenant;ea.section="System";ea.sort={field:"title",order:"asc"};X.enableMapAreaFilter=
!1;X.addQueryParameters=function(V){var aa;return!fa&&V.parameters&&"all"===V.parameters.section?"-owner: (esri_*)":V.parameters&&V.parameters.searchString&&V.parameters.searchString.current&&"System"===V.parameters.section?(V=V.parameters.searchString.current,-1===V.indexOf(":")&&(aa="tags: ("+V+")"),aa?aa:""):""};var J;n.some(X.customSections,function(V){if("System"===V.name)return J=V.baseQuery,!0});require(["arcgis-raster-function-editor/RFxRegistry"],function(V){V.initialize({sysRFxBaseQuery:J,
asRFxEditorBuddy:!1,isMultiTenant:!1===this.isSingleTenant});V=V.createRequestProxy(b);this._originalRequestModule=b;b=V}.bind(this))}this.ib=new F.ItemBrowserWrapper(w,{apiVersion:3,portal:A,request:b,initialState:k.mixin(F.initialState,{settings:k.mixin(F.initialState.settings,{config:k.mixin(X,{onBack:G.bind(this),onSelect:I.bind(this)})}),ui:k.mixin(F.initialState.ui,{expanded:k.mixin(F.initialState.ui.expanded,{filters:!0})})}),parameters:ea});t.isDialog&&this._createDialog(w,A);B.resolve()}.bind(this))}.bind(this))}}.bind(this));
return B},_queryTagsForLivingAtlasBrowseItems:function(t){if((t=t&&t.tags)&&0!==t.length){if(1===t.length)return['tags:"'+t[0]+'"'];m=[];t.forEach(function(x){m.push('tags:"'+x+'"')});return m}},onBrowseItemSelect:function(t,x,C,B){x=this._getPortalItem(t,x);var F={selection:x,dialog:this._browseLyrsdlg||this._browsedlg};!t.url||p.isHostedService(t.url)||this.isSingleTenant||x.selectedLayer instanceof c?this._handleBrowseItemsSelect(F,B):this._getProxyServiceInfo(t).then(function(){a.isDefined(t.analysisProxyCheck)&&
"failure"===t.analysisProxyCheck?this._resetSelectBox(C):this._handleBrowseItemsSelect(F,B)}.bind(this),function(){this._resetSelectBox(C)}.bind(this))},onSelectGPTool:function(t){t.resource.url=t.url;this._handleSelectGpTool(t.resource)},onSelectRFTTool:function(t,x){this._handleSelectRFTTool(this._getPortalItem(t,x))},onSelectDLPKTool:function(t,x){this._handleSelectDLPKTool(this._getPortalItem(t,x))},onEditRFTTool:function(t,x){this._handleEditRFTTool(this._getPortalItem(t,x))},_getPortalItem:function(t,
x){t.resource&&t.item?(x=new f.PortalItem(k.mixin(t.item,{portal:x})),x.selectedLayer=t.resource,x.selectedLayer.url=t.url):(x=new f.PortalItem(k.mixin(t,{portal:x})),t.type&&-1<[h.CSV,h.XLS].indexOf(t.type)&&(x.selectedLayer=x));return x},_createDialog:function(t,x){window.require(["dijit/Dialog","esri/dijit/analysis/mixins/browselayers/configs/Common"],function(C,B){this.itemBrowserDialog||(this.itemBrowserDialog=new C({style:"width: 900px; height:900px; overflow: auto",id:"itemBrowserDialog",closable:!1,
title:v.customAnalysisLayerTitle}));this.itemBrowserDialog.set("content",t);this.itemBrowserDialog.show()}.bind(this))},_closeDialog:function(){this.itemBrowserDialog.hide();this.itemBrowserDialog.destroy();delete this.itemBrowserDialog;delete this.ib},_closeFullScreenBrowser:function(){this._originalRequestModule&&(b=this._originalRequestModule);this.ib.dispatch({type:"CLOSE_FULLSCREEN_BROWSER"})},_setAllowedItemTypesAttr:function(t){this.allowedItemTypes=t},_setAvailableItemTypeFiltersAttr:function(t){this.availableItemTypeFilters=
t},_getDisableResources:function(t){var x={};t&&t.length&&t.forEach(function(C){C&&C.url&&(x[C.url]=!0)},this);return x},_projectExtentAndDispatch:function(t){this.sr||(this.sr=new e(4326));g(t,this.sr,function(x){this._dispatchExtentToItemBrowser(x[0])}.bind(this),function(x){console.error(x)}.bind(this))},_chopExtentAtDateLine:function(t){var x=new d;window.esri.geometry.normalizeCentralMeridian([t],null,function(C){if(C[0].rings){var B=(new window.esri.geometry.Polygon(t.spatialReference)).addRing(C[0].rings[0]).getExtent();
C=(new window.esri.geometry.Polygon(t.spatialReference)).addRing(C[0].rings[1]).getExtent();x.resolve(B.getWidth()>C.getWidth()?B:C)}else x.resolve(C[0])},function(C){x.reject(C)});return x},_dispatchExtentToItemBrowser:function(t){window.require(["arcgis-components/wrappers/ItemBrowser"],function(x){this.ib.dispatch(x.updateExtent({minx:t.xmin,miny:t.ymin,maxx:t.xmax,maxy:t.ymax}))}.bind(this))},_fetchGroupForRFT:function(t){var x=new d;-1===this.allowedItemTypes.indexOf(h.RFT)&&x.resolve();this._systemRFTsGroup&&
x.resolve(this._systemRFTsGroup);p.fetchGroupForRFT(t).then(function(C){this._systemRFTsGroup=C;x.resolve(C)}.bind(this));return x},_removeDOMfromBody:function(t){setTimeout(function(){document.body.removeChild(t)},300);delete this.ib},_resetSelectBox:function(t){t&&t.reset()},_getProxyServiceInfo:function(t){var x=new d,C;a.isDefined(t)&&a.isDefined(t.url)||x.reject({error:"mapLayer is not defined"});var B=t.url+(-1<t.url.indexOf("?")?"\x26":"?")+"f\x3djson";var F=l.id.findCredential(t.url);var y=
t.url;this.proxyCheckedServers||(this.proxyCheckedServers=[]);n.some(this.proxyCheckedServers,function(w){C=y.substring(0,y.indexOf("/",9));if(w.server===C)return t.analysisProxyCheck=w.check,!0},this)?x.resolve({}):(F&&F.token&&(B+="\x26token\x3d"+F.token),x=b({url:B,content:null},{useProxy:!0}),x.then(function(){t.analysisProxyCheck="success";this.proxyCheckedServers.push({server:y.substring(0,y.indexOf("/",9)),check:"success"})}.bind(this),function(){t.analysisProxyCheck="failure";this.proxyCheckedServers.push({server:y.substring(0,
y.indexOf("/",9)),check:"failure"})}.bind(this)));return x.promise}});r("extend-esri")&&k.setObject("dijit.analysis.mixins.browselayers.BrowseLayerMixin",H,l);return H})},"esri/layers/CSVLayer":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../arcgis/csv ./FeatureLayer ../geometry/Extent ../tasks/FeatureSet".split(" "),function(H,k,n,r,m,l,b,a,c){k=k(b,{declaredClass:"esri.layers.CSVLayer",_preventInit:!0,_fieldTypeMap:{Date:"esriFieldTypeDate",Number:"esriFieldTypeDouble",
String:"esriFieldTypeString"},constructor:function(f,e){this.url=f;e=n.mixin({},e);this.columnDelimiter=e.columnDelimiter;this.latitudeFieldName=e.latitudeFieldName;this.longitudeFieldName=e.longitudeFieldName;f=e.layerDefinition;f||(f={fields:e.fields||[],geometryType:"esriGeometryPoint",copyrightText:e.copyright},e.fields&&H.forEach(e.fields,function(g){g.type=this._fieldTypeMap[g.type||"String"];g.alias||(g.alias=g.name)},this));this._buildCsvFcParam={url:this.url,columnDelimiter:this.columnDelimiter,
layerDefinition:f,outFields:e.outFields};this.latitudeFieldName&&this.longitudeFieldName&&(this._buildCsvFcParam.locationInfo={locationType:"coordinates",latitudeFieldName:this.latitudeFieldName,longitudeFieldName:this.longitudeFieldName});this._projectFeatures=n.hitch(this,this._projectFeatures);this._addFeatures=n.hitch(this,this._addFeatures);this._initCSVLayer(e)},refresh:function(){this._fireUpdateStart();this.applyEdits(null,null,this.graphics);this._loadFeatures()},_isWebGLCompatible:function(){return!1},
_setMap:function(f){var e=this.inherited(arguments);this._fireUpdateStart();this._projectFeatures(this._csvFC).then(this._addFeatures).otherwise(this._errorHandler);this._csvFC=null;return e},_initCSVLayer:function(f){var e=this;l.buildCSVFeatureCollection(this._buildCsvFcParam).then(function(g){!e._buildCsvFcParam.locationInfo||e.latitudeFieldName&&e.longitudeFieldName||(e.latitudeFieldName=e._buildCsvFcParam.locationInfo.latitudeFieldName,e.longitudeFieldName=e._buildCsvFcParam.locationInfo.longitudeFieldName);
e._csvFC=g;var d=g.layerDefinition;d.extent=e._getFCExtent(g);f.outFields||(f.outFields=["*"]);f.timeInfo&&(d.timeInfo=f.timeInfo);e._initFeatureLayer({layerDefinition:d},f)}).otherwise(this._errorHandler)},_loadFeatures:function(){l.buildCSVFeatureCollection(this._buildCsvFcParam).then(this._projectFeatures).then(this._addFeatures).otherwise(this._errorHandler)},_projectFeatures:function(f){return l.projectFeatureCollection(f,this._map.spatialReference)},_addFeatures:function(f){f=new c(f.featureSet);
this.applyEdits(f.features,null,null);this._fireUpdateEnd()},_getFCExtent:function(f){if(f&&f.featureSet&&f.featureSet.features){f=f.featureSet.features;var e=f.length;if(1<e){var g=f[0].geometry;var d=new a(g.x,g.y,g.x,g.y);for(--e;0<e;e--)g=f[e].geometry,d.xmin=Math.min(d.xmin,g.x),d.ymin=Math.min(d.ymin,g.y),d.xmax=Math.max(d.xmax,g.x),d.ymax=Math.max(d.ymax,g.y);0>=d.getWidth()&&0>=d.getHeight()&&(d=null)}}return d}});r("extend-esri")&&n.setObject("layers.CSVLayer",k,m);return k})},"esri/arcgis/csv":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/number dojox/data/CsvStore ../kernel ../config ../request ../SpatialReference ../geometry/jsonUtils ../geometry/webMercatorUtils".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g){function d(B){var F=0,y="";k.forEach([","," ",";","|","\t"],function(w){var A=B.split(w).length;A>F&&(F=A,y=w)});return y}function h(B,F){if(!B||"[object Date]"!==Object.prototype.toString.call(B)||isNaN(B.getTime()))return!1;B=!0;if(r("chrome")&&/\d+\W*$/.test(F)){if(F.match(/[^0-9a-zA-Z\s]/))return!1;if(F=F.match(/[a-zA-Z]{2,}/)){B=!1;for(var y=0,w=F.length,A=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;!B&&
y<=w&&!(B=!A.test(F[y]));)y++;B=!B}}return B}function p(B,F,y){var w=B.indexOf("\n");w=H.trim(B.substr(0,w));var A=F.columnDelimiter;A||(A=d(w));var z=new l({data:B,separator:A});z.fetch({onComplete:function(G,I){I=0;var K={layerDefinition:F.layerDefinition,featureSet:{features:[],geometryType:"esriGeometryPoint"}},Q=K.layerDefinition.objectIdField,N=K.layerDefinition.fields;Q||k.some(N,function(D){return"esriFieldTypeOID"===D.type?(Q=D.name,!0):!1})||(N.push({name:"__OBJECTID",alias:"__OBJECTID",
type:"esriFieldTypeOID",editable:!1}),Q="__OBJECTID");var T=z._attributes,W=[],X=[];k.forEach(N,function(D){"esriFieldTypeDate"===D.type?W.push(D.name):("esriFieldTypeDouble"===D.type||"esriFieldTypeInteger"===D.type)&&X.push(D.name)});if(F.locationInfo&&"coordinates"===F.locationInfo.locationType){var ea=F.locationInfo.latitudeFieldName;var fa=F.locationInfo.longitudeFieldName}else k.forEach(T,function(D){var P=k.indexOf(t,D.toLowerCase());-1!==P&&(ea=D);P=k.indexOf(x,D.toLowerCase());-1!==P&&(fa=
D)}),ea&&fa&&(F.locationInfo={locationType:"coordinates",latitudeFieldName:ea,longitudeFieldName:fa});if(ea&&fa){-1===k.indexOf(X,ea)&&X.push(ea);-1===k.indexOf(X,fa)&&X.push(fa);if(H.isArray(F.outFields)&&-1===k.indexOf(F.outFields,"*"))var J=F.outFields;k.forEach(T,function(D){k.some(N,function(P){return D===P.name})||N.push({name:D,alias:D,type:D===ea||D===fa?"esriFieldTypeDouble":"esriFieldTypeString"})});T=0;var V=G.length;for(T;T<V;T++){var aa=G[T],Z=z.getAttributes(aa),L={};k.forEach(Z,function(D){if(D&&
(D===ea||D===fa||!J||-1<k.indexOf(J,D))){var P=D;0===D.length&&k.forEach(N,function(ca,ha){ca.name==="attribute_"+(ha-1)&&(D="attribute_"+(ha-1))});if(-1<k.indexOf(W,D)){P=z.getValue(aa,P);var R=new Date(P);L[D]=h(R,P)?R.getTime():null}else-1<k.indexOf(X,D)?(R=m.parse(z.getValue(aa,P)),D!==ea&&D!==fa||!(isNaN(R)||181<Math.abs(R))||(R=parseFloat(z.getValue(aa,P))),isNaN(R)?L[D]=null:L[D]=R):L[D]=z.getValue(aa,P)}});L[Q]=I;I++;Z=L[ea];var O=L[fa];null==O||null==Z||isNaN(Z)||isNaN(O)||(J&&-1===k.indexOf(J,
ea)&&delete L[ea],J&&-1===k.indexOf(J,fa)&&delete L[fa],K.featureSet.features.push({geometry:{x:O,y:Z,spatialReference:{wkid:4326}},attributes:L}))}K.layerDefinition.name="csv";y&&y(K)}else setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.")},1),y&&y(null,Error("File does not seem to contain fields with point coordinates."))},onError:function(G){console.error("Error fetching items from CSV store: ",G);y&&y(null,G)}});return!0}function q(B,F,y,w,A,z){0===
B.length&&A(null);var G=e.getGeometryType(F),I=[];k.forEach(B,function(K){K=new G(K);K.spatialReference=y;I.push(K)},this);F=[102113,102100,3857];y.wkid&&4326===y.wkid&&w.wkid&&-1<k.indexOf(F,w.wkid)?(k.forEach(I,function(K){K.xmin?(K.xmin=Math.max(K.xmin,-180),K.xmax=Math.min(K.xmax,180),K.ymin=Math.max(K.ymin,-89.99),K.ymax=Math.min(K.ymax,89.99)):K.rings?k.forEach(K.rings,function(Q){k.forEach(Q,function(N){N[0]=Math.min(Math.max(N[0],-180),180);N[1]=Math.min(Math.max(N[1],-89.99),89.99)},this)},
this):K.paths?k.forEach(K.paths,function(Q){k.forEach(Q,function(N){N[0]=Math.min(Math.max(N[0],-180),180);N[1]=Math.min(Math.max(N[1],-89.99),89.99)},this)},this):K.x&&(K.x=Math.min(Math.max(K.x,-180),180),K.y=Math.min(Math.max(K.y,-89.99),89.99))},this),B=[],k.forEach(I,function(K){K=g.geographicToWebMercator(K);102100!==w.wkid&&(K.spatialReference=w);B.push(K.toJson())},this),A(B)):null!==y.wkid&&-1<k.indexOf(F,y.wkid)&&null!==w.wkid&&4326===w.wkid?(B=[],k.forEach(I,function(K){B.push(g.webMercatorToGeographic(K).toJson())},
this),A(B)):(F=function(K,Q){K&&K.length===B.length?(B=[],k.forEach(K,function(N){N&&(N.rings&&0<N.rings.length&&0<N.rings[0].length&&0<N.rings[0][0].length&&!isNaN(N.rings[0][0][0])&&!isNaN(N.rings[0][0][1])||N.paths&&0<N.paths.length&&0<N.paths[0].length&&0<N.paths[0][0].length&&!isNaN(N.paths[0][0][0])&&!isNaN(N.paths[0][0][1])||N.xmin&&!isNaN(N.xmin)&&N.ymin&&!isNaN(N.ymin)||N.x&&!isNaN(N.x)&&N.y&&!isNaN(N.y))?B.push(N.toJson()):B.push(null)},this),A(B)):z(K,Q)},a.defaults.geometryService?a.defaults.geometryService.project(I,
w,H.hitch(this,F),z):A(null))}function u(B,F){var y=[102113,102100,3857];return B&&F&&B.wkid===F.wkid&&B.wkt===F.wkt||B&&F&&B.wkid&&F.wkid&&-1<k.indexOf(y,B.wkid)&&-1<k.indexOf(y,F.wkid)?!0:!1}function v(B,F,y,w){if(B.featureSet&&0!==B.featureSet.features.length)if(u(y,F))w(B);else{var A=function(K){var Q=[];k.forEach(B.featureSet.features,function(N,T){K[T]&&(N.geometry=K[T],Q.push(N))},this);w(B)},z=function(K,Q){console.error("error projecting featureSet ("+B.layerDefinition.name+"). Final try.");
w(B)},G=function(K,Q){console.error("error projecting featureSet ("+B.layerDefinition.name+"). Try one more time.");q(I,B.featureSet.geometryType,F,y,H.hitch(this,A),H.hitch(this,z))};if(B.featureSet.features&&0<B.featureSet.features.length){var I=[];k.forEach(B.featureSet.features,function(K){if(K.geometry.toJson)I.push(K.geometry);else{var Q=e.getGeometryType(B.featureSet.geometryType);I.push(new Q(K.geometry))}});F.toJson||(F=new f(F));y.toJson||(y=new f(y));q(I,B.featureSet.geometryType,F,y,H.hitch(this,
A),H.hitch(this,G))}else w(B)}}var t="lat latitude y ycenter latitude83 latdecdeg point-y lat_dd".split(" "),x="lon lng long longitude x xcenter longitude83 longdecdeg point-x long_dd".split(" "),C={latFieldStrings:t,longFieldStrings:x,buildCSVFeatureCollection:function(B){var F=new n,y=function(A,z){z?F.errback(z):F.callback(A)},w={url:B.url,handleAs:"text",load:function(A){p(A,B,H.hitch(this,y))},error:function(A){F.errback(A);console.error("error: "+A)}};-1<B.url.indexOf("arcgis.com")&&-1<B.url.indexOf("/content/items")&&
-1<B.url.indexOf("/data")&&(w.headers={"Content-Type":""});c(w,{usePost:!1});return F},projectFeatureCollection:function(B,F,y){var w=new n;y||(y=new f({wkid:4326}));v(B,y,F,H.hitch(this,function(A){w.callback(A)}));return w},generateDefaultPopupInfo:function(B){var F={esriFieldTypeDouble:1,esriFieldTypeSingle:1},y={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},w={esriFieldTypeDate:1},A=null;B=k.map(B.layerDefinition.fields,H.hitch(this,function(z){"NAME"===z.name.toUpperCase()&&(A=z.name);
var G="esriFieldTypeOID"!==z.type&&"esriFieldTypeGlobalID"!==z.type&&"esriFieldTypeGeometry"!==z.type,I=null;if(G){var K=z.name.toLowerCase();if(-1<",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,".indexOf(","+K+",")||-1<K.indexOf("area")||-1<K.indexOf("length")||-1<K.indexOf("shape")||-1<K.indexOf("perimeter")||-1<K.indexOf("objectid")||K.indexOf("_")===K.length-1||K.indexOf("_i")===K.length-2&&1<K.length)G=!1;z.type in y?I={places:0,digitSeparator:!0}:z.type in
F?I={places:2,digitSeparator:!0}:z.type in w&&(I={dateFormat:"shortDateShortTime"})}return H.mixin({},{fieldName:z.name,label:z.alias,isEditable:!0,tooltip:"",visible:G,format:I,stringFieldOption:"textbox"})}));return{title:A?"{"+A+"}":"",fieldInfos:B,description:null,showAttachments:!1,mediaInfos:[]}},_getSeparator:d,_isValidDate:h,_processCsvData:p,_projectGeometries:q,_sameSpatialReference:u,_projectFeatureSet:v};r("extend-esri")&&H.setObject("arcgis.csv",C,b);return C})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),
function(H,k,n,r,m,l){k=k("dojox.data.CsvStore",null,{constructor:function(b){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=!1;b.url&&(this.url=b.url);this._csvData=b.data;b.label?this.label=b.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=b.identifier;""===this.identifier?
delete this.identifier:this._idMap={};"separator"in b&&(this.separator=b.separator);"urlPreventCache"in b&&(this.urlPreventCache=b.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",separator:",",urlPreventCache:!1,_assertIsItem:function(b){if(!this.isItem(b))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(b){b=this.getIdentity(b);this.identifier&&(b=this._idMap[b]);return b},getValue:function(b,a,c){this._assertIsItem(b);var f=
c;if("string"===typeof a)a=this._attributeIndexes[a],null!=a&&(f=this._dataArray[this._getIndex(b)][a]||c);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");return f},getValues:function(b,a){return(b=this.getValue(b,a))?[b]:[]},getAttributes:function(b){this._assertIsItem(b);var a=[];b=this._dataArray[this._getIndex(b)];for(var c=0;c<b.length;c++)""!==b[c]&&a.push(this._attributes[c]);return a},hasAttribute:function(b,a){this._assertIsItem(b);
if("string"===typeof a)return a=this._attributeIndexes[a],b=this._dataArray[this._getIndex(b)],"undefined"!==typeof a&&a<b.length&&""!==b[a];throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");},containsValue:function(b,a,c){var f=void 0;"string"===typeof c&&(f=m.patternToRegExp(c,!1));return this._containsValue(b,a,c,f)},_containsValue:function(b,a,c,f){b=this.getValues(b,a);for(a=0;a<b.length;++a){var e=b[a];if("string"===typeof e&&f)return null!==
e.match(f);if(c===e)return!0}return!1},isItem:function(b){if(b&&b[this._storeProp]===this)if(b=b[this._idProp],this.identifier){if(this._dataArray[this._idMap[b]])return!0}else if(0<=b&&b<this._dataArray.length)return!0;return!1},isItemLoaded:function(b){return this.isItem(b)},loadItem:function(b){},getFeatures:function(){return this._features},getLabel:function(b){if(this.label&&this.isItem(b))return this.getValue(b,this.label)},getLabelAttributes:function(b){return this.label?[this.label]:null},
_fetchItems:function(b,a,c){var f=this,e=function(p,q){var u=null;if(p.query){var v;u=[];var t=p.queryOptions?p.queryOptions.ignoreCase:!1,x={};for(v in p.query){var C=p.query[v];"string"===typeof C&&(x[v]=m.patternToRegExp(C,t))}for(t=0;t<q.length;++t){var B=!0,F=q[t];for(v in p.query)C=p.query[v],f._containsValue(F,v,C,x[v])||(B=!1);B&&u.push(F)}}else u=q.slice(0,q.length);a(u,p)};if(this._loadFinished)e(b,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:b,
filter:e});else{this._loadInProgress=!0;var g=n.get({url:f.url,handleAs:"text",preventCache:f.urlPreventCache});g.addCallback(function(p){try{f._processData(p),e(b,f._arrayOfAllItems),f._handleQueuedFetches()}catch(q){c(q,b)}});g.addErrback(function(p){f._loadInProgress=!1;if(c)c(p,b);else throw p;});var d=null;b.abort&&(d=b.abort);b.abort=function(){var p=g;p&&-1===p.fired&&(p.cancel(),p=null);d&&d.call(b)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,e(b,this._arrayOfAllItems)}catch(p){c(p,
b)}else{var h=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(c)c(h,b);else throw h;}},close:function(b){},_getArrayOfArraysFromCsvFileContents:function(b){if(H.isString(b)){var a=/^\s+/g,c=/\s+$/g,f=/""/g,e=[],g=this._splitLines(b);for(b=0;b<g.length;++b){var d=g[b];if(0<d.length){d=d.split(this.separator);for(var h=0;h<d.length;){var p=d[h].replace(a,""),q=p.replace(c,""),u=q.charAt(0),v=q.charAt(q.length-1),t=q.charAt(q.length-2),x=q.charAt(q.length-
3);if(2===q.length&&'""'==q)d[h]="";else if('"'==u&&('"'!=v||'"'==v&&'"'==t&&'"'!=x)){if(h+1===d.length)return;d[h]=p+this.separator+d[h+1];d.splice(h+1,1)}else'"'==u&&'"'==v&&(q=q.slice(1,q.length-1),q=q.replace(f,'"')),d[h]=q,h+=1}e.push(d)}}this._attributes=e.shift();for(b=0;b<this._attributes.length;b++)this._attributeIndexes[this._attributes[b]]=b;this._dataArray=e}},_splitLines:function(b){var a=[],c,f="",e=!1;for(c=0;c<b.length;c++){var g=b.charAt(c);switch(g){case '"':e=!e;f+=g;break;case "\r":e?
f+=g:(a.push(f),f="",c<b.length-1&&"\n"==b.charAt(c+1)&&c++);break;case "\n":e?f+=g:(a.push(f),f="");break;default:f+=g}}""!==f&&a.push(f);return a},_processData:function(b){this._getArrayOfArraysFromCsvFileContents(b);this._arrayOfAllItems=[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(b=0;b<this._dataArray.length;b++){var a=b;this.identifier&&(a=this._dataArray[b][this._attributeIndexes[this.identifier]],
this._idMap[a]=b);this._arrayOfAllItems.push(this._createItemFromIdentity(a))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(b){var a={};a[this._storeProp]=this;a[this._idProp]=b;return a},getIdentity:function(b){return this.isItem(b)?b[this._idProp]:null},fetchItemByIdentity:function(b){var a=b.scope?b.scope:r.global;if(this._loadFinished){var c=this._createItemFromIdentity(b.identity);this.isItem(c)||(c=null);b.onItem&&b.onItem.call(a,c)}else{var f=this;if(""!==
this.url)this._loadInProgress?this._queuedFetches.push({args:b}):(this._loadInProgress=!0,c=n.get({url:f.url,handleAs:"text"}),c.addCallback(function(e){try{f._processData(e);var g=f._createItemFromIdentity(b.identity);f.isItem(g)||(g=null);b.onItem&&b.onItem.call(a,g);f._handleQueuedFetches()}catch(d){b.onError&&b.onError.call(a,d)}}),c.addErrback(function(e){this._loadInProgress=!1;b.onError&&b.onError.call(a,e)}));else if(this._csvData)try{f._processData(f._csvData),f._csvData=null,c=f._createItemFromIdentity(b.identity),
f.isItem(c)||(c=null),b.onItem&&b.onItem.call(a,c)}catch(e){b.onError&&b.onError.call(a,e)}}},getIdentityAttributes:function(b){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var b=0;b<this._queuedFetches.length;b++){var a=this._queuedFetches[b],c=a.filter,f=a.args;c?c(f,this._arrayOfAllItems):this.fetchItemByIdentity(a.args)}this._queuedFetches=[]}}});H.extend(k,l);return k})},"esri/dijit/analysis/ProjectExtent":function(){define(["dojo/_base/array",
"esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/geometry/Polygon","esri/tasks/GeometryService"],function(H,k,n,r,m){function l(b,a){if(b&&a.xmin>a.xmax){var c=b.valid[1]-a.xmin,f=a.xmax-b.valid[0];c>f?a.xmax=b.valid[1]+f:a.xmin=b.valid[0]-c}}return function(b,a,c,f,e,g){var d=[102113,102100,3857],h=b.spatialReference.wkid;if(h===a.wkid)return c([b],null);if(4326==h&&-1<H.indexOf(d,a.wkid))return b.ymin=Math.max(b.ymin,-89.99),b.ymax=Math.min(b.ymax,89.99),b=n.geographicToWebMercator(b),
e=b.spatialReference._getInfo(),l(e,b),b.spatialReference.wkid=a.wkid,c([b],null);if(-1<H.indexOf(d,h)&&4326==a.wkid)return b=n.webMercatorToGeographic(b),e=b.spatialReference._getInfo(),l(e,b),c([b],null);g||(g=new m(window.esriGeowConfig.self.helperServices.geometry.url));if(e&&e.wrapAround180&&"extent"===b.type){var p=b;b=r.fromExtent(b)}g.project([b],a,function(q,u){if(!(q&&0<q.length&&q[0]&&"extent"==q[0].type)||isNaN(q[0].xmin)||isNaN(q[0].ymin)||isNaN(q[0].xmax)||isNaN(q[0].ymax)){if(q&&0<
q.length&&q[0]&&"point"==q[0].type&&!isNaN(q[0].x)&&!isNaN(q[0].y))return c(q,u);if(p&&"polygon"===q[0].type){if(1===q[0].rings.length)q[0]=new k(q[0].getExtent());else{var v=(new r(q[0].spatialReference.toJson())).addRing(q[0].rings[0]).getExtent(),t=(new r(q[0].spatialReference.toJson())).addRing(q[0].rings[1]).getExtent();q[0]=t;q[0].xmin=t.xmin-v.getWidth();q[0].ymin=Math.min(t.ymin,v.ymin);q[0].ymax=Math.max(t.ymax,v.ymax)}return c(q,u)}if(f)return f()}else return c(q,u)},f)}})},"esri/dijit/analysis/mixins/browselayers/configs/AGOLBrowseItem":function(){define(["dojo/_base/lang",
"dojo/has","../../../../../kernel","./EnterpriseBrowseItem","../../../ItemTypes"],function(H,k,n,r,m){var l={getConfig:function(b){var a=r.getConfig(b);a.baseSections.push("all");a.baseSections.push("subscription");(-1<b.allowedItemTypes.indexOf(m.RFT)||-1<b.allowedItemTypes.indexOf(m.DLPK))&&a.baseSections.push("livingAtlas");return a}};k("extend-esri")&&H.setObject("dijit.analysis.mixins.browselayers.configs.AGOLBrowseItem",l,n);return l})},"esri/dijit/analysis/mixins/browselayers/configs/EnterpriseBrowseItem":function(){define("dojo/_base/lang dojo/has dojox/lang/functional/object ../../../../../kernel ./Common ../../../AnalysisRegistry ../../../ItemTypes dojo/i18n!../../../nls/BrowseLayerMixin".split(" "),
function(H,k,n,r,m,l,b,a){var c={getConfig:function(f){var e=f.disableLAAL?{customSections:[]}:{customSections:m.getLAALCustomSection(f)};!f.disableBoundary&&f.portal.EsriBoundaryLayersGroupQuery&&e.customSections.push(m.getBoundaryLayersSection(f));-1<f.allowedItemTypes.indexOf(b.RFT)&&f.showRFTSystemSection&&e.customSections.push(m.getSystemRFTSection(f));e=H.mixin({dialogTitle:f.title||a.customAnalysisLayerTitle,allowedItemTypes:f.allowedItemTypes,availableItemTypeFilters:f.availableItemTypeFilters,
baseSections:["myContent","myFavorites","myGroups","myOrganization"],resultsPerQuery:m.getNumberOfPages(),layoutMode:"fullscreen",staticFilters:m.getStaticFilters(f.customQueryTags),mainActionTitle:a.mainActionTitle,customActions:[m.getAddtoMapActions(f.onActionSubLayer)],showSubResources:this._getSubResourcesForPortal(f),disabledSubResources:f.disabledSubResources,addQueryParameters:f.addQueryParameters,enableMapAreaFilter:f.enableMapAreaFilter},e);f.showRFTEditCustomAction&&e.customActions.push(m.getEditRFTActions(f.onEditRFT));
return e},_getSubResourcesForPortal:function(f){var e={};-1<f.allowedItemTypes.indexOf(b.FS)&&(e[b.FS]={allowed:function(g){return this.allowedItemsForTypes(g,f.customQueryTags)}.bind(this),onSelect:f.onSelectSubLayer,customActions:[m.getAddtoMapActions(f.onActionSubLayer)],filters:this._getFilterforSubLayer(!1,f.customQueryTags)});-1<f.allowedItemTypes.indexOf(b.MS)&&(e[b.MS]={allowed:function(g){return this.allowedItemsForTypes(g,f.customQueryTags)}.bind(this),onSelect:f.onSelectSubLayer,customActions:[m.getAddtoMapActions(f.onActionSubLayer)],
filters:this._getFilterforSubLayer(!1,f.customQueryTags)});-1<f.allowedItemTypes.indexOf(b.BIGDATA)&&(e[b.BIGDATA]={allowed:function(g){return this.allowedItemsForTypes(g,f.customQueryTags)}.bind(this),onSelect:f.onSelectSubLayer,filters:this._getFilterforSubLayer(!0,f.customQueryTags)});-1<f.allowedItemTypes.indexOf(b.GPSERVICE)&&(e[b.GPSERVICE]={allowed:function(){return!0},onSelect:f.onSelectGPTool,filters:[]});return e},_getFilterforSubLayer:function(f,e){var g=[];g.push(this.getGeometryFilter(e.geometryTypes));
e.layerTypes&&(f?g.push(this.getFilterForLayerTypesForBigData(e.layerTypes)):g.push(this.getFilterForLayerTypesForFS(e.layerTypes)));e.timeTypes&&g.push(this.getTimeFilter(e.timeTypes));return g},getGeometryFilter:function(f){var e=[];(f&&0<f.length?f:n.values(l.GeometryTypes)).forEach(function(g){switch(g){case l.GeometryTypes.Point:e.push({displayName:a.pointFilterName,allowed:this.filters.geometryTypes[l.GeometryTypes.Point],value:"point"});break;case l.GeometryTypes.Polygon:e.push({displayName:a.polygonFilterName,
allowed:this.filters.geometryTypes[l.GeometryTypes.Polygon],value:"polygon"});break;case l.GeometryTypes.Line:e.push({displayName:a.lineFilterName,allowed:this.filters.geometryTypes[l.GeometryTypes.Line],value:"line"});break;case l.GeometryTypes.MultiPoint:e.push({displayName:a.multiPointFilterName,allowed:this.filters.geometryTypes[l.GeometryTypes.MultiPoint],value:"multipoint"})}},this);return{allowed:function(){return!0},displayName:a.geometryFilterName,value:"geometry",children:e}},getFilterForLayerTypesForFS:function(f){var e=
[];(f?0<f.length?f:[b.FLAYER,b.TABLE]:[]).forEach(function(g){switch(g){case b.FLAYER:e.push({displayName:a.featureLayerName,allowed:this.filters.layerTypes[b.FLAYER],value:"featurelayer"});break;case b.TABLE:e.push({displayName:a.tableLayerName,allowed:this.filters.layerTypes[b.TABLE],value:"ftable"})}},this);return{allowed:function(){return!0},displayName:a.itemTypeFilterName,value:"itemtype",children:e}},getFilterForLayerTypesForBigData:function(f){var e=[];(f?0<f.length?f:[b.BDATAFEATURE,b.BTABLE]:
[]).forEach(function(g){switch(g){case b.BDATAFEATURE:e.push({displayName:a.featureLayerName,allowed:this.filters.layerTypes[b.BDATAFEATURE],value:"bfeaturelayer"});break;case b.BTABLE:e.push({displayName:a.tableLayerName,allowed:this.filters.layerTypes[b.BTABLE],value:"btable"})}},this);return{allowed:function(){return!0},displayName:a.featureLayerName,value:"itemtype",children:e}},getTimeFilter:function(f){var e=[];(f?0<f.length?f:[l.TimeTypes.Instant,l.TimeTypes.Interval]:[]).forEach(function(g){switch(g){case l.TimeTypes.Instant:e.push({displayName:a.instantFilterName,
allowed:this.filters.timeTypes[l.TimeTypes.Instant].bind(this),value:"instant"});break;case l.TimeTypes.Interval:e.push({displayName:a.intervalFilterName,allowed:this.filters.timeTypes[l.TimeTypes.Interval].bind(this),value:"interval"})}},this);return{allowed:function(){return!0},displayName:a.timeFilterName,value:"time",children:e}},allowedItemsForTypes:function(f,e){var g=!0,d=e.layerTypes||[b.FLAYER,b.BDATAFEATURE];e.geometryTypes&&f.geometryType&&(e.geometryTypes=0<e.geometryTypes.length?e.geometryTypes:
n.values(l.GeometryTypes),g=g&&-1!==e.geometryTypes.indexOf(f.geometryType));d&&f.type&&(d=0<d.length?d:[b.FLAYER,b.BDATAFEATURE,b.BTABLE,b.TABLE],g=g&&-1!==d.indexOf(f.type));e.timeTypes&&(e.timeTypes=0<e.timeTypes.length?e.timeTypes:[l.TimeTypes.Instant,l.TimeTypes.Interval],g=g&&-1!==e.timeTypes.indexOf(this.getTimeType(f)));e.customCheck&&e.customCheck.customCheckHandler&&(g=g&&e.customCheck.customCheckHandler(f));return g&&f},getTimeType:function(f){return f?this.isDefined(f.timeInfo)&&this.isDefined(f.timeInfo.startTimeField)&&
!this.isDefined(f.timeInfo.endTimeField)?l.TimeTypes.Instant:this.isDefined(f.timeInfo)&&this.isDefined(f.timeInfo.startTimeField)&&this.isDefined(f.timeInfo.endTimeField)?l.TimeTypes.Interval:this.isDefined(f.time)&&this.isDefined(f.time.timeType)?f.time.timeType:!1:!1},isDefined:function(f){return void 0!==f&&null!==f},filters:{layerTypes:{"Feature Layer":function(f){return f.type===b.FLAYER},Table:function(f){return f.type===b.TABLE},featureClass:function(f){return f.type===b.BDATAFEATURE},table:function(f){return f.type===
b.BTABLE}},geometryTypes:{esriGeometryMultipoint:function(f){return f.geometryType===l.GeometryTypes.MultiPoint},esriGeometryPolyline:function(f){return f.geometryType===l.GeometryTypes.Line},esriGeometryPolygon:function(f){return f.geometryType===l.GeometryTypes.Polygon},esriGeometryPoint:function(f){return f.geometryType===l.GeometryTypes.Point}},timeTypes:{instant:function(f){return this.getTimeType(f)===l.TimeTypes.Instant},interval:function(f){return this.getTimeType(f)===l.TimeTypes.Interval}}}};
k("extend-esri")&&H.setObject("dijit.analysis.mixins.browselayers.configs.EnterpriseBrowseItem",c,r);return c})},"esri/dijit/analysis/mixins/browselayers/configs/Common":function(){define(["dojo/_base/lang","dojo/has","../../../../../kernel","dojo/i18n!../../../nls/BrowseLayerMixin","../../../ItemTypes"],function(H,k,n,r,m){var l={getLAALCustomSection:function(b){var a=this._isCustomAnalysisQuery(b.portal,b.isPortal),c=[{name:r.customeSectionName,baseQuery:this._getLAALBaseQuery(b.customQueryTags,
b.portal,b.isPortal),filters:[{fetchGroupIdByQuery:this._getDefaultQueryString(b.isPortal),name:r.Categories,type:"group",path:["categories"],staticSchema:this._getStaticLAALSchema(b.portal,b.isPortal)}].concat(this._getFilters(b.isPortal)),disableSubResources:!0}];a&&c.push({name:r.customAnalysisGroupName,baseQuery:"",filters:[{id:this._getAnalysisGroupQuery(b.portal,b.isPortal).split(":")[1],name:r.Categories,type:"group",path:["categories"],staticSchema:void 0}].concat(this._getFilters(b.isPortal)),
disableSubResources:!1});return c},getAddtoMapActions:function(b){return{allowed:function(a){return a.type!==m.RFT&&a.type!==m.XLS&&a.type!==m.CSV&&a.type!==m.DLPK},asynchronous:!1,onAction:b,name:r.customActionName}},getEditRFTActions:function(b){return{allowed:function(a){return a.type===m.RFT&&!a.rfxTemplateData},asynchronous:!1,onAction:b,name:r.edit}},getSystemRFTSection:function(b){var a='(group:"'+(b.rftGroupId&&b.rftGroupId.id)+'") -type:"Attachment" -tags:"mature support"';b.isPortal||(a+=
' -typekeywords:"categoryname#distance (legacy)system_rft"');return{name:"System",baseQuery:a,filters:[].concat(this._getFilters(b.isPortal)),addToFront:!1,sortField:"title"}},getStaticFilters:function(b){if((b=b.tags)&&0!==b.length){var a=[];b.forEach(function(c){a.push(r[c]?r[c]:c)});return a}},getBoundaryLayersSection:function(b){return{name:r.boundaryLayers,baseQuery:"("+b.portal.EsriBoundaryLayersGroupQuery.split("AND")[1].trim()+')-type:"Attachment" -tags:"mature support"',filters:this._getFilters(b.isPortal),
addToFront:!1,disableSubResources:!1}},getNumberOfPages:function(){return 16},_getLAALBaseQuery:function(b,a,c){c=['typekeywords:"Analysis Ready"'];(a||a.user||!a.user.demographics)&&c.push('-typekeywords:"Requires Credits"');c.push('-type:"Attachment" -tags:"mature support"');c.push(this._queryTagsForLivingAtlasItemBrowser(b));return c.join(" ")},_queryTagsForLivingAtlasItemBrowser:function(b){b=b.tags;var a=[];if(!b||0===b.length)return"";if(1===b.length)return"tags: ("+b[0]+")";b.forEach(function(c){a.push(c)});
return"tags: ("+a.join(" OR ")+")"},_getAnalysisGroupQuery:function(b,a){return this._isCustomAnalysisQuery(b,a)},_getDefaultQueryString:function(b){var a='title:"Living Atlas Analysis Layers" AND owner:esri';b&&(a='title:"Living Atlas Analysis Layers" AND owner:esri_livingatlas');return a},_isCustomAnalysisQuery:function(b,a){return b&&b.analysisLayersGroupQuery&&b.analysisLayersGroupQuery!==this._getDefaultQueryString(a)?b.analysisLayersGroupQuery:!1},_getStaticLAALSchema:function(b,a){return[{title:"categories",
categories:[{title:"boundaries and places",categories:[{title:"boundaries",categories:[],displayName:r.boundaries},{title:"places",categories:[],displayName:r.places}],displayName:r.boundariesAndPlaces},{title:"hexbins",categories:[],displayName:r.hexbins},{title:"transportation",categories:[],displayName:r.transportation}]}]},_getFilters:function(b){return["tags"]}};k("extend-esri")&&H.setObject("dijit.analysis.mixins.browselayers.configs.Common",l,n);return l})},"esri/dijit/analysis/mixins/FilterAndSelection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has dojo/dom-construct dojo/dom-class ../../../kernel dojo/aspect ../components/FilterAndSelection/FilterAndSelection".split(" "),
function(H,k,n,r,m,l,b,a,c,f){H=H([],{showFilterAndSelection:!1,filterAndSelections:[],aspectsForFilters:[],_updateJobFilterAndSelection:function(e){this.showFilterAndSelection&&this.filterObjects&&this.filterObjects.forEach(function(g){var d=e[g.layer]||e[g.jobParamLayer],h=this.filterAndSelections[g.layer];if((d="string"===typeof d?r.fromJson(d):d)&&h){var p=h.get("inputQuery");p&&(d.filter=d.filter?d.filter+" AND "+p:p,e[g.layer]=r.toJson(d),e[g.jobParamLayer]&&(e[g.jobParamLayer]=r.toJson(d)),
h.get("expression")&&(e[g.expressionObj]=r.toJson(h.get("expression"))))}}.bind(this));return e},clearFilterAndSelection:function(){n.forEach(this.aspectsForFilters,function(e){e.remove()});n.forEach(Object.keys(this.filterAndSelections),function(e){this.filterAndSelections[e].clear()},this)},_createFilterAndSelections:function(){this.filterAndSelections={};this.showFilterAndSelection&&n.forEach(this.filterObjects,function(e){this.filterAndSelections[e.layer]=this._createFilterAndSelection(e)},this)},
_createFilterAndSelection:function(e){b.add(e.select.domNode,"with-filter");var g=e.layerForTool||e.layer,d={map:this.map,layer:this[e.layer]||this[e.layerForTool]||e.layers&&e.layers[e.select.get("value")],expression:this[e.expressionObj]};d=this.constructDomForFilter(d,e.select);this.aspectsForFilters.push(c.after(e.select,"onChange",function(h){0<=parseInt(h)&&(h=e.layers&&e.layers[h]||this[g],this.filterAndSelections[e.layer]&&this.filterAndSelections[e.layer].set("layer",h))}.bind(this),!0));
this.aspectsForFilters.push(c.after(this,"_onClose",this.clearFilterAndSelection.bind(this)));return d},constructDomForFilter:function(e,g){g=g.domNode.parentNode;var d=l.create("div",null,g);e.msgContainer=l.create("div",{class:"esriLeadingMargin1 paddingTop1"},g);return new f(e,d)}});m("extend-esri")&&k.setObject("dijit.analysis.mixins.FilterAndSelection.FilterAndSelection",H,a);return H})},"esri/dijit/analysis/components/FilterAndSelection/FilterAndSelection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/_base/connect dojo/has dojo/string dojo/dom-attr dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/Button dijit/form/ToggleButton dijit/Dialog ../../../../kernel ../../../../lang ../../../../layers/FeatureLayer ../../ExpressionForm ../../../../geometry/Extent ../../../../geometry/ScreenPoint ../../../../symbols/CartographicLineSymbol ../../../../symbols/SimpleMarkerSymbol ../../../../symbols/SimpleLineSymbol ../../../../symbols/SimpleFillSymbol ../../../../tasks/query ../../ItemTypes ../../AnalysisRegistry dojo/i18n!../../../../nls/jsapi dojo/text!./FilterAndSelection.html".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I){H=H([c,f,e],{declaredClass:"esri.dijit.analysis.components.FilterAndSelection.FilterAndSelection",templateString:I,_pbConnects:[],i18n:{},map:{},layer:{},msgContainer:null,expression:{},inputQuery:"",postMixInProperties:function(){this.inherited(arguments);k.mixin(this.i18n,G.expressionGrid);k.mixin(this.i18n,G.common)},destroy:function(){this.inherited(arguments);n.forEach(this._pbConnects,m.disconnect);delete this._pbConnects},
postCreate:function(){this.inherited(arguments);this.own(this._expressionForm.on("add-expression",k.hitch(this,this._handleExpressionFormAdd)));this.own(this._expressionForm.on("cancel-expression",k.hitch(this,this._handleExpressionFormCancel)))},startup:function(){},_handleSelectionButtonClick:function(K){K&&!this._mapClickHandle?(this._mapClickHandle=this.map.on("click",k.hitch(this,this._handleMapClick)),this.emit("selecttool-activate",{}),this.set("expression",void 0)):(this._mapClickHandle&&
(this._mapClickHandle.remove(),this._mapClickHandle=null),this.emit("selecttool-deactivate",{}))},_setInputQueryForRerun:function(){var K=this.layer&&(this.layer.type===A.BDATAFEATURE||this.layer.type===A.BTABLE);this.layer&&this.layer.filter&&-1!==this.layer.filter.indexOf(" AND ")?(this.set("inputQuery",this.layer.filter.substring(this.layer.filter.indexOf(" AND ")+5)),K||this.layer.setDefinitionExpression(this.layer.filter.substring(0,this.layer.filter.indexOf(" AND ")))):this.layer&&this.layer.filter&&
-1===this.layer.filter.indexOf(" AND ")&&(this.set("inputQuery",this.layer.filter),K||this.layer.setDefinitionExpression(null));this.inputQuery===(this.expression&&this.expression.expression.where)?a.set(this.msgContainer,"innerHTML",this.expression.expression._attributeText):0===this._getObjectIds().length&&a.set(this.msgContainer,"innerHTML","")},_handleQueryButtonClick:function(){this._expDialog.set("title",this.i18n.queryLabel);this._selectBtn.set("checked",!1);this._isAttrFlag=!0;this._expressionForm.set("showUnique",
!(this.layer&&(this.layer.type===A.BDATAFEATURE||this.layer.type===A.TABLE||this.layer.type===A.BTABLE)));this.expression?(this._expressionForm.set("action","edit"),this._expressionForm.set("expression",this.expression.expression)):this._expressionForm.set("action","add");this._expDialog.show()},_handleExpressionFormAdd:function(K){this.selectionLayer&&this.selectionLayer.clearSelection();if("add"===K.action||"edit"===K.action)this.set("expression",K),this.set("inputQuery",K.expression&&K.expression.where||
""),K=this._getQuery(),this.selectionLayer&&this.selectionLayer.selectFeatures(K,u.SELECTION_ADD);this._expDialog.hide()},_handleExpressionFormCancel:function(){this._expDialog.hide()},clear:function(){this.selectionLayer&&(this.selectionLayer.clearSelection(),this.map.removeLayer(this.selectionLayer),this.selectionLayer=null,this.set("inputQuery",""));this._mapClickHandle&&(this._mapClickHandle.remove(),delete this._mapClickHandle)},_handleMapClick:function(K){var Q;!this._isAttrFlag&&this.expression&&
this.selectionLayer.clearSelection();var N=6;if((Q=this.layer.renderer)&&"esri.renderer.SimpleRenderer"===Q.declaredClass){var T=Q.symbol;T.xoffset&&(N=Math.max(N,Math.abs(T.xoffset)));T.yoffset&&(N=Math.max(N,Math.abs(T.yoffset)))}else!Q||"esri.renderer.UniqueValueRenderer"!==Q.declaredClass&&"esri.renderer.ClassBreaksRenderer"!==Q.declaredClass||n.forEach(Q.infos,function(W){T=W.symbol;T.xoffset&&(N=Math.max(N,Math.abs(T.xoffset)));T.yoffset&&(N=Math.max(N,Math.abs(T.yoffset)))});Q=K.screenPoint;
K=this.map.toMap(new x(Q.x-N,Q.y+N));Q=this.map.toMap(new x(Q.x+N,Q.y-N));K=new t(K.x,K.y,Q.x,Q.y,this.map.spatialReference);K=this._getQuery({extent:K});this.layer.getDefinitionExpression&&(K.where=this.layer.getDefinitionExpression());this.layer.queryFeatures(K).then(k.hitch(this,function(W){if(W){var X=[],ea=[],fa=[];this.selectionLayer&&0<this.selectionLayer.getSelectedFeatures().length&&(ea=n.map(this.selectionLayer.getSelectedFeatures(),function(J){return J.attributes[this.selectionLayer.objectIdField]},
this));n.forEach(W.features,function(J){0===ea.length?X.push(J.attributes[this.selectionLayer.objectIdField]):-1===n.indexOf(ea,J.attributes[this.selectionLayer.objectIdField])?X.push(J.attributes[this.selectionLayer.objectIdField]):fa.push(J.attributes[this.selectionLayer.objectIdField])},this);0<X.length&&(W=this._getQuery({oids:X}),this.selectionLayer.selectFeatures(W,u.SELECTION_ADD));0<fa.length&&(W=this._getQuery({oids:fa}),this.selectionLayer.selectFeatures(W,u.SELECTION_SUBTRACT))}}))},_handleLayerSelectionComplete:function(){var K=
this.selectionLayer.getSelectedFeatures();if(!this._isAttrFlag&&0<K.length){var Q="";n.forEach(K,function(N){Q+=this.selectionLayer.objectIdField+" \x3d "+N.attributes[this.selectionLayer.objectIdField]+" OR ";return N.attributes[this.selectionLayer.objectIdField]},this);Q=Q.substring(0,Q.lastIndexOf(" OR "));this.set("inputQuery",Q);a.set(this.msgContainer,"innerHTML",b.substitute(this.i18n.selectedFeaturesLabel,{total:K.length}))}this._isAttrFlag||0!==K.length||(a.set(this.msgContainer,"innerHTML",
""),this.set("inputQuery",""))},_onSelectionLayerLoad:function(K,Q){Q.setScaleRange(K.minScale,K.maxScale);this._connect(K,"onScaleRangeChange",k.hitch(this,function(N,T){N.setScaleRange(T.minScale,T.maxScale)},Q,K));this.map.addLayer(Q);Q.geometryType===z.GeometryTypes.Point||"esriGeometryMultPoint"===Q.geometryType?(K=new B,K.setStyle(B.STYLE_TARGET),K._setDim(16,16,0),K.setOutline(new C(F.STYLE_SOLID,new r([0,255,255]),2,C.CAP_ROUND,C.JOIN_ROUND)),K.setColor(new r([0,0,0,0])),Q.setSelectionSymbol(K)):
Q.geometryType===z.GeometryTypes.Line?Q.setSelectionSymbol(new F(F.STYLE_SOLID,new r([0,255,255]),2)):Q.geometryType===z.GeometryTypes.Polygon&&Q.setSelectionSymbol(new y(y.STYLE_NULL,new F(F.STYLE_SOLID,new r([0,255,255]),2),new r([0,0,0,0])));this.selectionLayer&&this.inputQuery&&(this.inputQuery.match(/ OR /g)||!this.expression?this._isAttrFlag=!1:(this._isAttrFlag=!0,this.set("expression",{action:"edit",expression:this.expression.expression})),Q=this._getQuery(),this.selectionLayer.selectFeatures(Q,
u.SELECTION_ADD))},_isLayerPresentInMap:function(K){var Q=!1;this.map.getLayersVisibleAtScale().forEach(function(N){Q=Q||N.url===K.url});return Q},_getObjectIds:function(){var K=this.get("inputQuery");K=K?K.split(" OR "):[];K=n.map(K,function(Q){return Q.split(" \x3d ")[1]});a.set(this.msgContainer,"innerHTML",b.substitute(this.i18n.selectedFeaturesLabel,{total:K.length}));return K},_getQuery:function(K){var Q=new w;Q.returnGeometry=!0;if(!K)return this._isAttrFlag?Q.where=this.get("inputQuery"):
Q.objectIds=this._getObjectIds(),Q;K.extent&&(Q.geometry=K.extent);K.oids&&(Q.objectIds=K.oids);return Q},_setMapAttr:function(K){this.map=K},_getMapAttr:function(){return this.map},_getInputQueryAttr:function(){return this.inputQuery},_setInputQueryAttr:function(K){this.inputQuery=K},_getLayerAttr:function(){return this.selectionLayer},_setLayerAttr:function(K){if(K&&K.url){var Q=this.layer&&(this.layer.type===A.BDATAFEATURE||this.layer.type===A.BTABLE||this.layer.type===A.TABLE);this.layer=K;this.set("inputQuery",
"");this.selectionLayer&&this.clear();this._selectBtn.set("checked",!1);this._expressionForm.set("showUnique",!Q);this._expressionForm.set("showFirstRow",!1);this._expressionForm.set("firstOperands",[K]);this._expressionForm.set("inputOperands",[K]);this._expressionForm.set("selectedFirstOperand",K);this._expressionForm.init();this._queryBtn.set("disabled",!1);this._setInputQueryForRerun();if(this._isLayerPresentInMap(K))if(this._selectBtn.set("disabled",!1),this.selectionLayer=new u(K.url&&!K._collection?
K.url:this.layer.toJson(),{outFields:["*"],mode:K.url&&!K._collection?u.MODE_SELECTION:u.MODE_SNAPSHOT}),this.selectionLayer.setRenderer(null),this.selectionLayer.on("selection-complete",k.hitch(this,this._handleLayerSelectionComplete)),this.selectionLayer.loaded)this._onSelectionLayerLoad(K,this.selectionLayer);else this.selectionLayer.on("load",k.hitch(this,this._onSelectionLayerLoad,K,this.selectionLayer));else this._selectBtn.set("disabled",!0)}else this._selectBtn.set("disabled",!0),this._queryBtn.set("disabled",
!0)},_setExpressionAttr:function(K){K?(this._isAttrFlag=!0,this.expression=K,this.expression.expression&&(a.set(this.msgContainer,"innerHTML",this.expression.expression._attributeText),this.set("inputQuery",this.expression.expression.where))):(this._isAttrFlag=!1,this.expression=void 0)},_getExpressionAttr:function(){return this.expression},_connect:function(K,Q,N){this._pbConnects.push(m.connect(K,Q,N))}});l("extend-esri")&&k.setObject("dijit.analysis.components.FilterAndSelection.FilterAndSelection",
H,p);return H})},"esri/dijit/analysis/ExpressionForm":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/fx dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/_base/event dojo/Evented dojo/fx/easing dojo/number dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/TextBox dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/form/FilteringSelect dijit/Dialog dijit/Tooltip ../../kernel ../../lang ./utils ../SingleFilter dojo/i18n!../../nls/jsapi dojo/text!./templates/ExpressionForm.html".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I,K,Q,N,T,W,X,ea,fa,J,V,aa,Z){H=k([x,C,B,F,y,u],{declaredClass:"esri.dijit.analysis.ExpressionForm",templateString:Z,widgetsInTemplate:!0,firstOperands:null,defaultUnits:"english",showFirstRow:!0,showUnique:!0,operator:null,isServerAdvanceLicensed:!0,allLayersOpertors:["intersects","notIntersects","withinDistance","notWithinDistance","nearest"],constructor:function(L){L.containerNode&&(this.container=L.containerNode);this._setClasses(L)},
_setClasses:function(L){this._addBtnClass=L.primaryActionButttonClass||"esriAnalysisSubmitButton"},destroy:function(){this.inherited(arguments);r.forEach(this._pbConnects,m.disconnect);delete this._pbConnects},postMixInProperties:function(){this.inherited(arguments);this.i18n={};n.mixin(this.i18n,aa.common);n.mixin(this.i18n,aa.expressionGrid);n.mixin(this.i18n,aa.expressionForm)},postCreate:function(){this.inherited(arguments);this.attributeChangeHandler=m.subscribe("filter-expression-change",n.hitch(this,
this._handleAttributeFilterChange));this._distanceInput.set("validator",n.hitch(this,this._validateDistance));this.set("action","add");e.set(this._firstRow,"display",this.showFirstRow?"":"none");this.isServerAdvanceLicensed||this._operatorSelect.removeOption("nearest");this.own(this.watch("showUnique",n.hitch(this,function(L,O,D){this._attributeFilter&&this._attributeFilter.set("showUnique",D)})))},init:function(){this.isServerAdvanceLicensed||this._operatorSelect.removeOption("nearest");this.showReadyToUseLayers&&
this.owningWidget&&!this._browseTitle&&(this._browseTitle=J._isCustomAnalysisQuery(this.owningWidget)?this.i18n.browseAnalysisLayers:this.i18n.browseAnalysisTitle);if(this._firstOperandSelect&&this.firstOperands&&this.inputOperands){this._firstOperandSelect.getOptions()&&this._firstOperandSelect.removeOption(this._firstOperandSelect.getOptions());var L,O,D=this.inputOperands.length,P=this.firstOperands.length,R=[];for(L=0;L<D;L+=1)for(O=0;O<P;O+=1)fa.isDefined(this.inputOperands[L].id)&&fa.isDefined(this.firstOperands[O].id)&&
this.inputOperands[L].id===this.firstOperands[O].id?R[this.firstOperands[O].id]=L.toString():fa.isDefined(this.inputOperands[L].name)&&fa.isDefined(this.firstOperands[O].name)&&this.inputOperands[L].name===this.firstOperands[O].name&&(R[this.firstOperands[O].name]=L.toString());r.forEach(this.firstOperands,function(ca,ha){fa.isDefined(ca)&&this._firstOperandSelect.addOption({value:R[ca.id||ca.name],label:ca.name})},this);this.selectedFirstOperand&&(fa.isDefined(this.selectedFirstOperand.id)||(this.selectedFirstOperand.id=
this.selectedFirstOperand.name),this._firstOperandSelect.set("value",R[this.selectedFirstOperand.id]));(this.get("showReadyToUseLayers")||this.get("showReadyLayersForFirst"))&&this._firstOperandSelect.addOption({type:"separator",value:""});this.get("showReadyToUseLayers")&&this.get("showReadyLayersForFirst")&&this._firstOperandSelect.addOption({value:"browse",label:this._browseTitle});this.get("showBrowseLayers")&&this.get("showReadyLayersForFirst")&&this._firstOperandSelect.addOption({value:"browselayers",
label:this.i18n.browseLayers});1===D&&!this.get("showReadyToUseLayers")&&!this.get("showBrowseLayers")&&this._operatorSelect&&this._operatorSelect.getOptions()&&(this._operatorSelect.removeOption(this._operatorSelect.getOptions()),this._operatorSelect.addOption({value:"where",label:this.i18n.where}))}"add"===this.get("action")&&(this._operatorSelect.set("value","where"),this._handleOperatorChange("where"),this._distanceInput.set("value",""),"metric"===this.defaultUnits?this._distanceUnitsSelect.set("value",
"Kilometers"):this._distanceUnitsSelect.set("value","Miles"))},startup:function(){},clear:function(){this.init()},_validateDistance:function(L){var O=this._operatorSelect.get("value");return-1===r.indexOf(["withinDistance","notWithinDistance"],O)?!0:(L=t.parse(L))&&0<parseFloat(L,10)&&Infinity>parseFloat(L,10)},_handleAttributeFilterChange:function(){if(this._attributeFilter){var L=this._attributeFilter.toJson();L=this._attributeFilter.builtSingleFilterString(L);L.whereClause?this._addBtn.set("disabled",
!1):this._addBtn.set("disabled",!0)}},_handleSecondOperandChange:function(L){if("browse"===L||"browselayers"===L)this.owningWidget.layersSelect=this._secondOperandSelect,this.owningWidget.showReadyToUseLayersDialog(!1,L)},_handleFirstOperandChange:function(L){"browse"!==L&&"browselayers"!==L||!this.get("showReadyLayersForFirst")?this._handleOperatorChange("where"):(this.owningWidget.layersSelect=this._firstOperandSelect,this.owningWidget.showReadyToUseLayersDialog(!0,L))},_handleDistanceInputChange:function(L){this._addBtn.set("disabled",
!this._distanceInput.validate())},_handleOperatorChange:function(L){var O=this.get("operator");this.set("operator",L);-1===r.indexOf(["where","withinDistance","notWithinDistance"],L)?!0!==this._checkBetweenPairs(L,O)&&this._buildSpatialExpression(L,O):"where"===L?this._buildAttributeExpression(L):-1!==r.indexOf(["withinDistance","notWithinDistance"],L)&&this._buildDistanceExpression(L,O)},_checkBetweenPairs:function(L,O){return r.some([["contains","notContains"],["within","notWithin"]],function(D){if(L===
D[0]&&O===D[1]||L===D[1]&&O===D[0])return!0})},_isValidSecondOperand:function(L,O,D){var P=!1;"contains"===L||"notContains"===L?"esriGeometryPoint"!==O&&"esriGeometryMultipoint"!==O||"esriGeometryPoint"!==D&&"esriGeometryMultipoint"!==D?"esriGeometryPolyline"!==O||"esriGeometryPoint"!==D&&"esriGeometryPolyline"!==D&&"esriGeometryMultipoint"!==D?"esriGeometryPolygon"===O&&(P=!0):P=!0:P=!0:"within"===L||"notWithin"===L?"esriGeometryPoint"===O||"esriGeometryMultipoint"===O?P=!0:"esriGeometryPolyline"!==
O||"esriGeometryPolygon"!==D&&"esriGeometryPolyline"!==D?"esriGeometryPolygon"===O&&"esriGeometryPolygon"===D&&(P=!0):P=!0:P=!0;return P},_isValidFirstOperand:function(L){var O=!0;L&&L.fields?L.fields&&1===L.fields.length&&"esriFieldTypeOID"===L.fields[0].type&&(this._showMessages(f.substitute(this.i18n.inValidAttributeFilterMessage,{layername:L.name})),O=!1):O=!1;return O},_addBrowseAndBrowseLayerOptions:function(L){if(!L)return!1;(this.get("showReadyToUseLayers")||this.get("showBrowseLayers"))&&
L.addOption({type:"separator",value:""});this.get("showReadyToUseLayers")&&L.addOption({value:"browse",label:this._browseTitle});this.get("showBrowseLayers")&&L.addOption({value:"browselayers",label:this.i18n.browseLayers});return!0},_buildSpatialExpression:function(L,O){var D=parseInt(this._firstOperandSelect.get("value"),10);var P=this.inputOperands[D].geometryType;this._addBtn.set("disabled",!1);this._distanceInput.set("required",!1);e.set(this._attrFilterDiv,"display","none");e.set(this._secondOperandSelect.domNode,
"display","");this._secondOperandSelect&&(-1===this.allLayersOpertors.indexOf(O)&&(this._secondOperandSelect.getOptions()&&this._secondOperandSelect.removeOption(this._secondOperandSelect.getOptions()),r.forEach(this.inputOperands,function(R,ca){ca.toString()!==this._firstOperandSelect.get("value")&&this._isValidSecondOperand(L,P,R.geometryType)&&(this._secondOperandSelect.addOption({value:ca.toString(),label:R.name}),""!==this._secondOperandSelect.get("value")&&this._secondOperandSelect.get("value")||
this._secondOperandSelect.set("value",ca.toString()))},this),this._addBrowseAndBrowseLayerOptions(this._secondOperandSelect)),e.set(this._secondRow,"display",""),e.set(this._secondExpressionDiv,"display","none"),e.set(this._secondOperandSelect,{display:"",width:"75%"}))},_buildAttributeExpression:function(L){this._distanceInput.set("required",!1);e.set(this._secondExpressionDiv,"display","none");this._secondOperandSelect&&this._secondOperandSelect.getOptions()&&this._secondOperandSelect.removeOption(this._secondOperandSelect.getOptions());
e.set(this._secondOperandSelect.domNode,"display","none");L=parseInt(this._firstOperandSelect.get("value"),10);L=this.inputOperands[L];this._isValidFirstOperand(L)?(this._addBtn.set("disabled",!0),e.set(this._secondRow,"display",""),e.set(this._attrFilterDiv,"display",""),this._attributeFilter&&(this._attributeFilter.init({mapLayer:L,version:L.version,fields:L.fields,allowAllDateTypes:!0,part:"edit"===this.get("action")&&this.expression&&this.expression._attributeExprObj?this.expression._attributeExprObj:
null}),this._attributeFilter.set("showUnique",this.showUnique)),this._attributeFilter||(this._attributeFilter=new V({"class":"filterSegment",mapLayer:L,version:L.version,fields:L.fields,part:"edit"===this.get("action")&&this.expression&&this.expression._attributeExprObj?this.expression._attributeExprObj:null,enableEvents:!0,isEnableInteractiveFilter:!1,allowAllDateTypes:!0,showUnique:this.showUnique},d.create("div",{},this._attrFilterDiv)),this._attributeFilter.fillFieldsList(this._attributeFilter.fieldsStore))):
(e.set(this._secondRow,"display","none"),e.set(this._attrFilterDiv,"display","none"),this._addBtn.set("disabled",!0))},_buildDistanceExpression:function(L,O){this._addBtn.set("disabled",!this._distanceInput.validate());this._distanceInput.set("required",!0);e.set(this._secondRow,"display","");e.set(this._secondOperandSelect.domNode,"display","");e.set(this._secondExpressionDiv,{display:"",width:"75%"});e.set(this._secondOperandSelect,{display:"",width:"75%"});e.set(this._attrFilterDiv,"display","none");
this._secondOperandSelect&&this._secondOperandSelect.getOptions()&&-1===this.allLayersOpertors.indexOf(O)&&(this._secondOperandSelect.removeOption(this._secondOperandSelect.getOptions()),r.forEach(this.inputOperands,function(D,P){P.toString()!==this._firstOperandSelect.get("value")&&this._secondOperandSelect.addOption({value:P.toString(),label:D.name})},this),this._addBrowseAndBrowseLayerOptions(this._secondOperandSelect))},_handleAddButtonClick:function(L){q.stop(L);this._expressionForm&&!this._expressionForm.validate()?
this.emit("cancel-expression",{}):(this.set("expression"),this.emit("add-expression",{expression:this.get("expression"),text:this.get("text"),displayText:this.get("displayText"),action:this.get("action")}))},_handleCloseButtonClick:function(L){q.stop(L);this.emit("cancel-expression",{})},_setInputOperandsAttr:function(L){this.inputOperands=L},_getInputOperandsAttr:function(){return this.inputOperands},_setFirstOperandsAttr:function(L){this.firstOperands=L},_getFirstOperandsAttr:function(L){return this.firstOperands},
_setSelectedFirstOperandAttr:function(L){this.selectedFirstOperand=L},_getExpressionAttr:function(L){return this.expression},_setExpressionAttr:function(L){var O=!1;if(L)this._operatorSelect&&(this._firstOperandSelect.set("value",L.layer),this._operatorSelect.set("value",L.spatialRel?L.spatialRel:"where"),"where"===this._operatorSelect.get("value")?O=!0:(-1!==r.indexOf(["withinDistance","notWithinDistance"],this._operatorSelect.get("value"))&&(this._distanceInput.set("value",L.distance),this._distanceUnitsSelect.set("value",
L.units)),setTimeout(n.hitch(this,function(){this._secondOperandSelect.set("value",L.selectingLayer)}),100)));else if(L={},this._operatorSelect)if(L.layer=parseInt(this._firstOperandSelect.get("value"),10),"where"===this._operatorSelect.get("value")){var D=this._attributeFilter.toJson();var P=this._attributeFilter.builtSingleFilterString(D);L._attributeFilter=P;L._attributeExprObj=D;L._attributeText=this._attributeFilter.buildFriendlyTextExpr(D);L.where=P.whereClause}else L.selectingLayer=parseInt(this._secondOperandSelect.get("value"),
10),L.spatialRel=this._operatorSelect.get("value"),-1!==r.indexOf(["withinDistance","notWithinDistance"],this._operatorSelect.get("value"))&&(L.distance=this._distanceInput.get("value"),L.units=this._distanceUnitsSelect.get("value"));this.expression=L;O&&this._handleOperatorChange("where")},_showMessages:function(L){g.set(this._bodyNode,"innerHTML",L);b.fadeIn({node:this._errorMessagePane,easing:v.quadIn,onEnd:n.hitch(this,function(){e.set(this._errorMessagePane,{display:""})})}).play()},_handleCloseMsg:function(L){L&&
L.preventDefault();b.fadeOut({node:this._errorMessagePane,easing:v.quadOut,onEnd:n.hitch(this,function(){e.set(this._errorMessagePane,{display:"none"})})}).play()},_setActionAttr:function(L){this.action=L},_getActionAttr:function(){return this.action},_setTextAttr:function(L){this.text=L},_getTextAttr:function(){var L="";this.expression&&(L=this.inputOperands[this.expression.layer].name);this.expression.spatialRel?(L+=" "+this.i18n[this.expression.spatialRel],this.expression.distance&&(L+=" "+this.expression.distance+
" "+this.expression.units+" "+this.i18n.from),L+=" "+this.inputOperands[this.expression.selectingLayer].name):L+=" "+this.i18n.whereLabel+" "+this.expression._attributeText;return L},_getDisplayTextAttr:function(){var L="";if(this.expression){var O=this.inputOperands[this.expression.layer].name;L+=this.shortenString(O)}this.expression.spatialRel?(L+=" \x3clabel style\x3d'font-style: italic;'\x3e"+this.i18n[this.expression.spatialRel],this.expression.distance&&(L+=" "+this.expression.distance+" "+
this.expression.units+" "+this.i18n.from),O=this.inputOperands[this.expression.selectingLayer].name,L=L+"\x3c/label\x3e "+this.shortenString(O)):L+=" \x3clabel style\x3d'font-style: italic;'\x3e"+this.i18n.whereLabel+" "+this.expression._attributeText+"\x3c/label";return L+"\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e"},shortenString:function(L){return"\x3clabel style\x3d'overflow: hidden;text-overflow: ellipsis'\x3e"+L+"\x3c/label\x3e\x3c/td\x3e"},_setPrimaryActionButttonClassAttr:function(L){this.primaryActionButttonClass=
L},_getPrimaryActionButttonClassAttr:function(){return this.primaryActionButttonClass},_setShowFirstRowAttr:function(L){this.showFirstRow=L},_getShowFirstRowAttr:function(){return this.showFirstRow},_setShowReadyToUseLayersAttr:function(L){this._set("showReadyToUseLayers",L)},_setShowReadyLayersForFirstAttr:function(L){this._set("showReadyLayersForFirst",L)},_setShowBrowseLayersAttr:function(L){this._set("showBrowseLayers",L)},_setOwningWidgetAttr:function(L){this._set("owningWidget",L)}});a("extend-esri")&&
n.setObject("dijit.analysis.ExpressionForm",H,ea);return H})},"esri/dijit/analysis/CreditEstimator":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/_base/kernel dojo/has dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/dom-style dojo/string dojo/number dijit/_WidgetBase dijit/_TemplatedMixin dijit/_OnDijitClickMixin dijit/_FocusMixin ../../kernel ../../lang dojo/i18n!../../nls/jsapi dojo/text!./templates/CreditEstimator.html".split(" "),function(H,
k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C){H=k([h,p,q,u],{declaredClass:"esri.dijit.analysis.CreditEstimator",i18n:null,templateString:C,postMixInProperties:function(){this.inherited(arguments);this.i18n={};n.mixin(this.i18n,x.common);n.mixin(this.i18n,x.analysisMsgCodes);n.mixin(this.i18n,x.creditEstimator)},postCreate:function(){this.inherited(arguments)},_setContentAttr:function(B){var F="";B.code&&!B.messageCode&&(B.messageCode=B.code);B.messageCode?(F=t.isDefined(this.i18n[B.messageCode])?this.i18n[B.messageCode]:
B.message,F=t.isDefined(B.params)?g.substitute(F,B.params):F,f.set(this._messageDiv,"display","block"),f.set(this._messageDiv,"innerHTML",F),e.set(this._table,"display","none")):(e.set(this._table,"display","table"),f.set(this._messageDiv,"display",t.isDefined(B.infoMessage)?"block":"none"),f.set(this._messageDiv,"innerHTML",t.isDefined(B.infoMessage)?B.infoMessage:""),t.isDefined(B.infoMessage)&&e.set(this._messageDiv,"margin-top","1em"),F=t.isDefined(B.cost)?B.cost:B.maximumCost,B.maximumCost&&
f.set(this._costLabelNode,"innerHTML",this.i18n.maxCreditsLabel),B.totalRecords?f.set(this._totalRecordsNode,"innerHTML",d.format(B.totalRecords,{locale:l.locale})):e.set(this._totalRecordsLabelNode,"display","none"),f.set(this._creditsReqNode,"innerHTML",d.format(F,{locale:l.locale})))},_setErrorContentAttr:function(B){e.set(this._table,"display","none");f.set(this._messageDiv,"innerHTML",B)}});b("extend-esri")&&n.setObject("dijit.analysis.CreditEstimator",H,v);return H})},"widgets/Visibility/js/geometryUtils":function(){define("esri/geometry/Point esri/geometry/Polyline esri/geometry/webMercatorUtils dojo/Deferred dojo/_base/array dojo/_base/lang esri/SpatialReference".split(" "),
function(H,k,n,r,m,l,b){var a={getProjectedGeometry:function(c,f,e){var g=new r;if(n.canProject(c,f)){var d=n.project(c,f);g.resolve(d)}else e.project([c],f,function(h){d=h[0];g.resolve(d)});return g.promise},getDestinationPoint:function(c,f,e){var g=c.x*Math.PI/180,d=f*Math.PI/180;f=Math.sin(d);d=Math.cos(d);var h=.9966471893352243*Math.tan(c.y*Math.PI/180);c=1/Math.sqrt(1+h*h);var p=h*c,q=Math.atan2(h,d);h=c*f;var u=1-h*h,v=2.7233160610984375E11*u/4.040829998465916E13,t=1+v/16384*(4096+v*(-768+
v*(320-175*v))),x=v/1024*(256+v*(-128+v*(74-47*v))),C=e/(6356752.314245*t),B=0;do{v=Math.cos(2*q+C);var F=Math.sin(C);var y=Math.cos(C);var w=x*F*(v+x/4*(y*(-1+2*v*v)-x/6*v*(-3+4*F*F)*(-3+4*v*v)));var A=C;C=e/(6356752.314245*t)+w}while(1E-12<Math.abs(C-A)&&200>++B);if(200<=B)return console.log("Formula failed to converge"),null;e=p*F-c*y*d;e=Math.atan2(p*y+c*F*d,.9966471893352243*Math.sqrt(h*h+e*e));u=2.0955066654848088E-4*u*(4+.003352810664775694*(4-3*u));g=(g+(Math.atan2(F*f,c*y-p*F*d)-.003352810664775694*
(1-u)*h*(C+u*F*(v+u*y*(-1+2*v*v))))+3*Math.PI)%(2*Math.PI)-Math.PI;e=180*e/Math.PI;g=180*g/Math.PI;return new H(g,e,new b(4326))},getInverseCalculations:function(c,f){var e=f.x*Math.PI/180-c.x*Math.PI/180,g=.9966471893352243*Math.tan(c.y*Math.PI/180);c=1/Math.sqrt(1+g*g);g*=c;var d=.9966471893352243*Math.tan(f.y*Math.PI/180);f=1/Math.sqrt(1+d*d);d*=f;var h=e,p=0;do{var q=Math.sin(h);var u=Math.cos(h);var v=f*q*f*q+(c*d-g*f*u)*(c*d-g*f*u);v=Math.sqrt(v);if(0==v)return{distance:0,initialBearing:0,finalBearing:0};
var t=g*d+c*f*u;var x=Math.atan2(v,t);var C=c*f*q/v;var B=1-C*C;var F=t-2*g*d/B;isNaN(F)&&(F=0);var y=2.0955066654848088E-4*B*(4+.003352810664775694*(4-3*B));var w=h;h=e+.003352810664775694*(1-y)*C*(x+y*v*(F+y*t*(-1+2*F*F)))}while(1E-12<Math.abs(h-w)&&200>++p);if(200<=p)return null;h=2.7233160610984375E11*B/4.040829998465916E13;p=h/1024*(256+h*(-128+h*(74-47*h)));e=Math.atan2(f*q,c*d-g*f*u);c=Math.atan2(c*q,-g*f+c*d*u);e=(e+2*Math.PI)%(2*Math.PI);c=(c+2*Math.PI)%(2*Math.PI);g=Number((6356752.314245*
(1+h/16384*(4096+h*(-768+h*(320-175*h))))*(x-p*v*(F+p/4*(t*(-1+2*F*F)-p/6*F*(-3+4*v*v)*(-3+4*F*F))))).toFixed(3));e=180*e/Math.PI;c=180*c/Math.PI;return{distance:g,initialBearing:e,finalBearing:c}},getLineBetweenPoints:function(c){var f,e=[];m.forEach(c,l.hitch(this,function(g){e.push([a.removeNegativeExponents(g.x),a.removeNegativeExponents(g.y)])}));0<e.length&&(f=new k({paths:[e],spatialReference:{wkid:4326}}));return f},getAngleBetweenPoints:function(c,f){c=a.getInverseCalculations(c,f);return null===
c?0:c.initialBearing},getDistanceBetweenPoints:function(c,f){c=a.getInverseCalculations(c,f);return null===c?0:c.distance},getPointsForArc:function(c,f,e,g){var d=[];var h=f-c;f=parseInt(h,10);0>=f&&(f=1);var p=Math.abs(h)/Math.abs(f);if(0<p)for(h=0;h<Math.abs(f)+1;h++){var q=c+p*h;(q=a.getDestinationPoint(e,q,Math.abs(g)))&&d.push(q)}return d},removeNegativeExponents:function(c){return 1<c.toString().toLowerCase().split("e-").length?0:c}};return a})},"jimu/dijit/CoordinateControl":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang jimu/utils dojo/on dojo/has dojo/query dojo/dom-attr dojo/dom-class dojo/dom-style dojo/string dojo/topic dojo/keys dojo/Deferred dojo/Evented dojo/dom dojo/dom-construct dojo/aspect jimu/BaseWidget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/registry dijit/Tooltip dijit/TooltipDialog dijit/popup dojo/text!./templates/CoordinateControl.html esri/geometry/webMercatorUtils esri/graphic esri/geometry/Point esri/request esri/SpatialReference esri/tasks/GeometryService esri/tasks/ProjectParameters esri/toolbars/draw jimu/dijit/Message ./_CoordinateControlFormatNotation ./_CoordinateControlConfirmNotation dojo/_base/sniff dijit/form/TextBox dijit/form/Textarea dijit/form/Select dijit/InlineEditBox".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w,A,z,G,I,K,Q,N,T,W,X,ea,fa){return H([t,x,C,p],{templateString:A,baseClass:"jimu-coordinate-control",parentWidget:null,input:!0,label:null,showCopyButton:!1,showFormatButton:!1,zoomScale:null,showDeleteButton:!0,showExpandButton:!0,showDrawPoint:!0,drawButtonLabel:null,drawToolTip:null,graphicsLayer:null,type:"DD",inputFromText:!0,addSign:!1,hasCustomLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.coordinateControl;this.isRenderIdForAttrs=
!0},constructor:function(J){H.safeMixin(this,J);this.uid=J.id||B.getUniqueId("cc");null===this.parentWidget&&console.error("No parentWidget parameter supplied: Parameter is mandatory");null===this.label&&console.info("No label parameter supplied (optional): Coordinate Control will have no label");null===this.zoomScale&&console.info("No zoomScale parameter supplied (optional): Coordinate Control will have no zoom button");null===this.drawButtonLabel&&console.info("No drawButtonLabel parameter supplied (optional): Coordinate Control will have no draw button");
null===this.graphicsLayer&&console.info("No graphicsLayer parameter supplied: Input graphics will not be shown on map")},postCreate:function(){this._frmtdlg=new y({id:this.uid+"_formatCoordinateTooltip",content:new ea({nls:this.nls,ct:this.type}),style:"width: 400px",onClose:n.hitch(this,this.popupDidClose)});v.after(this._frmtdlg,"onShow",n.hitch(this,function(){this._frmtdlg.content.frmtSelect.focus()}));v.after(this._frmtdlg,"onClose",n.hitch(this,function(){this.formatButton.focus()}));this.own(m(this._frmtdlg,
"keydown",n.hitch(this,function(J){J.keyCode===d.ESCAPE&&w.close(this._frmtdlg)})));"DartTheme"===this.parentWidget.appConfig.theme.name&&c.add(this._frmtdlg.domNode,"coordinateControlDialog");this.defaultFormat&&(this._frmtdlg.content.formats[this.type].defaultFormat=this.defaultFormat);this.geomsrvc=new N(this.parentWidget.appConfig.geometryService);this.dt=new W(this.parentWidget.map);this.initUI();this.setUIListeners()},initUI:function(){null===this.label?this.setHidden(this.coordNameContainer,
!1):this.coordName.setValue(this.label);this.input?(this.zoomButton.parentNode.style.display="none",this.setHidden(this.expandButton,!0),this.setHidden(this.removeControlBtn,!0),this.coordName.set("disabled","disabled"),this.coordName.set("value",this.label+" ("+this._frmtdlg.content.ct+")"),this.showDrawPoint?(this.drawPointButton.title=this.drawButtonLabel,null===this.drawToolTip&&(this.drawToolTip=this.nls.tooltip)):this.setHidden(this.drawPointButton,!0)):(this.coordtext.disabled=!0,this.coordtext.placeholder=
"",this.setHidden(this.drawPointButton,!0),this.showExpandButton||(this.setHidden(this.expandButton,!0),c.remove(this.domNode,"coordinateContainer"),c.add(this.domNode,"outputCoordinateContainer"),c.add(this.cpbtn,"outputCopyBtn"),this.coordtext.readOnly=!0),this.showDeleteButton||this.setHidden(this.removeControlBtn,!0));this.showCopyButton||(this.setHidden(this.cpbtn,!0),c.add(this.cpbtn,"inputCopyBtn"),a.set(this.cpbtn,"title",this.nls.copyAll));this.showFormatButton||this.setHidden(this.formatButton,
!0);null===this.zoomScale&&this.setHidden(this.zoomButton,!0);this.formatButton.title=this.input?this.nls.formatInput:this.nls.formatOutput;a.set(this.formatButton,"aria-label",this.formatButton.title)},setUIListeners:function(){this.input||g.subscribe("INPUTPOINTDIDCHANGE",n.hitch(this,this.mapWasClicked));g.subscribe("INPUTERROR",n.hitch(this,this.inputError));g.subscribe("VALIDINPUT",n.hitch(this,function(J){this.toggleZoomButton(J)}));this.own(m(this.expandButton,"click",n.hitch(this,this.expandButtonWasClicked)));
this.own(m(this.expandButton,"keydown",n.hitch(this,function(J){if(J.keyCode===d.ENTER||J.keyCode===d.SPACE)this.expandButtonWasClicked(J),J.preventDefault()})));this.own(m(this.zoomButton,"click",n.hitch(this,this.zoomButtonWasClicked)));this.own(m(this.zoomButton,"keydown",n.hitch(this,function(J){J.keyCode!==d.ENTER&&J.keyCode!==d.SPACE||this.zoomButtonWasClicked(J)})));this.own(m(this.coordName,"change",n.hitch(this,this.coordNameDidChange)));this.cpbtn.addEventListener("click",n.hitch(this,this.cpBtnWasClicked));
this.own(m(this.cpbtn,"keydown",n.hitch(this,function(J){J.keyCode!==d.ENTER&&J.keyCode!==d.SPACE||this.cpBtnWasClicked(J)})));this.subVal1CpBtn.addEventListener("click",n.hitch(this,this.cpSubBtnWasClicked));this.own(m(this.subVal1CpBtn,"keydown",n.hitch(this,function(J){J.keyCode!==d.ENTER&&J.keyCode!==d.SPACE||this.cpSubBtnWasClicked(J)})));this.subVal2CpBtn.addEventListener("click",n.hitch(this,this.cpSubBtnWasClicked));this.own(m(this.subVal2CpBtn,"keydown",n.hitch(this,function(J){J.keyCode!==
d.ENTER&&J.keyCode!==d.SPACE||this.cpSubBtnWasClicked(J)})));this.subVal3CpBtn.addEventListener("click",n.hitch(this,this.cpSubBtnWasClicked));this.own(m(this.subVal3CpBtn,"keydown",n.hitch(this,function(J){J.keyCode!==d.ENTER&&J.keyCode!==d.SPACE||this.cpSubBtnWasClicked(J)})));this.subVal4CpBtn.addEventListener("click",n.hitch(this,this.cpSubBtnWasClicked));this.own(m(this.subVal4CpBtn,"keydown",n.hitch(this,function(J){J.keyCode!==d.ENTER&&J.keyCode!==d.SPACE||this.cpSubBtnWasClicked(J)})));this.own(m(this.formatButton,
"click",n.hitch(this,this.formatButtonWasClicked)));this.own(m(this.formatButton,"keydown",n.hitch(this,function(J){J.keyCode!==d.ENTER&&J.keyCode!==d.SPACE||this.formatButtonWasClicked(J)})));this.own(m(this.drawPointButton,"click",n.hitch(this,this.drawPointButtonWasClicked)));this.own(m(this.drawPointButton,"keydown",n.hitch(this,function(J){J.keyCode!==d.ENTER&&J.keyCode!==d.SPACE||this.drawPointButtonWasClicked(J)})));this.own(m(this.removeControlBtn,"keydown",n.hitch(this,function(J){J.keyCode!==
d.ENTER&&J.keyCode!==d.SPACE||this.remove()})));this.own(m(this._frmtdlg.content.applyButton,"click",n.hitch(this,this.formatDialogApplyButtonClicked)));this.own(m(this._frmtdlg.content.applyButton,"keydown",n.hitch(this,function(J){J.keyCode!==d.ENTER&&J.keyCode!==d.SPACE||this.formatDialogApplyButtonClicked()})));this.own(m(this._frmtdlg.content.cancelButton,"click",n.hitch(this,function(){w.close(this._frmtdlg)})));this.own(m(this._frmtdlg.content.cancelButton,"keydown",n.hitch(this,function(J){J.keyCode!==
d.ENTER&&J.keyCode!==d.SPACE||w.close(this._frmtdlg)})));this.own(m(this.coordtext,"keydown",n.hitch(this,this.coordTextInputKeyWasPressed)));this.own(m(this.coordtext,"input",n.hitch(this,function(){this.currentClickPointDD=null;this.zoomButton.parentNode&&(this.zoomButton.parentNode.style.display="none");this.emit("coordinates-deleted",{})})));this.own(this.geomsrvc.on("error",n.hitch(this,this.geomSrvcDidFail)));this.own(m(this.dt,"draw-complete",n.hitch(this,this.drawComplete)));this.own(v.after(this.parentWidget,
"onClose",n.hitch(this,function(){this.input&&c.contains(this.drawPointButton,"drawPointBtn-active")&&this.deactivateDrawTool();this._frmtdlg&&this._frmtdlg.domNode.offsetParent&&"closed"===this.parentWidget.state&&w.close(this._frmtdlg)})));this.own(v.after(this.parentWidget,"onOpen",n.hitch(this,function(){var J=this.parentWidget.getParent().getParent().domNode;this.own(m(J,"click",n.hitch(this,function(V){"settingBtn"!==V.target.className&&this._frmtdlg&&this._frmtdlg.domNode.offsetParent&&"active"===
this.parentWidget.state&&w.close(this._frmtdlg)})))})))},formatDialogApplyButtonClicked:function(){this.type=this._frmtdlg.content.ct;this.updateDisplay();this.input?this.coordName.set("value",this.label+" ("+this._frmtdlg.content.ct+")"):this.hasCustomLabel&&this.coordName.set("value",this.label);w.close(this._frmtdlg)},popupDidClose:function(){if(this._frmtdlg.content.isCanceled)this.addSign!==this._frmtdlg.content.addSignChkBox.checked&&this._frmtdlg.content.addSignChkBox.setValue(this.addSign);
else{this.addSign=this._frmtdlg.content.addSignChkBox.checked;var J=this._frmtdlg.content.ct;this.type!==J&&(this.type=J,this.updateDisplay())}},coordNameDidChange:function(){this.hasCustomLabel=!0},cpSubBtnWasClicked:function(J){this[J.currentTarget.id.split("~")[0]].select();try{var V=document.execCommand("copy")}catch(aa){V=!1}this.showToolTip(J.currentTarget.id,V?this.nls.copySuccessful:this.nls.copyFailed)},cpBtnWasClicked:function(J){J.preventDefault();if(this.input){J=B.toArray().filter(function(Z){return"jimu-coordinate-control"===
Z.baseClass&&!Z.input});var V=J.map(function(Z){if(Z.coordtext)return Z.coordtext.value}).join("\r\n");J=this.coordtext.value;this.coordtext.value=J+"\r\n"+V;this.selectText(this.coordtext);try{var aa=document.execCommand("copy")}catch(Z){aa=!1}this.coordtext.value=J}else{this.selectText(this.coordtext);try{aa=document.execCommand("copy")}catch(Z){aa=!1}}this.showToolTip(this.cpbtn.id,aa?this.nls.copySuccessful:this.nls.copyFailed)},selectText:function(J){var V=document.getSelection();V.removeAllRanges();
J.focus();var aa=/Edge/.test(navigator.userAgent),Z=!!window.MSInputMethodContext&&!!document.documentMode;if(l("ff")||l("chrome")||l("safari"))!this.input&&this.coordtext.disabled?(this.coordtext.disabled=!1,J.select(),this.coordtext.disabled=!0):J.select();aa&&J.select();Z&&(aa=document.createRange(),aa.selectNode(J),V.addRange(aa))},showToolTip:function(J,V){var aa=q.byId(J);F.show(V,aa);setTimeout(function(){F.hide(aa)},1E3)},geomSrvcDidComplete:function(J){0>=J[0].length?(new X({message:this.nls.parseCoordinatesError}),
g.publish("INPUTERROR")):(this.currentClickPointDD=this.currentClickPoint=new I(J[0][0],J[0][1],new Q({wkid:4326})),this.input&&(this.currentClickPoint.spatialReference.equals(this.parentWidget.map.spatialReference)?this.parentWidget.map.centerAt(this.currentClickPoint):this.getProjectedPoint(this.currentClickPoint).then(n.hitch(this,function(V){this.currentClickPoint=V;this.parentWidget.map.centerAt(this.currentClickPoint)}),n.hitch(this,function(V){console.error(V);g.publish("INPUTERROR")})),this.updateDisplay(),
g.publish("INPUTPOINTDIDCHANGE",{mapPoint:this.currentClickPointDD,inputFromText:!0}),g.publish("VALIDINPUT",{show:!0})))},geomSrvcDidFail:function(){new X({message:this.nls.parseCoordinatesError});g.publish("INPUTERROR")},coordTextInputKeyWasPressed:function(J){if(J.keyCode===d.ENTER){J.preventDefault();var V=this.getCleanInput(J.currentTarget.value);this.inputFromText=!1;this.getCoordinateType(V).then(n.hitch(this,function(aa){if(aa)if(1===aa.length){var Z=this.processCoordTextInput(V,aa[0],!1);
this.getXYNotation(Z,aa[0].conversionType).then(n.hitch(this,function(L){0<L[0].length?this.geomSrvcDidComplete(L):this.geomSrvcDidFail()}))}else this.confirmNotationDialog||(this.confirmNotationDialog=new fa({title:this.nls.comfirmInputNotation,nls:this.nls,options:aa,style:"width: 400px",hasSkipCheckBox:!1,theme:this.parentWidget.appConfig.theme.name})),this.confirmNotationDialog.show().then(n.hitch(this,function(){var L=k.filter(aa,function(D){return D.name===this.confirmNotationDialog.comboOptions.get("value")},
this),O=this.processCoordTextInput(V,L[0],!1);this.getXYNotation(O,L[0].conversionType).then(n.hitch(this,function(D){0<D[0].length?this.geomSrvcDidComplete(D):this.geomSrvcDidFail()}))},function(){}));else new X({message:this.nls.parseCoordinatesError}),g.publish("INPUTERROR")}));a.set(this.coordtext,"value",V);this.emit("get-coordinate-complete",V);this.currentClickPoint=null}if(J.keyCode===d.BACKSPACE||J.keyCode===d.DELETE)this.currentClickPointDD=null,this.zoomButton&&this.zoomButton.parentNode&&
(this.zoomButton.parentNode.style.display="none"),this.emit("coordinates-deleted",{})},getFormattedCoordinateText:function(){return this.coordtext.value},getCurrentMapCoordinate:function(){return this.currentClickPoint},getMapCoordinateDD:function(){return this.currentClickPointDD},deactivateDrawTool:function(){this.dt.deactivate();c.remove(this.drawPointButton,"drawPointBtn-active")},processCoordTextInput:function(J,V,aa){var Z=V.pattern.exec(J),L=!1,O=V.name;switch(V.name){case "DD":var D=Z[2];
var P=Z[7];var R=Z[10];var ca=Z[16];var ha=Z[3].replace(/[,:]/,".");var oa=Z[11].replace(/[,:]/,".");O="DD";break;case "DDrev":D=Z[11];P=Z[16];R=Z[2];ca=Z[8];ha=Z[12].replace(/[,:]/,".");oa=Z[3].replace(/[,:]/,".");O="DD";break;case "DDM":D=Z[2];P=Z[7];R=Z[10];ca=Z[15];ha=Z[3];var ma=Z[4].replace(/[,:]/,".");oa=Z[11];var U=Z[12].replace(/[,:]/,".");O="DDM";break;case "DDMrev":D=Z[10];P=Z[15];R=Z[2];ca=Z[7];ha=Z[11];ma=Z[12].replace(/[,:]/,".");oa=Z[3];U=Z[4].replace(/[,:]/,".");O="DDM";break;case "DMS":D=
Z[2];P=Z[8];R=Z[11];ca=Z[17];ha=Z[3];ma=Z[4];var da=Z[5].replace(/[,:]/,".");oa=Z[12];U=Z[13];var na=Z[14].replace(/[,:]/,".");O="DMS";break;case "DMSrev":D=Z[11],P=Z[17],R=Z[2],ca=Z[8],ha=Z[12],ma=Z[13],da=Z[14].replace(/[,:]/,"."),oa=Z[3],U=Z[4],na=Z[5].replace(/[,:]/,"."),O="DMS"}D&&P?(L=!0,D=(new RegExp(/[Ss-]/)).test(D)?"-":"+"):D=D&&(new RegExp(/[Ss-]/)).test(D)?"-":P&&(new RegExp(/[Ss-]/)).test(P)?"-":"+";R&&ca?(L=!0,R=(new RegExp(/[Ww-]/)).test(R)?"-":"+"):R=R&&(new RegExp(/[Ww-]/)).test(R)?
"-":ca&&(new RegExp(/[Ww-]/)).test(ca)?"-":"+";L&&(aa||new X({message:this.nls.latLongWarningMessage}));switch(O){case "DD":J=D+ha+","+R+oa;break;case "DDM":J=D+ha+" "+ma+","+R+oa+" "+U;break;case "DMS":J=D+ha+" "+ma+" "+da+","+R+oa+" "+U+" "+na}return J},zoomButtonWasClicked:function(){this.currentClickPoint&&(this.parentWidget.map.getZoom()<this.zoomScale?this.parentWidget.map.centerAt(this.currentClickPoint).then(n.hitch(this,function(){this.parentWidget.map.setScale(this.zoomScale)})):this.parentWidget.map.centerAt(this.currentClickPoint))},
setHidden:function(J,V){f.set(J,"display","none");V&&u.destroy(J.parentNode)},setVisible:function(J){f.set(J,"display","inline-flex")},remove:function(){this._frmtdlg&&this._frmtdlg.domNode.offsetParent&&w.close(this._frmtdlg);this.destroyRecursive();this.emit("removeCoordsControl")},mapWasClicked:function(J){this.currentClickPoint=J.mapPoint;this.getDDPoint(J.mapPoint).then(n.hitch(this,function(V){this.currentClickPointDDDD=this.currentClickPointDD=V;this.inputFromText=J.inputFromText?!0:!1;this.updateDisplay()}),
n.hitch(this,function(V){console.error(V)}))},getDDPoint:function(J){var V=new h,aa=new Q(3857);z.canProject(J,aa)?V.resolve(z.webMercatorToGeographic(z.project(J,aa))):(aa={url:this.geomsrvc.url+"/findTransformations",content:{f:"json",inSR:JSON.stringify(J.spatialReference.toJson()),outSR:4326,extentOfInterest:JSON.stringify(this.parentWidget.map.extent)},handleAs:"json",callbackParamName:"callback"},(new K(aa,{usePost:!1})).then(n.hitch(this,function(Z){Z=(Z=Z&&Z.transformations?Z.transformations:
void 0)&&0<Z.length?Z[0].wkid:void 0;var L=new T;L.outSR=new Q(4326);L.geometries=[J];L.transformForward=!0;L.transformation=Z;this.geomsrvc.project(L,n.hitch(this,function(O){V.resolve(O[0])}),function(O){V.reject(O)})}),n.hitch(this,function(Z){V.reject(Z)})));return V},getProjectedPoint:function(J){var V=new h;if(z.canProject(J,this.parentWidget.map))V.resolve(z.geographicToWebMercator(J));else{var aa={url:this.geomsrvc.url+"/findTransformations",content:{f:"json",inSR:4326,outSR:JSON.stringify(this.parentWidget.map.spatialReference.toJson()),
extentOfInterest:JSON.stringify(this.parentWidget.map.extent)},handleAs:"json",callbackParamName:"callback"};(new K(aa,{usePost:!1})).then(n.hitch(this,function(Z){Z=(Z=Z&&Z.transformations?Z.transformations:void 0)&&0<Z.length?Z[0].geoTransforms[0].wkid:void 0;var L=new T;L.outSR=new Q(this.parentWidget.map.spatialReference);L.geometries=[J];L.transformForward=!0;L.transformation=Z;this.geomsrvc.project(L,n.hitch(this,function(O){V.resolve(O[0])}),function(O){V.reject(O)})}),n.hitch(this,function(Z){V.reject(Z)}))}return V},
expandButtonWasClicked:function(){c.toggle(this.coordcontrols,"expanded");c.contains(this.coordcontrols,"expanded")?(c.remove(this.expandButton,"expandBtn"),c.add(this.expandButton,"collapseBtn"),a.set(this.expandButton,"aria-expanded","true")):(c.remove(this.expandButton,"collapseBtn"),c.add(this.expandButton,"expandBtn"),a.set(this.expandButton,"aria-expanded","false"));this.setSubCoordUI(c.contains(this.coordcontrols,"expanded"));this._setCoordControlsTabindex(c.contains(this.coordcontrols,"expanded"));
this.emit("expandButtonClicked",c.contains(this.coordcontrols,"expanded"))},_setCoordControlsTabindex:function(J){var V=[];if(J){var aa=0;J=-1}else aa=-1,J=0;V=b("input[tabindex\x3d'"+J+"']",this.coordcontrols);V=V.concat(b("span[tabindex\x3d'"+J+"']",this.coordcontrols));k.forEach(V,n.hitch(this,function(Z){a.set(Z,"tabindex",aa)}))},formatButtonWasClicked:function(){this._frmtdlg.content.setCt(this.type);w.open({popup:this._frmtdlg,around:this.formatButton})},drawPointButtonWasClicked:function(){if(c.contains(this.drawPointButton,
"drawPointBtn-active"))this.dt.deactivate(),this.parentWidget.map.enableMapNavigation();else{this.parentWidget.map.disableMapNavigation();this.dt.activate(W.POINT);var J=this.dt._tooltip;J&&(J.innerHTML=this.drawToolTip)}c.toggle(this.drawPointButton,"drawPointBtn-active")},drawComplete:function(J){var V={};V.mapPoint=J.geometry;this.parentWidget.map.enableMapNavigation();this.mapWasClicked(V)},setSubCoordUI:function(J){if(J){J="165px";switch(this.type){case "DD":case "DMS":case "DDM":this.sub1label.innerHTML=
"Lat";this.sub2label.innerHTML="Lon";this.setHidden(this.sub3,!1);this.setHidden(this.sub4,!1);J="90px";break;case "GARS":this.sub1label.innerHTML="Lon";this.sub2label.innerHTML="Lat";this.sub3label.innerHTML="Quadrant";this.sub4label.innerHTML="Key";this.setVisible(this.sub3);this.setVisible(this.sub4);break;case "GEOREF":this.sub1label.innerHTML="15\u00b0 Quad";this.sub2label.innerHTML="1\u00b0 Quad";this.sub3label.innerHTML="Easting";this.setVisible(this.sub3);this.sub4label.innerHTML="Northing";
this.setVisible(this.sub4);break;case "USNG":case "MGRS":this.sub1label.innerHTML="GZD";this.sub2label.innerHTML="Grid Sq";this.sub3label.innerHTML="Easting";this.sub4label.innerHTML="Northing";this.setVisible(this.sub3);this.setVisible(this.sub4);break;case "UTM":this.sub1label.innerHTML="Zone";this.sub2label.innerHTML="Band";this.sub3label.innerHTML="Easting";this.sub4label.innerHTML="Northing";this.setVisible(this.sub3);this.setVisible(this.sub4);break;case "UTM_H":this.sub1label.innerHTML="Zone",
this.sub2label.innerHTML="Hemisphere",this.sub3label.innerHTML="Easting",this.sub4label.innerHTML="Northing",this.setVisible(this.sub3),this.setVisible(this.sub4)}f.set(this.coordcontrols,"display","block");f.set(this.coordcontrols,"height",J);f.set(this.coordcontrols,"width","300px")}else f.set(this.coordcontrols,"display","none"),f.set(this.coordcontrols,"height","0px");J=this.uid.split("_")[1];a.set(this["cc_"+J+"sub1val"],"aria-label",this.sub1label.innerHTML);a.set(this["cc_"+J+"sub2val"],"aria-label",
this.sub2label.innerHTML);a.set(this["cc_"+J+"sub3val"],"aria-label",this.sub3label.innerHTML);a.set(this["cc_"+J+"sub4val"],"aria-label",this.sub4label.innerHTML)},setCoordUI:function(J){if(J){var V=this.uid.split("_")[1];if(!this["cc_"+V+"sub1val"]||this.input&&this.inputFromText)return;var aa=this._frmtdlg.content.formats[this.type];aa=aa.useCustom?aa.customFormat:aa.defaultFormat;switch(this.type){case "DD":J=this.getFormattedDDStr(J,aa,this.addSign);this["cc_"+V+"sub1val"].value=e.substitute("${xcrd}",
{xcrd:J.latdeg});this["cc_"+V+"sub2val"].value=e.substitute("${ycrd}",{ycrd:J.londeg});var Z=J.formatResult;break;case "DDM":J=this.getFormattedDDMStr(J,aa,this.addSign);this["cc_"+V+"sub1val"].value=e.substitute("${latd} ${latm}",{latd:J.latdeg,latm:J.latmin});this["cc_"+V+"sub2val"].value=e.substitute("${lond} ${lonm}",{lond:J.londeg,lonm:J.lonmin});Z=J.formatResult;break;case "DMS":J=this.getFormattedDMSStr(J,aa,this.addSign);this["cc_"+V+"sub1val"].value=e.substitute("${latd} ${latm} ${lats}",
{latd:J.latdeg,latm:J.latmin,lats:J.latsec});this["cc_"+V+"sub2val"].value=e.substitute("${lond} ${lonm} ${lons}",{lond:J.londeg,lonm:J.lonmin,lons:J.lonsec});Z=J.formatResult;break;case "USNG":J=this.getFormattedUSNGStr(J,aa,!1);this["cc_"+V+"sub1val"].value=J.gzd;this["cc_"+V+"sub2val"].value=J.grdsq;this["cc_"+V+"sub3val"].value=J.easting;this["cc_"+V+"sub4val"].value=J.northing;Z=J.formatResult;break;case "MGRS":J=this.getFormattedMGRSStr(J,aa,!1);this["cc_"+V+"sub1val"].value=J.gzd;this["cc_"+
V+"sub2val"].value=J.grdsq;this["cc_"+V+"sub3val"].value=J.easting;this["cc_"+V+"sub4val"].value=J.northing;Z=J.formatResult;break;case "GARS":J=this.getFormattedGARSStr(J,aa,!1);this["cc_"+V+"sub1val"].value=J.lon;this["cc_"+V+"sub2val"].value=J.lat;this["cc_"+V+"sub3val"].value=J.quadrant;this["cc_"+V+"sub4val"].value=J.key;Z=J.formatResult;break;case "GEOREF":J=this.getFormattedGEOREFStr(J,aa,!1);this["cc_"+V+"sub1val"].value=J.lon+J.lat;this["cc_"+V+"sub2val"].value=J.quadrant15lon+J.quadrant15lat;
this["cc_"+V+"sub3val"].value=J.quadrant1lon;this["cc_"+V+"sub4val"].value=J.quadrant1lat;Z=J.formatResult;break;case "UTM":J=this.getFormattedUTMStr(J,aa,!1);J.bandLetter.match(/^[AaBbYyZz]/)?(this["cc_"+V+"sub1val"].value="",this["cc_"+V+"sub2val"].value="",this["cc_"+V+"sub3val"].value="",this["cc_"+V+"sub4val"].value="",J.formatResult=""):(this["cc_"+V+"sub1val"].value=J.zone,this["cc_"+V+"sub2val"].value=J.bandLetter,this["cc_"+V+"sub3val"].value=J.easting,this["cc_"+V+"sub4val"].value=J.westing);
Z=J.formatResult;break;case "UTM_H":J=this.getFormattedUTMHStr(J,aa,!1),J.hemisphere.match(/^[AaBbYyZz]/)?(this["cc_"+V+"sub1val"].value="",this["cc_"+V+"sub2val"].value="",this["cc_"+V+"sub3val"].value="",this["cc_"+V+"sub4val"].value="",J.formatResult=""):(this["cc_"+V+"sub1val"].value=J.zone,this["cc_"+V+"sub2val"].value=J.hemisphere,this["cc_"+V+"sub3val"].value=J.easting,this["cc_"+V+"sub4val"].value=J.westing),Z=J.formatResult}}else Z="";this.coordcontrols&&this.setSubCoordUI(c.contains(this.coordcontrols,
"expanded"));this.coordtext&&(a.set(this.coordtext,"value",Z),this.emit("get-coordinate-complete",Z))},getFormattedCoordinates:function(){this.getCoordValues(this.currentClickPointDD,this.type,4).then(n.hitch(this,function(J){this.setCoordUI(J)}),n.hitch(this,function(J){console.log(J)}))},updateDisplay:function(){this.currentClickPoint&&(this.currentClickPointDD||(this.currentClickPointDD=this.currentClickPoint),this.getFormattedCoordinates(this.currentClickPointDD),this.input&&(null!==this.graphicsLayer&&
(this.graphicsLayer.clear(),this.currentClickPoint.spatialReference.equals(this.parentWidget.map.spatialReference)?this.graphicsLayer.add(new G(this.currentClickPoint)):this.getProjectedPoint(this.currentClickPointDD).then(n.hitch(this,function(J){this.graphicsLayer.add(new G(J))}),n.hitch(this,function(J){console.error(J)}))),g.publish("INPUTPOINTDIDCHANGE",{mapPoint:this.currentClickPointDD,inputFromText:!0}),g.publish("VALIDINPUT",{show:!0})))},clear:function(){this.coordtext.value="";this.currentClickPointDDDD=
this.currentClickPointDD=this.currentClickPoint=null;this.graphicsLayer.clear()},inputError:function(){this.setCoordUI();this.toggleZoomButton(!1)},toggleZoomButton:function(J){this.zoomButton.parentNode&&(this.zoomButton.parentNode.style.display=J?"inline-block":"none")},getCleanInput:function(J){J=J.replace(/\n/g,"");J=J.replace(/\s+/g," ").trim();return J.toUpperCase()},getCoordValues:function(J,V,aa){var Z=new h;J={sr:4326,coordinates:[[J.x,J.y]],conversionType:V.name?V.name:V,numOfDigits:aa||
6,rounding:!0,addSpaces:!1};switch(V){case "DD":J.numOfDigits=6;break;case "USNG":J.numOfDigits=5;break;case "MGRS":J.conversionMode="mgrsDefault";J.numOfDigits=5;break;case "UTM_H":J.conversionType="utm";J.conversionMode="utmNorthSouth";J.addSpaces=!0;break;case "UTM":J.conversionType="utm";J.conversionMode="utmDefault";J.addSpaces=!0;break;case "GARS":J.conversionMode="garsDefault"}this.geomsrvc.toGeoCoordinateString(J).then(function(L){Z.resolve(L)},function(){Z.resolve(null)});return Z.promise},
getXYNotation:function(J,V){var aa=new h;var Z=V.name?V.name:V;V={sr:4326,conversionType:Z,strings:[]};switch(Z){case "DD":case "DDM":case "DMS":V.numOfDigits=2;J=J.replace(/[\u00b0\u02da\u00ba^~*"'\u2032\u00a8\u02dd]/g,"");V.strings.push(J);break;case "DDrev":V.conversionType="DD";V.numOfDigits=2;J=J.replace(/[\u00b0\u02da\u00ba^~*"'\u2032\u00a8\u02dd]/g,"");V.strings.push(J);break;case "DDMrev":V.conversionType="DDM";V.numOfDigits=2;J=J.replace(/[\u00b0\u02da\u00ba^~*"'\u2032\u00a8\u02dd]/g,"");
V.strings.push(J);break;case "DMSrev":V.conversionType="DMS";V.numOfDigits=2;J=J.replace(/[\u00b0\u02da\u00ba^~*"'\u2032\u00a8\u02dd]/g,"");V.strings.push(J);break;case "USNG":V.strings.push(J);V.addSpaces="false";break;case "MGRS":V.conversionMode="mgrsNewStyle";V.strings.push(J);V.addSpaces="false";break;case "UTM_H":V.conversionType="utm";V.conversionMode="utmNorthSouth";V.strings.push(J);break;case "UTM":V.conversionType="utm";V.conversionMode="utmDefault";V.strings.push(J);break;case "GARS":V.conversionMode=
"garsCenter";V.strings.push(J);break;case "GEOREF":V.strings.push(J)}this.geomsrvc.fromGeoCoordinateString(V).then(function(L){aa.resolve(L)},function(){aa.resolve(null)});return aa.promise},getNotations:function(){return[{name:"DD",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d([,.]\d*)?|90([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([NS\+\-\s])*)([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d([,.]\d*)?|1[0-7]\d([,.]\d*)?|180([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([EW\+\-\s])*)$/].map(function(J){return J.source}).join("")),
notationType:this.nls.DDLatLongNotation,conversionType:"DD"},{name:"DDrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d([,.]\d*)?|1[0-7]\d([,.]\d*)?|180([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([EW\+\-\s])*)/,/([,:;\s|\/\\]+)(([NS\+\-\s])*([0-8]?\d([,.]\d*)?|90([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([NS\+\-\s])*)$/].map(function(J){return J.source}).join("")),notationType:this.nls.DDLongLatNotation,conversionType:"DD"},{name:"DDM",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)['\u2032\s_]*([NS\+\-\s])*)/,
/([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]\d|\d)([,.]\d*)?)['\u2032\s_]*([EW\+\-\s])*)/,/[\s]*$/].map(function(J){return J.source}).join("")),notationType:this.nls.DDMLatLongNotation,conversionType:"DDM"},{name:"DDMrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]\d|\d)([,.]\d*)?)['\u2032\s_]*([EW\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)['\u2032\s_]*([NS\+\-\s])*)[\s]*$/].map(function(J){return J.source}).join("")),
notationType:this.nls.DDMLongLatNotation,conversionType:"DDM"},{name:"DMS",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]?\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([NS\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([EW\+\-\s])*)[\s]*$/].map(function(J){return J.source}).join("")),notationType:this.nls.DMSLatLongNotation,
conversionType:"DMS"},{name:"DMSrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([EW\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]?\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([NS\+\-\s])*)[\s]*$/].map(function(J){return J.source}).join("")),notationType:this.nls.DMSLongLatNotation,conversionType:"DMS"},{name:"GARS",
pattern:/^\d{3}[a-zA-Z]{2}[1-4]?[1-9]?$/,notationType:this.nls.GARSNotation,conversionType:"GARS"},{name:"GEOREF",pattern:/^[a-zA-Z]{4}\d{1,8}$/,notationType:this.nls.GEOREFNotation,conversionType:"GEOREF"},{name:"MGRS",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[C-HJ-NP-X][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*/,/(\d[-,;:\s]+\d|\d{2}[-,;:\s]+\d{2}|\d{3}[-,;:\s]+\d{3}|\d{4}[-,;:\s]+\d{4}|\d{5}[-,;:\s]+\d{5})/,/$|^(\d{1,2}[-,;:\s]*[C-HJ-NP-X][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*)/,/(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})?$|^[ABYZ][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*/,
/(\d[-,;:\s]+\d|\d{2}[-,;:\s]+\d{2}|\d{3}[-,;:\s]+\d{3}|\d{4}[-,;:\s]+\d{4}|\d{5}[-,;:\s]+\d{5})/,/$|^[ABYZ][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})?$/].map(function(J){return J.source}).join("")),notationType:this.nls.MGRSNotation,conversionType:"MGRS"},{name:"UTM",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[c-hj-np-xC-HJ-NP-X][-,;:\s]*\d{1,6}\.?\d*[mM]?[-,;:\s]?\d{1,7}\.?\d*[mM]?$/].map(function(J){return J.source}).join("")),notationType:this.nls.UTMBandNotation,conversionType:"UTM"},
{name:"UTM (H)",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[NnSs][-,;:\s]*\d{1,6}\.?\d*[mM]?[-,;:\s]+\d{1,7}\.?\d*[mM]?$/].map(function(J){return J.source}).join("")),notationType:this.nls.UTMHemNotation,conversionType:"UTM_H"}]},getCoordinateType:function(J){var V=this.getCleanInput(J);J=new h;var aa=this.getNotations();V=k.filter(aa,function(Z){return Z.pattern.test(this.v)},{v:V});0<V.length?J.resolve(V):J.resolve(null);return J.promise},getFormattedDDStr:function(J,V,aa){var Z={};Z.sourceValue=J;Z.sourceFormatString=
V;J=J[0].split(/[ ,]+/);Z.latdeg=J[0].replace(/[nNsS]/,"");Z.londeg=J[1].replace(/[eEwW]/,"");Z.latdeg=r.localizeNumber(parseFloat(Z.latdeg));Z.londeg=r.localizeNumber(parseFloat(Z.londeg));aa&&("N"===J[0].slice(-1)?Z.latdeg="+"+Z.latdeg:Z.latdeg="-"+Z.latdeg,"W"===J[1].slice(-1)?Z.londeg="-"+Z.londeg:Z.londeg="+"+Z.londeg);V=V.replace(/X/,Z.londeg);V=V.replace(/[eEwW]/,J[1].slice(-1));V=V.replace(/[nNsS]/,J[0].slice(-1));V=V.replace(/Y/,Z.latdeg);Z.formatResult=V;return Z},getFormattedDDMStr:function(J,
V,aa){var Z={};Z.sourceValue=J;Z.sourceFormatString=V;Z.parts=J[0].split(/[ ,]+/);Z.latdeg=Z.parts[0];Z.latmin=Z.parts[1].replace(/[nNsS]/,"");Z.londeg=Z.parts[2];Z.lonmin=Z.parts[3].replace(/[eEwW]/,"");Z.latmin=r.localizeNumber(parseFloat(Z.latmin));Z.lonmin=r.localizeNumber(parseFloat(Z.lonmin));aa&&("N"===Z.parts[1].slice(-1)?Z.latdeg="+"+Z.latdeg:Z.latdeg="-"+Z.latdeg,"W"===Z.parts[3].slice(-1)?Z.londeg="-"+Z.londeg:Z.londeg="+"+Z.londeg);J=V.replace(/[EeWw]/,Z.parts[3].slice(-1));J=J.replace(/Y/,
Z.lonmin);J=J.replace(/X/,Z.londeg);J=J.replace(/[NnSs]/,Z.parts[1].slice(-1));J=J.replace(/B/,Z.latmin);J=J.replace(/A/,Z.latdeg);Z.formatResult=J;return Z},getFormattedDMSStr:function(J,V,aa){var Z={};Z.sourceValue=J;Z.sourceFormatString=V;Z.parts=J[0].split(/[ ,]+/);Z.latdeg=Z.parts[0];Z.latmin=Z.parts[1];Z.latsec=Z.parts[2].replace(/[NnSs]/,"");Z.londeg=Z.parts[3];Z.lonmin=Z.parts[4];Z.latsec=r.localizeNumber(parseFloat(Z.latsec));Z.parts[5]&&(Z.lonsec=Z.parts[5].replace(/[EWew]/,""),Z.lonsec=
r.localizeNumber(parseFloat(Z.lonsec)));aa&&("N"===Z.parts[2].slice(-1)?Z.latdeg="+"+Z.latdeg:Z.latdeg="-"+Z.latdeg,"W"===Z.parts[5].slice(-1)?Z.londeg="-"+Z.londeg:Z.londeg="+"+Z.londeg);J=V.replace(/A/,Z.latdeg);J=J.replace(/B/,Z.latmin);J=J.replace(/C/,Z.latsec);J=J.replace(/X/,Z.londeg);J=J.replace(/Y/,Z.lonmin);J=J.replace(/Z/,Z.lonsec);J=J.replace(/[NnSs]/,Z.parts[2].slice(-1));Z.parts[5]&&(J=J.replace(/[EeWw]/,Z.parts[5].slice(-1)));Z.formatResult=J;return Z},getFormattedUSNGStr:function(J,
V){var aa={};aa.sourceValue=J;aa.sourceFormatString=V;J[0].match(/^[ABYZ]/)?aa.gzd=J[0].match(/[ABYZ]/)[0].trim():aa.gzd=J[0].match(/\d{1,2}[C-HJ-NP-X]/)[0].trim();J[0].replace(aa.gzd,"").match(/[a-hJ-zA-HJ-Z]{2}/)&&(aa.grdsq=J[0].replace(aa.gzd,"").match(/[a-hJ-zA-HJ-Z]{2}/)[0].trim());J[0].replace(aa.gzd+aa.grdsq,"").match(/^\d{1,5}/)&&(aa.easting=J[0].replace(aa.gzd+aa.grdsq,"").match(/^\d{1,5}/)[0].trim());J[0].replace(aa.gzd+aa.grdsq,"").match(/\d{1,5}$/)&&(aa.northing=J[0].replace(aa.gzd+aa.grdsq,
"").match(/\d{1,5}$/)[0].trim());J=V.replace(/Y/,aa.northing);J=J.replace(/X/,aa.easting);J=J.replace(/S/,aa.grdsq);J=J.replace(/Z/,aa.gzd);aa.formatResult=J;return aa},getFormattedMGRSStr:function(J,V){var aa={};aa.sourceValue=J;aa.sourceFormatString=V;J[0].match(/^[ABYZ]/)?aa.gzd=J[0].match(/[ABYZ]/)[0].trim():aa.gzd=J[0].match(/\d{1,2}[C-HJ-NP-X]/)[0].trim();aa.grdsq=J[0].replace(aa.gzd,"").match(/[a-hJ-zA-HJ-Z]{2}/)[0].trim();aa.easting=J[0].replace(aa.gzd+aa.grdsq,"").match(/^\d{1,5}/)[0].trim();
aa.northing=J[0].replace(aa.gzd+aa.grdsq,"").match(/\d{1,5}$/)[0].trim();J=V.replace(/Y/,aa.northing);J=J.replace(/X/,aa.easting);J=J.replace(/S/,aa.grdsq);J=J.replace(/Z/,aa.gzd);aa.formatResult=J;return aa},getFormattedGARSStr:function(J,V){var aa={};aa.sourceValue=J;aa.sourceFormatString=V;aa.lon=J[0].match(/\d{3}/);aa.lat=J[0].match(/[a-zA-Z]{2}/);J=J[0].match(/\d*$/);aa.quadrant=J[0][0];aa.key=J[0][1];V=V.replace(/K/,aa.key);V=V.replace(/Q/,aa.quadrant);V=V.replace(/Y/,aa.lat);V=V.replace(/X/,
aa.lon);aa.formatResult=V;return aa},getFormattedGEOREFStr:function(J,V){var aa={};aa.sourceValue=J;aa.sourceFormatString=V;aa.lon=J[0].match(/[a-zA-Z]{1}/)[0].trim();aa.lat=J[0].replace(aa.lon,"").match(/[a-zA-Z]{1}/)[0].trim();aa.quadrant15lon=J[0].replace(aa.lon+aa.lat,"").match(/[a-zA-Z]{1}/)[0].trim();aa.quadrant15lat=J[0].replace(aa.lon+aa.lat+aa.quadrant15lon,"").match(/[a-zA-Z]{1}/)[0].trim();J=J[0].replace(aa.lon+aa.lat+aa.quadrant15lon+aa.quadrant15lat,"");aa.quadrant1lon=J.substr(0,J.length/
2);aa.quadrant1lat=J.substr(J.length/2,J.length);V=V.replace(/Y/,aa.quadrant1lat);V=V.replace(/X/,aa.quadrant1lon);V=V.replace(/D/,aa.quadrant15lat);V=V.replace(/C/,aa.quadrant15lon);V=V.replace(/B/,aa.lat);V=V.replace(/A/,aa.lon);aa.formatResult=V;return aa},getFormattedUTMStr:function(J,V){var aa={};aa.sourceValue=J;aa.sourceFormatString=V;aa.parts=J[0].split(/[ ,]+/);aa.zone=aa.parts[0].replace(/[A-Z]/,"");aa.bandLetter=aa.parts[0].slice(-1);aa.easting=aa.parts[1];aa.westing=aa.parts[2];J=V.replace(/Y/,
aa.westing);J=J.replace(/X/,aa.easting);J=J.replace(/B/,aa.bandLetter);J=J.replace(/Z/,aa.zone);aa.formatResult=J;return aa},getFormattedUTMHStr:function(J,V){var aa={};aa.sourceValue=J;aa.sourceFormatString=V;aa.parts=J[0].split(/[ ,]+/);aa.zone=aa.parts[0].replace(/[A-Z]/,"");aa.hemisphere=aa.parts[0].slice(-1);aa.easting=aa.parts[1];aa.westing=aa.parts[2];J=V.replace(/Y/,aa.westing);J=J.replace(/X/,aa.easting);J=J.replace(/H/,aa.hemisphere);J=J.replace(/Z/,aa.zone);aa.formatResult=J;return aa}})})},
"jimu/dijit/_CoordinateControlFormatNotation":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-style dojo/on dojo/dom-attr dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin jimu/dijit/formSelect jimu/dijit/CheckBox".split(" "),function(H,k,n,r,m,l,b,a){return H([l,b,a],{baseClass:"jimu-coordinate-control",templateString:'\x3cdiv\x3e\x3cspan class\x3d"formatText"\x3e${nls.editCoordinateDialogTitle}\x3c/span\x3e\x3cdiv class\x3d"controlContainer"\x3e\x3cselect tabindex\x3d"0" class\x3d"selectFormat" data-dojo-attach-point\x3d"frmtSelect" aria-label\x3d"${nls.editCoordinateDialogTitle}" data-dojo-type\x3d"jimu/dijit/formSelect"\x3e\x3c/select\x3e\x3cinput tabindex\x3d"0" type\x3d"text" data-dojo-attach-point\x3d"frmtVal" class\x3d"formatInput"\x3e\x3c/input\x3e\x3cdiv class\x3d"settingsContainer" data-dojo-attach-point\x3d"prefixContainer"\x3e\x3cdiv class\x3d"formatText" data-dojo-attach-point\x3d"addSignChkBox" label\x3d"${nls.posNegPrefixLabel}" data-dojo-type\x3d"jimu/dijit/CheckBox"/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"btnContainer"\x3e\x3cdiv tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.applyButtonLabel}" data-dojo-attach-point\x3d"applyButton" class\x3d"jimu-btn"\x3e${nls.applyButtonLabel}\x3c/div\x3e\x3cdiv data-dojo-attach-point\x3d"cancelButton" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.cancelButtonLabel}" class\x3d"jimu-btn formatCoordCancelButton"\x3e${nls.cancelButtonLabel}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
isCanceled:!1,formats:{},setCt:function(c){this.ct=c;this.frmtSelect.set("value",this.ct)},postCreate:function(){this.formats={DD:{defaultFormat:"YN XE",customFormat:null,useCustom:!1},DDM:{defaultFormat:"A\u00b0 B'N X\u00b0 Y'E",customFormat:null,useCustom:!1},DMS:{defaultFormat:"A\u00b0 B' C\"N X\u00b0 Y' Z\"E",customFormat:null,useCustom:!1},GARS:{defaultFormat:"XYQK",customFormat:null,useCustom:!1},GEOREF:{defaultFormat:"ABCDXY",customFormat:null,useCustom:!1},MGRS:{defaultFormat:"ZSXY",customFormat:null,
useCustom:!1},USNG:{defaultFormat:"ZSXY",customFormat:null,useCustom:!1},UTM:{defaultFormat:"ZB X Y",customFormat:null,useCustom:!1},UTM_H:{defaultFormat:"ZH X Y",customFormat:null,useCustom:!1}};var c=[],f;for(f in this.formats){var e={value:f,label:this.nls.notations[f]};c.push(e)}this.frmtSelect.addOption(c);m.set(this.frmtVal,"value",this.formats[this.ct].defaultFormat);this.own(r(this.frmtSelect,"change",k.hitch(this,this.frmtSelectValueDidChange)));this.own(r(this.frmtVal,"change",k.hitch(this,
this.formatValDidChange)));this.own(r(this.cancelButton,"click",k.hitch(this,function(){this.isCanceled=!0})));this.own(r(this.applyButton,"click",k.hitch(this,function(){this.isCanceled=!1})));this.displayPrefixContainer()},formatValDidChange:function(){var c=m.get(this.frmtVal,"value"),f=this.frmtSelect.get("value");this.formats[f].customFormat=c;this.formats[f].useCustom=!0},frmtSelectValueDidChange:function(c){var f=this.formats[c].useCustom?this.formats[c].customFormat:this.formats[c].defaultFormat;
this.ct=c;m.set(this.frmtVal,"value",f);this.displayPrefixContainer()},displayPrefixContainer:function(){switch(this.ct){case "DD":case "DDM":case "DMS":n.set(this.prefixContainer,{display:""});break;default:n.set(this.prefixContainer,{display:"none"})}}})})},"jimu/dijit/_CoordinateControlConfirmNotation":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/aspect dojo/keys dojo/query dijit/Dialog dijit/form/Select dojo/_base/lang".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e){return H([c],{baseClass:"jimu-coordinate-control",numberOfInputs:0,selectOptions:{},comboOptions:{},dfd:null,constructor:function(g){e.mixin(this,g);this.numberOfInputs=g.options.length;this.selectOptions=g.options},postCreate:function(){this.inherited("postCreate",arguments);this.closable=!1;this.closeButtonNode.style.display="none";"DartTheme"===this.theme&&m.add(this.containerNode,"coordinateControlDialog");this.message=r.create("div",{style:"margin-bottom: 5px"},
this.containerNode,"first");this.message.innerHTML=this.numberOfInputs+" "+this.nls.multipleNotationLabel;this.comboOptions=new f({style:{width:"99%"},"aria-label":this.numberOfInputs+" "+this.nls.multipleNotationLabel},r.create("div",{},this.containerNode,"last"));this.own(l.after(this.comboOptions,"onChange",n.hitch(this,this._onComboOptionsChanged)));for(var g=0;g<this.selectOptions.length;g++)this.comboOptions.addOption({value:this.selectOptions[g].name,label:this.selectOptions[g].notationType});
this.buttonDiv=r.create("div",{"class":"buttonContainer",style:"margin-top:10px;"+(window.isRTL?"text-align:left":"text-align:right")},this.containerNode,"last");this.okButton=r.create("div",{innerHTML:this.nls.applyButtonLabel,"class":"jimu-btn",role:"button",tabindex:"0","aria-label":this.nls.applyButtonLabel,onclick:e.hitch(this,function(){this.hide();this.dfd.resolve()}),onkeypress:e.hitch(this,function(d){if(d.keyCode===b.ENTER||d.keyCode===b.SPACE)this.hide(),this.dfd.resolve()})},this.buttonDiv,
"first");this.cancelButton=r.create("div",{innerHTML:this.nls.cancelButtonLabel,"class":"jimu-btn",style:"margin: 0 5px 0 5px",role:"button",tabindex:"0","aria-label":this.nls.cancelButtonLabel,onclick:e.hitch(this,function(){this.hide();this.dfd.cancel()}),onkeypress:e.hitch(this,function(d){if(d.keyCode===b.ENTER||d.keyCode===b.SPACE)this.hide(),this.dfd.cancel()})},this.buttonDiv,"last")},show:function(){this.inherited("show",arguments);this.dfd=new k;var g=this._getDOMElement(".dijitSelectLabel",
this.comboOptions.domNode);g&&m.add(g,"dijitSelectLabelConfirmNotation");return this.dfd},_onComboOptionsChanged:function(){var g=this._getDOMElement(".dijitSelectLabel",this.comboOptions.domNode);g&&m.add(g,"dijitSelectLabelConfirmNotation")},_getDOMElement:function(g,d){return(g=a(g,d))&&1===g.length?g[0]:null}})})},"dijit/form/Textarea":function(){define(["dojo/_base/declare","dojo/dom-style","./_ExpandingTextAreaMixin","./SimpleTextarea"],function(H,k,n,r){return H("dijit.form.Textarea",[r,n],
{baseClass:"dijitTextBox dijitTextArea dijitExpandingTextArea",cols:"",buildRendering:function(){this.inherited(arguments);k.set(this.textbox,{overflowY:"hidden",overflowX:"auto",boxSizing:"border-box",MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"})}})})},"dijit/form/_ExpandingTextAreaMixin":function(){define("dojo/_base/declare dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/_base/window ../Viewport".split(" "),function(H,k,n,r,m,l,b){n.add("textarea-needs-help-shrinking",
function(){var a=l.body(),c=k.create("textarea",{rows:"5",cols:"20",value:" ",style:{zoom:1,fontSize:"12px",height:"96px",overflow:"hidden",visibility:"hidden",position:"absolute",border:"5px solid white",margin:"0",padding:"0",boxSizing:"border-box",MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"}},a,"last"),f=c.scrollHeight>=c.clientHeight;a.removeChild(c);return f});return H("dijit.form._ExpandingTextAreaMixin",null,{_setValueAttr:function(){this.inherited(arguments);
this.resize()},postCreate:function(){this.inherited(arguments);var a=this.textbox;a.style.overflowY="hidden";this.own(m(a,"focus, resize",r.hitch(this,"_resizeLater")))},startup:function(){this.inherited(arguments);this.own(b.on("resize",r.hitch(this,"_resizeLater")));this._resizeLater()},_onInput:function(a){this.inherited(arguments);this.resize()},_estimateHeight:function(){var a=this.textbox;a.rows=(a.value.match(/\n/g)||[]).length+1},_resizeLater:function(){this.defer("resize")},resize:function(){function a(){var q=
!1;""===c.value&&(c.value=" ",q=!0);var u=c.scrollHeight;q&&(c.value="");return u}var c=this.textbox;"hidden"==c.style.overflowY&&(c.scrollTop=0);if(!this.busyResizing){this.busyResizing=!0;if(a()||c.offsetHeight){var f=a()+Math.max(c.offsetHeight-c.clientHeight,0),e=f+"px";e!=c.style.height&&(c.style.height=e,c.rows=1);if(n("textarea-needs-help-shrinking")){var g=a(),d=c.style.minHeight,h=4,p=c.scrollTop;c.style.minHeight=e;for(c.style.height="auto";0<f;){c.style.minHeight=Math.max(f-h,4)+"px";e=
a();g-=e;f-=g;if(g<h)break;g=e;h<<=1}c.style.height=f+"px";c.style.minHeight=d;c.scrollTop=p}c.style.overflowY=a()>c.clientHeight?"auto":"hidden";"hidden"==c.style.overflowY&&(c.scrollTop=0)}else this._estimateHeight();this.busyResizing=!1}}})})},"dijit/InlineEditBox":function(){define("require dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojo/i18n dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/when ./a11yclick ./focus ./_Widget ./_TemplatedMixin ./_WidgetsInTemplateMixin ./_Container ./form/Button ./form/_TextBoxMixin ./form/TextBox dojo/text!./templates/InlineEditBox.html dojo/i18n!./nls/common".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y,w){t=r("dijit._InlineEditor",[v,t,x],{templateString:w,contextRequire:H,postMixInProperties:function(){this.inherited(arguments);this.messages=c.getLocalization("dijit","common",this.lang);k.forEach(["buttonSave","buttonCancel"],function(A){this[A]||(this[A]=this.messages[A])},this)},buildRendering:function(){this.inherited(arguments);var A="string"==typeof this.editor?g.getObject(this.editor)||H(this.editor):this.editor,z=this.sourceStyle,
G="line-height:"+z.lineHeight+";",I=a.getComputedStyle(this.domNode);k.forEach(["Weight","Family","Size","Style"],function(Q){I["font"+Q]!=z["font"+Q]&&(G+="font-"+Q+":"+z["font"+Q]+";")},this);k.forEach("marginTop marginBottom marginLeft marginRight position left top right bottom float clear display".split(" "),function(Q){this.domNode.style[Q]=z[Q]},this);var K=this.inlineEditBox.width;"100%"==K?(G+="width:100%;",this.domNode.style.display="block"):G+="width:"+(K+(Number(K)==K?"px":""))+";";K=g.delegate(this.inlineEditBox.editorParams,
{style:G,dir:this.dir,lang:this.lang,textDir:this.textDir});this.editWidget=new A(K,this.editorPlaceholder);this.inlineEditBox.autoSave&&(this.saveButton.destroy(),this.cancelButton.destroy(),this.saveButton=this.cancelButton=null,b.destroy(this.buttonContainer))},postCreate:function(){this.inherited(arguments);var A=this.editWidget;this.inlineEditBox.autoSave?this.own(n.after(A,"onChange",g.hitch(this,"_onChange"),!0),d(A,"keydown",g.hitch(this,"_onKeyDown"))):"intermediateChanges"in A&&(A.set("intermediateChanges",
!0),this.own(n.after(A,"onChange",g.hitch(this,"_onIntermediateChange"),!0)),this.saveButton.set("disabled",!0))},startup:function(){this.editWidget.startup();this.inherited(arguments)},_onIntermediateChange:function(){this.saveButton.set("disabled",this.getValue()==this._resetValue||!this.enableSave())},destroy:function(){this.editWidget.destroy(!0);this.inherited(arguments)},getValue:function(){var A=this.editWidget;return String(A.get("displayedValue"in A||"_getDisplayedValueAttr"in A?"displayedValue":
"value"))},_onKeyDown:function(A){this.inlineEditBox.autoSave&&this.inlineEditBox.editing&&!A.altKey&&!A.ctrlKey&&(A.keyCode==e.ESCAPE?(A.stopPropagation(),A.preventDefault(),this.cancel(!0)):A.keyCode==e.ENTER&&"INPUT"==A.target.tagName&&(A.stopPropagation(),A.preventDefault(),this._onChange()))},_onBlur:function(){this.inherited(arguments);this.inlineEditBox.autoSave&&this.inlineEditBox.editing&&(this.getValue()==this._resetValue?this.cancel(!1):this.enableSave()&&this.save(!1))},_onChange:function(){this.inlineEditBox.autoSave&&
this.inlineEditBox.editing&&this.enableSave()&&u.focus(this.inlineEditBox.displayNode)},enableSave:function(){return this.editWidget.isValid?this.editWidget.isValid():!0},focus:function(){this.editWidget.focus();this.editWidget.focusNode&&(u._onFocusNode(this.editWidget.focusNode),"INPUT"==this.editWidget.focusNode.tagName&&this.defer(function(){F.selectInputText(this.editWidget.focusNode)}))}});v=r("dijit.InlineEditBox"+(h("dojo-bidi")?"_NoBidi":""),v,{editing:!1,autoSave:!0,buttonSave:"",buttonCancel:"",
renderAsHtml:!1,editor:y,editorWrapper:t,editorParams:{},disabled:!1,onChange:function(){},onCancel:function(){},width:"100%",value:"",noValueIndicator:6>=h("ie")?"\x3cspan style\x3d'font-family: wingdings; text-decoration: underline;'\x3e\x26#160;\x26#160;\x26#160;\x26#160;\x26#x270d;\x26#160;\x26#160;\x26#160;\x26#160;\x3c/span\x3e":"\x3cspan style\x3d'text-decoration: underline;'\x3e\x26#160;\x26#160;\x26#160;\x26#160;\x26#x270d;\x26#160;\x26#160;\x26#160;\x26#160;\x3c/span\x3e",constructor:function(){this.editorParams=
{}},postMixInProperties:function(){this.inherited(arguments);this.displayNode=this.srcNodeRef;this.own(d(this.displayNode,q,g.hitch(this,"_onClick")),d(this.displayNode,"mouseover, focus",g.hitch(this,"_onMouseOver")),d(this.displayNode,"mouseout, blur",g.hitch(this,"_onMouseOut")));this.displayNode.setAttribute("role","button");this.displayNode.getAttribute("tabIndex")||this.displayNode.setAttribute("tabIndex",0);this.value||"value"in this.params||(this.value=g.trim(this.renderAsHtml?this.displayNode.innerHTML:
this.displayNode.innerText||this.displayNode.textContent||""));this.value||(this.displayNode.innerHTML=this.noValueIndicator);l.add(this.displayNode,"dijitInlineEditBoxDisplayMode")},setDisabled:function(A){f.deprecated("dijit.InlineEditBox.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",A)},_setDisabledAttr:function(A){this.domNode.setAttribute("aria-disabled",A?"true":"false");A?this.displayNode.removeAttribute("tabIndex"):this.displayNode.setAttribute("tabIndex",
0);l.toggle(this.displayNode,"dijitInlineEditBoxDisplayModeDisabled",A);this._set("disabled",A)},_onMouseOver:function(){this.disabled||l.add(this.displayNode,"dijitInlineEditBoxDisplayModeHover")},_onMouseOut:function(){l.remove(this.displayNode,"dijitInlineEditBoxDisplayModeHover")},_onClick:function(A){this.disabled||(A&&(A.stopPropagation(),A.preventDefault()),this._onMouseOut(),this.defer("edit"))},edit:function(){if(!this.disabled&&!this.editing){this._set("editing",!0);this._savedTabIndex=
m.get(this.displayNode,"tabIndex")||"0";if(!this.wrapperWidget){var A=b.create("span",null,this.domNode,"before");this.wrapperWidget=new ("string"==typeof this.editorWrapper?g.getObject(this.editorWrapper):this.editorWrapper)({value:this.value,buttonSave:this.buttonSave,buttonCancel:this.buttonCancel,dir:this.dir,lang:this.lang,tabIndex:this._savedTabIndex,editor:this.editor,inlineEditBox:this,sourceStyle:a.getComputedStyle(this.displayNode),save:g.hitch(this,"save"),cancel:g.hitch(this,"cancel"),
textDir:this.textDir},A);this.wrapperWidget._started||this.wrapperWidget.startup();this._started||this.startup()}var z=this.wrapperWidget;l.add(this.displayNode,"dijitOffScreen");l.remove(z.domNode,"dijitOffScreen");a.set(z.domNode,{visibility:"visible"});m.set(this.displayNode,"tabIndex","-1");var G=z.editWidget,I=this;p(G.onLoadDeferred,g.hitch(z,function(){G.set("displayedValue"in G||"_setDisplayedValueAttr"in G?"displayedValue":"value",I.value);this.defer(function(){z.saveButton&&z.saveButton.set("disabled",
"intermediateChanges"in G);this.focus();this._resetValue=this.getValue()})}))}},_onBlur:function(){this.inherited(arguments)},destroy:function(){this.wrapperWidget&&!this.wrapperWidget._destroyed&&(this.wrapperWidget.destroy(),delete this.wrapperWidget);this.inherited(arguments)},_showText:function(A){var z=this.wrapperWidget;a.set(z.domNode,{visibility:"hidden"});l.add(z.domNode,"dijitOffScreen");l.remove(this.displayNode,"dijitOffScreen");m.set(this.displayNode,"tabIndex",this._savedTabIndex);A&&
u.focus(this.displayNode)},save:function(A){if(!this.disabled&&this.editing){this._set("editing",!1);var z=this.wrapperWidget.getValue();this.set("value",z);this._showText(A)}},setValue:function(A){f.deprecated("dijit.InlineEditBox.setValue() is deprecated.  Use set('value', ...) instead.","","2.0");return this.set("value",A)},_setValueAttr:function(A){A=g.trim(A);var z=this.renderAsHtml?A:A.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;").replace(/\n/g,
"\x3cbr\x3e");this.displayNode.innerHTML=this.editorParams&&"password"===this.editorParams.type?"********":z||this.noValueIndicator;this._set("value",A);this._started&&this.defer(function(){this.onChange(A)})},getValue:function(){f.deprecated("dijit.InlineEditBox.getValue() is deprecated.  Use get('value') instead.","","2.0");return this.get("value")},cancel:function(A){!this.disabled&&this.editing&&(this._set("editing",!1),this.defer("onCancel"),this._showText(A))}});h("dojo-bidi")&&(v=r("dijit.InlineEditBox",
v,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.displayNode)}}));v._InlineEditor=t;return v})},"widgets/Visibility/js/util":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/Deferred","esri/tasks/GeometryService"],function(H,k,n,r){return H(null,{constructor:function(m){this.appConfig=m.appConfig;this.nls=m.nls;(m=this.appConfig.geometryService)||(m="//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer");this.geomService=new r(m)},
getCleanInput:function(m){m=m.replace(/\n/g,"");m=m.replace(/\s+/g," ").trim();return m.toUpperCase()},getCoordValues:function(m,l,b){var a=new n;m={sr:4326,coordinates:[[m.x,m.y]],conversionType:l.name?l.name:l,numOfDigits:b||6,rounding:!0,addSpaces:!1};switch(l){case "DD":m.numOfDigits=6;break;case "USNG":m.numOfDigits=5;break;case "MGRS":m.conversionMode="mgrsDefault";m.numOfDigits=5;break;case "UTM (H)":m.conversionType="utm";m.conversionMode="utmNorthSouth";m.addSpaces=!0;break;case "UTM":m.conversionType=
"utm";m.conversionMode="utmDefault";m.addSpaces=!0;break;case "GARS":m.conversionMode="garsDefault"}this.geomService.toGeoCoordinateString(m).then(function(c){a.resolve(c)},function(){a.resolve(null)});return a.promise},getXYNotation:function(m,l){var b=new n;var a=l.name?l.name:l;l={sr:4326,conversionType:a,strings:[]};switch(a){case "DD":case "DDM":case "DMS":l.numOfDigits=2;m=m.replace(/[\u00b0\u02da\u00ba^~*"'\u2032\u00a8\u02dd]/g,"");l.strings.push(m);break;case "USNG":l.strings.push(m);l.addSpaces=
"false";break;case "MGRS":l.conversionMode="mgrsNewStyle";l.strings.push(m);l.addSpaces="false";break;case "UTM (H)":l.conversionType="utm";l.conversionMode="utmNorthSouth";l.strings.push(m);break;case "UTM":l.conversionType="utm";l.conversionMode="utmDefault";l.strings.push(m);break;case "GARS":l.conversionMode="garsCenter";l.strings.push(m);break;case "GEOREF":l.strings.push(m)}this.geomService.fromGeoCoordinateString(l).then(function(c){b.resolve(c)},function(){b.resolve(null)});return b.promise},
getNotations:function(){return[{name:"DD",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d([,.]\d*)?|90([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([NS\+\-\s])*)([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d([,.]\d*)?|1[0-7]\d([,.]\d*)?|180([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([EW\+\-\s])*)$/].map(function(m){return m.source}).join("")),notationType:this.nls.DDLatLongNotation,conversionType:"DD"},{name:"DDrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d([,.]\d*)?|1[0-7]\d([,.]\d*)?|180([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([EW\+\-\s])*)/,
/([,:;\s|\/\\]+)(([NS\+\-\s])*([0-8]?\d([,.]\d*)?|90([,.]0*)?)([\u00b0\u02da\u00ba^~*]*)([NS\+\-\s])*)$/].map(function(m){return m.source}).join("")),notationType:this.nls.DDLongLatNotation,conversionType:"DD"},{name:"DDM",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)['\u2032\s_]*([NS\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]\d|\d)([,.]\d*)?)['\u2032\s_]*([EW\+\-\s])*)/,/[\s]*$/].map(function(m){return m.source}).join("")),
notationType:this.nls.DDMLatLongNotation,conversionType:"DDM"},{name:"DDMrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]\d|\d)([,.]\d*)?)['\u2032\s_]*([EW\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)['\u2032\s_]*([NS\+\-\s])*)[\s]*$/].map(function(m){return m.source}).join("")),notationType:this.nls.DDMLongLatNotation,conversionType:"DDM"},{name:"DMS",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]?\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([NS\+\-\s])*)/,
/([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([EW\+\-\s])*)[\s]*$/].map(function(m){return m.source}).join("")),notationType:this.nls.DMSLatLongNotation,conversionType:"DMS"},{name:"DMSrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([EW\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([NS\+\-\s])*([0-8]?\d|90)[\u00b0\u02da\u00ba^~*\s\-_]+([0-5]?\d|\d)['\u2032\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["\u00a8\u02dd\s_]*([NS\+\-\s])*)[\s]*$/].map(function(m){return m.source}).join("")),
notationType:this.nls.DMSLongLatNotation,conversionType:"DMS"},{name:"GARS",pattern:/^\d{3}[a-zA-Z]{2}[1-4]?[1-9]?$/,notationType:this.nls.GARSNotation,conversionType:"GARS"},{name:"GEOREF",pattern:/^[a-zA-Z]{4}\d{1,8}$/,notationType:this.nls.GEOREFNotation,conversionType:"GEOREF"},{name:"MGRS",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[C-HJ-NP-X][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*/,/(\d[-,;:\s]+\d|\d{2}[-,;:\s]+\d{2}|\d{3}[-,;:\s]+\d{3}|\d{4}[-,;:\s]+\d{4}|\d{5}[-,;:\s]+\d{5})/,/$|^(\d{1,2}[-,;:\s]*[C-HJ-NP-X][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*)/,
/(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})?$|^[ABYZ][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*/,/(\d[-,;:\s]+\d|\d{2}[-,;:\s]+\d{2}|\d{3}[-,;:\s]+\d{3}|\d{4}[-,;:\s]+\d{4}|\d{5}[-,;:\s]+\d{5})/,/$|^[ABYZ][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})?$/].map(function(m){return m.source}).join("")),notationType:this.nls.MGRSNotation,conversionType:"MGRS"},{name:"UTM",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[c-hj-np-xC-HJ-NP-X][-,;:\s]*\d{1,6}\.?\d*[mM]?[-,;:\s]?\d{1,7}\.?\d*[mM]?$/].map(function(m){return m.source}).join("")),
notationType:this.nls.UTMBandNotation,conversionType:"UTM"},{name:"UTM (H)",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[NnSs][-,;:\s]*\d{1,6}\.?\d*[mM]?[-,;:\s]+\d{1,7}\.?\d*[mM]?$/].map(function(m){return m.source}).join("")),notationType:this.nls.UTMHemNotation,conversionType:"UTM (H)"}]},getCoordinateType:function(m){var l=this.getCleanInput(m);m=new n;var b=this.getNotations();l=k.filter(b,function(a){return a.pattern.test(this.v)},{v:l});0<l.length?m.resolve(l):m.resolve(null);return m.promise},getFormattedDDStr:function(m,
l,b){var a={};a.sourceValue=m;a.sourceFormatString=l;m=m[0].split(/[ ,]+/);a.latdeg=m[0].replace(/[nNsS]/,"");a.londeg=m[1].replace(/[eEwW]/,"");b&&(a.latdeg="N"===m[0].slice(-1)?"+"+a.latdeg:"-"+a.latdeg,a.londeg="W"===m[1].slice(-1)?"-"+a.londeg:"+"+a.londeg);l=l.replace(/X/,a.londeg);l=l.replace(/[eEwW]/,m[1].slice(-1));l=l.replace(/[nNsS]/,m[0].slice(-1));l=l.replace(/Y/,a.latdeg);a.formatResult=l;return a},getFormattedDDMStr:function(m,l,b){var a={};a.sourceValue=m;a.sourceFormatString=l;a.parts=
m[0].split(/[ ,]+/);a.latdeg=a.parts[0];a.latmin=a.parts[1].replace(/[nNsS]/,"");a.londeg=a.parts[2];a.lonmin=a.parts[3].replace(/[eEwW]/,"");b&&(a.latdeg="N"===a.parts[1].slice(-1)?"+"+a.latdeg:"-"+a.latdeg,a.londeg="W"===a.parts[3].slice(-1)?"-"+a.londeg:"+"+a.londeg);m=l.replace(/[EeWw]/,a.parts[3].slice(-1));m=m.replace(/Y/,a.lonmin);m=m.replace(/X/,a.londeg);m=m.replace(/[NnSs]/,a.parts[1].slice(-1));m=m.replace(/B/,a.latmin);m=m.replace(/A/,a.latdeg);a.formatResult=m;return a},getFormattedDMSStr:function(m,
l,b){var a={};a.sourceValue=m;a.sourceFormatString=l;a.parts=m[0].split(/[ ,]+/);a.latdeg=a.parts[0];a.latmin=a.parts[1];a.latsec=a.parts[2].replace(/[NnSs]/,"");a.londeg=a.parts[3];a.lonmin=a.parts[4];a.lonsec=a.parts[5].replace(/[EWew]/,"");b&&(a.latdeg="N"===a.parts[2].slice(-1)?"+"+a.latdeg:"-"+a.latdeg,a.londeg="W"===a.parts[5].slice(-1)?"-"+a.londeg:"+"+a.londeg);m=l.replace(/A/,a.latdeg);m=m.replace(/B/,a.latmin);m=m.replace(/C/,a.latsec);m=m.replace(/X/,a.londeg);m=m.replace(/Y/,a.lonmin);
m=m.replace(/Z/,a.lonsec);m=m.replace(/[NnSs]/,a.parts[2].slice(-1));m=m.replace(/[EeWw]/,a.parts[5].slice(-1));a.formatResult=m;return a},getFormattedUSNGStr:function(m,l){var b={};b.sourceValue=m;b.sourceFormatString=l;m[0].match(/^[ABYZ]/)?b.gzd=m[0].match(/[ABYZ]/)[0].trim():b.gzd=m[0].match(/\d{1,2}[C-HJ-NP-X]/)[0].trim();b.grdsq=m[0].replace(b.gzd,"").match(/[a-hJ-zA-HJ-Z]{2}/)[0].trim();b.easting=m[0].replace(b.gzd+b.grdsq,"").match(/^\d{1,5}/)[0].trim();b.northing=m[0].replace(b.gzd+b.grdsq,
"").match(/\d{1,5}$/)[0].trim();m=l.replace(/Y/,b.northing);m=m.replace(/X/,b.easting);m=m.replace(/S/,b.grdsq);m=m.replace(/Z/,b.gzd);b.formatResult=m;return b},getFormattedMGRSStr:function(m,l){var b={};b.sourceValue=m;b.sourceFormatString=l;m[0].match(/^[ABYZ]/)?b.gzd=m[0].match(/[ABYZ]/)[0].trim():b.gzd=m[0].match(/\d{1,2}[C-HJ-NP-X]/)[0].trim();b.grdsq=m[0].replace(b.gzd,"").match(/[a-hJ-zA-HJ-Z]{2}/)[0].trim();b.easting=m[0].replace(b.gzd+b.grdsq,"").match(/^\d{1,5}/)[0].trim();b.northing=m[0].replace(b.gzd+
b.grdsq,"").match(/\d{1,5}$/)[0].trim();m=l.replace(/Y/,b.northing);m=m.replace(/X/,b.easting);m=m.replace(/S/,b.grdsq);m=m.replace(/Z/,b.gzd);b.formatResult=m;return b},getFormattedGARSStr:function(m,l){var b={};b.sourceValue=m;b.sourceFormatString=l;b.lon=m[0].match(/\d{3}/);b.lat=m[0].match(/[a-zA-Z]{2}/);m=m[0].match(/\d*$/);b.quadrant=m[0][0];b.key=m[0][1];l=l.replace(/K/,b.key);l=l.replace(/Q/,b.quadrant);l=l.replace(/Y/,b.lat);l=l.replace(/X/,b.lon);b.formatResult=l;return b},getFormattedGEOREFStr:function(m,
l){var b={};b.sourceValue=m;b.sourceFormatString=l;b.lon=m[0].match(/[a-zA-Z]{1}/)[0].trim();b.lat=m[0].replace(b.lon,"").match(/[a-zA-Z]{1}/)[0].trim();b.quadrant15lon=m[0].replace(b.lon+b.lat,"").match(/[a-zA-Z]{1}/)[0].trim();b.quadrant15lat=m[0].replace(b.lon+b.lat+b.quadrant15lon,"").match(/[a-zA-Z]{1}/)[0].trim();m=m[0].replace(b.lon+b.lat+b.quadrant15lon+b.quadrant15lat,"");b.quadrant1lon=m.substr(0,m.length/2);b.quadrant1lat=m.substr(m.length/2,m.length);l=l.replace(/Y/,b.quadrant1lat);l=
l.replace(/X/,b.quadrant1lon);l=l.replace(/D/,b.quadrant15lat);l=l.replace(/C/,b.quadrant15lon);l=l.replace(/B/,b.lat);l=l.replace(/A/,b.lon);b.formatResult=l;return b},getFormattedUTMStr:function(m,l){var b={};b.sourceValue=m;b.sourceFormatString=l;b.parts=m[0].split(/[ ,]+/);b.zone=b.parts[0].replace(/[A-Z]/,"");b.bandLetter=b.parts[0].slice(-1);b.easting=b.parts[1];b.westing=b.parts[2];m=l.replace(/Y/,b.westing);m=m.replace(/X/,b.easting);m=m.replace(/B/,b.bandLetter);m=m.replace(/Z/,b.zone);b.formatResult=
m;return b},getFormattedUTMHStr:function(m,l){var b={};b.sourceValue=m;b.sourceFormatString=l;b.parts=m[0].split(/[ ,]+/);b.zone=b.parts[0].replace(/[A-Z]/,"");b.hemisphere=b.parts[0].slice(-1);b.easting=b.parts[1];b.westing=b.parts[2];m=l.replace(/Y/,b.westing);m=m.replace(/X/,b.easting);m=m.replace(/H/,b.hemisphere);m=m.replace(/Z/,b.zone);b.formatResult=m;return b},convertMetersToUnits:function(m,l){var b=0;switch(l.toLowerCase()){case "meters":b=m;break;case "feet":b=3.28084*m;break;case "kilometers":b=
.001*m;break;case "miles":b=6.21371E-4*m;break;case "nauticalMiles":b=5.39957E-4*m;break;case "yards":b=1.09361*m}return b},convertToMeters:function(m,l){var b=m;switch(l){case "meters":b=m;break;case "feet":b=.3048*m;break;case "kilometers":b=1E3*m;break;case "miles":b=1609.34*m;break;case "nauticalMiles":b=1852.001376036*m;break;case "yards":b=.9144*m}return b}})})},"widgets/Visibility/js/portal-publish":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin jimu/dijit/CheckBox dojo/_base/array dojo/_base/lang dojo/json dojo/text!../templates/portal-publish.html dojo/dom-construct dojo/on dojo/dom-class dojo/dom-style esri/arcgis/Portal dojo/Evented ./portal-utils jimu/LayerInfos/LayerInfos esri/layers/FeatureLayer esri/graphic esri/dijit/util/busyIndicator jimu/utils dojo/keys dijit/focus dojo/query dojo/topic dijit/form/ValidationTextBox jimu/dijit/formSelect".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q,u,v,t,x,C,B,F,y){return H([k,n,h],{templateString:a,baseClass:"jimu-widget-visibility-publish",publishNewLayer:null,busyIndicator:null,fieldsObj:null,postCreate:function(){String.prototype.format||(String.prototype.format=function(){var w=arguments;return this.replace(/{(\d+)}/g,function(A,z){return"undefined"!==typeof w[z]?w[z]:A})});this.addLayerNameArea&&(this.addLayerNameArea.invalidMessage=this.nls.invalidLayerName,this.addLayerNameArea.missingMessage=
this.nls.missingLayerNameMessage);this.fieldsObj={RegionType:{value:"",dataType:"esriFieldTypeInteger"},CenterPoint:{value:this.centerPoint,dataType:"esriFieldTypeString"},ObservationHeight:{value:this.observerHeight,dataType:"esriFieldTypeDouble"},HeightUnit:{value:this.observerHeightDD,dataType:"esriFieldTypeString"},MinObservationDistance:{value:this.minObsRange,dataType:"esriFieldTypeDouble"},MaxObservationDistance:{value:this.maxObsRange,dataType:"esriFieldTypeDouble"},DistanceUnit:{value:this.distanceUnitDD,
dataType:"esriFieldTypeString"},FOVStartAngle:{value:this.fovStartAngle,dataType:"esriFieldTypeDouble"},FOVEndAngle:{value:this.fovEndAngle,dataType:"esriFieldTypeDouble"},AngleUnits:{value:this.angleUnits,dataType:"esriFieldTypeString"}};this.fields={RegionType:"",CenterPoint:this.centerPoint,ObservationHeight:this.observerHeight,HeightUnit:this.observerHeightDD,MinObservationDistance:this.minObsRange,MaxObservationDistance:this.maxObsRange,DistanceUnit:this.distanceUnitDD,FOVStartAngle:this.fovStartAngle,
FOVEndAngle:this.fovEndAngle,AngleUnits:this.angleUnits};this.publishNewLayer=new r({checked:!1,label:this.nls.publishToNewLayer},c.create("div",{},this.checkBoxParentContainer));this.own(f(this.publishNewLayer,"change",l.hitch(this,this._onCheckboxClicked)));this._populateSelectList(this.featureLayerList,this._layerList,!0);0===this.featureLayerList.options.length&&(this.publishNewLayer.setValue(!0),e.add(this.checkBoxParentContainer,"esriCTHidden"));!this.config.hasOwnProperty("operationalLayer")||
this.config.hasOwnProperty("operationalLayer")&&this.config.operationalLayer.hasOwnProperty("name")&&""===this.config.operationalLayer.name?(e.add(this.featureLayerList.domNode,"esriCTHidden"),this.publishNewLayer.setValue(!0),e.remove(this.addLayerNameArea.domNode,"esriCTHidden")):(e.remove(this.featureLayerList.domNode,"esriCTHidden"),this.publishNewLayer.setValue(!1),e.add(this.addLayerNameArea.domNode,"esriCTHidden"));this.own(f(this.resultsPanelBackButton,"click",l.hitch(this,function(){this.emit("displayMainPageOnBack")})));
this.own(f(this.resultsPanelBackButton,"keydown",l.hitch(this,function(w){w.keyCode!==C.ENTER&&w.keyCode!==C.SPACE||this.emit("displayMainPageOnBack")})));this.own(f(this.publishButton,"click",l.hitch(this,function(){if(this.publishNewLayer.checked&&!this.addLayerNameArea.isValid())this.publishMessage.innerHTML=this.nls.missingLayerNameMessage;else{this.publishMessage.innerHTML="";var w={layerName:this.publishNewLayer.checked?this.addLayerNameArea.value:this.featureLayerList.getValue(),url:"",itemId:"",
serviceItemId:""};if(!this.publishNewLayer.checked){var A=this._layerList.filter(function(z){return z.name===w.layerName},this);1===A.length&&(w.url=A[0].url,w.itemId=A[0].id,w.serviceItemId=b.parse(A[0]._json).serviceItemId)}this._initSaveToPortal(w)}})));this.own(f(this.publishButton,"keydown",l.hitch(this,function(w){if(w.keyCode===C.ENTER||w.keyCode===C.SPACE)if(this.publishNewLayer.checked&&!this.addLayerNameArea.isValid())this.publishMessage.innerHTML=this.nls.missingLayerNameMessage,this._setFirstLastFocusNodes();
else{this.publishMessage.innerHTML="";var A={layerName:this.publishNewLayer.checked?this.addLayerNameArea.value:this.featureLayerList.getValue(),url:"",itemId:"",serviceItemId:"",map:this.map,appConfig:this.appConfig,renderer:this._renderer,publishMessage:this.publishMessage,nls:this.nls,graphics:this.ThreatArea.graphics};this.publishNewLayer.checked||(w=this._layerList.filter(function(z){return z.name===A.layerName},this),1===w.length&&(A.url=w[0].url,A.itemId=w[0].id,A.serviceItemId=b.parse(w[0]._json).serviceItemId));
this._initSaveToPortal(A)}})));this.own(y.subscribe("WIDGET_RESIZE",l.hitch(this,this._onWidgetResize)));this.own(f(this.featureLayerList,"change",l.hitch(this,function(){this._onWidgetResize()})))},startup:function(){this.busyIndicator=t.create({target:this.parentNode.parentNode.parentNode.parentNode,backgroundOpacity:0})},_onWidgetResize:function(){var w=F(".dijitValidationTextBoxLabel",this.featureLayerList.domNode);0<w.length&&g.set(w[0],"width",this.publishButton.clientWidth-53+"px")},_onCheckboxClicked:function(){this.publishNewLayer.checked?
(e.add(this.featureLayerList.domNode,"esriCTHidden"),e.remove(this.addLayerNameArea.domNode,"esriCTHidden"),this.addLayerNameArea.reset(),this.addLayerNameArea.focus()):(e.add(this.addLayerNameArea.domNode,"esriCTHidden"),e.remove(this.featureLayerList.domNode,"esriCTHidden"));this._addLayerToMap=this.publishNewLayer.checked},_containsSupportedCapabilities:function(w){var A=!0;["create","delete","query","update","editing"].forEach(function(z){-1===w.toLowerCase().split(",").indexOf(z)&&(A=!1)});return A},
_populateSelectList:function(w,A,z){var G=[];z&&(G=m.filter(A,function(I){return"esriGeometryPolygon"===I.geometryType},this));A=0<G.length?G:A;m.forEach(A,l.hitch(this,function(I){I.url&&"Feature Layer"===I.type&&this._containsSupportedCapabilities(I.capabilities)&&w.addOption({value:I.name,label:x.sanitizeHTML(I.name),selected:!1,id:I.id})}));this.config.hasOwnProperty("operationalLayer")&&this.config.operationalLayer.hasOwnProperty("name")&&""!==this.config.operationalLayer.name?w.setValue(this.config.operationalLayer.name):
w.setValue("")},_toLowerCaseProps:function(w){for(var A,z=Object.keys(w),G=z.length,I={};G--;)A=z[G],I[A.toLowerCase()]=w[A];return I},_initSaveToPortal:function(w){var A=w.layerName,z=new d.Portal(this.appConfig.portalUrl);this.own(f(z,"load",l.hitch(this,function(){z.signIn().then(l.hitch(this,function(G){var I=G.credential.token,K=G.orgId,Q=G.username;if("org_user"===G.role)this.publishMessage.innerHTML=x.sanitizeHTML(this.nls.createService.format(this.nls.userRole)),this._setFirstLastFocusNodes();
else if(w.url){G=new u(w.url+"?token\x3d"+I,{id:w.layerName,outFields:["*"]});G._wabProperties={itemLayerInfo:{portalUrl:this.appConfig.portalUrl,itemId:w.itemId}};this.busyIndicator.show();var N=[];this.graphics.forEach(function(W){if(void 0!==W.attributes&&W.attributes.hasOwnProperty("type")){var X=l.clone(this.fields);X.RegionType="visible"===W.attributes.regionType?1:0;X=z.isPortal?this._toLowerCaseProps(X):X;N.push(new v(W.geometry,null,X))}},this);G.applyEdits(N,null,null).then(l.hitch(this,
function(){y.publish("moveMap",!1);this.publishMessage.innerHTML=this.nls.successfullyPublished.format('\x3cbr /\x3e\x3ca href\x3d"'+this.appConfig.portalUrl+"home/item.html?id\x3d"+w.serviceItemId+'" target\x3d"_blank"\x3e')+"\x3c/a\x3e";this._reset()})).otherwise(l.hitch(this,function(W){this.publishMessage.innerHTML=W.message;this._reset()}));this.busyIndicator.hide();this._setFirstLastFocusNodes()}else{var T=this.appConfig.portalUrl+"sharing/content/users/"+Q+"/createService";p.isNameAvailable(this.appConfig.portalUrl+
"sharing/rest/portals/"+K+"/isServiceNameAvailable",I,A).then(l.hitch(this,function(W){W.available?(this.busyIndicator.show(),p.createFeatureService(T,I,p.getFeatureServiceParams(A,this.map)).then(l.hitch(this,function(X){if(X.success){var ea=X.serviceurl.replace(/rest/g,"rest/admin")+"/addToDefinition";p.addDefinitionToService(ea,I,p.getLayerParams(A,this.map,this._renderer,this.nls)).then(l.hitch(this,function(fa){if(fa.success){fa=new u(X.serviceurl+"/0?token\x3d"+I,{id:A,outFields:["*"]});fa._wabProperties=
{itemLayerInfo:{portalUrl:this.appConfig.portalUrl,itemId:X.itemId}};this.map.addLayer(fa);if(fa.loaded){var J=q.getInstanceSync().getLayerInfoById(A);J.enablePopup()}else fa.on("load",l.hitch(this,function(){J=q.getInstanceSync().getLayerInfoById(A);J.enablePopup()}));var V=[];m.forEach(this.graphics,function(aa){if(void 0!==aa.attributes&&aa.attributes.hasOwnProperty("type")){var Z=l.clone(this.fields);Z.RegionType="visible"===aa.attributes.regionType?1:0;Z=z.isPortal?this._toLowerCaseProps(Z):
Z;V.push(new v(aa.geometry,null,Z))}},this);fa.applyEdits(V,null,null).then(l.hitch(this,function(){this._reset()})).otherwise(l.hitch(this,function(){this._reset()}));this.busyIndicator.hide();this.publishMessage.innerHTML=this.nls.successfullyPublished.format('\x3cbr /\x3e\x3ca role\x3d"link" tabindex\x3d0 aria-label\x3d"'+this.nls.successfullyPublished+'" href\x3d"'+this.appConfig.portalUrl+"home/item.html?id\x3d"+X.itemId+'" target\x3d"_blank"\x3e')+"\x3c/a\x3e";this._setFirstLastFocusNodes()}}),
l.hitch(this,function(fa){this.busyIndicator.hide();this.publishMessage.innerHTML=x.sanitizeHTML(this.nls.addToDefinition.format(fa.message));this._setFirstLastFocusNodes()}))}else this.busyIndicator.hide(),this.publishMessage.innerHTML=x.sanitizeHTML(this.nls.unableToCreate.format(A)),this._setFirstLastFocusNodes()}),l.hitch(this,function(X){this.busyIndicator.hide();this.publishMessage.innerHTML=x.sanitizeHTML(this.nls.createService.format(X.message));this._setFirstLastFocusNodes()}))):(this.busyIndicator.hide(),
this.publishMessage.innerHTML=this.nls.layerNameExists)}))}}),l.hitch(this,function(G){this.busyIndicator.hide();this.publishMessage.innerHTML=G.message;this._setFirstLastFocusNodes()}))})))},_reset:function(){this.graphicsLayer.clear();this.graphics=[];this.graphicsLayer.refresh()},_setFirstLastFocusNodes:function(){x.initFirstFocusNode(this.parentNode,this.resultsPanelBackButton);B.focus(this.resultsPanelBackButton);x.initLastFocusNode(this.parentNode,this.publishButton);var w=F("a",this.publishMessage)[0];
""!==this.publishMessage.innerHTML&&w?(x.initLastFocusNode(this.parentNode,this.publishMessage),B.focus(w)):""===this.publishMessage.innerHTML&&B.focus(this.resultsPanelBackButton)},_matchLayerFields:function(w,A){var z={},G=Object.keys(this.fieldsObj);m.forEach(A,l.hitch(this,function(I){m.forEach(G,l.hitch(this,function(K){if(I.name.toLowerCase()===K.toLowerCase()&&(I.type===this.fieldsObj[K].dataType||"esriFieldTypeString"===I.type)){var Q=this.fieldsObj[K].value;"esriFieldTypeString"===I.type&&
50>I.length&&"string"===typeof this.fieldsObj[K].value&&(Q=this.fieldsObj[K].value.substr(0,I.length));z[I.name]="RegionType"===K?w:Q}}))}));return z}})})},"widgets/Visibility/js/portal-utils":function(){define(["esri/request","dojo/json"],function(H,k){return{getFeatureServiceParams:function(n,r){return{name:n,serviceDescription:"",hasStaticData:!1,maxRecordCount:1E3,supportedQueryFormats:"JSON",capabilities:"Create,Delete,Query,Update,Editing",tags:"GRG",description:"",copyrightText:"",spatialReference:r.spatialReference.toJson(),
initialExtent:r.extent.toJson(),allowGeometryUpdates:!0,units:"esriMeters",xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"}}},getLayerParams:function(n,r,m,l){return{layers:[{adminLayerInfo:{geometryField:{name:"Shape"},xssTrustedFields:""},id:0,name:n,type:"Feature Layer",displayField:"",description:"",tags:"GRG",copyrightText:"",defaultVisibility:!0,ownershipBasedAccessControlForFeatures:{allowOthersToQuery:!1,allowOthersToDelete:!1,allowOthersToUpdate:!1},
relationships:[],isDataVersioned:!1,supportsCalculate:!0,supportsAttachmentsByUploadId:!0,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,supportsValidateSql:!0,supportsCoordinatesQuantization:!0,supportsApplyEditsWithGlobalIds:!0,advancedQueryCapabilities:{supportsPagination:!0,supportsQueryWithDistance:!0,supportsReturningQueryExtent:!0,supportsStatistics:!0,supportsOrderBy:!0,supportsDistinct:!0,supportsQueryWithResultType:!0,supportsSqlExpression:!0,supportsReturningGeometryCentroid:!0},
useStandardizedQueries:!1,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,extent:r.extent,drawingInfo:{renderer:m.toJson(),transparency:0},allowGeometryUpdates:!0,hasAttachments:!1,htmlPopupType:"esriServerHTMLPopupTypeNone",hasM:!1,hasZ:!1,objectIdField:"OBJECTID",globalIdField:"",typeIdField:"",fields:[{name:"OBJECTID",type:"esriFieldTypeOID",actualType:"int",alias:"OBJECTID",sqlType:"sqlTypeOther",nullable:!1,editable:!1,domain:null,defaultValue:null},{name:"RegionType",type:"esriFieldTypeInteger",
alias:l.regionTypeLabel,actualType:"nvarchar",nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"CenterPoint",type:"esriFieldTypeString",alias:l.centerPointLabel,actualType:"nvarchar",nullable:!0,editable:!0,domain:null,defaultValue:null,sqlType:"sqlTypeNVarchar",length:50},{name:"ObservationHeight",type:"esriFieldTypeDouble",alias:l.observationHeightLabel,nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"HeightUnit",type:"esriFieldTypeString",alias:l.heightUnitLabel,actualType:"nvarchar",
nullable:!0,editable:!0,domain:null,defaultValue:null,sqlType:"sqlTypeNVarchar",length:50},{name:"MinObservationDistance",type:"esriFieldTypeDouble",alias:l.minObservationDistanceLabel,nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"MaxObservationDistance",type:"esriFieldTypeDouble",alias:l.maxObservationDistance,nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"DistanceUnit",type:"esriFieldTypeString",alias:l.distanceUnitLabel,actualType:"nvarchar",nullable:!0,editable:!0,
domain:null,defaultValue:null,sqlType:"sqlTypeNVarchar",length:50},{name:"FOVStartAngle",type:"esriFieldTypeDouble",alias:l.fovstartAngleLabel,nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"FOVEndAngle",type:"esriFieldTypeDouble",alias:l.fovEndAngleLabel,nullable:!0,editable:!0,domain:null,defaultValue:null},{name:"AngleUnits",type:"esriFieldTypeString",alias:l.AngleUnits,actualType:"nvarchar",nullable:!0,editable:!0,domain:null,defaultValue:null,sqlType:"sqlTypeNVarchar",length:50}],
indexes:[],types:[],templates:[{name:"New Feature",description:"",drawingTool:"esriFeatureEditToolPolygon",prototype:{attributes:{}}}],supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:1E4,standardMaxRecordCount:4E3,tileMaxRecordCount:4E3,maxRecordCountFactor:1,exceedsLimitFactor:1,capabilities:"Query,Editing,Create,Update,Delete"}]}},isNameAvailable:function(n,r,m){return H({url:n,content:{name:m,type:"Feature Service",token:r,f:"json"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},
createFeatureService:function(n,r,m){return H({url:n,content:{f:"json",token:r,typeKeywords:"ArcGIS Server,Data,Feature Access,Feature Service,Service,Hosted Service",createParameters:k.stringify(m),outputType:"featureService"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},addDefinitionToService:function(n,r,m){return H({url:n,content:{token:r,addToDefinition:k.stringify(m),f:"json"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})}}})},"widgets/Visibility/js/symbologySettings":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/on ./ColorPickerEditor jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!../templates/symbologySettings.html dojo/_base/lang dojo/Evented dojo/dom-class dojo/dom-attr dojo/query dojo/keys jimu/utils dijit/focus jimu/dijit/formSelect jimu/dijit/SymbolChooser".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p,q){return H([l,b,f],{baseClass:"jimu-widget-visibility-symbologySettings",templateString:a,selectedSettings:{},colorPickerNodes:[],colorPickerObjList:[],constructor:function(u){c.mixin(this,u);this.colorPickerObjList=[];this.colorPickerNodes=[]},startup:function(){if(!this.config.hasOwnProperty("symbology"))var u={visibleSectionOutlineColor:{color:"#000000",transparency:1,type:"esriSLSSolid"},visibleSectionFillColor:{color:"#00ff00",transparency:.5,type:"esriSFSSolid"},
nonVisibleSectionOutlineColor:{color:"#000000",transparency:1,type:"esriSLSSolid"},nonVisibleSectionFillColor:{color:"#ff0000",transparency:.5,type:"esriSFSSolid"}};k.forEach(this.colorPickerNodes,c.hitch(this,function(t){var x=g.get(t,"nodeId");t=new m({nls:this.nls,type:e.contains(t,"Line")?"line":"fill",nodeId:x},t);t.setValues({color:u?u[x].color:this.config.symbology[x].color,transparency:u?u[x].transparency:this.config.symbology[x].transparency});t.startup();t.dropdown.set("value",u?u[x].type:
this.config.symbology[x].type);this.colorPickerObjList.push(t)}));var v=d(".jimu-color-pickerPopup",this.domNode);k.forEach(v,c.hitch(this,function(t){this.own(r(t,"keydown",c.hitch(this,function(x){x.keyCode!==h.ENTER&&x.keyCode!==h.SPACE||x.currentTarget.click()})))}));this.onSettingsChanged()},postCreate:function(){this.inherited(arguments);this.colorPickerObjList=[];this.colorPickerNodes=[];this.colorPickerNodes=d(".colorPicker",this.domNode);this._handleClickEvents();this.visibleSectionSettingsButton.click()},
_handleClickEvents:function(){this.own(r(this.visibleSectionSettingsButton,"click",c.hitch(this,function(){this._openCloseNodes(this.visibleSectionSettingsButton,this.visibleSectionContainer)})));this.own(r(this.nonVisibleSectionSettingsButton,"click",c.hitch(this,function(){this._openCloseNodes(this.nonVisibleSectionSettingsButton,this.nonVisibleSectionContainer)})));this.own(r(this.visibleSectionSettingsButton,"keydown",c.hitch(this,function(u){u.keyCode!==h.ENTER&&u.keyCode!==h.SPACE||this._openCloseNodes(this.visibleSectionSettingsButton,
this.visibleSectionContainer)})));this.own(r(this.nonVisibleSectionSettingsButton,"keydown",c.hitch(this,function(u){u.keyCode!==h.ENTER&&u.keyCode!==h.SPACE||this._openCloseNodes(this.nonVisibleSectionSettingsButton,this.nonVisibleSectionContainer)})))},_openCloseNodes:function(u,v){var t=d(".container",this.domNode),x=d(".esriCTSettingsButtonIcon",this.domNode),C=!1;this.validInputs()&&(u&&e.contains(u,"esriCTLabelSettingsRightButton")&&(C=!0),k.forEach(t,c.hitch(this,function(B){n.addClass(B,"esriCTGroupHidden")})),
k.forEach(x,c.hitch(this,function(B,F){n.removeClass(B,"esriCTLabelSettingsDownButton");n.addClass(B,"esriCTLabelSettingsRightButton");g.set(B,"aria-expanded","false");F===x.length-1&&setTimeout(c.hitch(this,function(){this._setLastFocusNode()}),100)})),C?(n.removeClass(v,"esriCTGroupHidden"),n.removeClass(u,"esriCTLabelSettingsRightButton"),n.addClass(u,"esriCTLabelSettingsDownButton"),g.set(u,"aria-expanded","true"),u=d(".jimu-color-picker",v),u.length&&q.focus(u[0])):q.focus(u))},onClose:function(){if(!this.validInputs())return!1;
this.onSettingsChanged();this._openCloseNodes()},onSettingsChanged:function(){k.forEach(this.colorPickerObjList,c.hitch(this,function(u){var v={color:u.getValues().color,transparency:u.getValues().transparency,type:u.dropdown.getValue()};this.selectedSettings[u.nodeId]=v}));this.emit("settingsChanged",this.selectedSettings)},validInputs:function(){var u=!0;k.some(this.colorPickerObjList,function(v){if(!v.validateSpinner())return u=!1,!0},this);return u},_setLastFocusNode:function(){var u=this.colorPickerObjList.length-
1;this.refDomNode&&(e.contains(this.nonVisibleSectionSettingsButton,"esriCTLabelSettingsDownButton")?p.initLastFocusNode(this.refDomNode,this.colorPickerObjList[u].dropdown.domNode):p.initLastFocusNode(this.refDomNode,this.nonVisibleSectionSettingsButton))}})})},"widgets/Visibility/js/ColorPickerEditor":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Color dojo/on dojo/query dojo/_base/html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!../templates/ColorPickerEditor.html dijit/form/HorizontalSlider jimu/dijit/ColorPickerPopup dojo/dom-style dojo/_base/kernel dijit/form/NumberSpinner".split(" "),
function(H,k,n,r,m,l,b,a,c,f,e,g,d,h,p){return H([a,c,f],{_defaultColor:"#485566",templateString:e,nls:null,postCreate:function(){this.colorPicker=new d({color:this._defaultColor,tabindex:0,"aria-label":this.nls.colorPicker},this.colorPicker);this.colorPicker.startup();this.slider=new g({name:"slider",value:100,minimum:0,maximum:100,discreteValues:101,intermediateChanges:!0,showButtons:!1,style:"display: inline-block;","aria-label":this.nls.transparency},this.sliderBar);this.slider.startup();"vi"===
p.locale&&h.set(this.sliderBarLabel.domNode,"white-space","nowrap");var q=[],u,v="esriSLSDash esriSLSDashDot esriSLSDashDotDot esriSLSDot esriSLSLongDash esriSLSLongDashDot esriSLSNull esriSLSShortDash esriSLSShortDashDot esriSLSShortDashDotDot esriSLSShortDot esriSLSSolid".split(" "),t="esriSFSBackwardDiagonal esriSFSCross esriSFSDiagonalCross esriSFSForwardDiagonal esriSFSHorizontal esriSFSNull esriSFSSolid esriSFSVertical".split(" ");"line"===this.type?k.forEach(v,n.hitch(this,function(x){u={value:x,
label:this.nls.lineStyles[x]};q.push(u)})):k.forEach(t,n.hitch(this,function(x){u={value:x,label:this.nls.fillStyles[x]};q.push(u)}));this.dropdown.addOption(q);this.inherited(arguments)},startup:function(){this.own(m(this.slider,"change",n.hitch(this,function(q){!1===this._isSameVal()&&this.spinner.setValue(q)})));this.own(m(this.spinner,"change",n.hitch(this,function(q){q<=this.slider.maximum&&this.slider.setValue(q)})));this._stylePolyfill();this.inherited(arguments)},_isSameVal:function(){return this.slider.getValue()===
this.spinner.getValue()},getValues:function(){var q=null,u=null;(u=this.colorPicker.getColor())&&u.toHex&&(q=u.toHex());u=this.spinner.getValue()/100;return{color:q,transparency:u}},setValues:function(q){if("object"===typeof q||"string"===typeof q)this.colorPicker.setColor(new r(q.color)),q.transparency="undefined"===typeof q.transparency?0:100*q.transparency,this.slider.setValue(q.transparency),this.spinner.setValue(q.transparency)},_stylePolyfill:function(){var q=l(".dijitSliderLeftBumper",this.domNode)[0];
q&&q.parentNode&&b.setStyle(q.parentNode,"background-color","#24b5cc")},validateSpinner:function(){var q=!0;this.spinner.isValid()||(this._shake(this.spinner.domNode,16),this.spinner.focus(),q=!1);return q},_shake:function(q,u){function v(){if(15>t){q.style.transform="translate(0px, 0px)";u-=x;var F=C(-u,u),y=C(-u,u);q.style.transform="translate("+F+"px, "+y+"px)";t+=1;requestAnimationFrame(v)}15<=t&&(q.style.transform="translate(0, 0)",B._shakingElements.splice(B._shakingElements.indexOf(q),1))}
var t=1,x=u/15,C=function(F,y){return Math.floor(Math.random()*(y-F+1))+F};this._shakingElements||(this._shakingElements=[]);if(-1===this._shakingElements.indexOf(q)){this._shakingElements.push(q);var B=this;v()}}})})},"jimu/dijit/ColorPickerPopup":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup jimu/dijit/ColorPalette jimu/utils".split(" "),function(H,k,n,r,m,l,b,a,c,f,e){return H([k,
n],{baseClass:"jimu-color-pickerPopup",declaredClass:"jimu.dijit.ColorPickerPopup",templateString:'\x3cdiv class\x3d"jimu-color-picker"\x3e\x3c/div\x3e',_isTooltipDialogOpened:!1,color:null,showLabel:!1,around:null,_ENABLE:!0,recordUID:"",postCreate:function(){this.inherited(arguments);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){c.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},enable:function(){this._ENABLE=
!0;m.removeClass(this.domNode,"disable")},disable:function(){this._ENABLE=!1;m.addClass(this.domNode,"disable")},isPartOfPopup:function(g){var d=this.tooltipDialog.domNode;return g===d||m.isDescendant(g,d)},hideTooltipDialog:function(){this._hideTooltipDialog()},showTooltipDialog:function(){this._showTooltipDialog()},initUI:function(){this.picker.initUI()},isOpen:function(){return this._isTooltipDialogOpened},_showTooltipDialog:function(){c.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.around?
this.around:this.domNode,orient:this.orient});this._isTooltipDialogOpened=!0},_hideTooltipDialog:function(){c.hide(this.tooltipDialog);this._isTooltipDialogOpened=!1},_createTooltipDialog:function(){var g=m.create("div");this.tooltipDialog=new a({content:g});m.addClass(this.tooltipDialog.domNode,"jimu-color-picker-popup-dialog");var d=new f({appearance:{showTransparent:!1,showColorPalette:!0,showCoustom:!0,showColorPickerOK:!0,showColorPickerApply:!0,showCoustomRecord:!0,closeDialogWhenChange:!0},
recordUID:this.recordUID,onChange:r.hitch(this,function(h){h&&(h=new b(h),this.setColor(h),this.onChange(h))})});d.placeAt(g);d.startup();this.own(l(d,"close",r.hitch(this,function(){this._hideTooltipDialog()})));this.own(l(d,"change-style",r.hitch(this,function(){this._hideTooltipDialog();this._showTooltipDialog()})));this.own(l(this.domNode,"click",r.hitch(this,function(h){h.stopPropagation();h.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():!1!==this._ENABLE&&this._showTooltipDialog()})));
this.own(l(document,"click",r.hitch(this,function(h){this.isPartOfPopup(h.srcElement||h.target)||this._hideTooltipDialog()})));this.picker=d},setColor:function(g){if(g instanceof b){null===this.color&&!0===this.showLabel&&this._changeLabel(g);var d=g.toHex();this.color=g;m.setStyle(this.domNode,"backgroundColor",d);this.picker&&(this.picker.refreshRecords(),this.picker.setColor(d,!1,!0));this.showLabel&&this._changeLabel(this.color)}},getColor:function(){return this.color},_changeLabel:function(g){m.empty(this.domNode);
m.create("span",{innerHTML:g.toHex(),className:"color-label",style:{color:e.invertColor(g.toHex())}},this.domNode)},onChange:function(g){g&&this.showLabel&&this._changeLabel(g)},changeColor:function(){this.picker&&this.picker.changeColor();this.showLabel&&this._changeLabel(this.color)},setTitle:function(g){this.domNode.title=g},getTooltipDialog:function(){return this.tooltipDialog||null}})})},"widgets/Visibility/js/jquery.knob.min":function(){define(["jimu/loaderplugins/jquery-loader! ./libs/jquery/jquery-1-11-1.js"],
function(H){var k=Math.max,n=Math.min;var r=void 0;r=H(document);var m=function(){var b=this;this.cv=this.v=this.g=this.i=this.$=this.o=null;this.h=this.w=this.y=this.x=0;this.c=this.$c=null;this.t=0;this.isInit=!1;this.rH=this.eH=this.cH=this.dH=this.pColor=this.fgColor=null;this.scale=1;this.relativeHeight=this.relativeWidth=this.relative=!1;this.$div=null;this.run=function(){var a=function(c,f){for(var e in f)b.o[e]=f[e];b._carve().init();b._configure()._draw()};if(!this.$.data("kontroled")){this.$.data("kontroled",
!0);this.extend();this.o=H.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:!0===this.$.data("cursor")&&90||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null===
this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#999",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),units:"degrees",milsValue:0,draw:null,change:null,cancel:null,release:null,format:function(c){return c},parse:function(c){return c}},this.o);this.o.flip="anticlockwise"===
this.o.rotation||"acw"===this.o.rotation;this.o.inputColor||(this.o.inputColor=this.o.fgColor);this.i=this.$;this.v=this.o.parse(this.$.val());this.$.bind("change blur",function(){"mils"===b.o.units&&(b.o.milsValue=b.$.val());b.val(b._validate(b.o.parse("degrees"===b.o.units?b.$.val():b.$.val()/17.777777777778)));b.o.cursor="degrees"===b.o.units?b.$.val():b.$.val()/17.777777777778;b.o.inputColor=0!==b.$.val()?"#ccc":"#f37371";b._carve().init();b._draw()});this.$c=H(document.createElement("canvas")).attr({width:this.o.width,
height:this.o.height});this.$div=H('\x3cdiv style\x3d"'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"\x3e\x3c/div\x3e');this.$.wrap(this.$div).before(this.$c);this.$div=this.$.parent();"undefined"!==typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]);this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null;if(!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+
": "+this.message}};this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1);this.relativeWidth=0!==this.o.width%1&&this.o.width.indexOf("%");this.relativeHeight=0!==this.o.height%1&&this.o.height.indexOf("%");this.relative=this.relativeWidth||this.relativeHeight;this._carve();this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=
this.v;this.$.bind("configure",a).parent().bind("configure",a);this._listen()._configure()._xy().init();this.isInit=!0;this._draw();return this}};this._carve=function(){if(this.relative){var a=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width,10)/100:this.$div.parent().width(),c=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height,10)/100:this.$div.parent().height();this.w=this.h=Math.min(a,c)}else this.w=this.o.width,this.h=this.o.height;this.$div.css({width:this.w+
"px",height:this.h+"px"});this.$c.attr({width:this.w,height:this.h});1!==this.scale&&(this.$c[0].width*=this.scale,this.$c[0].height*=this.scale,this.$c.width(this.w),this.$c.height(this.h));return this};this._draw=function(){var a=!0;b.g=b.c;b.clear();b.dH&&(a=b.dH());!1!==a&&b.draw()};this._mouse=function(a){var c=function(f){f=b.xy2val(f.pageX,f.pageY);f===b.cv||b.cH&&!1===b.cH(f)||(b.change(b._validate(f)),b._draw())};c(a);r.bind("mousemove.k",c).bind("keyup.k",function(f){27===f.keyCode&&(r.unbind("mouseup.k mousemove.k keyup.k"),
b.eH&&!1===b.eH()||b.cancel())}).bind("mouseup.k",function(){r.unbind("mousemove.k mouseup.k keyup.k");b.val(b.cv)});return this};this._xy=function(){var a=this.$c.offset();this.x=a.left;this.y=a.top;return this};this._listen=function(){this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(a){a.preventDefault();b._xy()._mouse(a)}),this.listen());this.relative&&H(window).resize(function(){b._carve().init();b._draw()});return this};this._configure=function(){this.o.draw&&
(this.dH=this.o.draw);this.o.change&&(this.cH=this.o.change);this.o.cancel&&(this.eH=this.o.cancel);this.o.release&&(this.rH=this.o.release);this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.5"),this.fgColor=this.h2rgba(this.o.fgColor,"0.5")):this.fgColor=this.o.fgColor;return this};this._clear=function(){this.$c[0].width=this.$c[0].width};this._validate=function(a){return Math.round(~~((0>a?-.5:.5)+a/this.o.step)*this.o.step*100)/100};this.listen=function(){};this.extend=function(){};
this.init=function(){};this.change=function(){};this.val=function(){};this.xy2val=function(){};this.draw=function(){};this.clear=function(){this._clear()};this.h2rgba=function(a,c){a=a.substring(1,7);a=[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)];return"rgba("+a[0]+","+a[1]+","+a[2]+","+c+")"};this.copy=function(a,c){for(var f in a)c[f]=a[f]}};var l=function(){m.call(this);this.w2=this.cursorExt=this.lineWidth=this.radius=this.xy=this.startAngle=null;
this.PI2=2*Math.PI;this.extend=function(){this.o=H.extend({bgColor:this.$.data("bgcolor")||"#999",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)};this.val=function(b,a){if(null!==b)b=this.o.parse(b),!1!==a&&b!==this.v&&this.rH&&!1===this.rH(b)||(this.v=this.cv=this.o.stopper?k(n(b,this.o.max),this.o.min):b,this._draw());else return this.v};this.xy2val=function(b,a){b=Math.atan2(b-(this.x+this.w2),-(a-this.y-this.w2))-this.angleOffset;this.o.flip&&
(b=this.angleArc-b-this.PI2);this.angleArc!==this.PI2&&0>b&&-.5<b?b=0:0>b&&(b+=this.PI2);b=b*(this.o.max-this.o.min)/this.angleArc+this.o.min;this.o.stopper&&(b=k(n(b,this.o.max),this.o.min));return b};this.listen=function(){var b=this,a,c;this.$.bind("keydown",function(f){var e=f.keyCode;96<=e&&105>=e&&(e=f.keyCode=e-48);a=parseInt(String.fromCharCode(e),10);isNaN(a)&&13!==e&&8!==e&&9!==e&&f.preventDefault()}).bind("keyup",function(){isNaN(a)?c&&(window.clearTimeout(c),c=null,b.val(b.$.val())):b.$.val()>
b.o.max&&b.$.val(b.o.max)||b.$.val()<b.o.min&&b.$.val(b.o.min)})};this.init=function(){if(this.v<this.o.min||this.v>this.o.max)this.v=this.o.min;"degrees"===this.o.units?this.$.val(this.v):this.$.val(this.o.milsValue);this.w2=this.w/2;this.cursorExt=this.o.cursor*Math.PI/180/2;this.xy=this.w2*this.scale;this.lineWidth=this.xy*this.o.thickness;this.lineCap=this.o.lineCap;this.radius=this.xy-this.lineWidth/2;this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset);this.o.angleArc&&
(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc);this.angleOffset=this.o.angleOffset*Math.PI/180;this.angleArc=this.o.angleArc*Math.PI/180;this.startAngle=1.5*Math.PI+this.angleOffset;this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var b=k(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:this.w/2+4+"px",height:this.w/3+"px",position:"absolute","vertical-align":"middle","margin-top":this.w/3+"px","margin-left":"-"+
(3*this.w/4+2)+"px",border:0,background:"none",font:this.o.fontWeight+" "+this.w/b+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})};this.change=function(b){this.cv=b};this.angle=function(b){return(b-this.o.min)*this.angleArc/(this.o.max-this.o.min)};this.arc=function(b){b=this.angle(b);if(this.o.flip){var a=this.endAngle+1E-5;b=a-b-1E-5}else a=this.startAngle-1E-5,b=a+b+1E-5;
this.o.cursor&&(a=b-this.cursorExt)&&(b+=this.cursorExt);return{s:a,e:b,d:this.o.flip&&!this.o.cursor}};this.draw=function(){var b=this.g,a=this.arc(this.cv);var c=1;b.lineWidth=this.lineWidth;b.lineCap=this.lineCap;"none"!==this.o.bgColor&&(b.beginPath(),b.strokeStyle=this.o.bgColor,b.arc(this.xy,this.xy,this.radius,this.endAngle-1E-5,this.startAngle+1E-5,!0),b.stroke());this.o.displayPrevious&&(c=this.arc(this.v),b.beginPath(),b.strokeStyle=this.pColor,b.arc(this.xy,this.xy,this.radius,c.s,c.e,
c.d),b.stroke(),c=this.cv===this.v);b.beginPath();b.strokeStyle=c?this.o.fgColor:this.fgColor;b.arc(this.xy,this.xy,this.radius,a.s,a.e,a.d);b.stroke()};this.cancel=function(){this.val(this.v)}};H.fn.dial=H.fn.knob=function(b){return this.each(function(){var a=new l;a.o=b;a.$=H(this);a.run()}).parent()}})},"jimu/loaderplugins/jquery-loader":function(){define(["dojo/Deferred","dojo/when"],function(H,k){var n,r={},m=function(c){var f=new H;if(r.locked)return setTimeout(function(){m(c)},50),f;if(r[c])return r.locked=
!0,f.resolve(r[c]),f;r.locked=!0;n([c],function(){r[c]=window.jQuery;f.resolve(r[c])});return f},l=function(c,f,e){n([c[f]],function(){f===c.length-1?e.resolve():(f++,l(c,f,e))})},b=function(c,f){c=new H;f[0]?l(f,0,c):c.resolve();return c},a=function(c,f){var e=new H;m(c).then(function(g){b(c,f).then(function(){r.locked=!1;e.resolve(g)})});return e};return{load:function(c,f,e){c=c.split(",");var g=[];n=f;0===c.length?e(null):(f=c[0],g=c.slice(1),k(a(f,g),e))}}})},"widgets/Visibility/js/PrivilegeUtil":function(){define("dojo/_base/declare dojo/_base/lang jimu/portalUtils jimu/portalUrlUtils jimu/Role esri/lang".split(" "),
function(H,k,n,r,m,l){var b=null,a=H([],{userRole:null,userPortalUrl:null,portalAnalysis:null,portalSelf:null,portalUrl:null,_isServiceAvailable:!1,constructor:function(c){this.portalUrl=c},_clearLoadedInfo:function(){this.portalUrl=this.portalSelf=this.userPortalUrl=this.userRole=null},loadPrivileges:function(c){this.portalSelf=this.userPortalUrl=this.userRole=null;this._isServiceAvailable=!1;c&&(this.portalUrl=c);c=n.getPortal(this.portalUrl);return c.haveSignIn()?this._loadUserInfo(c):this._signIn(c)},
getPortalUrl:function(c){return c?r.getStandardPortalUrl(c):this.portalUrl?r.getStandardPortalUrl(this.portalUrl):r.getStandardPortalUrl(this.appConfig.portalUrl)},_privilegeLoaded:function(){return null!==this.portalSelf},getUserPortal:function(){return this._privilegeLoaded()?this.getPortalUrl(this.userPortalUrl):null},_signIn:function(c){return c.loadSelfInfo().then(k.hitch(this,function(f){var e=n.getPortal(f.portalHostname);return null===e?!1:e.signIn().then(k.hitch(this,function(g){return this._loadUserInfo(e,
g)}),function(){return!1})}),function(){return!1})},_loadUserInfo:function(c){return c.loadSelfInfo().then(k.hitch(this,function(f){this.userPortalUrl=f.urlKey?f.urlKey+"."+f.customBaseUrl:this.portalUrl;return f&&f.user?(this.userRole=new m({id:f.user.roleId?f.user.roleId:f.user.role,role:f.user.role}),f.user.privileges&&this.userRole.setPrivileges(f.user.privileges),this.portalSelf=f,!0):!1}),function(){return!1})},_canPerformElevationAnalysis:function(){this.portalSelf&&(this._isServiceAvailable=
l.isDefined(this.portalSelf.helperServices.elevation));return this.canPerformAnalysis()&&this._isServiceAvailable},canPerformAnalysis:function(){var c=!1;this.userRole&&(this.userRole.isAdmin()||this.userRole.isPublisher())?c=!0:this.userRole&&this.userRole.isCustom()&&(c=this.userRole.canCreateItem()&&this.userRole.canPublishFeatures()&&this.userRole.canUseSpatialAnalysis());this.portalSelf&&this.portalSelf.isPortal&&(c=c&&l.isDefined(this.portalSelf.helperServices.analysis)&&l.isDefined(this.portalSelf.helperServices.analysis.url));
return c}});a.getInstance=function(c){null===b&&(b=new a(c));return b};return a})},"widgets/Visibility/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/Visibility/templates/VisibilityControl.html":'\x3cdiv\x3e\r\n\x3cdiv class\x3d"" data-dojo-attach-point\x3d"visibiltyWidget"\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTNewHeader"\x3e\r\n\x3c!-- Panel Title --\x3e\r\n\x3cdiv class\x3d"esriCTMainTitleDiv esriCTEllipsis" title\x3d"${nls.mainPageTitle}"\x3e\r\n  ${nls.mainPageTitle}\r\n  \x3c/div\x3e\r\n  \x3c!-- Settings Icon --\x3e\r\n  \x3cdiv class\x3d"esriCTRightSideButton"\x3e\r\n    \x3cdiv class\x3d"esriCTSettingsIcon esriCTPointer" title\x3d"${nls.settingsTitle}" tabindex\x3d"0" role\x3d\'button\'\r\n    aria-label\x3d\'${nls.settingsTitle}\' data-dojo-attach-point\x3d"settingsIcon"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTSaveToLayerIcon esriCTPointer esriCTHidden" title\x3d"${nls.resultsTitle}" tabindex\x3d"0"  role\x3d\'button\' aria-label\x3d\'${nls.resultsTitle}\' data-dojo-attach-point\x3d"saveToLayerIcon"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3clabel data-dojo-attach-point\x3d"errorText" style\x3d"display: none"\x3e\x3c/label\x3e\r\n  \x3cdiv class\x3d"controls" data-dojo-attach-point\x3d"controls"\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"observerCoordsContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel" data-dojo-attach-point\x3d"FOVLabel"\x3e${nls.fieldOfView}\x3c/label\x3e\r\n      \x3cdiv class\x3d"center" data-dojo-attach-point\x3d"FOVGroup"\x3e\r\n        \x3cinput type\x3d"text" value\x3d"360" class\x3d"fov" data-displayInput\x3d"true" data-cursor\x3d"true" disabled\x3d"true"\r\n          data-dojo-attach-point\x3d"FOVInput" aria-label\x3d"${nls.fieldOfView}" /\x3e\r\n        \x3cp class\x3d"cursortooltip" data-dojo-attach-point\x3d"tooltip" hidden\x3d\'true\'\x3e\x3c/p\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3cinput class\x3d"switch-toggle" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-point\x3d"angleUnits" checked\x3d"false" aria-label\x3d"${nls.useMilsText}"/\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.useMilsText}\x3c/label\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.observerHeight}\x3c/label\x3e\r\n      \x3cdiv\x3e\r\n        \x3cinput class\x3d"inputNumberTextbox" data-dojo-type\x3d\'dijit/form/NumberTextBox\' required\x3d"true" value\x3d"2"\r\n          data-dojo-props\x3d\'constraints: {min: 0}\' data-dojo-attach-point\x3d"observerHeight" aria-label\x3d"${nls.observerHeight}"\x3e\r\n        \x3cselect style\x3d"width: 100px" class\x3d"controlSpace noResize" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n          data-dojo-attach-point\x3d"observerHeightDD" aria-label\x3d"${nls.observerHeight}"\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.minObsDistance}\x3c/label\x3e\r\n      \x3cdiv\x3e\r\n        \x3cinput class\x3d"inputNumberTextbox" data-dojo-type\x3d\'dijit/form/NumberTextBox\' required\x3d"true" value\x3d"3"\r\n          data-dojo-props\x3d\'constraints: {min: 0},intermediateChanges:true\' data-dojo-attach-point\x3d"minObsRange"\r\n          aria-label\x3d"${nls.minObsDistance}"\x3e\r\n        \x3cselect style\x3d"width: 100px" class\x3d"controlSpace noResize" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n          data-dojo-attach-point\x3d"distanceUnitDD" aria-label\x3d"${nls.minObsDistance}"\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.maxObsDistance}\x3c/label\x3e\r\n      \x3cdiv\x3e\r\n        \x3cinput class\x3d"inputNumberTextbox" data-dojo-type\x3d\'dijit/form/NumberTextBox\' required\x3d"true" value\x3d"5"\r\n          data-dojo-props\x3d\'constraints: {min: 0}\' data-dojo-attach-point\x3d"maxObsRange" aria-label\x3d"${nls.maxObsDistance}"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"buttonContainer" data-dojo-attach-point\x3d"buttonContainer"\x3e\r\n      \x3cdiv class\x3d"btnContainer HalfWidthLeft"\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"btnCreate" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.createBtn}"\x3e${nls.createBtn}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"btnContainer HalfWidthRight"\x3e\r\n        \x3cdiv class\x3d"jimu-btn controlSpace" data-dojo-attach-point\x3d"btnClear" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.clearBtn}"\x3e${nls.clearBtn}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n\x3c/div\x3e\r\n\x3cdiv class\x3d"esriCTHidden" data-dojo-attach-point\x3d"portalPublishContainer"\x3e\x3c/div\x3e\r\n\x3cdiv class\x3d"esriCTHidden" data-dojo-attach-point\x3d"settingsContainer"\x3e\r\n  \x3cdiv\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTSettingHeader"\x3e\r\n      \x3cdiv class\x3d"esriCTBackButton" title\x3d"${nls.back}"\x3e\r\n        \x3cdiv class\x3d"esriCTItemLeftArrow" data-dojo-attach-point\x3d"settingsPanelBackButton" tabindex\x3d"0"\r\n          aria-label\x3d"${nls.back}" role\x3d"button"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTTitleDiv esriCTEllipsis" title\x3d"${nls.settingsTitle}"\x3e${nls.settingsTitle}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n      \x3cdiv style\x3d"overflow: hidden;" data-dojo-attach-point\x3d"symbologySettingsNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/SingleFilter.html":'\x3cdiv class\x3d"esriSingleFilterForm singleFilter" id\x3d"${id}.singleFilter"\x3e\r\n  \x3cdiv\x3e\r\n    \x3ctable id\x3d"${id}.exprTable" class\x3d"rowTable" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column1"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column2"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column3"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column4"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column5"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column6"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column7"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3ca id\x3d"${id}.deleteExpression" href\x3d"JavaScript:void(0);" style\x3d"margin:0 5px;display:none;" class\x3d"esriAGOFilterRemoveIcon" title\x3d"${i18n.deleteExpression}"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_interactiveFilterRow"\x3e\r\n          \x3ctd colspan\x3d"8"\x3e\r\n            \x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"interactiveFilter"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd nowrap\x3d"nowrap"\x3e\r\n                    \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            \x3cinput dojoAttachPoint\x3d"interactiveCheck" type\x3d"checkbox" class\x3d"promptCheckBox" title\x3d"${i18n.promptMsg}"/\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            \x3clabel class\x3d"labels" for\x3d"promptCheckBox"\x3e\r\n                              \x26nbsp;\x26nbsp;${i18n.askForValues}\r\n                            \x3c/label\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cspan dojoAttachPoint\x3d"interactiveArrow" style\x3d"color:#cbcbcb;cursor:pointer;" class\x3d"showHidePromptDiv"\x3e\x26nbsp;\x26#9660;\x3c/span\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr dojoAttachPoint\x3d"interactiveSpace" style\x3d"display:none"\x3e\r\n                  \x3ctd nowrap\x3d"nowrap"\x3e\r\n                    \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            ${i18n.prompt}\r\n                          \x3c/td\x3e\r\n                          \x3ctd width\x3d"10"\x3e\r\n                            \x26nbsp;\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"promptText" dojotype\x3d"dijit.form.TextBox" intermediateChanges\x3d"true" style\x3d"width:250px;"\x3e\r\n                            \x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            ${i18n.hint}\r\n                          \x3c/td\x3e\r\n                          \x3ctd width\x3d"10"\x3e\r\n                            \x26nbsp;\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"hintText" dojotype\x3d"dijit.form.TextBox" intermediateChanges\x3d"true" style\x3d"width:250px;"\x3e\r\n                            \x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"promptDiv" style\x3d"display:none;padding:10px 0px;"\x3e\r\n    \x3clabel class\x3d"labels promptLabels" for\x3d"txtPrompt"\x3e\r\n      ${i18n.prompt}\r\n    \x3c/label\x3e\r\n    \x3cinput class\x3d"promptFields txtPrompt" type\x3d"text"/\x3e\r\n    \x3cbr/\x3e\r\n    \x3clabel class\x3d"labels promptLabels" for\x3d"txtHint"\x3e\r\n      ${i18n.hint}\r\n    \x3c/label\x3e\r\n    \x3cinput class\x3d"promptFields txtHint" type\x3d"text" /\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/actionBar.html":"\x3cdiv class\x3d'dijitDialogPaneActionBar' data-dojo-attach-point\x3d\"actionBarNode\"\x3e\r\n\t\x3cbutton data-dojo-type\x3d'dijit/form/Button' type\x3d'submit' data-dojo-attach-point\x3d\"okButton\"\x3e\x3c/button\x3e\r\n\t\x3cbutton data-dojo-type\x3d'dijit/form/Button' type\x3d'button'\r\n\t\t\tdata-dojo-attach-point\x3d\"cancelButton\" data-dojo-attach-event\x3d'click:onCancel'\x3e\x3c/button\x3e\r\n\x3c/div\x3e\r\n","url:esri/dijit/analysis/templates/JobsList.html":'\x3cdiv class\x3d"esriAnalysis"\x3e\r\n   \x3cdiv class\x3d"analysisCategoryCtr" style\x3d"overflow:auto;" data-dojo-attach-point\x3d"_tableDiv"\x3e\r\n    \x3ctable class\x3d"calciteWebTable table-striped"\x3e\r\n       \x3cthead\x3e\r\n         \x3ctr\x3e\r\n          \x3cth\x3e${i18n.toolName}\x3c/th\x3e\r\n          \x3cth\x3e${i18n.dateCreated}\x3c/th\x3e\r\n         \x3c/tr\x3e\r\n      \x3c/thead\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"_analysisJobTBody"\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n   \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/analysis/templates/Settings.html":'\x3cdiv class\x3d"esriAnalysis"\x3e\r\n  \x3cdiv\x3e\r\n    \x3cdiv class\x3d"analysisTitle" style\x3d"padding:1em;" data-dojo-attach-point\x3d"_settingsHeader"\x3e\r\n         \x3ctable class\x3d"esriFormTable"\x3e\r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"2"\x3e\r\n                \x3clabel data-dojo-attach-point\x3d"_analysisTitle"\x3e${i18n.analysisEnv}\x3c/label\x3e\r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv class\x3d"esriFloatTrailing" style\x3d"padding:0;"\x3e\r\n                    \x3cdiv class\x3d"esriFloatTrailing" data-dojo-attach-point\x3d"_closeDiv"\x3e\r\n                      \x3ca href\x3d"#" data-dojo-attach-point\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"esriAnalysisCloseIcon"\x3e\x3c/a\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n         \x3c/table\x3e\r\n    \x3c/div\x3e\r\n    \x3cnav class\x3d"tab-nav feature-nav" data-dojo-attach-point\x3d"_settingsNavCtrl" style\x3d"display:none;"\x3e\r\n      \x3ca href\x3d"#" class\x3d"tab-title is-active general-tab" data-dojo-attach-point\x3d"_generalTab"\x3eGeneral\x3c/a\x3e\r\n      \x3ca href\x3d"#" class\x3d"tab-title history-tab" data-dojo-attach-point\x3d"_historyTab"\x3eHistory\x3c/a\x3e\r\n    \x3c/nav\x3e\r\n   \x3c!--\x3cdiv style\x3d"clear:both; border-bottom: #CCC thin solid; height:1px;width:100%;"\x3e\x3c/div\x3e--\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"_form" readOnly\x3d"true"\x3e\r\n     \x3ctable class\x3d"esriFormTable"\x3e\r\n       \x3ctbody\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_overwriteRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriSelectLabel esriLeadingMargin1"\x3e\r\n               \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_overwriteCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:false" name\x3d"overwriteResult" value\x3d"false" /\x3e\r\n               ${i18n.overwriteResultLayer}\r\n             \x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' data-dojo-attach-point\x3d"_analysisFieldHelpLink" esriHelpTopic\x3d"overwriteResult"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_closeAnalysisRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriSelectLabel esriLeadingMargin1"\x3e\r\n               \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_closeAnalysisCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:${viewModel.closeAnalysisWidget}" data-dojo-attach-event\x3d"onChange:_handleCloseAnalysisCheck" name\x3d"closeAnalysisWidget" value\x3d"false" /\x3e\r\n               ${i18n.closeAnalysisWisget}\r\n             \x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' data-dojo-attach-point\x3d"_analysisFieldHelpLink" esriHelpTopic\x3d"closeAnalysisWidget"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_storeAnalysisRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriSelectLabel esriLeadingMargin1"\x3e\r\n               \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_storeAnalysisCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:false" data-dojo-attach-event\x3d"onChange:_handleReturnFeatureCollectionCheck" name\x3d"storeAnalysisResults" value\x3d"false" /\x3e\r\n               ${i18n.storeAnalysisResults}\r\n             \x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' data-dojo-attach-point\x3d"_analysisFieldHelpLink" esriHelpTopic\x3d"storeAnalysisResults"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_coordinateLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.CoordinateSys}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_outSRLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.outSR}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"outputCoordinateSystem"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_outSRRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_outSRSelect" data-dojo-attach-event\x3d"onChange:_handleSRSelectChange"\x3e\r\n               \x3coption value\x3d"DEFAULT"\x3e${i18n.defaultExtentLabel}\x3c/option\x3e\r\n               \x3coption value\x3d"SPECIFIED"\x3e${i18n.extentSpecfiedBelow}\x3c/option\x3e\r\n             \x3c/select\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd style\x3d"width:15%"\x3e\r\n             \x3cdiv data-dojo-type\x3d"dijit/form/ToggleButton" data-dojo-props\x3d"showLabel:false,iconClass:\'esriAnalysisSRIcon\'" data-dojo-attach-point\x3d"_outSRBtn" data-dojo-attach-event\x3d"onChange:_handleOutSRBtnClick"\x3e\x3c/div\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_outSRCustomRow" style\x3d"display:none;"\x3e\r\n           \x3ctd colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin2"\x3e${i18n.spatialReference}\x3c/label\x3e\r\n             \x3cinput style\x3d"width:20%;" class\x3d"mediumInput esriMediumLabel" type\x3d"text" data-dojo-props\x3d"constraints: {pattern: \'######\', places: 0}" data-dojo-attach-point\x3d"_outSRInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleOutSRInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_outSRCustomInputRow" style\x3d"display:none;"\x3e\r\n           \x3ctd colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin2" data-dojo-attach-point\x3d"_outSRLabel"\x3e\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processSRLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.processSR}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"processingCoordinateSystem"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processSRRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_processSRSelect" data-dojo-attach-event\x3d"onChange:_handleProcessSRSelectChange"\x3e\r\n               \x3coption value\x3d"DEFAULT"\x3e${i18n.defaultExtentLabel}\x3c/option\x3e\r\n               \x3coption value\x3d"SPECIFIED"\x3e${i18n.extentSpecfiedBelow}\x3c/option\x3e\r\n             \x3c/select\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd style\x3d"width:15%"\x3e\r\n             \x3cdiv data-dojo-type\x3d"dijit/form/ToggleButton" class\x3d"esriFloatLeading" data-dojo-props\x3d"showLabel:false,iconClass:\'esriAnalysisSRIcon\'" data-dojo-attach-point\x3d"_processSRBtn" data-dojo-attach-event\x3d"onChange:_handleProcessSRBtnClick"\x3e\x3c/div\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processSRCustomRow" style\x3d"display:none;"\x3e\r\n           \x3ctd colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin2"\x3e${i18n.spatialReference}\x3c/label\x3e\r\n             \x3cinput style\x3d"width:20%;" class\x3d"mediumInput esriMediumLabel" type\x3d"text" data-dojo-props\x3d"constraints: {pattern: \'######\', places: 0}" data-dojo-attach-point\x3d"_processSRInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleProcessSRInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processSRCustomInputRow" style\x3d"display:none;"\x3e\r\n           \x3ctd colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin2" data-dojo-attach-point\x3d"_processSRLabel"\x3e\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processExtLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.processExtent}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_extentLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.extent}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"processingExtent"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_extentRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_extentSelect" data-dojo-attach-event\x3d"onChange:_handleExtentOptionChange"\x3e\r\n               \x3coption value\x3d"DEFAULT"\x3e${i18n.defaultLabel}\x3c/option\x3e\r\n               \x3coption value\x3d"DISPLAY"\x3e${i18n.extentAsDisplay}\x3c/option\x3e\r\n               \x3coption value\x3d"SPECIFIED"\x3e${i18n.extentSpecfiedBelow}\x3c/option\x3e\r\n             \x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_extentLbl"\x3e\r\n           \x3ctd style\x3d"padding:0" colspan\x3d"2"\x3e\r\n             \x3cdiv class\x3d"esriLeadingMargin1"\x3e\r\n               \x3clabel class\x3d"esriSmallLabel"\x3e${i18n.enterCoords}\x3c/label\x3e\r\n             \x3c/div\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_customExtentRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3ctable class\x3d"esriLeadigMargin1 esriFormTable" style\x3d"width:90%;"\x3e\r\n               \x3ctr\x3e\r\n                 \x3ctd\x3e\r\n                   \x3clabel class\x3d""\x3e${i18n.xMin}\x3c/label\x3e\r\n                   \x3cinput type\x3d"text" class\x3d"mediumInput" style\x3d"width:65%;" data-dojo-attach-point\x3d"_xMinInput" data-dojo-type\x3d"dijit/form/NumberTextBox"\x3e\x3c/input\x3e\r\n                 \x3c/td\x3e\r\n                 \x3ctd\x3e\r\n                   \x3clabel\x3e${i18n.xMax}\x3c/label\x3e\r\n                   \x3cinput type\x3d"text" class\x3d"mediumInput" style\x3d"width:65%;" data-dojo-attach-point\x3d"_xMaxInput" data-dojo-type\x3d"dijit/form/NumberTextBox"\x3e\x3c/input\x3e\r\n                 \x3c/td\x3e\r\n               \x3c/tr\x3e\r\n               \x3ctr\x3e\r\n                 \x3ctd\x3e\r\n                   \x3clabel class\x3d""\x3e${i18n.yMin}\x3c/label\x3e\r\n                   \x3cinput type\x3d"text" class\x3d"mediumInput" style\x3d"width:65%;" data-dojo-attach-point\x3d"_yMinInput" data-dojo-type\x3d"dijit/form/NumberTextBox"\x3e\x3c/input\x3e\r\n                 \x3c/td\x3e\r\n                 \x3ctd\x3e\r\n                   \x3clabel\x3e${i18n.yMax}\x3c/label\x3e\r\n                   \x3cinput type\x3d"text" class\x3d"mediumInput" style\x3d"width:65%;" data-dojo-attach-point\x3d"_yMaxInput" data-dojo-type\x3d"dijit/form/NumberTextBox"\x3e\x3c/input\x3e\r\n                 \x3c/td\x3e\r\n               \x3c/tr\x3e\r\n             \x3c/table\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_snapLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.snapRaster}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"snapRaster"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_snapSelRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_snapRasterSelect" data-dojo-attach-event\x3d"onChange:_handleSnapRasterSelectChange"\x3e\x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_geoanalyticsLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.geoanalytis}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_datastoreLabelRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.datastoreLabel}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"dataStore"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_selectDataStore"\x3e\r\n           \x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"_dataStoreTd"\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_rasterLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.rasterLabel}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_cellLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.cellSize}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"cellSize"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_cellSelectRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_cellSizeSelect" data-dojo-attach-event\x3d"onChange:_handleCellSizeSelectChange"\x3e\x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_cellSelectNumRow" style\x3d"display:none;"\x3e\r\n           \x3ctd colspan\x3d"3"\x3e\r\n             \x3cinput style\x3d"width:20%;" class\x3d"esriLeadingMargin1 mediumInput esriMediumLabel" type\x3d"text" data-dojo-attach-point\x3d"_cellSizeInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleCellSizeInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_maskLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.mask}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"mask"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_maskSelRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_maskSelect" data-dojo-attach-event\x3d"onChange:_handleMaskSelectChange"\x3e\x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_creditWarningRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriSelectLabel esriLeadingMargin1"\x3e\r\n               \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_creditWarningCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:true" data-dojo-attach-event\x3d"onChange:_handleCreditWarningCheck" name\x3d"creditWarning" value\x3d"false" /\x3e\r\n               ${i18n.creditWarning}\r\n             \x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_storageLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.storageLabel}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_resamplingMethodLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.resamplingMethod}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"resamplingMethod"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_resamplingMethodSelRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_resamplingMethodSelect" data-dojo-attach-event\x3d"onChange:_handleResamplingMethodSelectChange"\x3e\x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processorLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.processorType}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processorTypeLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.processorType}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"processorType"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_processorTypeSelRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_processorTypeSelect" data-dojo-attach-event\x3d"onChange:_handleProcessorTypeSelectChange"\x3e\x3c/select\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_parallelProcessingLblRow"\x3e\r\n           \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" colspan\x3d"3"\x3e\r\n             \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.parallelProcessingLabel}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_recycleProcessingWorkersLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.recycleProcessingWorkers}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"recycleProcessingWorkers"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_recycleProcessingWorkersNumRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cinput class\x3d"esriLeadingMargin1 mediumInput esriMediumLabel" type\x3d"text" data-dojo-attach-point\x3d"_recycleProcessingWorkersInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handlerecycleProcessingWorkersInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_parallelProcessingFactorLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.parallelProcessingFactor}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"parallelProcessingFactor"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_parallelProcessingFactorNumRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cinput class\x3d"esriLeadingMargin1 mediumInput esriMediumLabel" type\x3d"text" data-dojo-attach-point\x3d"_parallelProcessingFactorInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleparallelProcessingFactorInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_retryOnFailuresLblRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.retryOnFailures}\x3c/label\x3e\r\n           \x3c/td\x3e\r\n           \x3ctd class\x3d"shortTextInput"\x3e\r\n             \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"retryOnFailures"\x3e\x3c/a\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n         \x3ctr data-dojo-attach-point\x3d"_retryOnFailuresNumRow"\x3e\r\n           \x3ctd colspan\x3d"2"\x3e\r\n             \x3cinput class\x3d"esriLeadingMargin1 mediumInput esriMediumLabel" type\x3d"text" data-dojo-attach-point\x3d"_retryOnFailuresInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleretryOnFailuresInputChange"\x3e\x3c/input\x3e\r\n           \x3c/td\x3e\r\n         \x3c/tr\x3e\r\n       \x3c/tbody\x3e\r\n     \x3c/table\x3e\r\n    \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_jobHistoryCtr" style\x3d"display:none;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_jobsListDiv"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriFormWarning esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"display:none;"\x3e\r\n      \x3ca href\x3d"#" title\x3d"${i18n.close}" class\x3d"esriFloatTrailing esriAnalysisCloseIcon" title\x3d\'${i18n.close}\' data-dojo-attach-event\x3d"onclick:_handleCloseMsg"\x3e\r\n      \x3c/a\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"_bodyNode"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/ConfirmDialog" class\x3d"esriAnalysisStgSpatialDialog" title\x3d"${i18n.coordSysDialogTitle}" data-dojo-props\x3d"closable:false" data-dojo-attach-point\x3d"_coordDialog" style\x3d"width:40em;" data-dojo-attach-event\x3d"onExecute:_handleSRDlgOk,onCancel:_handleSRDlgCancel"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_spatialRefGridNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv  class\x3d"esriFloatTrailing" data-dojo-attach-point\x3d"_actionbuttonCtr"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/Button"  class\x3d"${cssClass.primaryButton}" data-dojo-attach-point\x3d"_addBtn" data-dojo-attach-event\x3d"onClick:_handleOkButtonClick"\x3e\r\n      ${i18n.apply}\r\n    \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"${cssClass.button}" data-dojo-attach-point\x3d"_closeBtn" data-dojo-attach-event\x3d"onClick:_handleCancelButtonClick"\x3e\r\n      ${i18n.cancel}\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/analysis/templates/ExpressionForm.html":'\x3cdiv class\x3d"esriAnalysis esriExpressionForm"\x3e\r\n  \x3cdiv class\x3d"esriFormError esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n  \x3c!--\x3cdiv class\x3d"clear" style\x3d"height:1em;"\x3e\x3c/div\x3e--\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" class\x3d"esriSimpleForm" data-dojo-attach-point\x3d"_expressionForm"\x3e\r\n    \x3ctable class\x3d"esriFormTable" style\x3d"border: 1px solid #929497;background-color: #F7F8F8 !important;"\x3e \r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_firstRow" \x3e\r\n          \x3ctd style\x3d"width:75%"\x3e\r\n            \x3cselect class\x3d"" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;table-layout:fixed;" data-dojo-attach-event\x3d"onChange:_handleFirstOperandChange" data-dojo-attach-point\x3d"_firstOperandSelect"\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd style\x3d"width:25%"\x3e\r\n            \x3cselect class\x3d"" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleOperatorChange" style\x3d"width:100%;table-layout:fixed;" data-dojo-attach-point\x3d"_operatorSelect"\x3e\r\n              \x3coption value\x3d"where"\x3e${i18n.where}\x3c/option\x3e\r\n              \x3coption value\x3d"intersects"\x3e${i18n.intersects}\x3c/option\x3e\r\n              \x3coption value\x3d"notIntersects"\x3e${i18n.notIntersects}\x3c/option\x3e\r\n              \x3coption value\x3d"withinDistance"\x3e${i18n.withinDistance}\x3c/option\x3e\r\n              \x3coption value\x3d"notWithinDistance"\x3e${i18n.notWithinDistance}\x3c/option\x3e\r\n              \x3coption value\x3d"contains"\x3e${i18n.contains}\x3c/option\x3e\r\n              \x3coption value\x3d"notContains"\x3e${i18n.notContains}\x3c/option\x3e\r\n              \x3coption value\x3d"within"\x3e${i18n.within}\x3c/option\x3e\r\n              \x3coption value\x3d"notWithin"\x3e${i18n.notWithin}\x3c/option\x3e\r\n              \x3coption value\x3d"nearest"\x3e${i18n.nearest}\x3c/option\x3e\r\n              \x3c!--\x3coption value\x3d"contains"\x3e${i18n.contains}\x3c/option\x3e\r\n              \x3coption value\x3d"notContains"\x3e${i18n.notContains}\x3c/option\x3e--\x3e\r\n              \x3c!--\x3coption value\x3d"within"\x3e${i18n.within}\x3c/option\x3e\r\n              \x3coption value\x3d"notWithin"\x3e${i18n.notWithin}\x3c/option\x3e--\x3e\r\n              \x3c!--\x3coption value\x3d"identical"\x3e${i18n.identical}\x3c/option\x3e\r\n              \x3coption value\x3d"notIdentical"\x3e${i18n.notIdentical}\x3c/option\x3e\r\n              \x3coption value\x3d"touches"\x3e${i18n.touches}\x3c/option\x3e\r\n              \x3coption value\x3d"notTouches"\x3e${i18n.notTouches}\x3c/option\x3e--\x3e\r\n              \x3c!--\x3coption value\x3d"crossesOutline"\x3e${i18n.crossesOutline}\x3c/option\x3e\r\n              \x3coption value\x3d"notCrossesOutline"\x3e${i18n.notCrossesOutline}\x3c/option\x3e--\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_secondRow" style\x3d"display:none;"\x3e\r\n          \x3ctd data-dojo-attach-point\x3d"_secondOperandTd" colspan\x3d"2"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_secondExpressionDiv" style\x3d"display:none; padding-bottom:0.25em;"\x3e\r\n              \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"onChange:_handleDistanceInputChange" data-dojo-props\x3d"intermediateChanges:true" data-dojo-attach-point\x3d"_distanceInput" style\x3d"width:20%;"\x3e\x3c/input\x3e\r\n              \x3cselect data-dojo-type\x3d"dijit/form/Select"  data-dojo-attach-point\x3d"_distanceUnitsSelect"  style\x3d"width:20%;table-layout:fixed;"\x3e\r\n                \x3coption value\x3d"Miles"\x3e${i18n.miles}\x3c/option\x3e\r\n                \x3coption value\x3d"Yards"\x3e${i18n.yards}\x3c/option\x3e\r\n                \x3coption value\x3d"Feet"\x3e${i18n.feet}\x3c/option\x3e\r\n                \x3coption type\x3d"separator"\x3e\x3c/option\x3e\r\n                \x3coption value\x3d"Kilometers"\x3e${i18n.kilometers}\x3c/option\x3e\r\n                \x3coption value\x3d"Meters"\x3e${i18n.meters}\x3c/option\x3e\r\n                \x3coption value\x3d"NauticalMiles"\x3e${i18n.nautMiles}\x3c/option\x3e\r\n              \x3c/select\x3e\r\n              \x3clabel\x3e ${i18n.from} \x3c/label\x3e\r\n            \x3c/div\x3e\r\n            \x3cselect class\x3d"" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:75%;table-layout:fixed;" data-dojo-attach-point\x3d"_secondOperandSelect" data-dojo-attach-event\x3d"onChange:_handleSecondOperandChange"\x3e\r\n            \x3c/select\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_attrFilterDiv" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n    \x3cdiv class\x3d"esriFormWarning esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"display:none;"\x3e\r\n      \x3ca href\x3d"#" title\x3d"${i18n.close}" class\x3d"esriFloatTrailing esriAnalysisInfoPaneCloseIcon" title\x3d\'${i18n.close}\' data-dojo-attach-event\x3d"onclick:_handleCloseMsg"\x3e\r\n      \x3c/a\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"_bodyNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e    \r\n    \x3cdiv style\x3d"clear:both;"\x3e\x3c/div\x3e\r\n    \x3cdiv  class\x3d"esriFloatTrailing" style\x3d"padding: 10px 5px;"\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/form/Button"  class\x3d"${_addBtnClass}" data-dojo-attach-point\x3d"_addBtn" data-dojo-attach-event\x3d"onClick:_handleAddButtonClick"\x3e\r\n        ${i18n.add}\r\n      \x3c/div\x3e\r\n       \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriLeadingMargin05" data-dojo-attach-point\x3d"_closeBtn" data-dojo-attach-event\x3d"onClick:_handleCloseButtonClick"\x3e\r\n        ${i18n.close}\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \r\n  \x3c/div\x3e\r\n\x3c/div\x3e  \r\n',
"url:esri/dijit/analysis/components/FilterAndSelection/FilterAndSelection.html":'\x3cdiv class\x3d"esriLeadingMargin1 esriFloatTrailing marginTop1"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/ToggleButton" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.selectLabel}\',iconClass:\'esriAnalysisSelectFilterIcon\',showLabel:false" data-dojo-attach-point\x3d"_selectBtn" data-dojo-attach-event\x3d"onChange:_handleSelectionButtonClick"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.queryLabel}\',iconClass:\'esriAnalysisAttributeFiltercon\',showLabel:false" data-dojo-attach-point\x3d"_queryBtn" data-dojo-attach-event\x3d"onClick:_handleQueryButtonClick"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" title\x3d"${i18n.expression}" data-dojo-props\x3d"closable:false" data-dojo-attach-point\x3d"_expDialog" style\x3d"width:65em;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_expressionForm" data-dojo-type\x3d"esri/dijit/analysis/ExpressionForm" data-dojo-props\x3d"showFirstRow:false,primaryActionButttonClass:\'btn calcite blue\'"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/analysis/templates/CreditEstimator.html":'\x3cdiv class\x3d"esriAnalysis esriSimpleForm"\x3e\r\n  \x3ctable class\x3d"esriFormTable"  data-dojo-attach-point\x3d"_table"  style\x3d"border-collapse:collapse;border-spacing:5px;"\x3e\r\n     \x3c!--\x3ctr\x3e\r\n      \x3ctd\x3e\r\n        \x3clabel class\x3d"esriFloatLeading"\x3e${i18n.analysisLayersLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e--\x3e\r\n     \x3ctr\x3e\r\n      \x3ctd\x3e\r\n        \x3clabel class\x3d"esriFloatLeading" data-dojo-attach-point\x3d"_totalRecordsLabelNode"\x3e${i18n.totalRecordsLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd data-dojo-attach-point\x3d"_totalRecordsNode"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n     \x3c!--\x3ctr\x3e\r\n      \x3ctd\x3e\r\n        \x3clabel class\x3d"esriFloatLeading"\x3e${i18n.creditsAvailLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e--\x3e\r\n     \x3ctr\x3e\r\n      \x3ctd\x3e\r\n        \x3clabel class\x3d"esriFloatLeading" data-dojo-attach-point\x3d"_costLabelNode"\x3e${i18n.creditsReqLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd data-dojo-attach-point\x3d"_creditsReqNode"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_messageDiv"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/analysis/templates/CreateViewshed.html":'\x3cdiv class\x3d"esriAnalysis"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" style\x3d"margin-top:0.5em; margin-bottom: 0.5em;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_hotspotsToolContentTitle" class\x3d"analysisTitle"\x3e\r\n         \x3ctable class\x3d"esriFormTable" \x3e \r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"esriToolIconTd"\x3e\x3cdiv class\x3d"createViewshedIcon"\x3e\x3c/div\x3e\x3c/td\x3e\r\n              \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" data-dojo-attach-point\x3d"_toolTitle"\x3e\r\n                \x3clabel data-dojo-attach-point\x3d"_titleLbl"\x3e${i18n.createViewshed}\x3c/label\x3e\r\n                \x3cnav class\x3d"breadcrumbs"  data-dojo-attach-point\x3d"_analysisModeLblNode" style\x3d"display:none;"\x3e\r\n                  \x3ca href\x3d"#" class\x3d"crumb breadcrumbs__modelabel" data-dojo-attach-event\x3d"onclick:_handleModeCrumbClick" data-dojo-attach-point\x3d"_analysisModeCrumb"\x3e\x3c/a\x3e\r\n                  \x3ca href\x3d"#" class\x3d"crumb is-active" data-dojo-attach-point\x3d"_analysisTitleCrumb" style\x3d"font-size:16px;"\x3e${i18n.createViewshed}\x3c/a\x3e\r\n                \x3c/nav\x3e                 \r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n                \x3cdiv class\x3d"esriFloatTrailing" style\x3d"padding:0;"\x3e\r\n                    \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n                      \x3ca href\x3d"#" class\x3d\'esriFloatLeading helpIcon\' esriHelpTopic\x3d"toolDescription"\x3e\x3c/a\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n                      \x3ca href\x3d"#" data-dojo-attach-point\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"esriAnalysisCloseIcon"\x3e\x3c/a\x3e\r\n                    \x3c/div\x3e              \r\n                \x3c/div\x3e  \r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n         \x3c/table\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"clear:both; border-bottom: #CCC thin solid; height:1px;width:100%;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"_form" readOnly\x3d"true"\x3e\r\n     \x3ctable class\x3d"esriFormTable"\x3e \r\n       \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_titleRow"\x3e\r\n          \x3ctd  colspan\x3d"3" class\x3d"sectionHeader" data-dojo-attach-point\x3d"_interpolateToolDescription" \x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_analysisLabelRow" style\x3d"display:none;"\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriFloatLeading  esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.oneLabel}\x3c/label\x3e\r\n            \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.analysisLayerLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"inputLayer"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_selectAnalysisRow" style\x3d"display:none;"\x3e\r\n          \x3ctd  colspan\x3d"3"\x3e\r\n            \x3ctable style\x3d"width:100%;"\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd style\x3d"width:80%"\x3e  \r\n                \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel"  style\x3d"margin-top:1.0em;" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_analysisSelect" data-dojo-attach-event\x3d"onChange:_handleAnalysisLayerChange"\x3e\x3c/select\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd style\x3d"width:20%"\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/ToggleButton"  data-dojo-attach-point\x3d"_analysisPointDrawBtn"  class\x3d"esriFloatLeading esriActionButton" data-dojo-props\x3d"showLabel:false,iconClass:\'toolbarIcon esriPointIcon\',label:\'${i18n.drawLabel}\'" data-dojo-attach-event\x3d"onChange:_handleInputDrawPointChange"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e          \r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.oneLabel}\x3c/label\x3e\r\n            \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.viewshedOptionlabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriLeadingMargin2"\x3e${i18n.observerHghtLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"ObserverHeight"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e                    \r\n        \x3c/tr\x3e                  \r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3" style\x3d"padding:0;"\x3e\r\n            \x3ctable class\x3d"esriFormTable esriLeadingMargin2" style\x3d"width:90%;"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                \x3ctd  style\x3d"width:50%;padding-right:1em;"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"value:${observerHeight},intermediateChanges:true,invalidMessage:\'${i18n.distanceInValidMsg}\',constraints:{min:0}" data-dojo-attach-point\x3d"_obsrHeightInput" style\x3d"width:100%;"\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd colspan\x3d"2"\x3e\r\n            \x3cselect class\x3d"longInput esriAnalysisSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_obsrUnitsSelect"\x3e\r\n            \x3c/select\x3e\r\n                \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriLeadingMargin2"\x3e${i18n.targetHghtLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"TargetHeight"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e                    \r\n        \x3c/tr\x3e                  \r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3" style\x3d"padding:0;"\x3e\r\n            \x3ctable class\x3d"esriFormTable esriLeadingMargin2" style\x3d"width:90%;"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                \x3ctd  style\x3d"width:50%;padding-right:1em;"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"value:${targetHeight},intermediateChanges:true,invalidMessage:\'${i18n.distanceInValidMsg}\',constraints:{min:0}" data-dojo-attach-point\x3d"_targetHgtInput" style\x3d"width:100%;"\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd colspan\x3d"2"\x3e\r\n            \x3cselect class\x3d"longInput esriAnalysisSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_targetUnitsSelect"\x3e\r\n            \x3c/select\x3e\r\n                \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriLeadingMargin2"\x3e${i18n.maxDistanceLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"MaximumDistance"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e                    \r\n        \x3c/tr\x3e                   \r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3" style\x3d"padding:0;"\x3e\r\n            \x3ctable class\x3d"esriFormTable esriLeadingMargin2" style\x3d"width:90%;"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                \x3ctd  style\x3d"width:50%;padding-right:1em;"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"value:${maximumDistance},intermediateChanges:true,invalidMessage:\'${i18n.distanceInValidMsg}\', constraints:{min:0}" data-dojo-attach-point\x3d"_maximumDistanceInput" style\x3d"width:100%;" data-dojo-attach-event\x3d"onChange:_handleMaxDstChange"\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd colspan\x3d"2"\x3e\r\n            \x3cselect class\x3d"longInput esriAnalysisSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_distanceUnitsSelect" data-dojo-attach-event\x3d"onChange:_handleMaxDstUnitsChange"\x3e\r\n            \x3c/select\x3e\r\n                \x3c/td\x3e\r\n               \x3c/tr\x3e                  \r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3" class\x3d"clear"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.twoLabel}\x3c/label\x3e\r\n            \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.outputLayerLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"OutputLayer"\x3e\x3c/a\x3e \r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true,required:true" class\x3d"longTextInput esriLeadingMargin1" data-dojo-attach-point\x3d"_outputLayerInput"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n             \x3cdiv data-dojo-attach-point\x3d"_chooseFolderRow" class\x3d"esriLeadingMargin1"\x3e\r\n               \x3clabel style\x3d"width:9px;font-size:smaller;"\x3e${i18n.saveResultIn}\x3c/label\x3e\r\n               \x3cinput class\x3d"longInput" data-dojo-attach-point\x3d"_webMapFolderSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" style\x3d"width:55%;"\x3e\x3c/input\x3e\r\n             \x3c/div\x3e              \r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n     \x3c/table\x3e\r\n   \x3c/div\x3e\r\n  \x3cdiv style\x3d"padding:5px;margin-top:5px;border-top:solid 1px #BBB;"\x3e\r\n    \x3cdiv class\x3d"esriExtentCreditsCtr"\x3e\r\n      \x3ca class\x3d"esriFloatTrailing esriSmallFont"  href\x3d"#" data-dojo-attach-point\x3d"_showCreditsLink"\x3e${i18n.showCredits}\x3c/a\x3e\r\n     \x3clabel data-dojo-attach-point\x3d"_chooseExtentDiv" class\x3d"esriSelectLabel esriExtentLabel"\x3e\r\n       \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_useExtentCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:true" name\x3d"extent" value\x3d"true"/\x3e\r\n         ${i18n.useMapExtent}\r\n     \x3c/label\x3e\r\n    \x3c/div\x3e\r\n    \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"submit" data-dojo-attach-point\x3d"_saveBtn" class\x3d"esriLeadingMargin4 esriAnalysisSubmitButton" data-dojo-attach-event\x3d"onClick:_handleSaveBtnClick"\x3e\r\n        ${i18n.runAnalysis}\r\n    \x3c/button\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" title\x3d"${i18n.creditTitle}" data-dojo-attach-point\x3d"_usageDialog" style\x3d"width:40em;"\x3e\r\n    \x3cdiv data-dojo-type\x3d"esri/dijit/analysis/CreditEstimator"  data-dojo-attach-point\x3d"_usageForm"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e    \r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/CoordinateControl.html":"\x3cdiv class\x3d'coordinateContainer'\x3e\r\n  \x3cdiv class\x3d'coordLabel' data-dojo-attach-point\x3d'coordNameContainer' data-a11y-label-id\x3d'coordLabel'\x3e\r\n    \x3cspan data-dojo-type\x3d'dijit/InlineEditBox' width\x3d'75px' data-dojo-props\x3d\"editor:'dijit/form/TextBox', autoSave:true\"\r\n      data-dojo-attach-point\x3d'coordName'\x3e${type}\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d'add-with-icon coordInput'\x3e\r\n    \x3ctextarea data-a11y-label-by\x3d'coordLabel' tabindex\x3d\"0\" aria-multiline\x3d\"true\" role\x3d\"textbox\" id\x3d'${uid}' type\x3d'text' rows\x3d'1' data-dojo-attach-point\x3d'coordtext' spellcheck\x3d'false'\r\n    placeholder\x3d'${nls.coordinateInputLabel}' title\x3d'${nls.coordinateInputLabel}'\x3e\x3c/textarea\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d'coordactions'\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" id\x3d'${uid}_cpbtn' aria-label\x3d'${nls.copyToClipboard}' title\x3d'${nls.copyToClipboard}' data-dojo-attach-point\x3d'cpbtn' class\x3d'cpbtn'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" title\x3d\"${nls.formatOutput}\" class\x3d'settingBtn' data-dojo-attach-point\x3d'formatButton'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" aria-label\x3d'${nls.zoomLabel}' title\x3d'${nls.zoomLabel}' class\x3d'zoomBtn' data-dojo-attach-point\x3d'zoomButton'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" aria-label\x3d'${nls.addPointLabel}' title\x3d'${nls.addPointLabel}' class\x3d'drawPointBtn' data-dojo-attach-point\x3d'drawPointButton'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" aria-label\x3d'${nls.removeCoordinate}' title\x3d'${nls.removeCoordinate}' class\x3d'jimu-icon jimu-icon-close' data-dojo-attach-point\x3d'removeControlBtn'\r\n        data-dojo-attach-event\x3d'onclick: remove'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d'add-with-icon'\x3e\r\n      \x3cspan tabindex\x3d\"0\" role\x3d\"button\" aria-label\x3d\"${nls.expandOutput}\" aria-expanded \x3d \"false\" title\x3d\"${nls.expandOutput}\" class\x3d'expandBtn' data-dojo-attach-point\x3d'expandButton'\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d'coordcontrols' class\x3d'coordarea' style\x3d\"display: none\"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d'sub1' class\x3d'coordformat'\x3e\r\n      \x3cdiv class\x3d'crdfrmtlabel'\x3e\r\n        \x3cspan data-dojo-attach-point\x3d'sub1label' data-a11y-label-id\x3d'sub1Label'/\x3e\r\n      \x3c/div\x3e\r\n      \x3cinput data-a11y-label-by\x3d'sub1Label' tabindex\x3d\"-1\" role\x3d\"textbox\" readonly data-dojo-attach-point\x3d'${uid}sub1val' class\x3d'jimu-input crds'\x3e\x3c/input\x3e\r\n      \x3cdiv class\x3d'add-with-icon'\x3e\r\n        \x3cspan tabindex\x3d\"-1\" role\x3d\"button\" id\x3d'${uid}sub1val~cpbtn' aria-label\x3d'${nls.copyToClipboard}' title\x3d'${nls.copyToClipboard}' data-dojo-attach-point\x3d'subVal1CpBtn' class\x3d'jimu-icon cpbtn'\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d'sub2' class\x3d'coordformat'\x3e\r\n      \x3cdiv class\x3d'crdfrmtlabel'\x3e\r\n        \x3cspan data-dojo-attach-point\x3d'sub2label' data-a11y-label-id\x3d'sub2Label'/\x3e\r\n      \x3c/div\x3e\r\n      \x3cinput data-a11y-label-by\x3d'sub2Label' tabindex\x3d\"-1\" role\x3d\"textbox\" readonly data-dojo-attach-point\x3d'${uid}sub2val' class\x3d'jimu-input crds'\x3e\x3c/input\x3e\r\n      \x3cdiv class\x3d'add-with-icon'\x3e\r\n        \x3cspan tabindex\x3d\"-1\" role\x3d\"button\" id\x3d'${uid}sub2val~cpbtn' aria-label\x3d'${nls.copyToClipboard}' title\x3d'${nls.copyToClipboard}' data-dojo-attach-point\x3d'subVal2CpBtn' class\x3d'jimu-icon cpbtn'\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d'sub3' class\x3d'coordformat sub3'\x3e\r\n      \x3cdiv class\x3d'crdfrmtlabel'\x3e\r\n        \x3cspan data-dojo-attach-point\x3d'sub3label' data-a11y-label-id\x3d'sub3Label'/\x3e\r\n      \x3c/div\x3e\r\n      \x3cinput data-a11y-label-by\x3d'sub3Label' tabindex\x3d\"-1\" role\x3d\"textbox\" readonly data-dojo-attach-point\x3d'${uid}sub3val' class\x3d'jimu-input crds'\x3e\r\n      \x3c/input\x3e\r\n      \x3cdiv class\x3d'add-with-icon'\x3e\r\n        \x3cspan tabindex\x3d\"-1\" role\x3d\"button\" id\x3d'${uid}sub3val~cpbtn' aria-label\x3d'$${nls.copyToClipboard}' title\x3d'$${nls.copyToClipboard}' data-dojo-attach-point\x3d'subVal3CpBtn' class\x3d'jimu-icon cpbtn'\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d'sub4' class\x3d'coordformat sub4'\x3e\r\n      \x3cdiv class\x3d'crdfrmtlabel'\x3e\r\n        \x3cspan data-dojo-attach-point\x3d'sub4label' data-a11y-label-id\x3d'sub4Label' /\x3e\r\n      \x3c/div\x3e\r\n      \x3cinput data-a11y-label-by\x3d'sub4Label' tabindex\x3d\"-1\" role\x3d\"textbox\" readonly data-dojo-attach-point\x3d'${uid}sub4val' class\x3d'jimu-input crds'\x3e\r\n      \x3c/input\x3e\r\n      \x3cdiv class\x3d'add-with-icon'\x3e\r\n        \x3cspan tabindex\x3d\"-1\" role\x3d\"button\" id\x3d'${uid}sub4val~cpbtn' aria-label\x3d'${nls.copyToClipboard} title\x3d'${nls.copyToClipboard}' data-dojo-attach-point\x3d'subVal4CpBtn' class\x3d'jimu-icon cpbtn'\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d\"line-separator\"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e",
"url:dijit/templates/InlineEditBox.html":'\x3cspan data-dojo-attach-point\x3d"editNode" role\x3d"presentation" class\x3d"dijitReset dijitInline dijitOffScreen"\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"editorPlaceholder"\x3e\x3c/span\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"buttonContainer"\r\n\t\t\x3e\x3cbutton data-dojo-type\x3d"./form/Button" data-dojo-props\x3d"label: \'${buttonSave}\', \'class\': \'saveButton\'"\r\n\t\t\tdata-dojo-attach-point\x3d"saveButton" data-dojo-attach-event\x3d"onClick:save"\x3e\x3c/button\r\n\t\t\x3e\x3cbutton data-dojo-type\x3d"./form/Button"  data-dojo-props\x3d"label: \'${buttonCancel}\', \'class\': \'cancelButton\'"\r\n\t\t\tdata-dojo-attach-point\x3d"cancelButton" data-dojo-attach-event\x3d"onClick:cancel"\x3e\x3c/button\r\n\t\x3e\x3c/span\r\n\x3e\x3c/span\x3e\r\n',
"url:widgets/Visibility/templates/portal-publish.html":'\x3cdiv class\x3d"esriCTFullHeight" data-dojo-attach-point\x3d"resultsPageNode"\x3e\r\n  \x3cdiv class\x3d"esriCTFullWidth esriCTSettingHeader"\x3e\r\n    \x3cdiv class\x3d"esriCTBackButton" title\x3d"${nls.back}"\x3e\r\n      \x3cdiv class\x3d"esriCTItemLeftArrow" data-dojo-attach-point\x3d"resultsPanelBackButton" tabindex\x3d"0"\r\n        aria-label\x3d"${nls.back}" role\x3d"button"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTTitleDiv esriCTEllipsis" title\x3d"${nls.resultsTitle}"\x3e${nls.resultsTitle}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n      \x3c!-- esriCT Layer Name --\x3e\r\n      \x3cdiv class\x3d"esriCTFullWidth esriCTSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTInputLabel esriCTEllipsis" title\x3d"${nls.layerName}"\x3e${nls.layerName}\x3c/div\x3e\r\n        \x3cinput aria-label\x3d"${nls.layerName}" class\x3d"esriCTHidden" style\x3d"width: 100%; margin-bottom: 8px;"\r\n          data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"addLayerNameArea"\r\n          data-dojo-props\x3d"regExp:\'[a-zA-Z0-9_ -]*\'" required\x3d"true" tabindex\x3d"0" trim\x3d"true"\x3e\x3c/input\x3e\r\n        \x3cselect class\x3d"publishSelect" aria-label\x3d"${nls.layerName}" data-dojo-type\x3d"jimu/dijit/formSelect" tabindex\x3d"0"\r\n          data-dojo-attach-point\x3d"featureLayerList"\x3e\x3c/select\x3e\r\n        \x3cdiv class\x3d"esriCTCheckBoxNode" data-dojo-attach-point\x3d"checkBoxParentContainer"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!-- Publish esriCT Button --\x3e\r\n      \x3cdiv class\x3d"esriCTPublishBtnContainer"\x3e\r\n        \x3cdiv class\x3d\'jimu-btn\' data-dojo-attach-point\x3d\'publishButton\' tabindex\x3d"0" aria-label\x3d"${nls.publishBtnLabel}"\r\n          role\x3d"button"\x3e${nls.publishBtnLabel}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3c!-- Publishing Message --\x3e\r\n      \x3cdiv class\x3d"esriCTPublishMessage" data-dojo-attach-point\x3d"publishMessage"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Visibility/templates/ColorPickerEditor.html":'\x3cdiv class\x3d"esriCTColorPickerEditor"\x3e\r\n  \x3cdiv class\x3d"colorPicker" data-dojo-attach-point\x3d"colorPicker"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTSliderWrapper"\x3e\r\n    \x3cdiv class\x3d"esriCTSliderbar" data-dojo-attach-point\x3d"sliderBar"\x3e\r\n      \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" class\x3d"esriCTSliderLabelHeight" style\x3d"height:2.5em;" container\x3d"topDecoration" data-dojo-attach-point\x3d"sliderBarLabel"\x3e\r\n        \x3cli\x3e${nls.transparency}\x3c/li\x3e\r\n        \x3cli\x3e\x3c/li\x3e\r\n      \x3c/ol\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberSpinner" value\x3d"0" data-dojo-attach-point\x3d"spinner"\r\n    data-dojo-props\x3d"smallDelta:10,intermediateChanges:true,constraints: {min:0,max:100}" aria-label\x3d"${nls.transparency}"\x3e\r\n  \x3cdiv class\x3d"esriCTOutFillSection"\x3e\r\n    \x3clabel for\x3d"${id}_select"\x3e${nls.style}\x3c/label\x3e\r\n    \x3cselect class\x3d"noResize" data-dojo-type\x3d"jimu/dijit/formSelect" aria-label\x3d"${nls.style}" data-dojo-attach-point\x3d"dropdown" /\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Visibility/templates/symbologySettings.html":'\x3cdiv\x3e\r\n       \x3c!-- Visible Section DropDown --\x3e\r\n       \x3cdiv class\x3d"esriCTSettingsRow"\x3e\r\n        \x3cdiv class\x3d"esriCTLabelSettingsRightButton esriCTSettingsButtonIcon esriCTPointer"\r\n          title\x3d"${nls.visibleSectionButtonLabel}" data-dojo-attach-point\x3d"visibleSectionSettingsButton"\r\n          role\x3d"button" aria-label\x3d"${nls.visibleSectionButtonLabel}" tabindex\x3d"0" aria-expanded \x3d"false"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTInputLabelSettings esriCTEllipsis esriCTSubTitle" title\x3d"${nls.visibleSectionLabel}"\x3e\r\n          ${nls.visibleSectionLabel}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3c!-- Visible Section Color Pickers --\x3e\r\n      \x3cdiv class\x3d"container esriCTGroupHidden" data-dojo-attach-point\x3d"visibleSectionContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTEllipsis" title\x3d"${nls.outline}"\x3e${nls.outline}\x3c/div\x3e\r\n        \x3cdiv class\x3d"colorPicker Line" nodeId\x3d"visibleSectionOutlineColor"\r\n          data-dojo-attach-point\x3d"visibleAreaOutlineColorPicker"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTEllipsis" title\x3d"${nls.fill}"\x3e${nls.fill}\x3c/div\x3e\r\n        \x3cdiv class\x3d"colorPicker Fill" nodeId\x3d"visibleSectionFillColor"\r\n          data-dojo-attach-point\x3d"visibleAreaFillColorPicker"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3c!-- Non-visible Section DropDown --\x3e\r\n      \x3cdiv class\x3d"esriCTSettingsRow"\x3e\r\n        \x3cdiv class\x3d"esriCTLabelSettingsRightButton esriCTSettingsButtonIcon esriCTPointer"\r\n        title\x3d"${nls.nonVisibleSectionButtonLabel}" data-dojo-attach-point\x3d"nonVisibleSectionSettingsButton"\r\n        role\x3d"button" aria-label\x3d"${nls.nonVisibleSectionButtonLabel}" tabindex\x3d"0" aria-expanded \x3d"false"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTInputLabelSettings esriCTEllipsis esriCTSubTitle" title\x3d"${nls.nonVisibleSectionLabel}"\x3e${nls.nonVisibleSectionLabel}\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3c!-- Non-visible Section --\x3e\r\n      \x3cdiv class\x3d"container esriCTGroupHidden" data-dojo-attach-point\x3d"nonVisibleSectionContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTEllipsis" title\x3d"${nls.outline}"\x3e${nls.outline}\x3c/div\x3e\r\n        \x3cdiv class\x3d"colorPicker Line" nodeId\x3d"nonVisibleSectionOutlineColor" data-dojo-attach-point\x3d"nonVisibleAreaOutlineColorPicker"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTEllipsis" title\x3d"${nls.fill}"\x3e${nls.fill}\x3c/div\x3e\r\n        \x3cdiv class\x3d"colorPicker Fill" nodeId\x3d"nonVisibleSectionFillColor" data-dojo-attach-point\x3d"nonVisibleAreaFillColorPicker"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e   \r\n\x3c/div\x3e',
"url:widgets/Visibility/Widget.html":"\x3cdiv\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d'visibilityContainer'\x3e\x3c/div\x3e\r\n\x3c/div\x3e","url:widgets/Visibility/css/style.css":".jimu-widget-visibility-control .controls {margin: 20px 0 0 0;}.jimu-widget-visibility-control .inputNumberTextbox {width: calc(100% - 120px) !important; margin: 0px;}.jimu-widget-visibility-control .controlGroup {padding: 4px 2px;}.jimu-widget-visibility-control .buttonContainer {display: flex;}.jimu-widget-visibility-control .controlSpace {margin-left: unset;}.jimu-widget-visibility-control .titleLabel {padding-bottom: 5px; display: block;}.jimu-widget-visibility-control .noResize .dijitSelectLabel,.jimu-widget-visibility-control .noResize .dijitTextBox .dijitInputInner,.jimu-widget-visibility-control .noResize.dijitValidationTextBox .dijitValidationContainer {text-overflow: ellipsis; overflow: hidden; width: 60px; text-align: initial; padding-top: 5px;}.jimu-widget-visibility-control .claro .dijitSelect {background-color: rgba(255, 255, 255, 0);}.jimu-widget-visibility-control .dijitSelect .dijitButtonContents {border-style: none none none none; background-color: #ffffff;}.jimu-widget-visibility-control .dijitSelect .dijitButtonContentsDartTheme {background-color: inherit;}.jimu-widget-visibility-control .dijitSelect .dijitArrowButton {background-color: #ffffff; background-image: none; border-color: #ffffff;}.jimu-widget-visibility-control .dijitSelect .dijitArrowButtonDartTheme {background-color: rgba(0, 0, 0, 0.5) !important;}.jimu-widget-visibility-control .dijitMenuItem {color: #7989a0;}.jimu-widget-visibility-control .dijitSelect .dijitInputField {margin-right: 8px;}.jimu-widget-visibility-control .cursortooltip {z-index: 10; position: fixed; border: 1px solid #777; color: black; background-color: white; margin: 2px; padding: 6px; border-radius: 6px;}.jimu-widget-visibility-control .center {display: table !important; margin: 0 auto;}.jimu-widget-visibility-control .btnContainer {text-align: right; margin-top: 15px; display: grid; padding: 15px 4px;}.jimu-widget-visibility-control .HalfWidthLeft {width: 50%;}.jimu-widget-visibility-control .HalfWidthRight {width: 50%;}.jimu-widget-visibility-control .jimu-coordinate-control textarea {width: 100%;}.jimu-widget-visibility-control .jimu-coordinate-control .add-with-icon.coordInput {width: calc(100% - 60px);}.jimu-widget-visibility-control .jimu-coordinate-control .coordLabel {font-size: 12px;}.jimu-widget-visibility-control .switch-toggle-group {padding: 5px;}.jimu-widget-visibility-control .switch-toggle-group .checkbox-inline {padding-left: 36px; vertical-align: top;}.jimu-widget-visibility-control .switch-toggle-group .switch-toggle.dijitCheckBox {margin-left: -36px;}.jimu-widget-visibility-control .switch-toggle.dijitCheckBox {height: 16px; width: 28px; border: 0 none; background: #adadad; position: relative; float: right; cursor: pointer; -moz-border-radius: 10px; -webkit-border-radius: 10px; border-radius: 10px;}.jimu-rtl .jimu-widget-visibility-control .switch-toggle.dijitCheckBox {float: left;}.jimu-widget-visibility-control .switch-toggle.dijitCheckBox:before {content: \"\"; background: #f8f8f8; position: absolute; padding: 0; height: 12px; width: 12px; left: auto; right: 14px; top: 2px; z-index: 1; -webkit-transition: right 0.3s; -moz-transition: right 0.3s; -o-transition: right 0.3s; transition: right 0.3s; -moz-border-radius: 50%; -webkit-border-radius: 50%; border-radius: 50%;}.jimu-widget-visibility-control .switch-toggle.dijitCheckBox input {width: 100%; height: 100%; position: absolute; left: 0; z-index: 2;}.jimu-widget-visibility-control .switch-toggle.dijitCheckBox.dijitCheckBoxChecked {background: #50ad4e;}.jimu-widget-visibility-control .switch-toggle.dijitCheckBox.dijitCheckBoxChecked:before {right: 2px;}.btnContainer {text-align: right; margin-top: 6px;}.settingsContainer {margin-top: 6px;}.checkBoxText {padding: 0 5px 0 5px;}.controlContainer {margin-top: 6px;}.customFormatTextbox {height: 30px; background-color: transparent; border: 1px solid #d2dae2; padding: 5px; margin: 0 3px 0 3px; width: 55%; font-family: 'Avenir Light', Verdana, Geneva, sans-serif;}.coordNotationSelect {background-color: transparent; height: 30px; user-select: none; width: 40%; float: left; border: 1px solid #d2dae2; font-family: 'Avenir Light', Verdana, Geneva, sans-serif; margin-bottom: 5px;}.jimu-rtl .coordNotationSelect {float: right;}.DartTheme .jimu-widget-visibility-control .cusrortooltip {background-color: #4c4c4c;}.claro .dartThemeClaroDijitTooltipContainerOverride .dijitTooltipContainer {background-color: #4c4c4c; background-image: -webkit-linear-gradient(bottom, rgb(76, 76, 76) 0px, #4c4c4c 10px); border: 1px solid #ffffff; color: #ffffff;}.claro .dartThemeClaroDijitTooltipContainerOverride .jimu-widget-subtitle {color: #ffffff;}.claro .dartThemeClaroDijitTooltipContainerOverride .dijitTooltipConnector {background-image: url('images/tooltip.png');}.jimu-widget-visibility-control .jimu-coordinate-control .settingBtn {margin-left: 1px;}.jimu-widget-visibility-control .jimu-coordinate-control .drawPointBtn {margin-left: 2px;}.jimu-widget-visibility-publish .esriCTFullHeight {height: 100%;}.jimu-widget-visibility-publish .esriCTFullWidth,.jimu-widget-visibility-control .esriCTFullWidth {width: 100%;}.jimu-widget-visibility-publish .esriCTSettingHeader,.jimu-widget-visibility-control .esriCTSettingHeader {height: 30px; border-bottom: 1px solid #464646;}.jimu-widget-visibility-publish .esriCTBackButton,.jimu-widget-visibility-control .esriCTBackButton {display: table; width: 100%;}.jimu-widget-visibility-publish .esriCTItemLeftArrow,.jimu-widget-visibility-control .esriCTItemLeftArrow {background-image: url('./images/left-arrow_black.png'); display: table-cell; width: 20px; height: 20px; background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-visibility-publish .esriCTItemLeftArrow {transform: rotate(180deg);}.jimu-widget-visibility-publish .esriCTItemLeftArrow:hover {background-image: url('./images/left-arrow_black_hover.png');}.jimu-widget-visibility-publish .esriCTTitleDiv,.jimu-widget-visibility-control .esriCTTitleDiv {line-height: 10px; font-weight: bold; text-align: center; width: calc(100% - 50px); height: 20px; padding-top: 6px;}.jimu-widget-visibility-publish .esriCTEllipsis,.jimu-widget-visibility-control .esriCTEllipsis {overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-visibility-publish .esriCTMainPageRow,.jimu-widget-visibility-control .esriCTMainPageRow {width: calc(100% - 20px); margin: 20px 10px 10px 10px; display: inline-block;}.jimu-widget-visibility-publish .esriCTInputLabel {float: left; line-height: 28px; padding: 5px 0px 0px 0px; width: 100%;}.jimu-widget-visibility-publish .SelectStyle {height: 30px; color: #7d7d7d; padding-left: 5px; font-size: 13px; width: 100%; margin: 1px 0 8px 0;}.jimu-widget-visibility-publish .publishSelect .dijitSelectLabel {overflow: hidden; white-space: nowrap; text-overflow: ellipsis; width: 288px; text-align: left;}.jimu-widget-visibility-publish .esriCTCheckBoxNode {padding-top: 10px;}.jimu-widget-visibility-publish .esriCTPublishBtnContainer {text-align: right; margin-top: 15px; display: grid;}.jimu-widget-visibility-publish .esriCTPublishMessage {float: left; line-height: 16px; padding: 18px 0px 0px 0; font-weight: bold; display: inline-block; word-break: break-all;}.jimu-rtl .jimu-widget-visibility-publish .esriCTPublishMessage {float: right;}.jimu-widget-visibility-publish .esriCTHidden {display: none;}.jimu-widget-visiblity .esriCTHidden {display: none;}.jimu-widget-visiblity .jimu-btn {width: 100%;}.jimu-widget-visibility-publish .esriCTPublishControl {float: right; min-width: 9px; line-height: 12px; padding-bottom: 3px; padding-top: 3px;}.jimu-widget-visibility-control .esriCTMainTitleDiv {line-height: 10px; font-weight: bold; text-align: left; width: calc(100% - 50px); padding: 5px 3px 5px 3px; display: inline-block;}.jimu-rtl .jimu-widget-visibility-control .esriCTMainTitleDiv {text-align: right;}.jimu-widget-visibility-control .esriCTSaveToLayerIcon {background-image: url('./images/left-arrow_black.png'); width: 20px; height: 20px; background-repeat: no-repeat; background-position: center center; cursor: pointer; transform: rotate(180deg);}.jimu-rtl .jimu-widget-visibility-control .esriCTSaveToLayerIcon {float: left; transform: rotate(360deg);}.jimu-widget-visibility-control .esriCTSaveToLayerIcon:hover {background-image: url('./images/left-arrow_black_hover.png'); background-repeat: no-repeat;}.jimu-widget-visibility-control .esriCTNewHeader {float: left; height: 30px; border-bottom: 1px solid #464646; padding: 0px 2px;}.jimu-widget-visibility-control .esriCTSliderWrapper {width: calc(100% - 278px); display: inline-block; margin: 5px;}.jimu-widget-visibility-control .dijitSlider {width: 100%;}.jimu-rtl .jimu-widget-visibility-control .dijitSlider {margin-left: auto; margin-right: 10px;}.jimu-widget-visibility-control .dijitSlider .dijitSliderImageHandleH {top: -10px; width: 20px; height: 20px;}.jimu-widget-visibility-control .esriCTColorPickerEditor {padding-top: 5px; padding-bottom: 8px; min-width: 350px; display: inline-table;}.jimu-widget-visibility-control .esriCTColorPickerEditor .jimu-color-picker {display: inline-block; width: 25px; height: 25px;}.jimu-widget-visibility-control .esriCTColorPickerEditor .dijitSpinner.dijitNumberTextBox.dijitValidationTextBox {width: 70px; height: 30px;}.jimu-widget-visibility-control .dijitSliderImageHandleH {top: -7px;}.jimu-widget-visibility-control .dijitSliderThumbHover {background-image: url(\"../images/sliderball.svg\"); background-position: 0 0;}.jimu-widget-visibility-control .dijitSliderImageHandle.dijitSliderImageHandleH {background-image: url(\"../images/sliderball.svg\"); background-position: 0 0;}.jimu-widget-visibility-control .dijitSliderImageHandle.dijitSliderImageHandleH.dojoMoveItem {background-image: url(\"../images/sliderball.svg\"); background-position: 0 0;}.jimu-widget-visibility-control .dijitSlider .dijitSliderProgressBarH,.jimu-widget-visibility-control .dijitSlider .dijitSliderLeftBumper {border-color: #000; background-color: #000; background-image: -webkit-linear-gradient(top, #000 0px, #000 1px, rgba(255, 255, 255, 0) 2px); background-image: -o-linear-gradient(top, #000 0px, #000 1px, rgba(255, 255, 255, 0) 2px); background-image: linear-gradient(top, #000 0px, #000 1px, rgba(255, 255, 255, 0) 2px);}.jimu-widget-visibility-control .dijitSlider .dijitSliderRemainingBarH,.jimu-widget-visibility-control .dijitSlider .dijitSliderRightBumper {border-color: #d7d7d7; background-color: #d7d7d7;}.jimu-widget-visibility-control .esriCTColorPickerEditor .trans {font-family: \"Avenir Light\"; font-size: 12px; padding: 0 5px 0 5px; letter-spacing: 0.33px;}.jimu-widget-visibility-control .sliderbar {width: 60px;}.dijitRuleLabelH {left: -12%;}.jimu-widget-visibility-control .esriCTOutFillSection {vertical-align: middle; display: inline-flex; flex-direction: column; margin: 0px 0px 14px 3px;}.jimu-rtl .jimu-widget-visibility-control .esriCTOutFillSection {margin: 0px 3px 14px 0px;}.jimu-widget-visibility-symbologySettings .esriCTSettingsRow {width: 100%; display: inline-flex;}.jimu-widget-visibility-symbologySettings .esriCTLabelSettingsRightButton {background: url(\"../images/arrow-right_black.png\") no-repeat;}.jimu-rtl .jimu-widget-visibility-symbologySettings .esriCTLabelSettingsRightButton {transform: rotate(180deg);}.jimu-widget-visibility-symbologySettings .esriCTLabelSettingsRightButton:hover {background: url(\"../images/arrow-right_black_hover.png\") no-repeat;}.jimu-widget-visibility-symbologySettings .esriCTSettingsButtonIcon {margin-top: 13px; height: 16px; width: 16px;}.jimu-rtl .jimu-widget-visibility-symbologySettings .esriCTSettingsButtonIcon {margin: 10px 0px 0px 5px;}.jimu-widget-visibility-symbologySettings .esriCTPointer {cursor: pointer;}.jimu-widget-visibility-symbologySettings .esriCTInputLabelSettings {float: left; line-height: 28px; padding: 5px 0px 0px 0px;}.jimu-widget-visibility-symbologySettings .esriCTEllipsis {overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-visibility-symbologySettings .esriCTSubTitle {font-weight: bold;}.jimu-widget-visibility-symbologySettings .esriCTGroupHidden {display: none;}.jimu-widget-visibility-symbologySettings .esriCTLabelSettingsDownButton {background: url(\"../images/arrow-down_black.png\") no-repeat; margin-top: 15px;}.jimu-rtl .jimu-widget-visibility-symbologySettings .esriCTLabelSettingsDownButton {margin: 15px 0px 0px 5px;}.jimu-widget-visibility-symbologySettings .esriCTLabelSettingsDownButton:hover {background: url(\"../images/arrow-down_black_hover.png\") no-repeat;}.jimu-widget-visibility-control .esriCTSettingsIcon {background-image: url('./images/settings_black.png'); height: 16px; width: 16px; background-size: 16px; background-repeat: no-repeat; margin-top: 2px; margin-right: 13px; display: inline-block;}.jimu-rtl .jimu-widget-visibility-control .esriCTSettingsIcon {float: left;}.jimu-widget-visibility-control .esriCTSettingsIcon:hover {background-image: url('./images/settings_black_hover.png'); background-repeat: no-repeat;}.jimu-widget-visibility-symbologySettings .esriCTSettingsButtonIcon:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px;}.jimu-widget-visibility-control .esriCTRightSideButton {float: right; display: inline-flex;}.jimu-rtl .jimu-widget-visibility-control .esriCTRightSideButton {float: left;}.DashboardTheme.light .jimu-widget-visibility-control .settingBtn {background-image: url(./images/settings_black.png);}.DashboardTheme.light .jimu-widget-visibility-control .settingBtn:hover {background-image: url(./images/settings_black_hover.png);}",
"*now":function(H){H(['dojo/i18n!*preload*widgets/Visibility/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/topic dojo/dom-attr jimu/BaseWidget dijit/_WidgetsInTemplateMixin jimu/dijit/Message jimu/utils ./js/VisibilityControl ./js/PrivilegeUtil".split(" "),function(H,k,n,r,m,l,b,a,c,f,e){return H([l,b],{baseClass:"jimu-widget-visiblity",privilegeUtil:null,_visibilityControl:null,postMixInProperties:function(){this.nls=n.mixin(this.nls,window.jimuNls.coordinateControl)},destroy:function(){if(this._visibilityControl)this._visibilityControl.onClearBtnClicked();
this.inherited(arguments)},resize:function(){r.publish("WIDGET_RESIZE",{})},startup:function(){this.inherited(arguments);this.config.portalUrl?(this.config.hasOwnProperty("defaultObserverHeightUnit")||(this.config.defaultObserverHeightUnit="meters"),this.config.hasOwnProperty("defaultObservableDistanceUnit")||(this.config.defaultObservableDistanceUnit="kilometers"),this.config.hasOwnProperty("defaultAngleUnits")||(this.config.defaultAngleUnits=!1),this.privilegeUtil=e.getInstance(this.config.portalUrl),
this.privilegeUtil.loadPrivileges().then(n.hitch(this,this._validatePrivileges),n.hitch(this,this._showError))):this._showError(this.nls.portalURLError)},_validatePrivileges:function(g){g&&this.privilegeUtil._canPerformElevationAnalysis()?this._createVisibilityControl():this._showError()},_showError:function(g){g||(g=this.nls.privilegeError,this.privilegeUtil._isServiceAvailable||(g=this.nls.noServiceError));new a({message:g});m.set(this.visibilityContainer,"innerHTML",g)},_createVisibilityControl:function(){var g=
this.privilegeUtil.getUserPortal();!this._visibilityControl&&g&&(this._visibilityControl=(new f({config:this.config,parentWidget:this,nls:this.nls,appConfig:this.appConfig,portalUrl:g,pointSymbol:{color:[255,0,0,64],size:12,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,0,0,255],width:1,type:"esriSLS",style:"esriSLSSolid"}},map:this.map},k.create("div"))).placeAt(this.visibilityContainer),this._visibilityControl.startup(),this._setTheme())},_removeStyleFile:function(g,d){var h=null;h="js"===
d?"src":"css"===d?"href":"none";d=document.getElementsByTagName("js"===d?"script":"css"===d?"link":"none");for(var p=d.length;0<=p;p--)d[p]&&null!==d[p].getAttribute(h)&&-1!==d[p].getAttribute(h).indexOf(g)&&d[p].parentNode.removeChild(d[p])},_setTheme:function(){"DartTheme"===this.appConfig.theme.name?c.loadStyleLink("dartOverrideCSS",this.folderUrl+"css/dartTheme.css",null):this._removeStyleFile(this.folderUrl+"css/dartTheme.css","css");"DashboardTheme"===this.appConfig.theme.name?c.loadStyleLink("dashboardOverrideCSS",
this.folderUrl+"css/dashboardTheme.css",null):this._removeStyleFile(this.folderUrl+"css/dashboardTheme.css","css");"LaunchpadTheme"===this.appConfig.theme.name?c.loadStyleLink("launchpadOverrideCSS",this.folderUrl+"css/launchpadTheme.css",null):this._removeStyleFile(this.folderUrl+"css/launchpadTheme.css","css");"BoxTheme"===this.appConfig.theme.name?c.loadStyleLink("boxOverrideCSS",this.folderUrl+"css/boxTheme.css",null):this._removeStyleFile(this.folderUrl+"css/boxTheme.css","css")}})});